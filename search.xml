<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Hi，很高兴见到你~</title>
      <link href="/2048/10/24/hello-world/"/>
      <url>/2048/10/24/hello-world/</url>
      
        <content type="html"><![CDATA[<p>欢迎<a href="/2048/10/24/hello-world/">在此</a>留言，或者去<a href="/friends/">友链</a>看看大家 ~</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Node 中间件原理</title>
      <link href="/2020/03/20/node-middleware/"/>
      <url>/2020/03/20/node-middleware/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Koa 和 Express 的设计风格非常类似，底层也都是共用的同一套 HTTP 基础库，但是有几个显著的区别，除了上面提到的默认异步解决方案之外，主要的特点还有下面几个。</p></blockquote><a id="more"></a><h2 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h2><p>Koa 的中间件和 Express 不同，Koa 选择了洋葱圈模型。</p><p><img src="https://ae01.alicdn.com/kf/H6d60d151712d4e1e8dfc887f5839c7ecz.png" alt="中间件洋葱图"></p><p>所有的请求经过一个中间件的时候都会执行两次，对比 Express 形式的中间件，Koa 的模型可以非常方便的实现后置处理逻辑，对比 Koa 和 Express 的 Compress 中间件就可以明显的感受到 Koa 中间件模型的优势。</p><h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><p>和 Express 只有 Request 和 Response 两个对象不同，Koa 增加了一个 Context 的对象，作为这次请求的上下文对象（在 Koa 1 中为中间件的 this，在 Koa 2 中作为中间件的第一个参数传入）。</p><p>我们可以将一次请求相关的上下文都挂载到这个对象上。类似 traceId 这种需要贯穿整个请求（在后续任何一个地方进行其他调用都需要用到）的属性就可以挂载上去。相较于 request 和 response 而言更加符合语义。</p><p>同时 Context 上也挂载了 Request 和 Response 两个对象。和 Express 类似，这两个对象都提供了大量的便捷方法辅助开发，例如</p><ul><li>get request.query</li><li>get request.hostname</li><li>set response.body</li><li>set response.status</li></ul><h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><p>通过同步方式编写异步代码带来的另外一个非常大的好处就是异常处理非常自然，使用 <code>try catch</code> 就可以将按照规范编写的代码中的所有错误都捕获到。这样我们可以很便捷的编写一个自定义的错误处理中间件。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">onerror</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> next();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    ctx.app.emit(<span class="string">"error"</span>, err);</span><br><span class="line">    ctx.body = <span class="string">"server error"</span>;</span><br><span class="line">    ctx.status = err.status || <span class="number">500</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>只需要将这个中间件放在其他中间件之前，就可以捕获它们所有的同步或者异步代码中抛出的异常了。</p><p>注：以上所有皆来自<a href="https://eggjs.org/zh-cn/intro/egg-and-koa.html" target="_blank" rel="noopener">Egg.js 与 Koa</a></p><h2 id="中间件模拟"><a href="#中间件模拟" class="headerlink" title="中间件模拟"></a>中间件模拟</h2><h3 id="Express"><a href="#Express" class="headerlink" title="Express"></a>Express</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">const</span> slice = <span class="built_in">Array</span>.prototype.slice;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LikeExpress</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="comment">// 存放中间件的列表</span></span><br><span class="line">    <span class="keyword">this</span>.routes = &#123;</span><br><span class="line">      all: [], <span class="comment">// app.use(...)</span></span><br><span class="line">      get: [], <span class="comment">// app.get(...)</span></span><br><span class="line">      post: [] <span class="comment">// app.post(...)</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  register(path) &#123;</span><br><span class="line">    <span class="keyword">const</span> info = &#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> path === <span class="string">"string"</span>) &#123;</span><br><span class="line">      info.path = path;</span><br><span class="line">      <span class="comment">// 从第二个参数开始，转换为数组，存入 stack</span></span><br><span class="line">      info.stack = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      info.path = <span class="string">"/"</span>;</span><br><span class="line">      <span class="comment">// 从第一个参数开始，转换为数组，存入 stack</span></span><br><span class="line">      info.stack = slice.call(<span class="built_in">arguments</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> info;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  use() &#123;</span><br><span class="line">    <span class="keyword">const</span> info = <span class="keyword">this</span>.register.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">this</span>.routes.all.push(info);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  get() &#123;</span><br><span class="line">    <span class="keyword">const</span> info = <span class="keyword">this</span>.register.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">this</span>.routes.get.push(info);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  post() &#123;</span><br><span class="line">    <span class="keyword">const</span> info = <span class="keyword">this</span>.register.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">this</span>.routes.post.push(info);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  match(method, url) &#123;</span><br><span class="line">    <span class="keyword">let</span> stack = [];</span><br><span class="line">    <span class="keyword">if</span> (url === <span class="string">"/favicon.ico"</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> stack;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 routes</span></span><br><span class="line">    <span class="keyword">let</span> curRoutes = [];</span><br><span class="line">    curRoutes = curRoutes.concat(<span class="keyword">this</span>.routes.all);</span><br><span class="line">    curRoutes = curRoutes.concat(<span class="keyword">this</span>.routes[method]);</span><br><span class="line"></span><br><span class="line">    curRoutes.forEach(<span class="function"><span class="params">routeInfo</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (url.indexOf(routeInfo.path) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// url === '/api/get-cookie' 且 routeInfo.path === '/'</span></span><br><span class="line">        <span class="comment">// url === '/api/get-cookie' 且 routeInfo.path === '/api'</span></span><br><span class="line">        <span class="comment">// url === '/api/get-cookie' 且 routeInfo.path === '/api/get-cookie'</span></span><br><span class="line">        stack = stack.concat(routeInfo.stack);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> stack;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 核心的 next 机制</span></span><br><span class="line">  handle(req, res, stack) &#123;</span><br><span class="line">    <span class="keyword">const</span> next = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 拿到第一个匹配的中间件</span></span><br><span class="line">      <span class="keyword">const</span> middleware = stack.shift();</span><br><span class="line">      <span class="keyword">if</span> (middleware) &#123;</span><br><span class="line">        <span class="comment">// 执行中间件函数</span></span><br><span class="line">        middleware(req, res, next);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  callback() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">      res.json = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        res.setHeader(<span class="string">"Content-type"</span>, <span class="string">"application/json"</span>);</span><br><span class="line">        res.end(<span class="built_in">JSON</span>.stringify(data));</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">const</span> url = req.url;</span><br><span class="line">      <span class="keyword">const</span> method = req.method.toLowerCase();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> resultList = <span class="keyword">this</span>.match(method, url);</span><br><span class="line">      <span class="keyword">this</span>.handle(req, res, resultList);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  listen(...args) &#123;</span><br><span class="line">    <span class="keyword">const</span> server = http.createServer(<span class="keyword">this</span>.callback());</span><br><span class="line">    server.listen(...args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工厂函数</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> LikeExpress();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="Koa"><a href="#Koa" class="headerlink" title="Koa"></a>Koa</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合中间件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params">middlewareList</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">ctx</span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> fn = middlewareList[i];</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(</span><br><span class="line">          fn(ctx, dispatch.bind(<span class="literal">null</span>, i + <span class="number">1</span>)) <span class="comment">// promise</span></span><br><span class="line">        );</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dispatch(<span class="number">0</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LikeKoa2</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.middlewareList = [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  use(fn) &#123;</span><br><span class="line">    <span class="keyword">this</span>.middlewareList.push(fn);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  createContext(req, res) &#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = &#123;</span><br><span class="line">      req,</span><br><span class="line">      res</span><br><span class="line">    &#125;;</span><br><span class="line">    ctx.query = req.query;</span><br><span class="line">    <span class="keyword">return</span> ctx;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleRequest(ctx, fn) &#123;</span><br><span class="line">    <span class="keyword">return</span> fn(ctx);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  callback() &#123;</span><br><span class="line">    <span class="keyword">const</span> fn = compose(<span class="keyword">this</span>.middlewareList);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> ctx = <span class="keyword">this</span>.createContext(req, res);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.handleRequest(ctx, fn);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  listen(...args) &#123;</span><br><span class="line">    <span class="keyword">const</span> server = http.createServer(<span class="keyword">this</span>.callback());</span><br><span class="line">    server.listen(...args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = LikeKoa2;</span><br></pre></td></tr></table></figure><h2 id="项目实践"><a href="#项目实践" class="headerlink" title="项目实践"></a>项目实践</h2><p><a href="https://github.com/yangtao2o/node-blog-express-koa2" target="_blank" rel="noopener">Node.js 从零开发 web server博客项目，并使用express、koa2重构</a></p>]]></content>
      
      
      <categories>
          
          <category> Nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cookie、Session、LocalStorage、SessionStorage</title>
      <link href="/2020/03/20/cookie-session/"/>
      <url>/2020/03/20/cookie-session/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Session 是在服务端保存的一个数据结构，用来跟踪用户的状态，这个数据可以保存在集群、数据库、文件中；<br>Cookie 是客户端保存用户信息的一种机制，用来记录用户的一些信息，也是实现 Session 的一种方式；<br>LocalStorage 是 Web Storage API 的一种类型，能在浏览器端存储键值对数据；<br>SessionStorage 只存储当前会话页(tab 页)的数据，一旦用户关闭当前页或者浏览器，数据就自动被清除掉了。</p></blockquote><a id="more"></a><h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p>在网站中，http 请求是无状态的。也就是说即使第一次和服务器连接后并且登录成功后，第二次请求服务器依然不能知道当前请求是哪个用户。</p><p>cookie 的出现就是为了解决这个问题，第一次登录后服务器返回一些数据（cookie）给浏览器，然后浏览器保存在本地，当该用户发送第二次请求的时候，就会自动的把上次请求存储的 cookie 数据自动的携带给服务器，服务器通过浏览器携带的数据就能判断当前用户是哪个了。</p><p>cookie 存储的数据量有限，不同的浏览器有不同的存储大小，但一般不超过 4KB。因此使用 cookie 只能存储一些小量的数据。</p><p><strong>Cookie 的优点：</strong></p><ul><li>能用于和服务端通信</li><li>当 cookie 快要自动过期时，我们可以重新设置而不是删除</li></ul><p><strong>Cookie 缺点：</strong></p><ul><li>增加了文档传输的负载</li><li>只能存储少量的数据</li><li>只能存储字符串</li><li>潜在的 安全问题（通过服务端设置 httpOnly）</li></ul><p>解决办法：Web Storage API (Local and Session Storage)。</p><p>创建，读取，更新和删除 Cookie：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取</span></span><br><span class="line"><span class="built_in">document</span>.cookie;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改/更新</span></span><br><span class="line"><span class="built_in">document</span>.cookie = <span class="string">"testname=Yangtao"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除，设置expires的过期时间</span></span><br><span class="line"><span class="built_in">document</span>.cookie = <span class="string">"testname=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"</span>;</span><br></pre></td></tr></table></figure><p>客户端设置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> getAndSetCookie = &#123;</span><br><span class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.checkCookie();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 设置cookie，同一域名都可获取</span></span><br><span class="line">    setCookie: <span class="function"><span class="keyword">function</span>(<span class="params">name, value, exdays</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> exdays = exdays || <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">      d.setTime(d.getTime() + exdays * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">      <span class="built_in">document</span>.cookie =</span><br><span class="line">        name + <span class="string">"="</span> + <span class="built_in">escape</span>(value) + <span class="string">";path=/;expires="</span> + d.toGMTString();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 读取cookies，判断是否存在设置的name</span></span><br><span class="line">    getCookie: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> name = name + <span class="string">"="</span>;</span><br><span class="line">      <span class="keyword">var</span> ca = <span class="built_in">document</span>.cookie.split(<span class="string">";"</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; ca.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> c = ca[i].trim();</span><br><span class="line">        <span class="keyword">if</span> (c.indexOf(name) == <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> c.substring(name.length, c.length);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    checkCookie: <span class="function"><span class="keyword">function</span>(<span class="params">pc</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> user = <span class="keyword">this</span>.getCookie(<span class="string">"msgCookie"</span>);</span><br><span class="line">      <span class="keyword">if</span> (user == <span class="string">""</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.setCookie(<span class="string">"msgCookie"</span>, <span class="string">"msgCookie"</span>, <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// init</span></span><br><span class="line">  getAndSetCookie.init();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>Node 设置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 cookie 过期时间</span></span><br><span class="line"><span class="keyword">const</span> getCookieExpires = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">d.setTime(d.getTime() + <span class="number">24</span> _ <span class="number">60</span> _ <span class="number">60</span> \* <span class="number">1000</span>);</span><br><span class="line"><span class="keyword">return</span> d.toGMTString();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置</span></span><br><span class="line">res.setHeader(</span><br><span class="line"><span class="string">"Set-Cookie"</span>,</span><br><span class="line"><span class="string">`username=<span class="subst">$&#123;data.username&#125;</span>; path=/; httpOnly; expires=<span class="subst">$&#123;getCookieExpires()&#125;</span>`</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析 cookie</span></span><br><span class="line">req.cookie = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> cookieStr = req.headers.cookie || <span class="string">""</span>; <span class="comment">// "k1=v1; k2=v2; k3=v3"</span></span><br><span class="line">cookieStr.split(<span class="string">";"</span>).forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!item) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> str = item.split(<span class="string">"="</span>);</span><br><span class="line">  <span class="keyword">const</span> key = str[<span class="number">0</span>].trim();</span><br><span class="line">  <span class="keyword">const</span> val = str[<span class="number">1</span>].trim();</span><br><span class="line"></span><br><span class="line">  req.cookie[key] = val;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><p>session 和 cookie 的作用有点类似，都是为了存储用户相关的信息。不同的是，cookie 是存储在本地浏览器，而 session 存储在服务器。</p><p>存储在服务器的数据会更加的安全，不容易被窃取。但存储在服务器也有一定的弊端，就是会占用服务器的资源，所以就用到了 redis。</p><p><strong>Session 的问题：</strong></p><ul><li>session 是一个变量存在 nodejs 进程内存中</li><li>进程内存有限，访问量过大，内存容易暴增</li><li>线上多为多进程，进程间内存无法共享</li><li>可以借助 redis 解决</li></ul><h2 id="Cookie-Session"><a href="#Cookie-Session" class="headerlink" title="Cookie+Session"></a>Cookie+Session</h2><p>cookie 和 session 的使用已经出现了一些非常成熟的方案。在如今的市场或者企业里，一般有两种存储方式：</p><p><strong>1、存储在服务端</strong></p><p>通过 cookie 存储一个 session_id，然后具体的数据则是保存在 session 中。如果用户已经登录，则服务器会在 cookie 中保存一个 session_id，下次再次请求的时候，会把该 session_id 携带上来，服务器根据 session_id 在 session 库中获取用户的 session 数据。就能知道该用户到底是谁，以及之前保存的一些状态信息。这种专业术语叫做 <code>server side session</code>。</p><p><strong>2、将 session 数据加密，然后存储在 cookie 中</strong></p><p>这种专业术语叫做 <code>client side session</code>。</p><p><strong>总结：</strong></p><ul><li>存储在浏览器的一段字符串</li><li>跨域不共享</li><li>可以存储结构化数据，格式为：”k1=v1; k2=v2; k3=v3”</li><li>浏览器可以使用 JavaScript 修改 cookie（有限制）</li><li>每次发送 http 请求，都将请求域的 cookie 一起发给 server</li><li>server 可以修改 cookie，并返给浏览器</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> SESSION_DATA = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> needSetCookie = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serverHandle = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 解析 session</span></span><br><span class="line">  <span class="keyword">let</span> userId = req.cookie.userid;</span><br><span class="line">  <span class="keyword">if</span> (userId) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!SESSION_DATA[userId]) &#123;</span><br><span class="line">      SESSION_DATA[userId] = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    needSetCookie = <span class="literal">true</span>;</span><br><span class="line">    userId = <span class="string">`<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>_<span class="subst">$&#123;<span class="built_in">Math</span>.random()&#125;</span>`</span>;</span><br><span class="line">    SESSION_DATA[userId] = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  req.session = SESSION_DATA[userId];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 操作 cookie</span></span><br><span class="line">  <span class="keyword">if</span> (needSetCookie) &#123;</span><br><span class="line">    res.setHeader(</span><br><span class="line">      <span class="string">"Set-Cookie"</span>,</span><br><span class="line">      <span class="string">`userid=<span class="subst">$&#123;userId&#125;</span>; path=/; httpOnly; expires=<span class="subst">$&#123;getCookieExpires()&#125;</span>`</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取username并赋值</span></span><br><span class="line">  <span class="keyword">if</span> (data.username) &#123;</span><br><span class="line">    req.session.username = data.username;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SuccessModel();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 然后返回</span></span><br><span class="line">  <span class="keyword">if</span> (req.session.username) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(</span><br><span class="line">      <span class="keyword">new</span> SuccessModel(&#123;</span><br><span class="line">        session: req.session</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>详细内容：</strong><a href="https://github.com/yangtao2o/node-blog-express-koa2/blob/master/docs/signin.md" target="_blank" rel="noopener">登录</a></p><h2 id="LocalStorage"><a href="#LocalStorage" class="headerlink" title="LocalStorage"></a>LocalStorage</h2><p>Local Storage 是 Web Storage API 的一种类型，能在浏览器端存储键值对数据。</p><p>Local Storage 因提供了更直观和安全的 API 来存储简单的数据，被视为替代 Cookies 的一种解决方案。从技术上说，尽管 Local Storage 只能存储字符串，但是它也是可以存储字符串化的 JSON 数据。这就意味着，Local Storage 能比 Cookies 存储更复杂的数据。</p><p>创建，读取，更新和删除 Local Storage：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create</span></span><br><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">name</span>: <span class="string">"Bob"</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;;</span><br><span class="line">localStorage.setItem(<span class="string">"user"</span>, <span class="built_in">JSON</span>.stringify(user));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Read (Single)</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.parse(localStorage.getItem(<span class="string">"user"</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update</span></span><br><span class="line"><span class="keyword">const</span> updatedUser = &#123; <span class="attr">name</span>: <span class="string">"Bob"</span>, <span class="attr">age</span>: <span class="number">24</span> &#125;;</span><br><span class="line"></span><br><span class="line">localStorage.setItem(<span class="string">"user"</span>, <span class="built_in">JSON</span>.stringify(updatedUser));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delete</span></span><br><span class="line">localStorage.removeItem(<span class="string">"user"</span>);</span><br></pre></td></tr></table></figure><p><strong>Local Storage 的优点：</strong>相比于 Cookie，其提供了更直观地接口来存储数据更安全,能存储更多数据。</p><p><strong>Local Storage 的缺点：</strong>只能存储字符串数据，浏览器支持<code>IE8+/Edge/Firefox 2+/Chrome/Safari 4+/Opera 11.5+(caniuse)</code></p><h2 id="SessionStorage"><a href="#SessionStorage" class="headerlink" title="SessionStorage"></a>SessionStorage</h2><p>Session Storage 和 Local Storage 非常类似，区别是 Session Storage 只存储当前会话页(tab 页)的数据，一旦用户关闭当前页或者浏览器，数据就自动被清除掉了。</p><p>创建，读取，更新和删除 Session Storage：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create</span></span><br><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">name</span>: <span class="string">'Bob'</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;sessionStorage.setItem(<span class="string">'user'</span>, <span class="built_in">JSON</span>.stringify(user))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Read (Single)</span></span><br><span class="line"><span class="built_in">console</span>.log( <span class="built_in">JSON</span>.parse(sessionStorage.getItem(<span class="string">'user'</span>)) )</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update</span></span><br><span class="line"><span class="keyword">const</span> updatedUser = &#123; <span class="attr">name</span>: <span class="string">'Bob'</span>, <span class="attr">age</span>: <span class="number">24</span> &#125;</span><br><span class="line"></span><br><span class="line">sessionStorage.setItem(<span class="string">'user'</span>, <span class="built_in">JSON</span>.stringify(updatedUser))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delete</span></span><br><span class="line">sessionStorage.removeItem(<span class="string">'user'</span>)</span><br></pre></td></tr></table></figure><p>sessionStorage、localStorage、cookie 都是在浏览器端存储的数据。</p><p>其中，sessionStorage 的概念很特别，引入了一个“浏览器窗口”的概念，sessionStorage 是在同源的同窗口中，始终存在的数据，也就是说只要这个浏览器窗口没有关闭，即使刷新页面或进入同源另一个页面，数据仍然存在，关闭窗口后 sessionStorage 就会被销毁，同时“独立”打开的不同窗口，即使同一页面，sessionStorage 对象也是不同的。</p><h2 id="客户端存储方式异同"><a href="#客户端存储方式异同" class="headerlink" title="客户端存储方式异同"></a>客户端存储方式异同</h2><p><strong>cookie，sessionStorage 和 localStorage 的区别？</strong></p><ul><li>cookie 是网站为了标示用户身份而储存在用户本地终端（Client Side）上 的数据（通常经过加密）- cookie 数据始终在同源的 http 请求中携带（即使不需要），记会在浏 览器和服务器间来回传递</li><li>sessionStorage 和 localStorage 不会自动把数据发给服务器，仅在本地 保存</li></ul><p><strong>存储大小：</strong></p><ul><li>cookie 数据大小不能超过 4k</li><li>sessionStorage 和 localStorage 虽然也有存储大小的限制，但比 cookie 大得多，可以达到 5M 或更大</li></ul><p><strong>有效期（生命周期）：</strong></p><ul><li>localStorage: 存储持久数据，浏览器关闭后数据不丢失，除非主动删除数据</li><li>sessionStorage: 数据在当前浏览器窗口关闭后自动删除</li><li>cookie: 设置的 cookie 过期时间之前一直有效，即使窗口或浏览器关闭</li></ul><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li>自己博客项目中<a href="https://github.com/yangtao2o/node-blog-express-koa2/blob/master/docs/signin.md" target="_blank" rel="noopener">什么是 cookie</a></li><li><a href="https://www.zhihu.com/question/19786827" target="_blank" rel="noopener">COOKIE 和 SESSION 有什么区别？</a></li><li><a href="https://baijiahao.baidu.com/s?id=1652697788741886713&amp;wfr=spider&amp;for=pc" target="_blank" rel="noopener">浅谈 cookie，sessionStorage，localStorage</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络知识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> http </tag>
            
            <tag> web </tag>
            
            <tag> cookie </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Understanding JavaScript Bind ()</title>
      <link href="/2020/03/16/js-bind/"/>
      <url>/2020/03/16/js-bind/</url>
      
        <content type="html"><![CDATA[<blockquote><p>如何将“this”的上下文保留在另一个函数中？我们可能会需要使用<code>Function.prototype.bind()</code>。资料地址：<a href="https://www.smashingmagazine.com/2014/01/understanding-javascript-function-prototype-bind/" target="_blank" rel="noopener">Understanding JavaScript Bind ()</a></p></blockquote><a id="more"></a>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React 设计思想【转载】</title>
      <link href="/2020/03/16/react-design-ideass/"/>
      <url>/2020/03/16/react-design-ideass/</url>
      
        <content type="html"><![CDATA[<blockquote><p>译者序：本文是 React 核心开发者、有 React API 终结者之称的 Sebastian Markbåge 撰写，阐述了他设计 React 的初衷。阅读此文，你能站在更高的高度思考 React 的过去、现在和未来。<br>原文地址：<a href="https://github.com/reactjs/react-basic" target="_blank" rel="noopener">https://github.com/reactjs/react-basic</a></p></blockquote><a id="more"></a><p>我写此文是想正式地阐述我心中 React 的<a href="http://baike.baidu.com/view/2333986.htm" target="_blank" rel="noopener">心智模型</a>。目的是解释为什么我们会这样设计 React，同时你也可以根据这些论点反推出 React。</p><p>不可否认，此文中的部分论据或前提尚存争议，而且部分示例的设计可能存在 bug 或疏忽。这只是正式确定它的最初阶段。如果你有更好的完善它的想法可以随时提交 pull request。本文不会介绍框架细节中的奇技淫巧，相信这样能提纲挈领，让你看清 React 由简单到复杂的设计过程。</p><p>React.js 的真实实现中充满了具体问题的解决方案，渐进式的解法，算法优化，历史遗留代码，debug 工具以及其他一些可以让它真的具有高可用性的内容。这些代码可能并不稳定，因为未来浏览器的变化和功能权重的变化随时面临改变。所以具体的代码很难彻底解释清楚。</p><p>我偏向于选择一种我能完全 hold 住的简洁的心智模型来作介绍。</p><h2 id="变换（Transformation）"><a href="#变换（Transformation）" class="headerlink" title="变换（Transformation）"></a>变换（Transformation）</h2><p>设计 React 的核心前提是认为 UI 只是把数据通过映射关系变换成另一种形式的数据。同样的输入必会有同样的输出。这恰好就是纯函数。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NameBox</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">fontWeight</span>: <span class="string">"bold"</span>, <span class="attr">labelContent</span>: name &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&apos;Sebastian Markbåge&apos; -&gt;</span><br><span class="line">&#123; fontWeight: &apos;bold&apos;, labelContent: &apos;Sebastian Markbåge&apos; &#125;;</span><br></pre></td></tr></table></figure><h2 id="抽象（Abstraction）"><a href="#抽象（Abstraction）" class="headerlink" title="抽象（Abstraction）"></a>抽象（Abstraction）</h2><p>你不可能仅用一个函数就能实现复杂的 UI。重要的是，你需要把 UI 抽象成多个隐藏内部细节，又可复用的函数。通过在一个函数中调用另一个函数来实现复杂的 UI，这就是抽象。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyUserBox</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    borderStyle: <span class="string">"1px solid blue"</span>,</span><br><span class="line">    childContent: [<span class="string">"Name: "</span>, NameBox(user.firstName + <span class="string">" "</span> + user.lastName)]</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123; firstName: &apos;Sebastian&apos;, lastName: &apos;Markbåge&apos; &#125; -&gt;</span><br><span class="line">&#123;</span><br><span class="line">  borderStyle: &apos;1px solid blue&apos;,</span><br><span class="line">  childContent: [</span><br><span class="line">    &apos;Name: &apos;,</span><br><span class="line">    &#123; fontWeight: &apos;bold&apos;, labelContent: &apos;Sebastian Markbåge&apos; &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="组合（Composition）"><a href="#组合（Composition）" class="headerlink" title="组合（Composition）"></a>组合（Composition）</h2><p>为了真正达到重用的特性，只重用叶子然后每次都为他们创建一个新的容器是不够的。你还需要可以包含其他抽象的容器再次进行组合。我理解的“组合”就是将两个或者多个不同的抽象合并为一个。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyBox</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    borderStyle: <span class="string">"1px solid blue"</span>,</span><br><span class="line">    children: children</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UserBox</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox([<span class="string">"Name: "</span>, NameBox(user.firstName + <span class="string">" "</span> + user.lastName)]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="状态（State）"><a href="#状态（State）" class="headerlink" title="状态（State）"></a>状态（State）</h2><p>UI 不单单是对服务器端或业务逻辑状态的复制。实际上还有很多状态是针对具体的渲染目标。举个例子，在一个 text field 中打字。它不一定要复制到其他页面或者你的手机设备。滚动位置这个状态是一个典型的你几乎不会复制到多个渲染目标的。</p><p>我们倾向于使用不可变的数据模型。我们把可以改变 state 的函数串联起来作为原点放置在顶层。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyNameBox</span>(<span class="params">user, likes, onClick</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox([</span><br><span class="line">    <span class="string">"Name: "</span>,</span><br><span class="line">    NameBox(user.firstName + <span class="string">" "</span> + user.lastName),</span><br><span class="line">    <span class="string">"Likes: "</span>,</span><br><span class="line">    LikeBox(likes),</span><br><span class="line">    LikeButton(onClick)</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现细节</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> likes = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addOneMoreLike</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  likes++;</span><br><span class="line">  rerender();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line"></span><br><span class="line">FancyNameBox(</span><br><span class="line">  &#123; <span class="attr">firstName</span>: <span class="string">"Sebastian"</span>, <span class="attr">lastName</span>: <span class="string">"Markbåge"</span> &#125;,</span><br><span class="line">  likes,</span><br><span class="line">  addOneMoreLike</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><em>注意：本例更新状态时会带来副作用（addOneMoreLike 函数中）。我实际的想法是当一个“update”传入时我们返回下一个版本的状态，但那样会比较复杂。此示例待更新</em></p><h2 id="Memoization"><a href="#Memoization" class="headerlink" title="Memoization"></a>Memoization</h2><p>对于纯函数，使用相同的参数一次次调用未免太浪费资源。我们可以创建一个函数的 memorized 版本，用来追踪最后一个参数和结果。这样如果我们继续使用同样的值，就不需要反复执行它了。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">memoize</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cachedArg;</span><br><span class="line">  <span class="keyword">var</span> cachedResult;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cachedArg === arg) &#123;</span><br><span class="line">      <span class="keyword">return</span> cachedResult;</span><br><span class="line">    &#125;</span><br><span class="line">    cachedArg = arg;</span><br><span class="line">    cachedResult = fn(arg);</span><br><span class="line">    <span class="keyword">return</span> cachedResult;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> MemoizedNameBox = memoize(NameBox);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NameAndAgeBox</span>(<span class="params">user, currentTime</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox([</span><br><span class="line">    <span class="string">"Name: "</span>,</span><br><span class="line">    MemoizedNameBox(user.firstName + <span class="string">" "</span> + user.lastName),</span><br><span class="line">    <span class="string">"Age in milliseconds: "</span>,</span><br><span class="line">    currentTime - user.dateOfBirth</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="列表（Lists）"><a href="#列表（Lists）" class="headerlink" title="列表（Lists）"></a>列表（Lists）</h2><p>大部分 UI 都是展示列表数据中不同 item 的列表结构。这是一个天然的层级。</p><p>为了管理列表中的每一个 item 的 state ，我们可以创造一个 Map 容纳具体 item 的 state。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UserList</span>(<span class="params">users, likesPerUser, updateUserLikes</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> users.map(<span class="function"><span class="params">user</span> =&gt;</span></span><br><span class="line">    FancyNameBox(user, likesPerUser.get(user.id), () =&gt;</span><br><span class="line">      updateUserLikes(user.id, likesPerUser.get(user.id) + <span class="number">1</span>)</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> likesPerUser = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateUserLikes</span>(<span class="params">id, likeCount</span>) </span>&#123;</span><br><span class="line">  likesPerUser.set(id, likeCount);</span><br><span class="line">  rerender();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">UserList(data.users, likesPerUser, updateUserLikes);</span><br></pre></td></tr></table></figure><p><em>注意：现在我们向 FancyNameBox 传了多个不同的参数。这打破了我们的 memoization 因为我们每次只能存储一个值。更多相关内容在下面。</em></p><h2 id="连续性（Continuations）"><a href="#连续性（Continuations）" class="headerlink" title="连续性（Continuations）"></a>连续性（Continuations）</h2><p>不幸的是，自从 UI 中有太多的列表，明确的管理就需要大量的重复性样板代码。</p><p>我们可以通过推迟一些函数的执行，进而把一些模板移出业务逻辑。比如，使用“柯里化”（JavaScript 中的 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind" target="_blank" rel="noopener"><code>bind</code></a>）。然后我们可以从核心的函数外面传递 state，这样就没有样板代码了。</p><p>下面这样并没有减少样板代码，但至少把它从关键业务逻辑中剥离。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyUserList</span>(<span class="params">users</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox(UserList.bind(<span class="literal">null</span>, users));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> box = FancyUserList(data.users);</span><br><span class="line"><span class="keyword">const</span> resolvedChildren = box.children(likesPerUser, updateUserLikes);</span><br><span class="line"><span class="keyword">const</span> resolvedBox = &#123;</span><br><span class="line">  ...box,</span><br><span class="line">  children: resolvedChildren</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="State-Map"><a href="#State-Map" class="headerlink" title="State Map"></a>State Map</h2><p>之前我们知道可以使用组合避免重复执行相同的东西这样一种重复模式。我们可以把执行和传递 state 逻辑挪动到被复用很多的低层级的函数中去。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyBoxWithState</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  children,</span></span></span><br><span class="line"><span class="function"><span class="params">  stateMap,</span></span></span><br><span class="line"><span class="function"><span class="params">  updateState</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox(</span><br><span class="line">    children.map(<span class="function"><span class="params">child</span> =&gt;</span> child.continuation(</span><br><span class="line">      stateMap.get(child.key),</span><br><span class="line">      updateState</span><br><span class="line">    ))</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UserList</span>(<span class="params">users</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> users.map(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">    continuation: FancyNameBox.bind(<span class="literal">null</span>, user),</span><br><span class="line">    key: user.id</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyUserList</span>(<span class="params">users</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBoxWithState.bind(<span class="literal">null</span>,</span><br><span class="line">    UserList(users)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> continuation = FancyUserList(data.users);</span><br><span class="line">continuation(likesPerUser, updateUserLikes);</span><br></pre></td></tr></table></figure><h2 id="Memoization-Map"><a href="#Memoization-Map" class="headerlink" title="Memoization Map"></a>Memoization Map</h2><p>一旦我们想在一个 memoization 列表中 memoize 多个 item 就会变得很困难。因为你需要制定复杂的缓存算法来平衡调用频率和内存占有率。</p><p>还好 UI 在同一个位置会相对的稳定。相同的位置一般每次都会接受相同的参数。这样以来，使用一个集合来做 memoization 是一个非常好用的策略。</p><p>我们可以用对待 state 同样的方式，在组合的函数中传递一个 memoization 缓存。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">memoize</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">arg, memoizationCache</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (memoizationCache.arg === arg) &#123;</span><br><span class="line">      <span class="keyword">return</span> memoizationCache.result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> result = fn(arg);</span><br><span class="line">    memoizationCache.arg = arg;</span><br><span class="line">    memoizationCache.result = result;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyBoxWithState</span>(<span class="params">children, stateMap, updateState, memoizationCache</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox(</span><br><span class="line">    children.map(<span class="function"><span class="params">child</span> =&gt;</span></span><br><span class="line">      child.continuation(</span><br><span class="line">        stateMap.get(child.key),</span><br><span class="line">        updateState,</span><br><span class="line">        memoizationCache.get(child.key)</span><br><span class="line">      )</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MemoizedFancyNameBox = memoize(FancyNameBox);</span><br></pre></td></tr></table></figure><h2 id="代数效应（Algebraic-Effects）"><a href="#代数效应（Algebraic-Effects）" class="headerlink" title="代数效应（Algebraic Effects）"></a>代数效应（Algebraic Effects）</h2><p>多层抽象需要共享琐碎数据时，一层层传递数据非常麻烦。如果能有一种方式可以在多层抽象中快捷地传递数据，同时又不需要牵涉到中间层级，那该有多好。React 中我们把它叫做“context”。</p><p>有时候数据依赖并不是严格按照抽象树自上而下进行。举个例子，在布局算法中，你需要在实现他们的位置之前了解子节点的大小。</p><p>现在，这个例子有一点超纲。我会使用 <a href="http://math.andrej.com/eff/" target="_blank" rel="noopener">代数效应</a> 这个由我发起的 <a href="https://esdiscuss.org/topic/one-shot-delimited-continuations-with-effect-handlers" target="_blank" rel="noopener">ECMAScript 新特性提议</a>。如果你对函数式编程很熟悉，它们 在避免由 monad 强制引入的仪式一样的编码。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ThemeBorderColorRequest</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyBox</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> color = raise <span class="keyword">new</span> ThemeBorderColorRequest();</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    borderWidth: <span class="string">'1px'</span>,</span><br><span class="line">    borderColor: color,</span><br><span class="line">    children: children</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BlueTheme</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">try</span> &#123;</span><br><span class="line">    children();</span><br><span class="line">  &#125; <span class="keyword">catch</span> effect ThemeBorderColorRequest -&gt; [, continuation] &#123;</span><br><span class="line">    continuation(<span class="string">'blue'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> BlueTheme(</span><br><span class="line">    FancyUserList.bind(<span class="literal">null</span>, data.users)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>原文地址：<a href="https://github.com/react-guide/react-basic" target="_blank" rel="noopener">React 设计思想</a></p>]]></content>
      
      
      <categories>
          
          <category> 前端框架 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> react </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gulp 自动化构建</title>
      <link href="/2020/03/14/gulp-v4/"/>
      <url>/2020/03/14/gulp-v4/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Gulp 自动化构建的一些过程，以及其他插件的结合使用等</p></blockquote><a id="more"></a><h2 id="起步"><a href="#起步" class="headerlink" title="起步"></a>起步</h2><ul><li><a href="https://www.gulpjs.com.cn/docs/getting-started/quick-start/" target="_blank" rel="noopener">Gulp 快速入门指南</a></li><li><a href="https://github.com/yangtao2o/gulp-project/tree/master/src/mygulp" target="_blank" rel="noopener">Github Demo</a></li></ul><h3 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h3><p>项目根目录创建<code>gulpfile.js</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">defaultTask</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"success"</span>);</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.default = defaultTask;</span><br></pre></td></tr></table></figure><p>gulp 命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  gulp-project git:(master) ✗ gulp</span><br><span class="line">[17:06:29] Using gulpfile ~/Documents/GitHub/gulp-project/gulpfile.js</span><br><span class="line">[17:06:29] Starting <span class="string">'default'</span>...</span><br><span class="line">success</span><br><span class="line">[17:06:29] Finished <span class="string">'default'</span> after 2.67 ms</span><br></pre></td></tr></table></figure><h3 id="Gulpfile-分割"><a href="#Gulpfile-分割" class="headerlink" title="Gulpfile 分割"></a>Gulpfile 分割</h3><blockquote><p>Node 的模块解析功能允许你将 gulpfile.js’ 文件替换为同样命名为 gulpfile.js 的目录，该目录中包含了一个名为 index.js 的文件，该文件被当作 gulpfile.js 使用。并且，该目录中还可以包含各个独立的任务（task）模块。 — 官方文档</p></blockquote><p>创建 <code>gulpfile.js</code>目录，<code>gulpfile.js</code>目录下新建 <code>index.js</code></p><h3 id="组合任务"><a href="#组合任务" class="headerlink" title="组合任务"></a>组合任务</h3><ul><li>series() 允许将多个独立的任务组合为一个更大的操作</li><li>对于希望以最大并发来运行的任务（tasks），可以使用 parallel() 方法将它们组合起来</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; series, parallel &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clean</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cssTranspile</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cssMinify</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsTranspile</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsBundle</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsMinify</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">publish</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">build</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.default = series(</span><br><span class="line">  clean,</span><br><span class="line">  parallel(cssTranspile, series(jsTranspile, jsBundle)),</span><br><span class="line">  parallel(cssMinify, jsMinify),</span><br><span class="line">  publish</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[16:50:36] Starting <span class="string">'default'</span>...</span><br><span class="line">[16:50:36] Starting <span class="string">'clean'</span>...</span><br><span class="line">[16:50:36] Finished <span class="string">'clean'</span> after 606 μs</span><br><span class="line">[16:50:36] Starting <span class="string">'cssTranspile'</span>...</span><br><span class="line">[16:50:36] Finished <span class="string">'cssTranspile'</span> after 199 μs</span><br><span class="line">[16:50:36] Starting <span class="string">'jsTranspile'</span>...</span><br><span class="line">[16:50:36] Finished <span class="string">'jsTranspile'</span> after 131 μs</span><br><span class="line">[16:50:36] Starting <span class="string">'jsBundle'</span>...</span><br><span class="line">[16:50:36] Finished <span class="string">'jsBundle'</span> after 125 μs</span><br><span class="line">[16:50:36] Starting <span class="string">'cssMinify'</span>...</span><br><span class="line">[16:50:36] Starting <span class="string">'jsMinify'</span>...</span><br><span class="line">[16:50:36] Finished <span class="string">'cssMinify'</span> after 183 μs</span><br><span class="line">[16:50:36] Finished <span class="string">'jsMinify'</span> after 218 μs</span><br><span class="line">[16:50:36] Starting <span class="string">'publish'</span>...</span><br><span class="line">[16:50:36] Finished <span class="string">'publish'</span> after 115 μs</span><br><span class="line">[16:50:36] Finished <span class="string">'default'</span> after 4.55 ms</span><br></pre></td></tr></table></figure><p>当一个组合操作执行时，这个组合中的每一个任务每次被调用时都会被执行。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This is INCORRECT</span></span><br><span class="line"><span class="keyword">const</span> &#123; series, parallel &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clean = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> css = series(clean, <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> javascript = series(clean, <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">exports.default = parallel(css, javascript);</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[17:02:45] Starting <span class="string">'default'</span>...</span><br><span class="line">[17:02:45] Starting <span class="string">'clean'</span>...</span><br><span class="line">[17:02:45] Starting <span class="string">'clean'</span>...</span><br><span class="line">[17:02:45] Finished <span class="string">'clean'</span> after 850 μs</span><br><span class="line">[17:02:45] Starting <span class="string">'&lt;anonymous&gt;'</span>...</span><br><span class="line">[17:02:45] Finished <span class="string">'clean'</span> after 2.04 ms</span><br><span class="line">[17:02:45] Starting <span class="string">'&lt;anonymous&gt;'</span>...</span><br><span class="line">[17:02:45] Finished <span class="string">'&lt;anonymous&gt;'</span> after 563 μs</span><br><span class="line">[17:02:45] Finished <span class="string">'&lt;anonymous&gt;'</span> after 438 μs</span><br><span class="line">[17:02:45] Finished <span class="string">'default'</span> after 7.67 ms</span><br></pre></td></tr></table></figure><p>重构：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This is INCORRECT</span></span><br><span class="line"><span class="keyword">const</span> &#123; series, parallel &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clean = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> css = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> javascript = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports.default = series(clean, parallel(css, javascript));</span><br></pre></td></tr></table></figure><p>再次输出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[17:04:48] Starting <span class="string">'default'</span>...</span><br><span class="line">[17:04:48] Starting <span class="string">'clean'</span>...</span><br><span class="line">[17:04:48] Finished <span class="string">'clean'</span> after 546 μs</span><br><span class="line">[17:04:48] Starting <span class="string">'css'</span>...</span><br><span class="line">[17:04:48] Starting <span class="string">'javascript'</span>...</span><br><span class="line">[17:04:48] Finished <span class="string">'css'</span> after 242 μs</span><br><span class="line">[17:04:48] Finished <span class="string">'javascript'</span> after 285 μs</span><br><span class="line">[17:04:48] Finished <span class="string">'default'</span> after 3.4 ms</span><br></pre></td></tr></table></figure><h3 id="异步执行"><a href="#异步执行" class="headerlink" title="异步执行"></a>异步执行</h3><blockquote><p>Node 库以多种方式处理异步功能。最常见的模式是 error-first callbacks，但是你还可能会遇到 streams、promises、event emitters、child processes, 或 observables。gulp 任务（task）规范化了所有这些类型的异步功能。 — 官方文档</p></blockquote><ul><li>返回 stream</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">streamTask</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> src(<span class="string">"*.js"</span>).pipe(dest(<span class="string">"output"</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.default = streamTask;</span><br></pre></td></tr></table></figure><p>然后发现，根目录下会看到 output 目录，及根目录下所有以 <code>*js</code>结尾的文件，包括目录。</p><ul><li>返回 promise</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">promiseTask</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(<span class="string">"the value is ignored"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.default = promiseTask;</span><br></pre></td></tr></table></figure><h3 id="返回-event-emitter"><a href="#返回-event-emitter" class="headerlink" title="返回 event emitter"></a>返回 event emitter</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; EventEmitter &#125; = <span class="built_in">require</span>(<span class="string">"events"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">eventEmitterTask</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> emitter = <span class="keyword">new</span> EventEmitter();</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> emitter.emit(<span class="string">"finish"</span>), <span class="number">250</span>);</span><br><span class="line">  <span class="keyword">return</span> emitter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.default = eventEmitterTask;</span><br></pre></td></tr></table></figure><h3 id="使用-callback"><a href="#使用-callback" class="headerlink" title="使用 callback"></a>使用 callback</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callbackTask</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// `cb()` should be called by some async work</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.default = callbackTask;</span><br></pre></td></tr></table></figure><h3 id="使用-async-await"><a href="#使用-async-await" class="headerlink" title="使用 async/await"></a>使用 async/await</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncAwaitTask</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; version &#125; = fs.readFileSync(<span class="string">"package.json"</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"version"</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="built_in">Promise</span>.resolve(<span class="string">"some result"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.default = asyncAwaitTask;</span><br></pre></td></tr></table></figure><h3 id="使用插件"><a href="#使用插件" class="headerlink" title="使用插件"></a>使用插件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"><span class="keyword">const</span> uglify = <span class="built_in">require</span>(<span class="string">"gulp-uglify"</span>);</span><br><span class="line"><span class="keyword">const</span> rename = <span class="built_in">require</span>(<span class="string">"gulp-rename"</span>);</span><br><span class="line"></span><br><span class="line">exports.default = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> src(<span class="string">"src/assets/**/*.js"</span>)</span><br><span class="line">    .pipe(uglify())</span><br><span class="line">    .pipe(rename(&#123; <span class="attr">extname</span>: <span class="string">".min.js"</span> &#125;))</span><br><span class="line">    .pipe(dest(<span class="string">"output/"</span>));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="browsersync"><a href="#browsersync" class="headerlink" title="browsersync"></a>browsersync</h3><ul><li><a href="http://www.browsersync.cn/docs/gulp/#gulp-install" target="_blank" rel="noopener">Browsersync + Gulp.js</a></li></ul><p>下载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install browser-sync gulp --save-dev</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; task, watch &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"><span class="keyword">const</span> browserSync = <span class="built_in">require</span>(<span class="string">"browser-sync"</span>).create();</span><br><span class="line"><span class="keyword">const</span> reload = browserSync.reload;</span><br><span class="line"><span class="keyword">const</span> serve = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  browserSync.init(&#123;</span><br><span class="line">    server: &#123;</span><br><span class="line">      baseDir: <span class="string">"./src"</span>,</span><br><span class="line">      https: <span class="literal">true</span>,</span><br><span class="line">      directory: <span class="literal">true</span> <span class="comment">//从与目录列表的应用程序目录中的文件即成</span></span><br><span class="line">      <span class="comment">// index: "index.html"  //从应用程序目录中提供文件，指定特定文件名为索引</span></span><br><span class="line">    &#125;,</span><br><span class="line">    port: <span class="number">8080</span>,</span><br><span class="line">    notify: <span class="literal">false</span> <span class="comment">// 开启静默模式</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  watch(<span class="string">"src/*.html"</span>).on(<span class="string">"change"</span>, reload);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">task(serve);</span><br></pre></td></tr></table></figure><p>本地使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest, watch, series, parallel &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"><span class="keyword">const</span> uglify = <span class="built_in">require</span>(<span class="string">"gulp-uglify"</span>);</span><br><span class="line"><span class="keyword">const</span> rename = <span class="built_in">require</span>(<span class="string">"gulp-rename"</span>);</span><br><span class="line"><span class="keyword">const</span> browserSync = <span class="built_in">require</span>(<span class="string">"browser-sync"</span>).create();</span><br><span class="line"><span class="keyword">const</span> reload = browserSync.reload;</span><br><span class="line"><span class="keyword">const</span> jsWatcher = watch(<span class="string">"src/**/*.js"</span>);</span><br><span class="line"><span class="keyword">const</span> cssWatcher = watch(<span class="string">"src/**/*.css"</span>);</span><br><span class="line"><span class="keyword">const</span> htmlWatcher = watch(<span class="string">"src/**/*.html"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clean = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> css = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> javascript = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serve = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  browserSync.init(&#123;</span><br><span class="line">    server: &#123;</span><br><span class="line">      baseDir: <span class="string">"./src"</span>,</span><br><span class="line">      <span class="comment">// https: true,</span></span><br><span class="line">      directory: <span class="literal">true</span> <span class="comment">//从与目录列表的应用程序目录中的文件即成，如果要指定文件，可注释掉</span></span><br><span class="line">      <span class="comment">// index: "index.html"  //从应用程序目录中提供文件，指定特定文件名为索引</span></span><br><span class="line">    &#125;,</span><br><span class="line">    port: <span class="number">8080</span>,</span><br><span class="line">    notify: <span class="literal">false</span> <span class="comment">// 开启静默模式</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听 globs 并在发生更改时运行任务</span></span><br><span class="line">jsWatcher.on(<span class="string">"change"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">path, stats</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`File <span class="subst">$&#123;path&#125;</span> was changed`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">cssWatcher.on(<span class="string">"change"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">path, stats</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`File <span class="subst">$&#123;path&#125;</span> was changed`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">htmlWatcher.on(<span class="string">"change"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">path, stats</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`File <span class="subst">$&#123;path&#125;</span> was changed`</span>);</span><br><span class="line">  reload(); <span class="comment">// Reloading Browsers</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">exports.build = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> src(<span class="string">"src/assets/**/*.js"</span>)</span><br><span class="line">    .pipe(uglify())</span><br><span class="line">    .pipe(rename(&#123; <span class="attr">extname</span>: <span class="string">".min.js"</span> &#125;))</span><br><span class="line">    .pipe(dest(<span class="string">"output/"</span>));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports.serve = serve;</span><br><span class="line"></span><br><span class="line">exports.default = series(clean, parallel(css, javascript));</span><br></pre></td></tr></table></figure><p>然后在根目录下的<code>package.json</code>，修改：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "dev": "gulp",</span><br><span class="line">  "build": "gulp build",</span><br><span class="line">  "serve": "gulp serve"</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>启动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run serve</span><br></pre></td></tr></table></figure><h2 id="Gulp-SASS"><a href="#Gulp-SASS" class="headerlink" title="Gulp + SASS"></a>Gulp + SASS</h2><p>-<a href="https://www.sass.hk/install/" target="_blank" rel="noopener">如何安装 Sass</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install node-sass gulp-sass --save-dev</span><br></pre></td></tr></table></figure><p><code>gulpfile.js</code> 文件主要配置如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest, watch &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"><span class="keyword">const</span> sass = <span class="built_in">require</span>(<span class="string">"gulp-sass"</span>);</span><br><span class="line">sass.compiler = <span class="built_in">require</span>(<span class="string">"node-sass"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scss</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> src(scssGlobSrc)</span><br><span class="line">    .pipe(sass(&#123; <span class="attr">outputStyle</span>: <span class="string">"expanded"</span> &#125;).on(<span class="string">"error"</span>, sass.logError))</span><br><span class="line">    .pipe(dest(<span class="string">"dist/sass"</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.scss = scss;</span><br></pre></td></tr></table></figure><p>启动：<code>gulp scss</code>。</p><h2 id="Gulp-Browsersync"><a href="#Gulp-Browsersync" class="headerlink" title="Gulp + Browsersync"></a>Gulp + Browsersync</h2><ul><li><a href="http://www.browsersync.cn/docs/gulp/" target="_blank" rel="noopener">Browsersync + Gulp.js</a></li></ul><p>下载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install browser-sync gulp --save-dev</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; task, watch &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"><span class="keyword">const</span> browserSync = <span class="built_in">require</span>(<span class="string">"browser-sync"</span>).create();</span><br><span class="line"><span class="keyword">const</span> reload = browserSync.reload;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serve = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  browserSync.init(&#123;</span><br><span class="line">    server: &#123;</span><br><span class="line">      baseDir: <span class="string">"./src"</span>,</span><br><span class="line">      https: <span class="literal">true</span>,</span><br><span class="line">      directory: <span class="literal">true</span> <span class="comment">//从与目录列表的应用程序目录中的文件即成</span></span><br><span class="line">      <span class="comment">// index: "index.html"  //从应用程序目录中提供文件，指定特定文件名为索引</span></span><br><span class="line">    &#125;,</span><br><span class="line">    port: <span class="number">8080</span>,</span><br><span class="line">    notify: <span class="literal">false</span> <span class="comment">// 开启静默模式</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  watch(<span class="string">"src/*.html"</span>).on(<span class="string">"change"</span>, reload);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports.serve = serve;</span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp serve</span><br></pre></td></tr></table></figure><h2 id="Gulp-TypeScript"><a href="#Gulp-TypeScript" class="headerlink" title="Gulp + TypeScript"></a>Gulp + TypeScript</h2><p>根目录下初始化：<code>tsc --init</code>。</p><p>安装依赖：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D typescript gulp-typescript</span><br></pre></td></tr></table></figure><p>配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ts = <span class="built_in">require</span>(<span class="string">"gulp-typescript"</span>);</span><br><span class="line"><span class="keyword">const</span> tsProject = ts.createProject(<span class="string">"tsconfig.json"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">typescript</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> tsProject</span><br><span class="line">    .src()</span><br><span class="line">    .pipe(tsProject())</span><br><span class="line">    .js.pipe(dest(<span class="string">"dist/ts"</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.typescript = typescript;</span><br></pre></td></tr></table></figure><p>src 目录下新建文件 <code>main.ts</code>：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Student &#123;</span><br><span class="line">  fullName: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="keyword">public</span> firstName: <span class="built_in">string</span>, <span class="keyword">public</span> lastName: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.fullName = <span class="string">`<span class="subst">$&#123;firstName&#125;</span> <span class="subst">$&#123;lastName&#125;</span> `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">  firstName: <span class="built_in">string</span>;</span><br><span class="line">  lastName: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">greeter</span>(<span class="params">person: Person</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`hello, <span class="subst">$&#123;person.firstName&#125;</span> <span class="subst">$&#123;person.lastName&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = <span class="keyword">new</span> Student(<span class="string">"Yang"</span>, <span class="string">"Tao"</span>);</span><br><span class="line"></span><br><span class="line">greeter(user);</span><br><span class="line"><span class="built_in">console</span>.log(user.fullName);</span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp typescript</span><br></pre></td></tr></table></figure><h2 id="Riot"><a href="#Riot" class="headerlink" title="Riot"></a>Riot</h2><ul><li><a href="http://eux.baidu.com/blog/fe/riot-js-%E6%A1%86%E6%9E%B6%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90" target="_blank" rel="noopener">Riot.js 框架深入解析</a></li><li><a href="https://cloud.tencent.com/developer/article/1019472" target="_blank" rel="noopener">riot.js 教程【一】简介</a></li><li><a href="https://riot.js.org/documentation/" target="_blank" rel="noopener">RIOT</a>文档</li></ul>]]></content>
      
      
      <categories>
          
          <category> 开发工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gulp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zepto-core-1.1.6 源码注释【转载】</title>
      <link href="/2020/03/13/zepto-v1.6.6/"/>
      <url>/2020/03/13/zepto-v1.6.6/</url>
      
        <content type="html"><![CDATA[<blockquote><p>原文：<a href="https://www.kancloud.cn/wangfupeng/zepto-design-srouce/173692" target="_blank" rel="noopener">zepto-core-1.1.6 源码注释</a></p></blockquote><a id="more"></a><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br><span class="line">1835</span><br><span class="line">1836</span><br><span class="line">1837</span><br><span class="line">1838</span><br><span class="line">1839</span><br><span class="line">1840</span><br><span class="line">1841</span><br><span class="line">1842</span><br><span class="line">1843</span><br><span class="line">1844</span><br><span class="line">1845</span><br><span class="line">1846</span><br><span class="line">1847</span><br><span class="line">1848</span><br><span class="line">1849</span><br><span class="line">1850</span><br><span class="line">1851</span><br><span class="line">1852</span><br><span class="line">1853</span><br><span class="line">1854</span><br><span class="line">1855</span><br><span class="line">1856</span><br><span class="line">1857</span><br><span class="line">1858</span><br><span class="line">1859</span><br><span class="line">1860</span><br><span class="line">1861</span><br><span class="line">1862</span><br><span class="line">1863</span><br><span class="line">1864</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Zepto v1.1.6 - zepto event ajax form ie - zeptojs.com/license */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Zepto = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="literal">undefined</span>,</span><br><span class="line">    key,</span><br><span class="line">    $,</span><br><span class="line">    classList,</span><br><span class="line">    <span class="comment">// 获取数组的slice 和 filter（返回数组中的满足回调函数中指定的条件的元素）方法</span></span><br><span class="line">    emptyArray = [],</span><br><span class="line">    slice = emptyArray.slice,</span><br><span class="line">    filter = emptyArray.filter,</span><br><span class="line">    <span class="built_in">document</span> = <span class="built_in">window</span>.document,</span><br><span class="line">    elementDisplay = &#123;&#125;,</span><br><span class="line">    classCache = &#123;&#125;,</span><br><span class="line">    cssNumber = &#123;</span><br><span class="line">      <span class="string">"column-count"</span>: <span class="number">1</span>,</span><br><span class="line">      columns: <span class="number">1</span>,</span><br><span class="line">      <span class="string">"font-weight"</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">"line-height"</span>: <span class="number">1</span>,</span><br><span class="line">      opacity: <span class="number">1</span>,</span><br><span class="line">      <span class="string">"z-index"</span>: <span class="number">1</span>,</span><br><span class="line">      zoom: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 取出html代码中第一个html标签（或注释），如取出 &lt;p&gt;123&lt;/p&gt;&lt;h1&gt;345&lt;/h1&gt; 中的 &lt;p&gt;</span></span><br><span class="line">    fragmentRE = <span class="regexp">/^\s*&lt;(\w+|!)[^&gt;]*&gt;/</span>,</span><br><span class="line">    <span class="comment">// 匹配 &lt;img /&gt; &lt;p&gt;&lt;/p&gt;  不匹配 &lt;img src=""/&gt; &lt;p&gt;123&lt;/p&gt;</span></span><br><span class="line">    singleTagRE = <span class="regexp">/^&lt;(\w+)\s*\/?&gt;(?:&lt;\/\1&gt;|)$/</span>,</span><br><span class="line">    <span class="comment">// 单标签</span></span><br><span class="line">    tagExpanderRE = <span class="regexp">/&lt;(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^&gt;]*)\/&gt;/gi</span>,</span><br><span class="line">    <span class="comment">// body html</span></span><br><span class="line">    rootNodeRE = <span class="regexp">/^(?:body|html)$/i</span>,</span><br><span class="line">    <span class="comment">// 大写字母</span></span><br><span class="line">    capitalRE = <span class="regexp">/([A-Z])/g</span>,</span><br><span class="line">    <span class="comment">// special attributes that should be get/set via method calls</span></span><br><span class="line">    <span class="comment">// 应该通过方法调用来设置/获取的特殊属性</span></span><br><span class="line">    methodAttributes = [</span><br><span class="line">      <span class="string">"val"</span>,</span><br><span class="line">      <span class="string">"css"</span>,</span><br><span class="line">      <span class="string">"html"</span>,</span><br><span class="line">      <span class="string">"text"</span>,</span><br><span class="line">      <span class="string">"data"</span>,</span><br><span class="line">      <span class="string">"width"</span>,</span><br><span class="line">      <span class="string">"height"</span>,</span><br><span class="line">      <span class="string">"offset"</span></span><br><span class="line">    ],</span><br><span class="line">    adjacencyOperators = [<span class="string">"after"</span>, <span class="string">"prepend"</span>, <span class="string">"before"</span>, <span class="string">"append"</span>],</span><br><span class="line">    table = <span class="built_in">document</span>.createElement(<span class="string">"table"</span>),</span><br><span class="line">    tableRow = <span class="built_in">document</span>.createElement(<span class="string">"tr"</span>),</span><br><span class="line">    <span class="comment">// 指定特殊元素的 容器</span></span><br><span class="line">    containers = &#123;</span><br><span class="line">      tr: <span class="built_in">document</span>.createElement(<span class="string">"tbody"</span>),</span><br><span class="line">      tbody: table,</span><br><span class="line">      thead: table,</span><br><span class="line">      tfoot: table,</span><br><span class="line">      td: tableRow,</span><br><span class="line">      th: tableRow,</span><br><span class="line">      <span class="comment">// 除了上面指定的，其他所有元素的容器都是 div</span></span><br><span class="line">      <span class="string">"*"</span>: <span class="built_in">document</span>.createElement(<span class="string">"div"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// interactive ？？？</span></span><br><span class="line">    readyRE = <span class="regexp">/complete|loaded|interactive/</span>,</span><br><span class="line">    <span class="comment">// 匹配一个包括（字母、数组、下划线、-）的字符串</span></span><br><span class="line">    simpleSelectorRE = <span class="regexp">/^[\w-]*$/</span>,</span><br><span class="line">    class2type = &#123;&#125;,</span><br><span class="line">    toString = class2type.toString,</span><br><span class="line">    zepto = &#123;&#125;,</span><br><span class="line">    camelize,</span><br><span class="line">    uniq,</span><br><span class="line">    tempParent = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>),</span><br><span class="line">    <span class="comment">// 属性转换为 camalCase 格式。</span></span><br><span class="line">    <span class="comment">// $.fn.prop 方法用到了</span></span><br><span class="line">    propMap = &#123;</span><br><span class="line">      tabindex: <span class="string">"tabIndex"</span>,</span><br><span class="line">      readonly: <span class="string">"readOnly"</span>,</span><br><span class="line">      <span class="keyword">for</span>: <span class="string">"htmlFor"</span>,</span><br><span class="line">      class: "className",</span><br><span class="line">      maxlength: <span class="string">"maxLength"</span>,</span><br><span class="line">      cellspacing: <span class="string">"cellSpacing"</span>,</span><br><span class="line">      cellpadding: <span class="string">"cellPadding"</span>,</span><br><span class="line">      rowspan: <span class="string">"rowSpan"</span>,</span><br><span class="line">      colspan: <span class="string">"colSpan"</span>,</span><br><span class="line">      usemap: <span class="string">"useMap"</span>,</span><br><span class="line">      frameborder: <span class="string">"frameBorder"</span>,</span><br><span class="line">      contenteditable: <span class="string">"contentEditable"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 判断是否是arr的函数</span></span><br><span class="line">    isArray =</span><br><span class="line">      <span class="built_in">Array</span>.isArray ||</span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params">object</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> object <span class="keyword">instanceof</span> <span class="built_in">Array</span>;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 上文定义 zepto = &#123;&#125;</span></span><br><span class="line">  <span class="comment">// 判断 element 是否符合 selector 的选择要求</span></span><br><span class="line">  zepto.matches = <span class="function"><span class="keyword">function</span>(<span class="params">element, selector</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// selector有值，element有值，element是普通DOM节点</span></span><br><span class="line">    <span class="keyword">if</span> (!selector || !element || element.nodeType !== <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// elem.matchesSelector('.item')</span></span><br><span class="line">    <span class="comment">// 判断当前的 elem 是否符合传入的 selector 的要求</span></span><br><span class="line">    <span class="keyword">var</span> matchesSelector =</span><br><span class="line">      element.webkitMatchesSelector ||</span><br><span class="line">      element.mozMatchesSelector ||</span><br><span class="line">      element.oMatchesSelector ||</span><br><span class="line">      element.matchesSelector;</span><br><span class="line">    <span class="keyword">if</span> (matchesSelector) <span class="keyword">return</span> matchesSelector.call(element, selector);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 浏览器不支持 matchesSelector</span></span><br><span class="line">    <span class="comment">// fall back to performing a selector:</span></span><br><span class="line">    <span class="keyword">var</span> match,</span><br><span class="line">      parent = element.parentNode,</span><br><span class="line">      temp = !parent;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上文定义 tempParent = document.createElement('div'),</span></span><br><span class="line">    <span class="comment">// 如果没有parent，parent赋值为一个div，然后将当前元素加入到这个div中</span></span><br><span class="line">    <span class="keyword">if</span> (temp) &#123;</span><br><span class="line">      parent = tempParent;</span><br><span class="line">      tempParent.appendChild(element);</span><br><span class="line">      <span class="comment">// (parent = tempParent).appendChild(element); 这种写法不易读</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过 qsa 获取匹配的元素，判断其中有没有 element</span></span><br><span class="line">    match = ~zepto.qsa(parent, selector).indexOf(element);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (temp) &#123;</span><br><span class="line">      <span class="comment">// 如果没有parent时，之前执行过  tempParent.appendChild(element);</span></span><br><span class="line">      <span class="comment">// 此时要移除子元素</span></span><br><span class="line">      tempParent.removeChild(element);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// temp &amp;&amp; tempParent.removeChild(element)  // 这种写法不易读</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回最终的匹配结果，经过 qsa 判断的结果</span></span><br><span class="line">    <span class="keyword">return</span> match;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">type</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj == <span class="literal">null</span></span><br><span class="line">      ? <span class="built_in">String</span>(obj) <span class="comment">// null undefined</span></span><br><span class="line">      : class2type[toString.call(obj)] || <span class="string">"object"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下文定义：</span></span><br><span class="line">    <span class="comment">// // Populate the class2type map</span></span><br><span class="line">    <span class="comment">// $.each("Boolean Number String Function Array Date RegExp Object Error".split(" "), function(i, name) &#123;</span></span><br><span class="line">    <span class="comment">//   class2type[ "[object " + name + "]" ] = name.toLowerCase()</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isFunction</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> type(value) == <span class="string">"function"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// window的特点：window.window === window</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isWindow</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj == obj.window;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// document.nodeType === 9</span></span><br><span class="line">  <span class="comment">// elem.DOCUMENT_NODE 也等于 9 （这里直接判断是不是9也行？？？）</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isDocument</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj.nodeType == obj.DOCUMENT_NODE;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> type(obj) == <span class="string">"object"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 判断是否是最基本的object：Object.getPrototypeOf(obj) == Object.prototype</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isPlainObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      isObject(obj) &amp;&amp;</span><br><span class="line">      !isWindow(obj) &amp;&amp;</span><br><span class="line">      <span class="built_in">Object</span>.getPrototypeOf(obj) == <span class="built_in">Object</span>.prototype</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 数组或者对象数组</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">likeArray</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> obj.length == <span class="string">"number"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 筛选数组，踢出 null undefined 元素</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">compact</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> filter.call(array, <span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> item != <span class="literal">null</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 下文定义：</span></span><br><span class="line">  <span class="comment">// $.fn = &#123;</span></span><br><span class="line">  <span class="comment">//    concat: emptyArray.concat,</span></span><br><span class="line">  <span class="comment">// $.fn.concat.apply([], array) —— 无论 array 是不是数组，都将返回一个数组，</span></span><br><span class="line">  <span class="comment">// 例如 $.fn.concat.call([], 'abc') 返回的是 ['abc']</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">flatten</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> array.length &gt; <span class="number">0</span> ? $.fn.concat.apply([], array) : array;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// camelize 已在上文定义</span></span><br><span class="line">  <span class="comment">// 用于 css 的 camalCase 转换，例如 background-color 转换为 backgroundColor</span></span><br><span class="line">  camelize = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str.replace(<span class="regexp">/-+(.)?/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">match, chr</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> chr ? chr.toUpperCase() : <span class="string">""</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将 lineHeight 转换为 line-height 格式</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">dasherize</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line">      .replace(<span class="regexp">/::/g</span>, <span class="string">"/"</span>)</span><br><span class="line">      .replace(<span class="regexp">/([A-Z]+)([A-Z][a-z])/g</span>, <span class="string">"$1_$2"</span>)</span><br><span class="line">      .replace(<span class="regexp">/([a-z\d])([A-Z])/g</span>, <span class="string">"$1_$2"</span>)</span><br><span class="line">      .replace(<span class="regexp">/_/g</span>, <span class="string">"-"</span>)</span><br><span class="line">      .toLowerCase();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// uniq变量已经在前面定义</span></span><br><span class="line">  <span class="comment">// 用来将 [1,1,2,2,3,3] 替换为 [1,2,3]</span></span><br><span class="line">  uniq = <span class="function"><span class="keyword">function</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> filter.call(array, <span class="function"><span class="keyword">function</span>(<span class="params">item, idx</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> array.indexOf(item) == idx;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 上文定义 classCache = &#123;&#125;</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">classRE</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name <span class="keyword">in</span> classCache</span><br><span class="line">      ? classCache[name]</span><br><span class="line">      : (classCache[name] = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"(^|\\s)"</span> + name + <span class="string">"(\\s|$)"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// classCache 存储的数据是这样的：</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//   abc: /(^|\s)abc(\s|$)/,  // 能匹配 'abc' 或 ' abc ' 或 ' abc' 或 'abc '</span></span><br><span class="line">    <span class="comment">//   xyz: /(^|\s)abc(\s|$)/,</span></span><br><span class="line">    <span class="comment">//   ...</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 传入一个 css 的 name 和 value，判断这个 value 是否需要增加 'px'</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">maybeAddPx</span>(<span class="params">name, value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// dasherize(name) 将 lineHeight 转换为 line-height 格式</span></span><br><span class="line">    <span class="comment">// \!cssNumber[dasherize(name)] 判断转换出来的 css name 是否再这个数组之外</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> value == <span class="string">"number"</span> &amp;&amp; !cssNumber[dasherize(name)]</span><br><span class="line">      ? <span class="comment">// 如果 value 是数字，并且 name 不在 cssNumber 数组之内，就需要加 'px'，否则不需要</span></span><br><span class="line">        <span class="comment">// 例如 'width'、'font-size' 就需要加 'px'， 'font-weight' 就不需要加</span></span><br><span class="line">        value + <span class="string">"px"</span></span><br><span class="line">      : value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 前文定义----------------------</span></span><br><span class="line">    <span class="comment">// cssNumber = &#123;</span></span><br><span class="line">    <span class="comment">//   'column-count': 1,</span></span><br><span class="line">    <span class="comment">//   'columns': 1,</span></span><br><span class="line">    <span class="comment">//   'font-weight': 1,</span></span><br><span class="line">    <span class="comment">//   'line-height': 1,</span></span><br><span class="line">    <span class="comment">//   'opacity': 1,</span></span><br><span class="line">    <span class="comment">//   'z-index': 1,</span></span><br><span class="line">    <span class="comment">//   'zoom': 1</span></span><br><span class="line">    <span class="comment">// &#125;,</span></span><br><span class="line">    <span class="comment">// function dasherize(str) &#123;</span></span><br><span class="line">    <span class="comment">//   return str.replace(/::/g, '/')</span></span><br><span class="line">    <span class="comment">//             .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')</span></span><br><span class="line">    <span class="comment">//             .replace(/([a-z\d])([A-Z])/g, '$1_$2')</span></span><br><span class="line">    <span class="comment">//             .replace(/_/g, '-')</span></span><br><span class="line">    <span class="comment">//             .toLowerCase()</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取一个元素的默认 display 样式值，可能的结果是：inline block inline-block table .... （none 转换为 block）</span></span><br><span class="line">  <span class="comment">// $.fn.show 方法中用到了</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">defaultDisplay</span>(<span class="params">nodeName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> element, display;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 前文定义 elementDisplay = &#123;&#125;</span></span><br><span class="line">    <span class="keyword">if</span> (!elementDisplay[nodeName]) &#123;</span><br><span class="line">      <span class="comment">// 如果 elementDisplay 对象中，没有存储 nodeName 的信息</span></span><br><span class="line">      <span class="comment">// 则新建一个 nodeName 元素，添加到 body 中</span></span><br><span class="line">      element = <span class="built_in">document</span>.createElement(nodeName);</span><br><span class="line">      <span class="built_in">document</span>.body.appendChild(element);</span><br><span class="line">      <span class="comment">// 获取它的默认的 display 样式信息。</span></span><br><span class="line">      display = getComputedStyle(element, <span class="string">""</span>).getPropertyValue(<span class="string">"display"</span>);</span><br><span class="line">      <span class="comment">// 接着马上移除元素！！！</span></span><br><span class="line">      element.parentNode.removeChild(element);</span><br><span class="line">      <span class="comment">// 'none' 换成 'block'，另外还可能是 'inline' 'inline-block' 'table' 等等...</span></span><br><span class="line">      display == <span class="string">"none"</span> &amp;&amp; (display = <span class="string">"block"</span>);</span><br><span class="line">      <span class="comment">// 存储下来</span></span><br><span class="line">      elementDisplay[nodeName] = display;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 下文定义</span></span><br><span class="line">      <span class="comment">// var nativeGetComputedStyle = getComputedStyle;</span></span><br><span class="line">      <span class="comment">// window.getComputedStyle = function(element)&#123;</span></span><br><span class="line">      <span class="comment">//   try &#123;</span></span><br><span class="line">      <span class="comment">//     return nativeGetComputedStyle(element)</span></span><br><span class="line">      <span class="comment">//   &#125; catch(e) &#123;</span></span><br><span class="line">      <span class="comment">//     return null</span></span><br><span class="line">      <span class="comment">//   &#125;</span></span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line">      <span class="comment">// 解释：</span></span><br><span class="line">      <span class="comment">// 如果浏览器支持 getComputedStyle 则使用，如果不支持，就返回 null</span></span><br><span class="line">      <span class="comment">// getComputedStyle(elem, '伪类，如 :link') 返回一个 CSSStyleDeclaration 对象，里面存储了元素的样式信息，可以通过 getPropertyValue('name') 方法获取</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最终返回 display 结果</span></span><br><span class="line">    <span class="keyword">return</span> elementDisplay[nodeName];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回一个元素的子元素，数组形式</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">children</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 有些浏览器支持 elem.children 获取子元素，有些不支持</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"children"</span> <span class="keyword">in</span> element</span><br><span class="line">      ? <span class="comment">// 上文定义 slice = [].slice</span></span><br><span class="line">        <span class="comment">// slice.call(likeArr) 可以将对象数组转换为真正的数组</span></span><br><span class="line">        slice.call(element.children)</span><br><span class="line">      : <span class="comment">// 浏览器不支持 elem.children 只能通过 elem.childNodes 获取子元素</span></span><br><span class="line">        <span class="comment">// 只去 node.nodeType == 1 的子元素，通过 $.map 拼接成数组</span></span><br><span class="line">        <span class="comment">// $.map 下文定义的， $.map = function (elements, callback) &#123;....&#125;</span></span><br><span class="line">        <span class="comment">// $.map 作用：针对 elements（对象数组或数组），对每个元素都经过 callback 函数的过滤，并将过滤通过的元素，push到一个新数组中，返回新数组</span></span><br><span class="line">        $.map(element.childNodes, <span class="function"><span class="keyword">function</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (node.nodeType == <span class="number">1</span>) <span class="keyword">return</span> node;</span><br><span class="line">        &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 上文定义 zepto = &#123;&#125;</span></span><br><span class="line">  <span class="comment">// 上文定义 zepto.matches = function(element, selector) &#123; /* 判断elem是否符合selector的要求 */ &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.fragment` takes a html string and an optional tag name</span></span><br><span class="line">  <span class="comment">// to generate DOM nodes nodes from the given html string.</span></span><br><span class="line">  <span class="comment">// The generated DOM nodes are returned as an array.</span></span><br><span class="line">  <span class="comment">// This function can be overriden in plugins for example to make</span></span><br><span class="line">  <span class="comment">// it compatible with browsers that don't support the DOM fully.</span></span><br><span class="line">  zepto.fragment = <span class="function"><span class="keyword">function</span>(<span class="params">html, name, properties</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      参数：</span></span><br><span class="line"><span class="comment">      @html: 待处理的html字符串</span></span><br><span class="line"><span class="comment">      @name: 通过 name 可在 containers 中查找容器节点，如果不传入，取得的容器默认为 div</span></span><br><span class="line"><span class="comment">      @properties: 节点属性对象</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> dom, nodes, container;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上文定义：singleTagRE = /^&lt;(\w+)\s*\/?&gt;(?:&lt;\/\1&gt;|)$/,   // 匹配 &lt;img /&gt; &lt;p&gt;&lt;/p&gt;  不匹配 &lt;img src=""/&gt; &lt;p&gt;123&lt;/p&gt;</span></span><br><span class="line">    <span class="comment">// 如果 html 是单标签，则直接用该标签创建元素</span></span><br><span class="line">    <span class="comment">// RegExp.$1 表示正则中的第一个括号匹配的内容，在此即 (\w+) 匹配的内容，</span></span><br><span class="line">    <span class="comment">// A special case optimization for a single tag</span></span><br><span class="line">    <span class="keyword">if</span> (singleTagRE.test(html)) dom = $(<span class="built_in">document</span>.createElement(<span class="built_in">RegExp</span>.$<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!dom) &#123;</span><br><span class="line">      <span class="comment">// 说明 html 不是单标签，dom未被赋值</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 上文定义 tagExpanderRE = /&lt;(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^&gt;]*)\/&gt;/ig,   // 单标签</span></span><br><span class="line">      <span class="comment">// 将 &lt;p/&gt;或&lt;p /&gt;，替换为 &lt;p&gt;&lt;/p&gt;，将&lt;p abc/&gt;替换为&lt;p&gt;abc&lt;/p&gt;</span></span><br><span class="line">      <span class="comment">// &lt;input/&gt; （在 tagExpanderRE 中定义）的不替换</span></span><br><span class="line">      <span class="keyword">if</span> (html.replace) html = html.replace(tagExpanderRE, <span class="string">"&lt;$1&gt;&lt;/$2&gt;"</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// fragmentRE = /^\s*&lt;(\w+|!)[^&gt;]*&gt;/,   // 取出html代码中第一个html标签（或注释），如取出 &lt;p&gt;123&lt;/p&gt;&lt;h1&gt;345&lt;/h1&gt; 中的 &lt;p&gt;</span></span><br><span class="line">      <span class="comment">// 如果 name 未传入，则赋值为 html 的第一个标签</span></span><br><span class="line">      <span class="keyword">if</span> (name === <span class="literal">undefined</span>) name = fragmentRE.test(html) &amp;&amp; <span class="built_in">RegExp</span>.$<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 上文定义</span></span><br><span class="line">      <span class="comment">// 指定特殊元素的 容器</span></span><br><span class="line">      <span class="comment">// containers = &#123;</span></span><br><span class="line">      <span class="comment">//   'tr': document.createElement('tbody'),</span></span><br><span class="line">      <span class="comment">//   'tbody': table,</span></span><br><span class="line">      <span class="comment">//   'thead': table,</span></span><br><span class="line">      <span class="comment">//   'tfoot': table,</span></span><br><span class="line">      <span class="comment">//   'td': tableRow,</span></span><br><span class="line">      <span class="comment">//   'th': tableRow,</span></span><br><span class="line">      <span class="comment">// 除了上面指定的，其他所有元素的容器都是 div</span></span><br><span class="line">      <span class="comment">//   '*': document.createElement('div')</span></span><br><span class="line">      <span class="comment">// &#125;,</span></span><br><span class="line">      <span class="keyword">if</span> (!(name <span class="keyword">in</span> containers)) name = <span class="string">"*"</span>;</span><br><span class="line"></span><br><span class="line">      container = containers[name];</span><br><span class="line">      container.innerHTML = <span class="string">""</span> + html; <span class="comment">// 转变为字符串的快捷方式</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 遍历 container 的子元素（先转换为数组形式）</span></span><br><span class="line">      <span class="comment">// 返回的同时，将每个子元素移除。</span></span><br><span class="line">      <span class="comment">// $.each 返回的是一个数组，因为第一个参数就是数组 slice.call(container.childNodes)</span></span><br><span class="line">      dom = $.each(slice.call(container.childNodes), <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        container.removeChild(<span class="keyword">this</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 赋值属性</span></span><br><span class="line">    <span class="keyword">if</span> (isPlainObject(properties)) &#123;</span><br><span class="line">      <span class="comment">// 先将dom转换为 zepto 对象</span></span><br><span class="line">      nodes = $(dom);</span><br><span class="line"></span><br><span class="line">      $.each(properties, <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 上文定义：</span></span><br><span class="line">        <span class="comment">// 应该通过方法调用来设置/获取的特殊属性</span></span><br><span class="line">        <span class="comment">// methodAttributes = ['val', 'css', 'html', 'text', 'data', 'width', 'height', 'offset'],</span></span><br><span class="line">        <span class="keyword">if</span> (methodAttributes.indexOf(key) &gt; <span class="number">-1</span>) nodes[key](value);</span><br><span class="line">        <span class="comment">// 满足 methodAttributes 的，通过方法赋值</span></span><br><span class="line">        <span class="keyword">else</span> nodes.attr(key, value); <span class="comment">// 否则，通过属性复制</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最终返回的dom可能有两种形式</span></span><br><span class="line">    <span class="comment">// 第一，如果 html 是单标签，则dom被复制为一个zepto对象 dom = $(document.createElement(RegExp.$1))</span></span><br><span class="line">    <span class="comment">// 第二，如果 html 不是单标签，则dom被复制为一个DOM节点的数组</span></span><br><span class="line">    <span class="keyword">return</span> dom;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 上文定义 zepto = &#123;&#125;</span></span><br><span class="line">  <span class="comment">// 上文定义 zepto.matches = function(element, selector) &#123; /* 判断elem是否符合selector的要求 */ &#125;</span></span><br><span class="line">  <span class="comment">// 上文定义 zepto.fragment = function(html, name, properties) &#123; /* 通过html字符串获取文档碎片 */ &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.Z` swaps out the prototype of the given `dom` array</span></span><br><span class="line">  <span class="comment">// of nodes with `$.fn` and thus supplying all the Zepto functions</span></span><br><span class="line">  <span class="comment">// to the array. Note that `__proto__` is not supported on Internet</span></span><br><span class="line">  <span class="comment">// Explorer. This method can be overriden in plugins.</span></span><br><span class="line">  zepto.Z = <span class="function"><span class="keyword">function</span>(<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">    dom = dom || [];</span><br><span class="line">    <span class="comment">// 将 dom 隐式原型强制改为 $.fn</span></span><br><span class="line">    <span class="comment">// 下文 zepto.Z.prototype = $.fn   因此，dom.__proto__ = $.fn 即 dom.__proto__ = zepto.Z.prototype  可以不较真的认为 zepto.Z 就是一个构造函数（但感觉这么设计，有些蹩脚）</span></span><br><span class="line">    dom.__proto__ = $.fn;</span><br><span class="line">    dom.selector = selector || <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">return</span> dom;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.isZ` should return `true` if the given object is a Zepto</span></span><br><span class="line">  <span class="comment">// collection. This method can be overriden in plugins.</span></span><br><span class="line">  zepto.isZ = <span class="function"><span class="keyword">function</span>(<span class="params">object</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 上文 dom.__proto__ = $.fn</span></span><br><span class="line">    <span class="comment">// 下文 zepto.Z.prototype = $.fn</span></span><br><span class="line">    <span class="comment">// 可知：dom.__proto__ === $.fn === zepto.Z.prototype</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 因此，zepto对象都符合 object instanceof zepto.Z</span></span><br><span class="line">    <span class="keyword">return</span> object <span class="keyword">instanceof</span> zepto.Z;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.init` is Zepto's counterpart to jQuery's `$.fn.init` and</span></span><br><span class="line">  <span class="comment">// takes a CSS selector and an optional context (and handles various</span></span><br><span class="line">  <span class="comment">// special cases).</span></span><br><span class="line">  <span class="comment">// This method can be overriden in plugins.</span></span><br><span class="line">  zepto.init = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dom;</span><br><span class="line">    <span class="comment">// If nothing given, return an empty Zepto collection</span></span><br><span class="line">    <span class="keyword">if</span> (!selector) <span class="keyword">return</span> zepto.Z();</span><br><span class="line">    <span class="comment">// Optimize for string selectors</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">"string"</span>) &#123;</span><br><span class="line">      <span class="comment">// 字符串的情况，一般有两种：</span></span><br><span class="line">      <span class="comment">// 第一，一段 html 代码，旨在通过zepto生成dom对象</span></span><br><span class="line">      <span class="comment">// 第二，一段查询字符串，旨在通过zepto查找dom对象</span></span><br><span class="line">      <span class="comment">// 将查询结果存储到 dom 变量中</span></span><br><span class="line"></span><br><span class="line">      selector = selector.trim();</span><br><span class="line">      <span class="comment">// If it's a html fragment, create nodes from it</span></span><br><span class="line">      <span class="comment">// Note: In both Chrome 21 and Firefox 15, DOM error 12</span></span><br><span class="line">      <span class="comment">// is thrown if the fragment doesn't begin with &lt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 上文定义：</span></span><br><span class="line">      <span class="comment">// 取出html代码中第一个html标签（或注释），如取出 &lt;p&gt;123&lt;/p&gt;&lt;h1&gt;345&lt;/h1&gt; 中的 &lt;p&gt;</span></span><br><span class="line">      <span class="comment">// fragmentRE = /^\s*&lt;(\w+|!)[^&gt;]*&gt;/,</span></span><br><span class="line">      <span class="keyword">if</span> (selector[<span class="number">0</span>] == <span class="string">"&lt;"</span> &amp;&amp; fragmentRE.test(selector))</span><br><span class="line">        <span class="comment">// 第一，RegExp.$1取出来的就是第一个标签名称，即正则中 (\w+|!) 对应的内容</span></span><br><span class="line">        <span class="comment">// 第二，此时的 context 应该传入的是css属性对象（这里会产生歧义，老版的不会传入 context）</span></span><br><span class="line">        (dom = zepto.fragment(selector, <span class="built_in">RegExp</span>.$<span class="number">1</span>, context)), (selector = <span class="literal">null</span>);</span><br><span class="line">      <span class="comment">// If there's a context, create a collection on that context first, and select</span></span><br><span class="line">      <span class="comment">// nodes from there</span></span><br><span class="line">      <span class="comment">// 如果 selector 不是html字符串标签，并且 context 有值，则从context中查找</span></span><br><span class="line">      <span class="comment">// find 应该是在 $.fn 中定义的，有待解读？？？</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector);</span><br><span class="line">      <span class="comment">// If it's a CSS selector, use it to select nodes.</span></span><br><span class="line">      <span class="comment">// 除了以上情况，就从整个 document 执行 qsa 的查找</span></span><br><span class="line">      <span class="keyword">else</span> dom = zepto.qsa(<span class="built_in">document</span>, selector);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If a function is given, call it when the DOM is ready</span></span><br><span class="line">    <span class="comment">// 如果是函数，则dom ready时执行，</span></span><br><span class="line">    <span class="comment">// ready方法应该在 $.fn 中定义，有待解毒</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (isFunction(selector)) <span class="keyword">return</span> $(<span class="built_in">document</span>).ready(selector);</span><br><span class="line">    <span class="comment">// If a Zepto collection is given, just return it</span></span><br><span class="line">    <span class="comment">// 传入的参数本身就已经是 zepto 对象，则直接返回</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (zepto.isZ(selector)) <span class="keyword">return</span> selector;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// compact函数：踢出数组中 == null 的元素</span></span><br><span class="line">      <span class="comment">// normalize array if an array of nodes is given</span></span><br><span class="line">      <span class="keyword">if</span> (isArray(selector)) dom = compact(selector);</span><br><span class="line">      <span class="comment">// 如果传入的是object，直接强制塞进一个数组</span></span><br><span class="line">      <span class="comment">// Wrap DOM nodes.</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (isObject(selector)) (dom = [selector]), (selector = <span class="literal">null</span>);</span><br><span class="line">      <span class="comment">// 及时清空 selector 不妨碍下面的判断</span></span><br><span class="line">      <span class="comment">// 从此往下，感觉和上文 selector 是字符串的情况下，重复了</span></span><br><span class="line">      <span class="comment">// ？？？？？？？？</span></span><br><span class="line">      <span class="comment">// fragmentRE.test 即判断字符串是否是 html 标签开头（即是否是html fragement）</span></span><br><span class="line">      <span class="comment">// If it's a html fragment, create nodes from it</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (fragmentRE.test(selector))</span><br><span class="line">        <span class="comment">//此时，context 也是属性集合，不是容器！！！</span></span><br><span class="line">        <span class="comment">//（这里会产生歧义，老版的不会传入 context）</span></span><br><span class="line">        (dom = zepto.fragment(selector.trim(), <span class="built_in">RegExp</span>.$<span class="number">1</span>, context)),</span><br><span class="line">          (selector = <span class="literal">null</span>);</span><br><span class="line">      <span class="comment">// 及时清空 selector 不妨碍下面的判断</span></span><br><span class="line">      <span class="comment">// If there's a context, create a collection on that context first, and select</span></span><br><span class="line">      <span class="comment">// nodes from there</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector);</span><br><span class="line">      <span class="comment">// And last but no least, if it's a CSS selector, use it to select nodes.</span></span><br><span class="line">      <span class="keyword">else</span> dom = zepto.qsa(<span class="built_in">document</span>, selector);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最终，还是通过 zepto.Z 创建了对象</span></span><br><span class="line">    <span class="comment">// 这里的 dom，其实就是一个数组</span></span><br><span class="line">    <span class="comment">// create a new Zepto collection from the nodes found</span></span><br><span class="line">    <span class="keyword">return</span> zepto.Z(dom, selector);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$` will be the base `Zepto` object. When calling this</span></span><br><span class="line">  <span class="comment">// function just call `$.zepto.init, which makes the implementation</span></span><br><span class="line">  <span class="comment">// details of selecting nodes and creating Zepto collections</span></span><br><span class="line">  <span class="comment">// patchable in plugins.</span></span><br><span class="line">  $ = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> zepto.init(selector, context);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// $ 最终被这个匿名函数所返回，并复制给了全局的 Zepto 变量</span></span><br><span class="line">  <span class="comment">// 全局的 zepto 变量暴露给了 window，并且可能有一个别名—— $</span></span><br><span class="line">  <span class="comment">// 此 $ 非彼 $</span></span><br><span class="line">  <span class="comment">// 对于初学者来说，这里肯定非常绕（还不如把这里的 $ 改改名字）</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">extend</span>(<span class="params">target, source, deep</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// key 在上文已经定义，否则就污染全局变量了</span></span><br><span class="line">    <span class="comment">// 深度递归，首先必须 deep 参数为 true</span></span><br><span class="line">    <span class="comment">// 其次，source[key] 必须是数组或者对象，才有必要深度递归（否则没必要）</span></span><br><span class="line">    <span class="keyword">for</span> (key <span class="keyword">in</span> source)</span><br><span class="line">      <span class="keyword">if</span> (deep &amp;&amp; (isPlainObject(source[key]) || isArray(source[key]))) &#123;</span><br><span class="line">        <span class="comment">// source[key] 是对象，而 target[key] 不是对象</span></span><br><span class="line">        <span class="comment">// 则 target[key] = &#123;&#125; 初始化一下，否则递归会出错的</span></span><br><span class="line">        <span class="keyword">if</span> (isPlainObject(source[key]) &amp;&amp; !isPlainObject(target[key]))</span><br><span class="line">          target[key] = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// source[key] 是数组，而 target[key] 不是数组</span></span><br><span class="line">        <span class="comment">// 则 target[key] = [] 初始化一下，否则递归会出错的</span></span><br><span class="line">        <span class="keyword">if</span> (isArray(source[key]) &amp;&amp; !isArray(target[key])) target[key] = [];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行递归</span></span><br><span class="line">        extend(target[key], source[key], deep);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 不满足以上条件，说明 source[key] 是一般的值类型，直接赋值给 target 就是了</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (source[key] !== <span class="literal">undefined</span>) target[key] = source[key];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Copy all but undefined properties from one or more</span></span><br><span class="line">  <span class="comment">// objects to the `target` object.</span></span><br><span class="line">  $.extend = <span class="function"><span class="keyword">function</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 一般传入的参数会是：</span></span><br><span class="line">    <span class="comment">// (targetObj, srcObj1, srcObj2, srcObj1...)</span></span><br><span class="line">    <span class="comment">// (true, targetObj, srcObj1, srcObj2, srcObj1...)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// arguments 是对象数组，slice.call 会返回真正的数组（此处返回从第二项开始）</span></span><br><span class="line">    <span class="keyword">var</span> deep,</span><br><span class="line">      args = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第一个参数是boolean，这里会把第二个参数当做 target，其他的作为 source</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> target == <span class="string">"boolean"</span>) &#123;</span><br><span class="line">      deep = target;</span><br><span class="line">      target = args.shift();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将所有的 source 添加到 target 中</span></span><br><span class="line">    args.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">      extend(target, arg, deep);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 感觉这样设计是比较好，很好的将业务和底层进行了分离（虽然比较简单）：</span></span><br><span class="line">    <span class="comment">// 核心方法再 function extend(...)&#123;...&#125; 中定义，</span></span><br><span class="line">    <span class="comment">// 而 $.extend 方法中做一些外围的判断和处理，最终调用 extend 函数去执行</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.qsa` is Zepto's CSS selector implementation which</span></span><br><span class="line">  <span class="comment">// uses `document.querySelectorAll` and optimizes for some special cases, like `#id`.</span></span><br><span class="line">  <span class="comment">// This method can be overriden in plugins.</span></span><br><span class="line">  zepto.qsa = <span class="function"><span class="keyword">function</span>(<span class="params">element, selector</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      @element: 容器</span></span><br><span class="line"><span class="comment">      @selector: 选择器</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> found,</span><br><span class="line">      maybeID = selector[<span class="number">0</span>] == <span class="string">"#"</span>,</span><br><span class="line">      maybeClass = !maybeID &amp;&amp; selector[<span class="number">0</span>] == <span class="string">"."</span>,</span><br><span class="line">      <span class="comment">// ID或class形式：返回 selector.slice(1) 即ID或者class的值</span></span><br><span class="line">      <span class="comment">// 否则：返回 selector，如通过 tagName 查询</span></span><br><span class="line">      nameOnly = maybeID || maybeClass ? selector.slice(<span class="number">1</span>) : selector, <span class="comment">// Ensure that a 1 char tag name still gets checked</span></span><br><span class="line">      <span class="comment">// 是否是一个简单的字符串（可能是一个复杂的选择器，如 'div#div1 .item[link] .red'）</span></span><br><span class="line">      isSimple = simpleSelectorRE.test(nameOnly);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上文定义：</span></span><br><span class="line">    <span class="comment">// // 匹配一个包括（字母、数组、下划线、-）的字符串</span></span><br><span class="line">    <span class="comment">// simpleSelectorRE = /^[\w-]*$/,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 以下代码的基本思路是：</span></span><br><span class="line">    <span class="comment">// 1. 优先通过 ID 获取元素；</span></span><br><span class="line">    <span class="comment">// 2. 然后试图通过 className 和 tagName 获取元素</span></span><br><span class="line">    <span class="comment">// 3. 最后通过 querySelectorAll 来获取</span></span><br><span class="line">    <span class="keyword">return</span> isDocument(element) &amp;&amp; isSimple &amp;&amp; maybeID</span><br><span class="line">      ? <span class="comment">// 这是最简单的形式：容器是document、选择器是一个id</span></span><br><span class="line">        <span class="comment">// 因为 getElementById 只能在 document 上用，所以这里单独拿出来</span></span><br><span class="line">        (found = element.getElementById(nameOnly))</span><br><span class="line">        ? [found]</span><br><span class="line">        : []</span><br><span class="line">      : element.nodeType !== <span class="number">1</span> &amp;&amp; element.nodeType !== <span class="number">9</span></span><br><span class="line">      ? <span class="comment">// 容器不是一般元素，也不是document，直接返回 []</span></span><br><span class="line">        []</span><br><span class="line">      : <span class="comment">// 将获取的所有元素集合，都转换为数组</span></span><br><span class="line">        slice.call(</span><br><span class="line">          isSimple &amp;&amp; !maybeID</span><br><span class="line">            ? <span class="comment">// isSimple情况下，nameOnly 只可能是 className 或者 tagName</span></span><br><span class="line">              <span class="comment">// getElementsByClassName 和 getElementsByTagName 可以在 elem 上用，而且比 querySelectorAll 速度快</span></span><br><span class="line">              <span class="comment">// 所以，只要elem容器有值，尽量单独拿出来处理</span></span><br><span class="line">              maybeClass</span><br><span class="line">              ? element.getElementsByClassName(nameOnly) <span class="comment">// If it's simple, it could be a class</span></span><br><span class="line">              : element.getElementsByTagName(selector) <span class="comment">// Or a tag</span></span><br><span class="line">            : <span class="comment">// 最后其他情况，只能通过 querySelectorAll 来处理</span></span><br><span class="line">              element.querySelectorAll(selector) <span class="comment">// Or it's not simple, and we need to query all</span></span><br><span class="line">        );</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 根据 selector 筛选 nodes</span></span><br><span class="line">  <span class="comment">// 并将 nodes 封装为 zepto 对象</span></span><br><span class="line">  <span class="comment">// $.fn.filter 下文定义</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">filtered</span>(<span class="params">nodes, selector</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> selector == <span class="literal">null</span> ? $(nodes) : $(nodes).filter(selector);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断 parent 是否包含 node</span></span><br><span class="line">  $.contains = <span class="built_in">document</span>.documentElement.contains</span><br><span class="line">    ? <span class="comment">// 浏览器支持 contains 方法</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params">parent, node</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> parent !== node &amp;&amp; parent.contains(node);</span><br><span class="line">      &#125;</span><br><span class="line">    : <span class="comment">// 不支持 contains 方法</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params">parent, node</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (node &amp;&amp; (node = node.parentNode))</span><br><span class="line">          <span class="keyword">if</span> (node === parent) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果 arg 是函数，则改变函数的执行环境和参数</span></span><br><span class="line">  <span class="comment">// 如果不是，直接返回 arg</span></span><br><span class="line">  <span class="comment">// $.fn.html 方法就用到了</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">funcArg</span>(<span class="params">context, arg, idx, payload</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> isFunction(arg) ? arg.call(context, idx, payload) : arg;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置属性</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setAttribute</span>(<span class="params">node, name, value</span>) </span>&#123;</span><br><span class="line">    value == <span class="literal">null</span> ? node.removeAttribute(name) : node.setAttribute(name, value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置或获取 node 的 className</span></span><br><span class="line">  <span class="comment">// 考虑 svg ？？？？</span></span><br><span class="line">  <span class="comment">// access className property while respecting SVGAnimatedString</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">className</span>(<span class="params">node, value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> klass = node.className || <span class="string">""</span>,</span><br><span class="line">      svg = klass &amp;&amp; klass.baseVal !== <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取</span></span><br><span class="line">    <span class="keyword">if</span> (value === <span class="literal">undefined</span>) <span class="keyword">return</span> svg ? klass.baseVal : klass;</span><br><span class="line">    <span class="comment">// 设置</span></span><br><span class="line">    svg ? (klass.baseVal = value) : (node.className = value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将字符串变成响应的对象或者值，例如源代码的注释：</span></span><br><span class="line">  <span class="comment">// "true"  =&gt; true</span></span><br><span class="line">  <span class="comment">// "false" =&gt; false</span></span><br><span class="line">  <span class="comment">// "null"  =&gt; null</span></span><br><span class="line">  <span class="comment">// "42"    =&gt; 42</span></span><br><span class="line">  <span class="comment">// "42.5"  =&gt; 42.5</span></span><br><span class="line">  <span class="comment">// "08"    =&gt; "08"</span></span><br><span class="line">  <span class="comment">// JSON    =&gt; parse if valid</span></span><br><span class="line">  <span class="comment">// String  =&gt; self</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">deserializeValue</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">        ? <span class="comment">// value『有值』的情况：</span></span><br><span class="line">          value == <span class="string">"true"</span> || <span class="comment">// 如果 value == 'true'，那么这个表达式本身就返回 true ，导致整个函数返回true</span></span><br><span class="line">            <span class="comment">// value !== 'true' 的情况：</span></span><br><span class="line">            (value == <span class="string">"false"</span></span><br><span class="line">              ? <span class="literal">false</span> <span class="comment">// "null"  =&gt; null</span></span><br><span class="line">              : value == <span class="string">"null"</span></span><br><span class="line">              ? <span class="literal">null</span> <span class="comment">// "null"  =&gt; null</span></span><br><span class="line">              : +value + <span class="string">""</span> == value</span><br><span class="line">              ? +value <span class="comment">// 数字："42" =&gt; 42  "42.5" =&gt; 42.5  （ 但是 '08' 却不符合这个条件 ）</span></span><br><span class="line">              : <span class="regexp">/^[\[\&#123;]/</span>.test(value)</span><br><span class="line">              ? $.parseJSON(value) <span class="comment">// '[...]' 或者 '&#123;...&#125;'</span></span><br><span class="line">              : value) <span class="comment">// 其他</span></span><br><span class="line">        : <span class="comment">// value『无值』的情况： undefined / '' / flase / 0 / null</span></span><br><span class="line">          value;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将上文定义的函数，暴露给 $ 对象（其实 $ 是一个 function）</span></span><br><span class="line">  $.type = type;</span><br><span class="line">  $.isFunction = isFunction;</span><br><span class="line">  $.isWindow = isWindow;</span><br><span class="line">  $.isArray = isArray;</span><br><span class="line">  $.isPlainObject = isPlainObject;</span><br><span class="line"></span><br><span class="line">  $.isEmptyObject = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name;</span><br><span class="line">    <span class="keyword">for</span> (name <span class="keyword">in</span> obj) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  $.inArray = <span class="function"><span class="keyword">function</span>(<span class="params">elem, array, i</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> emptyArray.indexOf.call(array, elem, i);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  $.camelCase = camelize;</span><br><span class="line">  $.trim = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str == <span class="literal">null</span> ? <span class="string">""</span> : <span class="built_in">String</span>.prototype.trim.call(str);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// plugin compatibility</span></span><br><span class="line">  $.uuid = <span class="number">0</span>;</span><br><span class="line">  $.support = &#123;&#125;;</span><br><span class="line">  $.expr = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重新组织 elements 对象（数组、对象或者对象数组），针对每一个元素，都用 callback 进行检验</span></span><br><span class="line">  <span class="comment">// 检验通过后，将元素push进一个新数组，并返回</span></span><br><span class="line">  $.map = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value,</span><br><span class="line">      values = [],</span><br><span class="line">      i,</span><br><span class="line">      key;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数组，或者对象数组</span></span><br><span class="line">    <span class="keyword">if</span> (likeArray(elements))</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; elements.length; i++) &#123;</span><br><span class="line">        <span class="comment">// 遍历，经过 callback 验证，push到结果中</span></span><br><span class="line">        value = callback(elements[i], i);</span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) values.push(value);</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="comment">// 对象</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="keyword">for</span> (key <span class="keyword">in</span> elements) &#123;</span><br><span class="line">        <span class="comment">// 遍历，经过 callback 验证，push到结果中</span></span><br><span class="line">        value = callback(elements[key], key);</span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) values.push(value);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回数组</span></span><br><span class="line">    <span class="comment">// flatten 函数上文定义的，作用：无论 values 是否是数组，都将返回一个正确的数组。例如，传入 'abc' ，返回 ['abc']</span></span><br><span class="line">    <span class="keyword">return</span> flatten(values);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 遍历 elements 所有元素（数组、对象数组、对象），执行 callback 方法，最终还是返回 elements</span></span><br><span class="line">  <span class="comment">// 注意1：callback.call(elements[i], i, elements[i]) 函数执行的环境和参数</span></span><br><span class="line">  <span class="comment">// 注意2：=== false) return elements 一旦有函数返回 false，即跳出循环，类似 break</span></span><br><span class="line">  <span class="comment">// 注意3：无论哪种情况，最终返回的还是 elements</span></span><br><span class="line">  $.each = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i, key;</span><br><span class="line">    <span class="keyword">if</span> (likeArray(elements)) &#123;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; elements.length; i++)</span><br><span class="line">        <span class="keyword">if</span> (callback.call(elements[i], i, elements[i]) === <span class="literal">false</span>)</span><br><span class="line">          <span class="keyword">return</span> elements;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (key <span class="keyword">in</span> elements)</span><br><span class="line">        <span class="keyword">if</span> (callback.call(elements[key], key, elements[key]) === <span class="literal">false</span>)</span><br><span class="line">          <span class="keyword">return</span> elements;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> elements;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 上文定义：filter = emptyArray.filter</span></span><br><span class="line">  <span class="comment">// 筛选数组</span></span><br><span class="line">  $.grep = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> filter.call(elements, callback);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.JSON) $.parseJSON = <span class="built_in">JSON</span>.parse;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Populate the class2type map</span></span><br><span class="line">  $.each(</span><br><span class="line">    <span class="string">"Boolean Number String Function Array Date RegExp Object Error"</span>.split(<span class="string">" "</span>),</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">i, name</span>) </span>&#123;</span><br><span class="line">      class2type[<span class="string">"[object "</span> + name + <span class="string">"]"</span>] = name.toLowerCase();</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">      上文将 class2type 赋值为 &#123;&#125;</span></span><br><span class="line"><span class="comment">      最终将 class2type 赋值为：</span></span><br><span class="line"><span class="comment">      &#123;</span></span><br><span class="line"><span class="comment">        '[object boolean]': 'boolean',</span></span><br><span class="line"><span class="comment">        '[object number]': 'number',</span></span><br><span class="line"><span class="comment">        '[object string]': 'string',</span></span><br><span class="line"><span class="comment">        ...</span></span><br><span class="line"><span class="comment">      &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      存储这个数据是为了方便的获取一些对象的类型，</span></span><br><span class="line"><span class="comment">      例如 Object.prototype.toString.call([]) 返回的是 '[Object Array]'</span></span><br><span class="line"><span class="comment">      那么即可根据这个获取 [] 的类型是 'array'</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Define methods that will be available on all</span></span><br><span class="line">  <span class="comment">// Zepto collections</span></span><br><span class="line">  $.fn = &#123;</span><br><span class="line">    <span class="comment">// 为何要这么多数组的方法？</span></span><br><span class="line">    <span class="comment">// 因为一个 zepto 对象，本身就是一个数组</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Because a collection acts like an array</span></span><br><span class="line">    <span class="comment">// copy over these useful array functions.</span></span><br><span class="line">    forEach: emptyArray.forEach,</span><br><span class="line">    reduce: emptyArray.reduce, <span class="comment">// 方法何用？？？？</span></span><br><span class="line">    push: emptyArray.push,</span><br><span class="line">    sort: emptyArray.sort,</span><br><span class="line">    indexOf: emptyArray.indexOf,</span><br><span class="line">    concat: emptyArray.concat,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// `map` and `slice` in the jQuery API work differently</span></span><br><span class="line">    <span class="comment">// from their array counterparts</span></span><br><span class="line">    map: <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// $.map 上文定义的， $.map = function (elements, callback) &#123;....&#125;</span></span><br><span class="line">      <span class="comment">// $.map 作用：针对 elements（对象、对象数组或数组），对每个元素都经过 callback 函数的过滤，并将过滤通过的元素，push到一个新数组中，返回新数组</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 最后，用 $ 封装返回</span></span><br><span class="line">      <span class="keyword">return</span> $(</span><br><span class="line">        <span class="comment">// $.map 返回的是一个数组</span></span><br><span class="line">        $.map(</span><br><span class="line">          <span class="keyword">this</span>,</span><br><span class="line">          <span class="comment">// 针对每一个元素，都执行传入的函数，如果函数返回的 !=null 就将插入到新返回的数组</span></span><br><span class="line">          <span class="function"><span class="keyword">function</span>(<span class="params">el, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> fn.call(el, i, el);</span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        $('div').map(function(key, value)&#123;</span></span><br><span class="line"><span class="comment">          return value.id;</span></span><br><span class="line"><span class="comment">          // 或者 return this.id;</span></span><br><span class="line"><span class="comment">        &#125;)</span></span><br><span class="line"><span class="comment">        这个结果就是 $(['div1', 'div2' ...])</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    slice: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 直接数组的slice方法，并将结果用 $ 封装返回</span></span><br><span class="line">      <span class="keyword">return</span> $(slice.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>));</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在 zepto.init 函数中，当传入的函数是函数时，就用到了 ready</span></span><br><span class="line">    <span class="comment">// else if (isFunction(selector)) return $(document).ready(selector)</span></span><br><span class="line">    ready: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// need to check if document.body exists for IE as that browser reports</span></span><br><span class="line">      <span class="comment">// document ready when it hasn't yet created the body element</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 下文定义：readyRE = /complete|loaded|interactive/,</span></span><br><span class="line">      <span class="keyword">if</span> (readyRE.test(<span class="built_in">document</span>.readyState) &amp;&amp; <span class="built_in">document</span>.body) callback($);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">document</span>.addEventListener(</span><br><span class="line">          <span class="string">"DOMContentLoaded"</span>,</span><br><span class="line">          <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            callback($);</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="literal">false</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 返回当前对象</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    get: <span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> idx === <span class="literal">undefined</span></span><br><span class="line">        ? slice.call(<span class="keyword">this</span>) <span class="comment">// 未传参数，直接返回一整个数组</span></span><br><span class="line">        : <span class="comment">// 有参数，则试图返回单个元素（大于0，小于0 两种情况）</span></span><br><span class="line">          <span class="keyword">this</span>[idx &gt;= <span class="number">0</span> ? idx : idx + <span class="keyword">this</span>.length];</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将zepto集合变为纯数组</span></span><br><span class="line">    toArray: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.get();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    size: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.length;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将元素从这个DOM树中移除</span></span><br><span class="line">    remove: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.parentNode != <span class="literal">null</span>) <span class="keyword">this</span>.parentNode.removeChild(<span class="keyword">this</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    each: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// [].every ES5中Array的新特性。循环数组每个元素，返回是否符合callback函数的要求</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// every 函数返回的是 false 或者 true（不过这里返回什么无所谓，执行就可以了）</span></span><br><span class="line">      emptyArray.every.call(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el, idx</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> callback.call(el, idx, el) !== <span class="literal">false</span>;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 最后返回本身对象</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    filter: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// not函数下文定义</span></span><br><span class="line">      <span class="comment">// 如果给not传入的参数是函数，则返回不符合这个函数规则的元素的数组（用 $ 封装）</span></span><br><span class="line">      <span class="keyword">if</span> (isFunction(selector)) <span class="keyword">return</span> <span class="keyword">this</span>.not(<span class="keyword">this</span>.not(selector));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 上文定义：zepto.matches 判断elements是否符合 selector 的要求</span></span><br><span class="line">      <span class="comment">// zepto.matches = function(element, selector) &#123;...&#125;</span></span><br><span class="line">      <span class="keyword">return</span> $(</span><br><span class="line">        filter.call(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 利用 [].filter 方法做筛选，利用 zepto.matches 做判断</span></span><br><span class="line">          <span class="keyword">return</span> zepto.matches(element, selector);</span><br><span class="line">        &#125;)</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// $('div') 可能只有三个 div 节点，那么 $('div').add('p') 再三个 div 节点的基础上，增加三个 p 节点</span></span><br><span class="line">    add: <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// uniq函数——数组去重，例如：用来将 [1,1,2,2,3,3] 替换为 [1,2,3]</span></span><br><span class="line">      <span class="keyword">return</span> $(uniq(<span class="keyword">this</span>.concat($(selector, context))));</span><br><span class="line">    &#125;,</span><br><span class="line">    is: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 注意：这里只对 this[0] 第一个元素做判断了，其他的元素不管了</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.length &gt; <span class="number">0</span> &amp;&amp; zepto.matches(<span class="keyword">this</span>[<span class="number">0</span>], selector);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    not: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> nodes = []; <span class="comment">// 存储最后返回的结果</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果参数是函数</span></span><br><span class="line">      <span class="keyword">if</span> (isFunction(selector) &amp;&amp; selector.call !== <span class="literal">undefined</span>)</span><br><span class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 遍历对象的所有元素，对每个元素都执行传入的函数</span></span><br><span class="line">          <span class="comment">// 当函数返回 false 时（即不符合函数的规则），则将当前元素push到结果中，等待返回</span></span><br><span class="line">          <span class="keyword">if</span> (!selector.call(<span class="keyword">this</span>, idx)) nodes.push(<span class="keyword">this</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">      <span class="comment">// 如果参数不是函数</span></span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 为 excludes 赋值</span></span><br><span class="line">        <span class="keyword">var</span> excludes =</span><br><span class="line">          <span class="comment">// 如果 selector 是字符串（css选择器），则用filter过滤，将结果存储到 excludes 中</span></span><br><span class="line">          <span class="keyword">typeof</span> selector == <span class="string">"string"</span></span><br><span class="line">            ? <span class="keyword">this</span>.filter(selector)</span><br><span class="line">            : <span class="comment">// 如果 selector 不是字符串</span></span><br><span class="line">            <span class="comment">// 如果是数组或者对象数组（并且 selector.item 是函数？？？），则生成数组，赋值给 excludes</span></span><br><span class="line">            likeArray(selector) &amp;&amp; isFunction(selector.item)</span><br><span class="line">            ? slice.call(selector)</span><br><span class="line">            : <span class="comment">// 否则直接生成 zepto 对象，赋值给 excludes</span></span><br><span class="line">              $(selector);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 至此，excludes 中就存储了通过 selector 查找出来的元素</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// [].forEach 是ES5的新特性</span></span><br><span class="line">        <span class="keyword">this</span>.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 取出 excludes 中不包含的元素，push到结果中</span></span><br><span class="line">          <span class="keyword">if</span> (excludes.indexOf(el) &lt; <span class="number">0</span>) nodes.push(el);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 返回最后的结果，用 $ 封装</span></span><br><span class="line">      <span class="keyword">return</span> $(nodes);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    has: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 经过 filter 函数处理，返回的是一个处理后的值</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isObject(selector)</span><br><span class="line">          ? <span class="comment">// 如果 seletor 是 object（可能是elem节点），则用 $.contains 判断</span></span><br><span class="line">            $.contains(<span class="keyword">this</span>, selector)</span><br><span class="line">          : <span class="comment">// 否则（selector是css选择字符串）则返回find后的size（如果 size === 0 即相当于返回 false）</span></span><br><span class="line">            $(<span class="keyword">this</span>)</span><br><span class="line">              .find(selector)</span><br><span class="line">              .size();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// $.fn.find 在下文定义</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    eq: <span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 取出指定index的元素</span></span><br><span class="line">      <span class="comment">// 可支持 -1、0、1、2 ……</span></span><br><span class="line">      <span class="keyword">return</span> idx === <span class="number">-1</span> ? <span class="keyword">this</span>.slice(idx) : <span class="keyword">this</span>.slice(idx, +idx + <span class="number">1</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    first: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> el = <span class="keyword">this</span>[<span class="number">0</span>];</span><br><span class="line">      <span class="comment">// 不是 object 则直接返回</span></span><br><span class="line">      <span class="comment">// 是 object 类型，则用 $ 封装 （因为时刻都要支持链式操作！！！）</span></span><br><span class="line">      <span class="keyword">return</span> el &amp;&amp; !isObject(el) ? el : $(el);</span><br><span class="line">    &#125;,</span><br><span class="line">    last: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> el = <span class="keyword">this</span>[<span class="keyword">this</span>.length - <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">return</span> el &amp;&amp; !isObject(el) ? el : $(el);</span><br><span class="line">    &#125;,</span><br><span class="line">    find: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// result 存储返回结果</span></span><br><span class="line">      <span class="keyword">var</span> result,</span><br><span class="line">        $<span class="keyword">this</span> = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果没有参数，就返回一个空的 zepto 对象</span></span><br><span class="line">      <span class="keyword">if</span> (!selector) result = $();</span><br><span class="line">      <span class="comment">// 如果selector是对象</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">"object"</span>)</span><br><span class="line">        result = $(selector).filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> node = <span class="keyword">this</span>;</span><br><span class="line">          <span class="keyword">return</span> emptyArray.some.call($<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">parent</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> $.contains(parent, node);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      <span class="comment">// 如果 selector 不是对象（即是css选择器）：</span></span><br><span class="line">      <span class="comment">// 如果只有一个元素，则使用 qsa 判断，结果经过 $ 封装后赋值给 result</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.length == <span class="number">1</span>) result = $(zepto.qsa(<span class="keyword">this</span>[<span class="number">0</span>], selector));</span><br><span class="line">      <span class="comment">// 如果有多个元素，则使用 map 遍历所有元素，使用 qsa 针对每个元素判断，符合条件即返回（map将返回包含符合条件的元素的新数组，并 $ 封装，支持链式操作！！）</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        result = <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> zepto.qsa(<span class="keyword">this</span>, selector);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 返回最终结果</span></span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从元素本身开始，逐级向上级元素匹配，并返回最先匹配selector的元素</span></span><br><span class="line">    closest: <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> node = <span class="keyword">this</span>[<span class="number">0</span>],</span><br><span class="line">        collection = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果 selector 是对象，则用 $ 封装后，赋值给 collection</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">"object"</span>) collection = $(selector);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">while</span> (</span><br><span class="line">        <span class="comment">// while循环的判断条件：</span></span><br><span class="line">        <span class="comment">// 第一，node有值（node一开始被赋值为对象的第一个元素）</span></span><br><span class="line">        <span class="comment">// 第二，collection有值（传入的selector是对象）则collection包含node；collection无值（传入的selector是字符串，css选择），则node满足selector条件</span></span><br><span class="line">        <span class="comment">// 满足第一个条件，不满足第二条件，则循环继续（node试图赋值为node.parentNode）；否则，循环跳出（说明已经找到了符合条件的父节点）</span></span><br><span class="line">        node &amp;&amp;</span><br><span class="line">        !(collection</span><br><span class="line">          ? collection.indexOf(node) &gt;= <span class="number">0</span></span><br><span class="line">          : zepto.matches(node, selector))</span><br><span class="line">      )</span><br><span class="line">        <span class="comment">// node赋值成 node.parentNode</span></span><br><span class="line">        <span class="comment">// 前提条件是：node != context &amp;&amp; node 不是 document，如果是这两个条件之一，那就不继续赋值</span></span><br><span class="line">        node = node !== context &amp;&amp; !isDocument(node) &amp;&amp; node.parentNode;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 返回最终结果</span></span><br><span class="line">      <span class="keyword">return</span> $(node);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取对象集合每个元素所有的祖先元素。 $('h1').parents() =&gt; [&lt;div#container&gt;, &lt;body&gt;, &lt;html&gt;]</span></span><br><span class="line">    parents: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> ancestors = [],</span><br><span class="line">        nodes = <span class="keyword">this</span>;</span><br><span class="line">      <span class="keyword">while</span> (nodes.length &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// 可能需要执行多次 while 循环</span></span><br><span class="line">        <span class="comment">// 每次执行 $.map 函数都会对 nodes 重新赋值，然后再判断是否需要继续循环</span></span><br><span class="line">        <span class="comment">// 因为要获取每个元素的所有祖先元素，所以要多次循环</span></span><br><span class="line">        nodes = $.map(nodes, <span class="function"><span class="keyword">function</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 使用 $.map（返回符合条件的元素的新数组，并用 $ 封装）遍历所有元素</span></span><br><span class="line">          <span class="keyword">if</span> (</span><br><span class="line">            (node = node.parentNode) &amp;&amp;</span><br><span class="line">            !isDocument(node) &amp;&amp;</span><br><span class="line">            ancestors.indexOf(node) &lt; <span class="number">0</span></span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="comment">// 将符合条件的元素push到结果中</span></span><br><span class="line">            <span class="comment">// 条件：不能是 document，结果中元素不能重复。否则不执行push</span></span><br><span class="line">            ancestors.push(node);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 返回的 node ，将拼接出新数组，重新复制给 nodes，然后试图继续执行 while 循环</span></span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果css选择器参数给出，过滤出符合条件的元素</span></span><br><span class="line">      <span class="keyword">return</span> filtered(ancestors, selector);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取对象集合中每个元素的直接父元素。如果css选择器参数给出。过滤出符合条件的元素。</span></span><br><span class="line">    parent: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// pluck 函数在下文定义</span></span><br><span class="line">      <span class="comment">// parent 函数，只获取第一级父节点即可</span></span><br><span class="line">      <span class="keyword">return</span> filtered(uniq(<span class="keyword">this</span>.pluck(<span class="string">"parentNode"</span>)), selector);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得每个匹配元素集合元素的直接子元素，可通过 selector 过滤</span></span><br><span class="line">    children: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> filtered(</span><br><span class="line">        <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> children(<span class="keyword">this</span>);</span><br><span class="line">        &#125;),</span><br><span class="line">        selector</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得每个匹配元素集合元素的子元素，包括文字和注释节点</span></span><br><span class="line">    contents: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> slice.call(<span class="keyword">this</span>.childNodes);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取对象集合中所有元素的兄弟节点，可通过 selector 过滤</span></span><br><span class="line">    siblings: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> filtered(</span><br><span class="line">        <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params">i, el</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 获取兄弟节点</span></span><br><span class="line">          <span class="keyword">return</span> filter.call(children(el.parentNode), <span class="function"><span class="keyword">function</span>(<span class="params">child</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> child !== el;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;),</span><br><span class="line">        selector</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    empty: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.innerHTML = <span class="string">""</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// `pluck` is borrowed from Prototype.js</span></span><br><span class="line">    pluck: <span class="function"><span class="keyword">function</span>(<span class="params">property</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 获取自定义属性，返回值，拼接数组</span></span><br><span class="line">      <span class="keyword">return</span> $.map(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> el[property];</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    show: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 返回当前对象，保证可链式操作</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 第一步，针对内联样式，将 none 改为空字符串，如 &lt;p id="p2" style="display:none;"&gt;p2&lt;/p&gt;</span></span><br><span class="line">        <span class="keyword">this</span>.style.display == <span class="string">"none"</span> &amp;&amp; (<span class="keyword">this</span>.style.display = <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第二步，针对css样式，如果是 none 则修改为默认的显示样式</span></span><br><span class="line">        <span class="keyword">if</span> (getComputedStyle(<span class="keyword">this</span>, <span class="string">""</span>).getPropertyValue(<span class="string">"display"</span>) == <span class="string">"none"</span>)</span><br><span class="line">          <span class="keyword">this</span>.style.display = defaultDisplay(<span class="keyword">this</span>.nodeName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// show 方法是为了显示对象，而对象隐藏的方式有两种：内联样式 或 css样式</span></span><br><span class="line">        <span class="comment">// this.style.display 只能获取内联样式的值（获取属性值）</span></span><br><span class="line">        <span class="comment">// getComputedStyle(this, '').getPropertyValue("display") 可以获取内联、css样式的值（获取 renderTree 的值）</span></span><br><span class="line">        <span class="comment">// 因此，这两步都要做判断，</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    replaceWith: <span class="function"><span class="keyword">function</span>(<span class="params">newContent</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 先在前面插入，然后将当前对象移除</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.before(newContent).remove();</span><br><span class="line">    &#125;,</span><br><span class="line">    wrap: <span class="function"><span class="keyword">function</span>(<span class="params">structure</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 是否是函数</span></span><br><span class="line">      <span class="keyword">var</span> func = isFunction(structure);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; !func)</span><br><span class="line">        <span class="keyword">var</span> dom = $(structure).get(<span class="number">0</span>),</span><br><span class="line">          <span class="comment">// 何时用 clone ？</span></span><br><span class="line">          <span class="comment">// 第一，dom.parentNode 说明 dom 在文档结构中，不 clone 就会被移动</span></span><br><span class="line">          <span class="comment">// 第二，this.length &gt; 1 说明当前对象有多个元素，每个元素都要添加，所有要clone</span></span><br><span class="line">          clone = dom.parentNode || <span class="keyword">this</span>.length &gt; <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 借用 wrapAll 方法来做包装</span></span><br><span class="line">        $(<span class="keyword">this</span>).wrapAll(</span><br><span class="line">          func ? structure.call(<span class="keyword">this</span>, index) : clone ? dom.cloneNode(<span class="literal">true</span>) : dom</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 在所有匹配元素外面包一个单独的结构</span></span><br><span class="line">    wrapAll: <span class="function"><span class="keyword">function</span>(<span class="params">structure</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>[<span class="number">0</span>]) &#123;</span><br><span class="line">        <span class="comment">// 先将 structure 插入到文档结构</span></span><br><span class="line">        $(<span class="keyword">this</span>[<span class="number">0</span>]).before((structure = $(structure)));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> children;</span><br><span class="line">        <span class="comment">// drill down to the inmost element</span></span><br><span class="line">        <span class="comment">// 通过循环，将 structure 重新赋值为当前 structure 的最深处的一个子元素</span></span><br><span class="line">        <span class="keyword">while</span> ((children = structure.children()).length)</span><br><span class="line">          structure = children.first();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将所有子元素都包裹进 structure</span></span><br><span class="line">        $(structure).append(<span class="keyword">this</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 返回当前对象</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    wrapInner: <span class="function"><span class="keyword">function</span>(<span class="params">structure</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 是否是函数</span></span><br><span class="line">      <span class="keyword">var</span> func = isFunction(structure);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 返回对象自身，保证链式操作</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self = $(<span class="keyword">this</span>),</span><br><span class="line">          contents = self.contents(),</span><br><span class="line">          <span class="comment">// 是函数，即获取函数执行的返回结果；否则直接用 structure 参数</span></span><br><span class="line">          dom = func ? structure.call(<span class="keyword">this</span>, index) : structure;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果当前元素有内容，则通过内容 wrapAll。无内容，则直接用自身的 append 增加</span></span><br><span class="line">        contents.length ? contents.wrapAll(dom) : self.append(dom);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    unwrap: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 通过 this.parent() 获取每个元素的父节点（集合）</span></span><br><span class="line">      <span class="comment">// 遍历这个父节点的集合</span></span><br><span class="line">      <span class="keyword">this</span>.parent().each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 将当前父节点替换为它的子节点</span></span><br><span class="line">        $(<span class="keyword">this</span>).replaceWith($(<span class="keyword">this</span>).children());</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 返回对象自身，保证链式操作</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    clone: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 通过 this.map 循环对象，</span></span><br><span class="line">      <span class="comment">// 针对每个元素都返回它的clone         这个 this 和前面的 this 不一样</span></span><br><span class="line">      <span class="comment">// 返回新数组（用 $ 封装）</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.cloneNode(<span class="literal">true</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    hide: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.css(<span class="string">"display"</span>, <span class="string">"none"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 切换显示和隐藏</span></span><br><span class="line">    toggle: <span class="function"><span class="keyword">function</span>(<span class="params">setting</span>) </span>&#123;</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        @setting</span></span><br><span class="line"><span class="comment">        true : 强制切换为 show</span></span><br><span class="line"><span class="comment">        false : 强制切换为 hide</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> el = $(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 条件判断：</span></span><br><span class="line">        <span class="comment">// 如果 setting === undefined 则看 el.css("display") == "none"</span></span><br><span class="line">        <span class="comment">// 如果 setting !== undefined 则看 !!setting</span></span><br><span class="line">        (setting === <span class="literal">undefined</span></span><br><span class="line">        ? el.css(<span class="string">"display"</span>) == <span class="string">"none"</span></span><br><span class="line">        : setting)</span><br><span class="line">          ? el.show() <span class="comment">// 如果 true 则显示</span></span><br><span class="line">          : el.hide(); <span class="comment">// 如果 false 则隐藏</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 借助 previousElementSibling 属性</span></span><br><span class="line">    prev: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $(<span class="keyword">this</span>.pluck(<span class="string">"previousElementSibling"</span>)).filter(selector || <span class="string">"*"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 借助 nextElementSibling 属性</span></span><br><span class="line">    next: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $(<span class="keyword">this</span>.pluck(<span class="string">"nextElementSibling"</span>)).filter(selector || <span class="string">"*"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    html: <span class="function"><span class="keyword">function</span>(<span class="params">html</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 情况1：有参数，赋值，并返回自身</span></span><br><span class="line">      <span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span></span><br><span class="line">        ? <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> originHtml = <span class="keyword">this</span>.innerHTML;</span><br><span class="line">            <span class="comment">// 传入的 html 参数允许是一个字符串，也允许是一个函数</span></span><br><span class="line">            <span class="comment">// 通过 funcArg 函数：</span></span><br><span class="line">            <span class="comment">//  1.如果 html 是字符串，则返回html</span></span><br><span class="line">            <span class="comment">//  2.如果 html 是函数，则执行执行函数（传入 idx、originHtml），返回函数执行结果</span></span><br><span class="line">            $(<span class="keyword">this</span>)</span><br><span class="line">              .empty()</span><br><span class="line">              .append(funcArg(<span class="keyword">this</span>, html, idx, originHtml));</span><br><span class="line">          &#125;)</span><br><span class="line">        : <span class="comment">/*</span></span><br><span class="line"><span class="comment">          插播：</span></span><br><span class="line"><span class="comment">          function funcArg(context, arg, idx, payload) &#123;</span></span><br><span class="line"><span class="comment">            return isFunction(arg) ? arg.call(context, idx, payload) : arg</span></span><br><span class="line"><span class="comment">          &#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 情况2：无参数，取值</span></span><br><span class="line">        <span class="number">0</span> <span class="keyword">in</span> <span class="keyword">this</span></span><br><span class="line">        ? <span class="keyword">this</span>[<span class="number">0</span>].innerHTML <span class="comment">// 直接取第一个元素的 innerHTML</span></span><br><span class="line">        : <span class="literal">null</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    text: <span class="function"><span class="keyword">function</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 情况1：有参数，赋值，并返回自身</span></span><br><span class="line">      <span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span></span><br><span class="line">        ? <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// funcArg的应用，和html方法中一样</span></span><br><span class="line">            <span class="keyword">var</span> newText = funcArg(<span class="keyword">this</span>, text, idx, <span class="keyword">this</span>.textContent);</span><br><span class="line">            <span class="keyword">this</span>.textContent = newText == <span class="literal">null</span> ? <span class="string">""</span> : <span class="string">""</span> + newText;</span><br><span class="line">          &#125;)</span><br><span class="line">        : <span class="comment">// 情况2：无参数，取值</span></span><br><span class="line">        <span class="number">0</span> <span class="keyword">in</span> <span class="keyword">this</span></span><br><span class="line">        ? <span class="keyword">this</span>[<span class="number">0</span>].textContent</span><br><span class="line">        : <span class="literal">null</span>; <span class="comment">// 直接借用 textContent 属性</span></span><br><span class="line">    &#125;,</span><br><span class="line">    attr: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> result;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 情况1：无第二个参数，读取值（读取值只能读取第一个元素的值）</span></span><br><span class="line">      <span class="keyword">typeof</span> name == <span class="string">"string"</span> &amp;&amp; !(<span class="number">1</span> <span class="keyword">in</span> <span class="built_in">arguments</span>)</span><br><span class="line">        ? !<span class="keyword">this</span>.length || <span class="keyword">this</span>[<span class="number">0</span>].nodeType !== <span class="number">1</span></span><br><span class="line">          ? <span class="literal">undefined</span></span><br><span class="line">          : <span class="comment">/*</span></span><br><span class="line"><span class="comment">            注释：</span></span><br><span class="line"><span class="comment">            this[0]是一个DOM节点，有『属性』也有『特性』</span></span><br><span class="line"><span class="comment">              result = this[0].getAttribute(name) 试图获取 DOM节点属性</span></span><br><span class="line"><span class="comment">              name in this[0] 判断是不是js对象的属性</span></span><br><span class="line"><span class="comment">            然后，该返回哪一个就返回哪一个</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line">          !(result = <span class="keyword">this</span>[<span class="number">0</span>].getAttribute(name)) &amp;&amp; name <span class="keyword">in</span> <span class="keyword">this</span>[<span class="number">0</span>]</span><br><span class="line">          ? <span class="keyword">this</span>[<span class="number">0</span>][name]</span><br><span class="line">          : result</span><br><span class="line">        : <span class="comment">// 情况2：有第二个参数，设置值（针对每个元素设置值）</span></span><br><span class="line">          <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.nodeType !== <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 传入的参数可能是一个对象集合</span></span><br><span class="line">            <span class="comment">// 此时，是不是应该放在『情况1』当中？？？此时，value根本没有用啊？？？</span></span><br><span class="line">            <span class="keyword">if</span> (isObject(name))</span><br><span class="line">              <span class="keyword">for</span> (key <span class="keyword">in</span> name) setAttribute(<span class="keyword">this</span>, key, name[key]);</span><br><span class="line">            <span class="comment">// 传入的不是对象，即设置一个单一的属性。</span></span><br><span class="line">            <span class="comment">// 但是，这里的 value 参数可以是一个函数</span></span><br><span class="line">            <span class="comment">// funcArg 即处理了 value 是函数和非函数的两种情况</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">              setAttribute(</span><br><span class="line">                <span class="keyword">this</span>,</span><br><span class="line">                name,</span><br><span class="line">                funcArg(<span class="keyword">this</span>, value, idx, <span class="keyword">this</span>.getAttribute(name))</span><br><span class="line">              );</span><br><span class="line">          &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    removeAttr: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nodeType === <span class="number">1</span> &amp;&amp;</span><br><span class="line">          name.split(<span class="string">" "</span>).forEach(</span><br><span class="line">            <span class="function"><span class="keyword">function</span>(<span class="params">attribute</span>) </span>&#123;</span><br><span class="line">              setAttribute(<span class="keyword">this</span>, attribute); <span class="comment">// 将属性设置为空，setAttribute会移除属性</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">this</span> <span class="comment">// 改参数将成为 forEach 中函数的this</span></span><br><span class="line">          );</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取、设置属性（js对象的属性）</span></span><br><span class="line">    prop: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// propMap 中存储的：key是html中的属性名称，value是js对象中的属性名称</span></span><br><span class="line">      <span class="comment">// 例如，html中的 "class" 在DOM对象中，就需要使用 "className" 这个名字读取，同理于：for  maxlength  cellspacing 等等</span></span><br><span class="line">      name = propMap[name] || name;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        上文定义：</span></span><br><span class="line"><span class="comment">        propMap = &#123;</span></span><br><span class="line"><span class="comment">          'tabindex': 'tabIndex',</span></span><br><span class="line"><span class="comment">          'readonly': 'readOnly',</span></span><br><span class="line"><span class="comment">          'for': 'htmlFor',</span></span><br><span class="line"><span class="comment">          'class': 'className',</span></span><br><span class="line"><span class="comment">          'maxlength': 'maxLength',</span></span><br><span class="line"><span class="comment">          'cellspacing': 'cellSpacing',</span></span><br><span class="line"><span class="comment">          'cellpadding': 'cellPadding',</span></span><br><span class="line"><span class="comment">          'rowspan': 'rowSpan',</span></span><br><span class="line"><span class="comment">          'colspan': 'colSpan',</span></span><br><span class="line"><span class="comment">          'usemap': 'useMap',</span></span><br><span class="line"><span class="comment">          'frameborder': 'frameBorder',</span></span><br><span class="line"><span class="comment">          'contenteditable': 'contentEditable'</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 有第二个参数，设置属性</span></span><br><span class="line">      <span class="number">1</span> <span class="keyword">in</span> <span class="built_in">arguments</span></span><br><span class="line">        ? <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// 设置属性值，funcArg处理函数或者非函数</span></span><br><span class="line">            <span class="keyword">this</span>[name] = funcArg(<span class="keyword">this</span>, value, idx, <span class="keyword">this</span>[name]);</span><br><span class="line">          &#125;)</span><br><span class="line">        : <span class="comment">// 无第二个参数，读取属性（读取第一个元素的）</span></span><br><span class="line">          <span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; <span class="keyword">this</span>[<span class="number">0</span>][name];</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 前面加上 'data-' 通过 attr 设置或者读取</span></span><br><span class="line">    data: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>) </span>&#123;</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        上文定义：</span></span><br><span class="line"><span class="comment">        capitalRE = /([A-Z])/g,  //大写字母</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//      前面加上 'data-'               将 'A' 替换为 '-a'</span></span><br><span class="line">      <span class="keyword">var</span> attrName = <span class="string">"data-"</span> + name.replace(capitalRE, <span class="string">"-$1"</span>).toLowerCase();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> data =</span><br><span class="line">        <span class="number">1</span> <span class="keyword">in</span> <span class="built_in">arguments</span> ? <span class="keyword">this</span>.attr(attrName, value) : <span class="keyword">this</span>.attr(attrName);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> data !== <span class="literal">null</span> ? deserializeValue(data) : <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        上文定义的，deserializeValue 函数的作用是：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        // 将字符串变成响应的对象或者值，例如源代码的注释：</span></span><br><span class="line"><span class="comment">        // "true"  =&gt; true</span></span><br><span class="line"><span class="comment">        // "false" =&gt; false</span></span><br><span class="line"><span class="comment">        // "null"  =&gt; null</span></span><br><span class="line"><span class="comment">        // "42"    =&gt; 42</span></span><br><span class="line"><span class="comment">        // "42.5"  =&gt; 42.5</span></span><br><span class="line"><span class="comment">        // "08"    =&gt; "08"</span></span><br><span class="line"><span class="comment">        // JSON    =&gt; parse if valid</span></span><br><span class="line"><span class="comment">        // String  =&gt; self</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    val: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 有参数，设置值</span></span><br><span class="line">      <span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span></span><br><span class="line">        ? <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// 遍历每个元素，直接对 value 属性赋值</span></span><br><span class="line">            <span class="keyword">this</span>.value = funcArg(<span class="keyword">this</span>, value, idx, <span class="keyword">this</span>.value);</span><br><span class="line">          &#125;)</span><br><span class="line">        : <span class="comment">// 无参数，读取值</span></span><br><span class="line">          <span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp;</span><br><span class="line">          <span class="comment">// 如果元素是 &lt;select multiple&gt; 多选列表</span></span><br><span class="line">          (<span class="keyword">this</span>[<span class="number">0</span>].multiple</span><br><span class="line">            ? <span class="comment">// 返回所有选中的option的值的数组</span></span><br><span class="line">              $(<span class="keyword">this</span>[<span class="number">0</span>])</span><br><span class="line">                .find(<span class="string">"option"</span>)</span><br><span class="line">                .filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">this</span>.selected;</span><br><span class="line">                &#125;)</span><br><span class="line">                .pluck(<span class="string">"value"</span>)</span><br><span class="line">            : <span class="comment">/*</span></span><br><span class="line"><span class="comment">                      上文定义：</span></span><br><span class="line"><span class="comment">                      pluck: function(property)&#123;</span></span><br><span class="line"><span class="comment">                        return $.map(this, function(el)&#123; return el[property] &#125;)</span></span><br><span class="line"><span class="comment">                      &#125;,</span></span><br><span class="line"><span class="comment">                   */</span></span><br><span class="line"></span><br><span class="line">              <span class="comment">// 如果不是，直接获取 value</span></span><br><span class="line">              <span class="keyword">this</span>[<span class="number">0</span>].value);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取、设置元素的 offset</span></span><br><span class="line">    offset: <span class="function"><span class="keyword">function</span>(<span class="params">coordinates</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 如果有 coordinates 参数，设置坐标值，并返回当前对象</span></span><br><span class="line">      <span class="keyword">if</span> (coordinates)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),</span><br><span class="line">            <span class="comment">// 支持函数（传入 $this.offset() 做参数）和非函数</span></span><br><span class="line">            coords = funcArg(<span class="keyword">this</span>, coordinates, index, $<span class="keyword">this</span>.offset()),</span><br><span class="line">            <span class="comment">// 找到最近的 “relative”, “absolute” or “fixed” 的祖先元素，并获取它的 offset()</span></span><br><span class="line">            parentOffset = $<span class="keyword">this</span>.offsetParent().offset(),</span><br><span class="line">            <span class="comment">// left 和 top 需要去掉定位的祖先元素的 left、top 值</span></span><br><span class="line">            props = &#123;</span><br><span class="line">              top: coords.top - parentOffset.top,</span><br><span class="line">              left: coords.left - parentOffset.left</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// static时，设置 top、left是无效的</span></span><br><span class="line">          <span class="keyword">if</span> ($<span class="keyword">this</span>.css(<span class="string">"position"</span>) == <span class="string">"static"</span>) props[<span class="string">"position"</span>] = <span class="string">"relative"</span>;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 通过 css 赋值</span></span><br><span class="line">          $<span class="keyword">this</span>.css(props);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 当前对象是空，则返回 null</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果没有 coordinates 参数，则返回第一个元素的坐标值</span></span><br><span class="line">      <span class="keyword">var</span> obj = <span class="keyword">this</span>[<span class="number">0</span>].getBoundingClientRect();</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        elem.getBoundingClientRect() 返回一个对象，</span></span><br><span class="line"><span class="comment">        包含元素的 top bottom left right width height 的值</span></span><br><span class="line"><span class="comment">        但是这个 top、bottom、left、right 是相对于浏览器窗口的距离，而不是页面的边界</span></span><br><span class="line"><span class="comment">        （注意，elem.getBoundingClientRect()在IE低版本浏览器有2px的兼容问题）</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        window.pageXOffset 和 window.pageYOffset 可获取网页滚动的距离，</span></span><br><span class="line"><span class="comment">        IE低版本需要用 document.body.scrollLeft 和 document.body.scrollTop 兼容</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        left: obj.left + <span class="built_in">window</span>.pageXOffset,</span><br><span class="line">        top: obj.top + <span class="built_in">window</span>.pageYOffset,</span><br><span class="line">        width: <span class="built_in">Math</span>.round(obj.width),</span><br><span class="line">        height: <span class="built_in">Math</span>.round(obj.height)</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置、获取 css</span></span><br><span class="line">    css: <span class="function"><span class="keyword">function</span>(<span class="params">property, value</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 只有一个参数，获取第一个元素的样式</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> computedStyle,</span><br><span class="line">          element = <span class="keyword">this</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (!element) <span class="keyword">return</span>; <span class="comment">// 如果第一个元素无值，直接返回。否则继续</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取元素的计算后的样式</span></span><br><span class="line">        computedStyle = getComputedStyle(element, <span class="string">""</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> property == <span class="string">"string"</span>)</span><br><span class="line">          <span class="comment">// 情况1，参数为字符串形式</span></span><br><span class="line">          <span class="comment">// 先从elem内联样式获取（element.style），此时需要 camelize(property) 转换，如将 background-color 变为 backgroundColor</span></span><br><span class="line">          <span class="comment">// 如果未找到，则从css样式获取 computedStyle.getPropertyValue(property)</span></span><br><span class="line">          <span class="comment">// （重要）注释：elem.style 只能获取元素设置的内联样式、不能获取css样式；而 getComputedStyle 可获取内联、css样式。</span></span><br><span class="line">          <span class="keyword">return</span> (</span><br><span class="line">            element.style[camelize(property)] ||</span><br><span class="line">            computedStyle.getPropertyValue(property)</span><br><span class="line">          );</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (isArray(property)) &#123;</span><br><span class="line">          <span class="comment">// 情况2，参数为数组形式（注意，此时 isObject 情况尚未判断）</span></span><br><span class="line">          <span class="keyword">var</span> props = &#123;&#125;;</span><br><span class="line">          $.each(property, <span class="function"><span class="keyword">function</span>(<span class="params">_, prop</span>) </span>&#123;</span><br><span class="line">            props[prop] =</span><br><span class="line">              element.style[camelize(prop)] ||</span><br><span class="line">              computedStyle.getPropertyValue(prop);</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="keyword">return</span> props; <span class="comment">// 返回一个对象</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 其他情况：有两个参数、property是对象</span></span><br><span class="line">      <span class="keyword">var</span> css = <span class="string">""</span>;</span><br><span class="line">      <span class="keyword">if</span> (type(property) == <span class="string">"string"</span>) &#123;</span><br><span class="line">        <span class="comment">// 情况1，property 是字符串，设置单个样式</span></span><br><span class="line">        <span class="keyword">if</span> (!value &amp;&amp; value !== <span class="number">0</span>)</span><br><span class="line">          <span class="comment">// 如果value参数是 '' null undefined 则移除这个css样式</span></span><br><span class="line">          <span class="comment">// 注：此计算只适用于内联样式的删除，对 css 样式无效，因为它只通过 this.style.removeProperty 计算，而 this.style 获取不到css样式</span></span><br><span class="line">          <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.style.removeProperty(dasherize(property));</span><br><span class="line">          &#125;);</span><br><span class="line">        <span class="comment">// value有正常值，将 css 生成一个字符串（如 'font-size:20px'）等待赋值给内联样式</span></span><br><span class="line">        <span class="comment">// maybeAddPx(property, value) 需要增加 px 的增加上</span></span><br><span class="line">        <span class="keyword">else</span> css = dasherize(property) + <span class="string">":"</span> + maybeAddPx(property, value);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 情况2，property 是对象（此时就不管第二个参数是什么了，不用第二个参数），一次性设置多个样式</span></span><br><span class="line">        <span class="keyword">for</span> (key <span class="keyword">in</span> property)</span><br><span class="line">          <span class="keyword">if</span> (!property[key] &amp;&amp; property[key] !== <span class="number">0</span>)</span><br><span class="line">            <span class="comment">// 如果对象属性值是 '' null undefined 则移除这个css样式，同理，只针对内联样式</span></span><br><span class="line">            <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="keyword">this</span>.style.removeProperty(dasherize(key));</span><br><span class="line">            &#125;);</span><br><span class="line">          <span class="comment">// 否则，给 css 赋值一个字符串，多样式属性用 ; 隔开</span></span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            css += dasherize(key) + <span class="string">":"</span> + maybeAddPx(key, property[key]) + <span class="string">";"</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 针对每个元素，设置内联样式（this.style.cssText可获取、设置内联样式）</span></span><br><span class="line">      <span class="comment">// 最后返回自身</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.style.cssText += <span class="string">";"</span> + css;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        上文定义：</span></span><br><span class="line"><span class="comment">        // 将 lineHeight 转换为 line-height 格式</span></span><br><span class="line"><span class="comment">        function dasherize(str) &#123;</span></span><br><span class="line"><span class="comment">          return str.replace(/::/g, '/')</span></span><br><span class="line"><span class="comment">                    .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')</span></span><br><span class="line"><span class="comment">                    .replace(/([a-z\d])([A-Z])/g, '$1_$2')</span></span><br><span class="line"><span class="comment">                    .replace(/_/g, '-')</span></span><br><span class="line"><span class="comment">                    .toLowerCase()</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 获取一个元素的索引值（从0开始计数）。当elemen参数没有给出时，返回当前元素在兄弟节点中的位置</span></span><br><span class="line">    index: <span class="function"><span class="keyword">function</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        上文定义：</span></span><br><span class="line"><span class="comment">        $.fn.indexOf: emptyArray.indexOf</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 其实 this 本身就是一个数组，数组本身就有 indexOf ，为何还要上文的这个赋值呢？</span></span><br><span class="line">      <span class="comment">// 因为上文中，this.__proto__ 修改了，不是 Array.prototype 了，也就没有 indexOf 方法了</span></span><br><span class="line">      <span class="comment">// 因此要手动赋值，需要将数组常用的方法在重新赋值给 $.fn.indexOf</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> element</span><br><span class="line">        ? <span class="keyword">this</span>.indexOf($(element)[<span class="number">0</span>])</span><br><span class="line">        : <span class="keyword">this</span>.parent()</span><br><span class="line">            .children()</span><br><span class="line">            .indexOf(<span class="keyword">this</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;,</span><br><span class="line">    hasClass: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">return</span> emptyArray.some.call(</span><br><span class="line">        <span class="keyword">this</span>,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// this 就是 classRE(name) 的返回值（返回一个正则）</span></span><br><span class="line">          <span class="comment">// function className(node, value)&#123;...&#125; 获取或者设置elem的className</span></span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">this</span>.test(className(el));</span><br><span class="line">        &#125;,</span><br><span class="line">        classRE(name)</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">// array.some(callback,[ thisObject]); 只要数组中一项符合callback要求，即返回true</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        // 上文定义 classCache = &#123;&#125;</span></span><br><span class="line"><span class="comment">        function classRE(name) &#123;</span></span><br><span class="line"><span class="comment">          return name in classCache ?</span></span><br><span class="line"><span class="comment">                 classCache[name] : </span></span><br><span class="line"><span class="comment">                 (classCache[name] = new RegExp('(^|\\s)' + name + '(\\s|$)'))</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">          // classCache 存储的数据是这样的：</span></span><br><span class="line"><span class="comment">          // &#123;</span></span><br><span class="line"><span class="comment">          //   abc: /(^|\s)abc(\s|$)/,  // 能匹配 'abc' 或 ' abc ' 或 ' abc' 或 'abc '</span></span><br><span class="line"><span class="comment">          //   xyz: /(^|\s)abc(\s|$)/,</span></span><br><span class="line"><span class="comment">          //   ...</span></span><br><span class="line"><span class="comment">          // &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    addClass: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 针对所有元素都添加className，最终返回本身</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 说明当前元素不是 DOM node</span></span><br><span class="line">        <span class="keyword">if</span> (!(<span class="string">"className"</span> <span class="keyword">in</span> <span class="keyword">this</span>)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// classList 是一开始就定义的空变量</span></span><br><span class="line">        classList = [];</span><br><span class="line">        <span class="comment">// 获取元素的 clasname      // 支持传入函数</span></span><br><span class="line">        <span class="keyword">var</span> cls = className(<span class="keyword">this</span>),</span><br><span class="line">          newName = funcArg(<span class="keyword">this</span>, name, idx, cls);</span><br><span class="line">        <span class="comment">// 把要赋值的值，按照空白分组，遍历</span></span><br><span class="line">        newName.split(<span class="regexp">/\s+/g</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">klass</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 把当前元素不存在的class，push到classlist中</span></span><br><span class="line">          <span class="keyword">if</span> (!$(<span class="keyword">this</span>).hasClass(klass)) classList.push(klass);</span><br><span class="line">        &#125;, <span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// 如果classlist有数据，则为当前元素赋值最新的class值（现有的classname和新的classname拼接）</span></span><br><span class="line">        classList.length &amp;&amp;</span><br><span class="line">          className(<span class="keyword">this</span>, cls + (cls ? <span class="string">" "</span> : <span class="string">""</span>) + classList.join(<span class="string">" "</span>));</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    removeClass: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 针对所有元素都移除className，最终返回本身</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 说明当前元素不是 DOM node</span></span><br><span class="line">        <span class="keyword">if</span> (!(<span class="string">"className"</span> <span class="keyword">in</span> <span class="keyword">this</span>)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果参数空，则移除元素的所有class</span></span><br><span class="line">        <span class="keyword">if</span> (name === <span class="literal">undefined</span>) <span class="keyword">return</span> className(<span class="keyword">this</span>, <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取现有的classname</span></span><br><span class="line">        classList = className(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// （可以传入函数）遍历新的classname字符串</span></span><br><span class="line">        funcArg(<span class="keyword">this</span>, name, idx, classList)</span><br><span class="line">          .split(<span class="regexp">/\s+/g</span>)</span><br><span class="line">          .forEach(<span class="function"><span class="keyword">function</span>(<span class="params">klass</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// classRE(klass) 返回一个正则，匹配 'classname' 或 ' classname ' 或 ' classname' 或 'classname '</span></span><br><span class="line">            <span class="comment">// 针对传入的classname字符串，对每个符合条件的classname，都替换为 ' '（即删除了）</span></span><br><span class="line">            classList = classList.replace(classRE(klass), <span class="string">" "</span>);</span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对整理好的classname，重新赋值给当前元素</span></span><br><span class="line">        className(<span class="keyword">this</span>, classList.trim());</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    toggleClass: <span class="function"><span class="keyword">function</span>(<span class="params">name, when</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// when 参数相当于一个条件：</span></span><br><span class="line">      <span class="comment">// 如果 when === true 则单纯执行 addClass</span></span><br><span class="line">      <span class="comment">// 如果 when === false 则单纯执行 removeClass</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//                   name 可接收函数，可以是空白分割开来的多个classname</span></span><br><span class="line">        <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),</span><br><span class="line">          names = funcArg(<span class="keyword">this</span>, name, idx, className(<span class="keyword">this</span>));</span><br><span class="line">        <span class="comment">// 用空白分割开多个class</span></span><br><span class="line">        names.split(<span class="regexp">/\s+/g</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">klass</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 如果有 when 参数，则只通过when参数判断，true则只执行addClass，false则只执行removeClass</span></span><br><span class="line">          <span class="comment">// 如果没有 when 参数，则判断元素有没有该class，有则移除，没有则添加</span></span><br><span class="line">          (when === <span class="literal">undefined</span></span><br><span class="line">          ? !$<span class="keyword">this</span>.hasClass(klass)</span><br><span class="line">          : when)</span><br><span class="line">            ? $<span class="keyword">this</span>.addClass(klass)</span><br><span class="line">            : $<span class="keyword">this</span>.removeClass(klass);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    scrollTop: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 普通elem有 scrollTop 属性，可以获取或者设置top值</span></span><br><span class="line">      <span class="comment">// window对象没有 scrollTop 属性，通过 pageYOffset 获取，通过 scrollTo() 赋值</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> hasScrollTop = <span class="string">"scrollTop"</span> <span class="keyword">in</span> <span class="keyword">this</span>[<span class="number">0</span>];</span><br><span class="line">      <span class="comment">// value 无值，获取 top</span></span><br><span class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>)</span><br><span class="line">        <span class="keyword">return</span> hasScrollTop ? <span class="keyword">this</span>[<span class="number">0</span>].scrollTop : <span class="keyword">this</span>[<span class="number">0</span>].pageYOffset;</span><br><span class="line">      <span class="comment">// value 有值，设置 top</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(</span><br><span class="line">        hasScrollTop</span><br><span class="line">          ? <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="keyword">this</span>.scrollTop = value;</span><br><span class="line">            &#125;</span><br><span class="line">          : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="keyword">this</span>.scrollTo(<span class="keyword">this</span>.scrollX, value);</span><br><span class="line">            &#125;</span><br><span class="line">      ); <span class="comment">// window.scrollX 获取横向滚动值</span></span><br><span class="line">    &#125;,</span><br><span class="line">    scrollLeft: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">var</span> hasScrollLeft = <span class="string">"scrollLeft"</span> <span class="keyword">in</span> <span class="keyword">this</span>[<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>)</span><br><span class="line">        <span class="keyword">return</span> hasScrollLeft ? <span class="keyword">this</span>[<span class="number">0</span>].scrollLeft : <span class="keyword">this</span>[<span class="number">0</span>].pageXOffset;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(</span><br><span class="line">        hasScrollLeft</span><br><span class="line">          ? <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="keyword">this</span>.scrollLeft = value;</span><br><span class="line">            &#125;</span><br><span class="line">          : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="keyword">this</span>.scrollTo(value, <span class="keyword">this</span>.scrollY);</span><br><span class="line">            &#125;</span><br><span class="line">      ); <span class="comment">// window.scrollX 获取纵向滚动值</span></span><br><span class="line">    &#125;,</span><br><span class="line">    position: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> elem = <span class="keyword">this</span>[<span class="number">0</span>],</span><br><span class="line">        <span class="comment">// Get *real* offsetParent</span></span><br><span class="line">        offsetParent = <span class="keyword">this</span>.offsetParent(), <span class="comment">// 找到第一个定位过的祖先元素 “relative”, “absolute” or “fixed”</span></span><br><span class="line">        <span class="comment">// Get correct offsets</span></span><br><span class="line">        offset = <span class="keyword">this</span>.offset(), <span class="comment">// 获取自身的offset</span></span><br><span class="line">        parentOffset = rootNodeRE.test(offsetParent[<span class="number">0</span>].nodeName)</span><br><span class="line">          ? &#123; <span class="attr">top</span>: <span class="number">0</span>, <span class="attr">left</span>: <span class="number">0</span> &#125;</span><br><span class="line">          : offsetParent.offset(); <span class="comment">// 获取定位祖先元素的offset（ body、html直接设置 top:0;left:0 ）</span></span><br><span class="line">      <span class="comment">// 上文定义： rootNodeRE = /^(?:body|html)$/i,</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 去掉当前元素的 margin 宽度</span></span><br><span class="line">      <span class="comment">// Subtract element margins</span></span><br><span class="line">      <span class="comment">// note: when an element has margin: auto the offsetLeft and marginLeft</span></span><br><span class="line">      <span class="comment">// are the same in Safari causing offset.left to incorrectly be 0</span></span><br><span class="line">      offset.top -= <span class="built_in">parseFloat</span>($(elem).css(<span class="string">"margin-top"</span>)) || <span class="number">0</span>;</span><br><span class="line">      offset.left -= <span class="built_in">parseFloat</span>($(elem).css(<span class="string">"margin-left"</span>)) || <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 增加父元素的 border 宽度</span></span><br><span class="line">      <span class="comment">// Add offsetParent borders</span></span><br><span class="line">      parentOffset.top +=</span><br><span class="line">        <span class="built_in">parseFloat</span>($(offsetParent[<span class="number">0</span>]).css(<span class="string">"border-top-width"</span>)) || <span class="number">0</span>;</span><br><span class="line">      parentOffset.left +=</span><br><span class="line">        <span class="built_in">parseFloat</span>($(offsetParent[<span class="number">0</span>]).css(<span class="string">"border-left-width"</span>)) || <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Subtract the two offsets</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        top: offset.top - parentOffset.top,</span><br><span class="line">        left: offset.left - parentOffset.left</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    offsetParent: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 通过 this.map 遍历当前对象所有元素，进行计算，然后拼接新的数组，并返回。保证链式操作</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> parent = <span class="keyword">this</span>.offsetParent || <span class="built_in">document</span>.body; <span class="comment">// elem.offsetParent 可返回最近的改元素最近的已经定位的父元素</span></span><br><span class="line">        <span class="keyword">while</span> (</span><br><span class="line">          parent &amp;&amp;</span><br><span class="line">          !rootNodeRE.test(parent.nodeName) &amp;&amp;</span><br><span class="line">          $(parent).css(<span class="string">"position"</span>) == <span class="string">"static"</span></span><br><span class="line">        )</span><br><span class="line">          <span class="comment">// 如果获取的parent不是null、不是body或html、而且position==static</span></span><br><span class="line">          <span class="comment">// 则继续向上查找 offsetParent、大不了找到 body 为止</span></span><br><span class="line">          parent = parent.offsetParent;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 最后返回改元素</span></span><br><span class="line">        <span class="keyword">return</span> parent;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for now</span></span><br><span class="line">  $.fn.detach = $.fn.remove;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Generate the `width` and `height` functions</span></span><br><span class="line">  [<span class="string">"width"</span>, <span class="string">"height"</span>].forEach(<span class="function"><span class="keyword">function</span>(<span class="params">dimension</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 将 width height 变为  Width Height</span></span><br><span class="line">    <span class="keyword">var</span> dimensionProperty = dimension.replace(<span class="regexp">/./</span>, <span class="function"><span class="keyword">function</span>(<span class="params">m</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> m[<span class="number">0</span>].toUpperCase();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    $.fn[dimension] = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> offset,</span><br><span class="line">        el = <span class="keyword">this</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 情况1，无参数，获取第一个元素的值</span></span><br><span class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>)</span><br><span class="line">        <span class="keyword">return</span> isWindow(el)</span><br><span class="line">          ? el[<span class="string">"inner"</span> + dimensionProperty] <span class="comment">// window.innerHeight</span></span><br><span class="line">          : isDocument(el)</span><br><span class="line">          ? el.documentElement[<span class="string">"scroll"</span> + dimensionProperty] <span class="comment">// document.documentElement.scrollHeight</span></span><br><span class="line">          : (offset = <span class="keyword">this</span>.offset()) &amp;&amp; offset[dimension];</span><br><span class="line">      <span class="comment">// this.offset().width</span></span><br><span class="line">      <span class="comment">// 情况2，有参数，设置所有元素的值</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">          el = $(<span class="keyword">this</span>);</span><br><span class="line">          <span class="comment">// 通过 css() 方法设置，支持传入函数</span></span><br><span class="line">          el.css(dimension, funcArg(<span class="keyword">this</span>, value, idx, el[dimension]()));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 针对当前元素、遍历子元素，都执行 fun 函数</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">traverseNode</span>(<span class="params">node, fun</span>) </span>&#123;</span><br><span class="line">    fun(node);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = node.childNodes.length; i &lt; len; i++)</span><br><span class="line">      traverseNode(node.childNodes[i], fun);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 上文定义 adjacencyOperators = [ 'after', 'prepend', 'before', 'append' ],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Generate the `after`, `prepend`, `before`, `append`,</span></span><br><span class="line">  <span class="comment">// `insertAfter`, `insertBefore`, `appendTo`, and `prependTo` methods.</span></span><br><span class="line">  adjacencyOperators.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">operator, operatorIndex</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> inside = operatorIndex % <span class="number">2</span>; <span class="comment">//=&gt; prepend, append</span></span><br><span class="line"></span><br><span class="line">    $.fn[operator] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// arguments can be nodes, arrays of nodes, Zepto objects and HTML strings</span></span><br><span class="line">      <span class="keyword">var</span> argType,</span><br><span class="line">        nodes = $.map(<span class="built_in">arguments</span>, <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">          argType = type(arg);</span><br><span class="line">          <span class="keyword">return</span> argType == <span class="string">"object"</span> || argType == <span class="string">"array"</span> || arg == <span class="literal">null</span></span><br><span class="line">            ? arg</span><br><span class="line">            : zepto.fragment(arg);</span><br><span class="line">        &#125;),</span><br><span class="line">        parent,</span><br><span class="line">        copyByClone = <span class="keyword">this</span>.length &gt; <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> (nodes.length &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">_, target</span>) </span>&#123;</span><br><span class="line">        parent = inside ? target : target.parentNode;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// convert all methods to a "before" operation</span></span><br><span class="line">        target =</span><br><span class="line">          operatorIndex == <span class="number">0</span></span><br><span class="line">            ? target.nextSibling</span><br><span class="line">            : operatorIndex == <span class="number">1</span></span><br><span class="line">            ? target.firstChild</span><br><span class="line">            : operatorIndex == <span class="number">2</span></span><br><span class="line">            ? target</span><br><span class="line">            : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> parentInDocument = $.contains(<span class="built_in">document</span>.documentElement, parent);</span><br><span class="line"></span><br><span class="line">        nodes.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (copyByClone) node = node.cloneNode(<span class="literal">true</span>);</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (!parent) <span class="keyword">return</span> $(node).remove();</span><br><span class="line"></span><br><span class="line">          parent.insertBefore(node, target);</span><br><span class="line">          <span class="keyword">if</span> (parentInDocument)</span><br><span class="line">            traverseNode(node, <span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">              <span class="keyword">if</span> (</span><br><span class="line">                el.nodeName != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">                el.nodeName.toUpperCase() === <span class="string">"SCRIPT"</span> &amp;&amp;</span><br><span class="line">                (!el.type || el.type === <span class="string">"text/javascript"</span>) &amp;&amp;</span><br><span class="line">                !el.src</span><br><span class="line">              )</span><br><span class="line">                <span class="built_in">window</span>[<span class="string">"eval"</span>].call(<span class="built_in">window</span>, el.innerHTML);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// after    =&gt; insertAfter</span></span><br><span class="line">    <span class="comment">// prepend  =&gt; prependTo</span></span><br><span class="line">    <span class="comment">// before   =&gt; insertBefore</span></span><br><span class="line">    <span class="comment">// append   =&gt; appendTo</span></span><br><span class="line">    $.fn[</span><br><span class="line">      inside ? operator + <span class="string">"To"</span> : <span class="string">"insert"</span> + (operatorIndex ? <span class="string">"Before"</span> : <span class="string">"After"</span>)</span><br><span class="line">    ] = <span class="function"><span class="keyword">function</span>(<span class="params">html</span>) </span>&#123;</span><br><span class="line">      $(html)[operator](<span class="keyword">this</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  zepto.Z.prototype = $.fn;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Export internal API functions in the `$.zepto` namespace</span></span><br><span class="line">  zepto.uniq = uniq;</span><br><span class="line">  zepto.deserializeValue = deserializeValue;</span><br><span class="line">  $.zepto = zepto;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> $;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.Zepto = Zepto;</span><br><span class="line"><span class="built_in">window</span>.$ === <span class="literal">undefined</span> &amp;&amp; (<span class="built_in">window</span>.$ = Zepto);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 前端框架 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zepto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zepto 对象思想与源码分析</title>
      <link href="/2020/03/12/zepto/"/>
      <url>/2020/03/12/zepto/</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="http://www.kancloud.cn/wangfupeng/zepto-design-srouce/173680" target="_blank" rel="noopener">zepto 对象思想与源码分析</a></p></blockquote><a id="more"></a><h2 id="原型对象"><a href="#原型对象" class="headerlink" title="原型对象"></a>原型对象</h2><h3 id="Array-prototype"><a href="#Array-prototype" class="headerlink" title="Array.prototype"></a><code>Array.prototype</code></h3><p><strong>每一个函数，都有一个 prototype 属性</strong>，不管是你自定义的，还是函数内置的。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(fn.prototype); <span class="comment">// &#123;constructor: ƒ&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(fn.prototype.constructor === fn); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/19526072/53319611-f76d3c00-390d-11e9-8542-313fa56bffab.png" alt="image"></p><p>这里的 <code>fn.prototype</code> 打印出一个对象，对象里的 <code>constructor</code> 属性又指回了该函数本身 fn。</p><p>即<strong>每一个原型对象都有一个 consctructor 属性指向关联的构造函数</strong>，比如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.constructor === <span class="built_in">Array</span>; <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/19526072/53319627-ff2ce080-390d-11e9-8dab-3659d53b1296.png" alt="image"></p><p>我们接着看：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.prototype); <span class="comment">// [constructor: ƒ, concat: ƒ, copyWithin: ƒ, fill: ƒ, find: ƒ, …]</span></span><br></pre></td></tr></table></figure><p>这里，除了 constructor 属性，还有其他内置的属性，即我们经常使用的操作数组的方法。</p><h3 id="proto-隐式原型"><a href="#proto-隐式原型" class="headerlink" title="__proto__(隐式原型)"></a><code>__proto__</code>(隐式原型)</h3><p>所有通过函数 <code>new</code> （构造函数）出来的实例对象，都有一个 <code>__proto__</code>属性，指向该对象的 <code>prototype</code>，比如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">arr.__proto__ === <span class="built_in">Array</span>.prototype; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/19526072/53319688-2f747f00-390e-11e9-9555-af336e12b587.png" alt="image"></p><p>原型链：由相互关联的原型(<code>__proto__</code>)组成的链状结构就是原型链。</p><p>举个关于继承 extends 的例子：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.eat = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Animal eat"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.bark = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Dog bark"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 绑定原型，实现继承</span></span><br><span class="line">Dog.prototype = <span class="keyword">new</span> Animal();</span><br><span class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> Dog();</span><br><span class="line"></span><br><span class="line">dog.eat(); <span class="comment">// Animal eat</span></span><br><span class="line">dog.bark(); <span class="comment">// Dog bark</span></span><br></pre></td></tr></table></figure><p>上面看明白了，那么 ES6 的继承我们也就可以明白原理了，即 <code>class Dog extends Animal</code> 相当于 <code>Dog.prototype = new Animal()</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">  eat() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Animal eat!"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">super</span>(name);</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">  bark() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Dog bark!"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dog = <span class="keyword">new</span> Dog(<span class="string">"哈士奇"</span>);</span><br><span class="line">dog.eat();</span><br><span class="line">dog.bark();</span><br></pre></td></tr></table></figure><p>接下来，我们就清楚为什么能这样：</p><p><strong>当我们要使用一个对象（数组）的某个功能时，如果该对象本身具有这个功能，直接调用，没有的话，那就去自身的<code>__proto__</code>属性中去找</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  myfn: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"myfn"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj.myfn(); <span class="comment">// 'myfn'</span></span><br><span class="line">obj.hasOwnProperty(<span class="string">"myfn"</span>); <span class="comment">//true</span></span><br><span class="line">obj.toString(); <span class="comment">// "[object Object]"</span></span><br><span class="line">obj.hasOwnProperty(<span class="string">"toString"</span>); <span class="comment">// false</span></span><br><span class="line">obj.__proto__.hasOwnProperty(<span class="string">"toString"</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p><code>hasOwnProperty()</code>就可以得出这个属性是否是属于该对象本身的属性:</p><ul><li>myfn 是我们自定义的，<code>obj.hasOwnProperty(&#39;myfn&#39;)</code>为 true</li><li>toString() 我们不是自定义的，却可以使用，查一下是否属于自定义属性，<code>obj.hasOwnProperty(&#39;toString&#39;)</code>，答案为 false</li><li>既然不属于自定义属性，那就去自身的<code>__proto__</code>去找，然后去原型对象上查一下，<code>obj.__proto__.hasOwnProperty(&#39;toString&#39;)</code>，哦，原来在这儿</li></ul><p>在源码中，我们经常看到<code>Array.prototype.concat</code>，其实就是我们使用的<code>[].concat</code>，<code>[]</code>，因为<code>[].__proto__ === Array.prototype</code></p><h3 id="proto-是可修改的"><a href="#proto-是可修改的" class="headerlink" title="__proto__是可修改的"></a><code>__proto__</code>是可修改的</h3><p>比如，我们新增一个<code>addClass()</code>方法：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">arr.__proto__.addClass = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">123</span>);</span><br><span class="line">&#125;;</span><br><span class="line">arr.push(<span class="number">4</span>);</span><br><span class="line">arr.addClass(); <span class="comment">// 123</span></span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/19526072/53319708-44e9a900-390e-11e9-9899-6c303f5467aa.png" alt="image"></p><p>但是，这里要注意，如下重写之后，就没有了诸如 push、concat 等方法：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">arr.__proto__ = &#123;</span><br><span class="line">  addClass: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">123</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">arr.push(<span class="number">3</span>); <span class="comment">//Uncaught TypeError: arr.push is not a function</span></span><br></pre></td></tr></table></figure><h3 id="Object-prototype的原型"><a href="#Object-prototype的原型" class="headerlink" title="Object.prototype的原型"></a><code>Object.prototype</code>的原型</h3><p>万物皆对象，到最后依旧是对象，最后这个东东是个啥，我们来看一下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构造函数 Person</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例对象 myfn，它的 隐式原型 指向了其构造函数的 原型对象</span></span><br><span class="line"><span class="keyword">var</span> myfn = <span class="keyword">new</span> Person();</span><br><span class="line">myfn.__proto__ === Person.prototype; <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 那构造函数 Person 的 隐式原型又指向了谁呢</span></span><br><span class="line">Person.prototype.__proto__ === <span class="built_in">Object</span>.prototype; <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Function呐</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.__proto__ === <span class="built_in">Object</span>.prototype; <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个呢</span></span><br><span class="line"><span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">fn.prototype.__proto__ === <span class="built_in">Object</span>.prototype; <span class="comment">//true</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.__proto__ === <span class="literal">null</span>; <span class="comment">//true</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">null</span>; <span class="comment">//"object"</span></span><br></pre></td></tr></table></figure><p>总结：</p><ul><li><p>所有的函数都有一个 <code>prototype</code>属性，该属性指向了一个对象，该对象就是调用该构造函数而创建出来的实例（如 myfn）的原型（如<code>myfn.__proto__</code>）,即：<code>myfn.__proto__ === Person.prototype</code></p></li><li><p>所有的对象（除 null）都具有一个<code>__proto__</code>属性，该属性指向该对象的原型，比如：<code>myfn.__proto__ === Person.prototype</code></p></li><li><p>原型也是一个对象，根据上条，那原型的原型，就是<code>Object.prototype</code></p></li><li><p>最后的 null 对象，可以当做是 什么都没有</p></li></ul><p>盗一张图，我们就更加清楚了（蓝色这条表示的是原型链）<br><img src="https://user-images.githubusercontent.com/19526072/53319411-64340680-390d-11e9-80b9-4b86736291b2.png" alt="image"></p><p>参考资料：</p><ul><li><a href="https://www.kancloud.cn/wangfupeng/zepto-design-srouce/173684" target="_blank" rel="noopener">js 原型链基础</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/2" target="_blank" rel="noopener">JavaScript 深入之从原型到原型链 </a></li><li><a href="https://www.cnblogs.com/wangfupeng1988/p/3978131.html" target="_blank" rel="noopener">深入理解 javascript 原型和闭包（3）——prototype 原型</a></li></ul><h2 id="Zepto-对象设计"><a href="#Zepto-对象设计" class="headerlink" title="Zepto 对象设计"></a>Zepto 对象设计</h2><h3 id="主体设计"><a href="#主体设计" class="headerlink" title="主体设计"></a>主体设计</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Zepto = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> $,</span><br><span class="line">    zepto = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...省略N行代码...</span></span><br><span class="line"></span><br><span class="line">  zepto.Z = <span class="function"><span class="keyword">function</span>(<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">    dom = dom || [];</span><br><span class="line">    dom.__proto__ = $.fn; <span class="comment">// 关键位置</span></span><br><span class="line">    dom.selector = selector || <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">return</span> dom;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  zepto.init = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dom;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 针对参数情况，分别对dom赋值</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最终调用 zepto.Z 返回的数据</span></span><br><span class="line">    <span class="keyword">return</span> zepto.Z(dom, selector);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  $ = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> zepto.init(selector, context);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 里面有若干个工具函数</span></span><br><span class="line">  $.fn = &#123;</span><br><span class="line">    forEach: emptyArray.forEach,</span><br><span class="line">    <span class="comment">// ...省略N行代码...</span></span><br><span class="line">    concat: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    <span class="comment">// ...省略N行代码...</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...省略N行代码...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> $;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.Zepto = Zepto;</span><br><span class="line"><span class="built_in">window</span>.$ === <span class="literal">undefined</span> &amp;&amp; (<span class="built_in">window</span>.$ = Zepto);</span><br></pre></td></tr></table></figure><h3 id="自定义模拟"><a href="#自定义模拟" class="headerlink" title="自定义模拟"></a>自定义模拟</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">window</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> $,</span><br><span class="line">    zepto = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Z</span>(<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i,</span><br><span class="line">      len = dom.length ? dom.length : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; dom.length; i++) &#123;</span><br><span class="line">      <span class="keyword">this</span>[i] = dom[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.length = len;</span><br><span class="line">    <span class="keyword">this</span>.selector = selector || <span class="string">""</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  zepto.Z = <span class="function"><span class="keyword">function</span>(<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Z(dom, selector);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  zepto.init = <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> slice = <span class="built_in">Array</span>.prototype.slice;</span><br><span class="line">    <span class="keyword">var</span> dom = slice.call(<span class="built_in">document</span>.querySelectorAll(selector));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> zepto.Z(dom, selector);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  $ = <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> zepto.init(selector);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  $.fn = &#123;</span><br><span class="line">    css: <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"css"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    html: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"html"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  Z.prototype = $.fn;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.$ = $;</span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure><p>流程：<code>$() -&gt; zepto.init() -&gt; zepto.Z() -&gt; new Z() -&gt; Z.prototype = $.fn;</code></p><h3 id="最新版（v1-2-0）模拟"><a href="#最新版（v1-2-0）模拟" class="headerlink" title="最新版（v1.2.0）模拟"></a>最新版（v1.2.0）模拟</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自执行匿名函数(IIFE，立即调用函数表达式)</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">global, factory</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// amd 规范</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">"function"</span> &amp;&amp; define.amd) &#123;</span><br><span class="line">    define(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> factory(global);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    factory(global);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">window</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> Zepto = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $;</span><br><span class="line">    <span class="keyword">var</span> zepto = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 大Z构造函数</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Z</span>(<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> i,</span><br><span class="line">        len = dom ? dom.length : <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++) <span class="keyword">this</span>[i] = dom[i];</span><br><span class="line">      <span class="keyword">this</span>.length = len;</span><br><span class="line">      <span class="keyword">this</span>.selector = selector || <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// zepto.Z() 返回大Z构造函数的实例，方便实例对象的 __proto 就会指向 Z.prototype</span></span><br><span class="line">    zepto.Z = <span class="function"><span class="keyword">function</span>(<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Z(dom, selector);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析 DOM，并调用 zepto.Z()</span></span><br><span class="line">    zepto.init = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 自定义模拟方法，源码并非这样简单</span></span><br><span class="line">      <span class="keyword">var</span> slice = <span class="built_in">Array</span>.prototype.slice;</span><br><span class="line">      <span class="keyword">var</span> dom = slice.call(<span class="built_in">document</span>.querySelectorAll(selector));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// create a new Zepto collection from the nodes found</span></span><br><span class="line">      <span class="keyword">return</span> zepto.Z(dom, selector);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第一步初始化</span></span><br><span class="line">    $ = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> zepto.init(selector, context);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方法属性</span></span><br><span class="line">    $.fn = &#123;</span><br><span class="line">      <span class="keyword">constructor</span>: zepto.Z, // 手动绑定 <span class="keyword">constructor</span> 属性</span><br><span class="line">      length: 0,</span><br><span class="line">      push: "push method",</span><br><span class="line">      css: function() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"css"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;  <span class="comment">// 返回 this，可以链式调用</span></span><br><span class="line">      &#125;,</span><br><span class="line">      html: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"html"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    $.fn.on = <span class="function"><span class="keyword">function</span>(<span class="params">event, data, callback</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"on method"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    $.fn.off = <span class="function"><span class="keyword">function</span>(<span class="params">event, data, callback</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"off method"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    $.fn.bind = <span class="function"><span class="keyword">function</span>(<span class="params">event, data, callback</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.on(event, data, callback);</span><br><span class="line">    &#125;;</span><br><span class="line">    $.fn.unbind = <span class="function"><span class="keyword">function</span>(<span class="params">event, callback</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.off(event, callback);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最终的方法属性等都指向了 $.fn，这里就是原型的关键使用</span></span><br><span class="line">    zepto.Z.prototype = Z.prototype = $.fn;</span><br><span class="line"></span><br><span class="line">    $.zepto = zepto;</span><br><span class="line">    <span class="keyword">return</span> $;</span><br><span class="line">  &#125;)();</span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.Zepto = Zepto;</span><br><span class="line">  <span class="built_in">window</span>.$ === <span class="literal">undefined</span> &amp;&amp; (<span class="built_in">window</span>.$ = Zepto);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>amd 规范：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">global, factory</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">"function"</span> &amp;&amp; define.amd) &#123;</span><br><span class="line">    define(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> factory(global);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    factory(global);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">window</span>) </span>&#123;&#125;)</span><br></pre></td></tr></table></figure><h3 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h3><ul><li><a href="https://www.imooc.com/learn/745" target="_blank" rel="noopener">zepto 设计和源码分析</a> - 视频</li><li><a href="http://www.kancloud.cn/wangfupeng/zepto-design-srouce/173680" target="_blank" rel="noopener">zepto 对象思想与源码分析</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 前端框架 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zepto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AJAX 请求</title>
      <link href="/2020/01/07/ajax/"/>
      <url>/2020/01/07/ajax/</url>
      
        <content type="html"><![CDATA[<blockquote><p>关于 http 请求的几种方式</p></blockquote><a id="more"></a><h2 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h2><p>具体来说，AJAX 包括以下几个步骤：</p><ul><li>创建 XMLHttpRequest 实例</li><li>发出 HTTP 请求</li><li>接收服务器传回的数据</li><li>更新网页数据</li></ul><h2 id="起步"><a href="#起步" class="headerlink" title="起步"></a>起步</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MYTHOD = <span class="string">"GET"</span>;</span><br><span class="line"><span class="keyword">const</span> URL =</span><br><span class="line">  <span class="string">"https://api.github.com/search/repositories?q=javascript&amp;sort=stars"</span>;</span><br><span class="line"><span class="keyword">let</span> xhr = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理低版本IE不兼容问题</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123;</span><br><span class="line">  xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定回调函数，监听通信状态（readyState属性）的变化</span></span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span> &amp;&amp; xhr.status === <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(xhr.responseText);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 捕获错误</span></span><br><span class="line">xhr.onerror = <span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.error(<span class="string">"Error: "</span>, xhr.statusText);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发出 HTTP 请求</span></span><br><span class="line">xhr.open(MYTHOD, URL, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">xhr.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure><h2 id="设置头信息"><a href="#设置头信息" class="headerlink" title="设置头信息"></a>设置头信息</h2><p>该方法必须在 open()之后、send()之前调用。如果该方法多次调用，设定同一个字段，则每一次调用的值会被合并成一个单一的值发送。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xhr.setRequestHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/json"</span>);</span><br><span class="line">xhr.setRequestHeader(<span class="string">"Content-Length"</span>, <span class="built_in">JSON</span>.stringify(data).length);</span><br><span class="line">xhr.send(<span class="built_in">JSON</span>.stringify(data));</span><br></pre></td></tr></table></figure><h2 id="Ajax-Promise"><a href="#Ajax-Promise" class="headerlink" title="Ajax+Promise"></a>Ajax+Promise</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ajax = <span class="function">(<span class="params">&#123; method = <span class="string">"GET"</span>, path, body, headers &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//进行Promise封装</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> request = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">    request.open(method, path, <span class="literal">true</span>); <span class="comment">//配置</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method == <span class="string">"GET"</span>) &#123;</span><br><span class="line">      request.send(<span class="literal">null</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> headers) &#123;</span><br><span class="line">        <span class="comment">//遍历header,设置响应头</span></span><br><span class="line">        <span class="keyword">let</span> value = headers[key];</span><br><span class="line">        request.setRequestHeader(key, value);</span><br><span class="line">      &#125;</span><br><span class="line">      request.send(body);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    request.onreadystatechange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (request.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (request.status &gt;= <span class="number">200</span> &amp;&amp; request.status &lt; <span class="number">400</span>) &#123;</span><br><span class="line">          resolve.call(<span class="literal">undefined</span>, request.responseText);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (request.status &gt;= <span class="number">400</span>) &#123;</span><br><span class="line">          reject.call(<span class="literal">undefined</span>, request);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用ajax</span></span><br><span class="line">ajax(&#123;</span><br><span class="line">  method: <span class="string">"get"</span>,</span><br><span class="line">  path: <span class="string">"https://api.github.com/search/repositories?q=javascript&amp;sort=stars"</span>,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    <span class="string">"content-type"</span>: <span class="string">"application/json"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(</span><br><span class="line">  responseText =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(responseText);</span><br><span class="line">  &#125;,</span><br><span class="line">  request =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(request);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="jQuery-使用"><a href="#jQuery-使用" class="headerlink" title="jQuery 使用"></a>jQuery 使用</h2><p>get 方法，返回一个 deferred 对象：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> URL =</span><br><span class="line">  <span class="string">"https://api.github.com/search/repositories?q=javascript&amp;sort=stars"</span>;</span><br><span class="line"><span class="keyword">let</span> request = $.get(URL);</span><br><span class="line">request</span><br><span class="line">  .done(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125;)</span><br><span class="line">  .fail(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="keyword">let</span> request = $.ajax(&#123;</span><br><span class="line">  url: URL,</span><br><span class="line">  type: <span class="string">"GET"</span></span><br><span class="line">&#125;);</span><br><span class="line">request.done(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(data)).fail(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err));</span><br></pre></td></tr></table></figure><p>使用 promise：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">      url: <span class="string">"https://api.github.com/search/repositories?q=javascript&amp;sort=stars"</span>,</span><br><span class="line">      type: <span class="string">"GET"</span>,</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        resolve(data);</span><br><span class="line">      &#125;,</span><br><span class="line">      error: <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">        resolve(err);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getData()</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><h2 id="Fetch-函数"><a href="#Fetch-函数" class="headerlink" title="Fetch 函数"></a>Fetch 函数</h2><p>Fetch 提供了 Request 和 Response 对象（以及与网络请求有关的其他内容）的一般定义。</p><p>Fetch API 提供了 fetch() 方法，它被定义在 BOM 的 window 对象中，你可以用它来发起对远程资源的请求。</p><p>fetch() 方法返回的是一个 Promise 对象，让你能够对请求的返回结果进行检索。</p><p>fetch 的配置：</p><ul><li><code>Promise fetch(String url [, Object options])</code>;</li><li><code>Promise fetch(Request req [, Object options])</code>;</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> URL = <span class="string">'https://api.github.com/search/repositories?q=javascript&amp;sort=stars'</span>;</span><br><span class="line"><span class="keyword">let</span> req = <span class="keyword">new</span> Request(URL, &#123; <span class="attr">method</span>: <span class="string">"GET"</span>, <span class="attr">cache</span>: <span class="string">"reload"</span> &#125;);</span><br><span class="line">fetch(req)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> response.json();</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(json);</span><br><span class="line">  &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>fetch 和 ajax 的主要区别：</p><ul><li>fetch()返回的 promise 将不会拒绝 http 的错误状态，即使响应是一个 HTTP 404 或者 500</li><li>在默认情况下 fetch 不会接受或者发送 cookies</li></ul><h2 id="Axios"><a href="#Axios" class="headerlink" title="Axios"></a>Axios</h2><p>基本使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> URL =</span><br><span class="line">  <span class="string">"https://api.github.com/search/repositories?q=javascript&amp;sort=stars"</span>;</span><br><span class="line">axios</span><br><span class="line">  .get(URL)</span><br><span class="line">  .then(<span class="function"><span class="params">response</span> =&gt;</span> <span class="built_in">console</span>.log(response))</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err));</span><br></pre></td></tr></table></figure><p>或者使用 <code>async/await</code>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> axios.get(URL);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">getData().then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(data));</span><br></pre></td></tr></table></figure><h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><ul><li><a href="http://javascript.ruanyifeng.com/bom/ajax.html" target="_blank" rel="noopener">AJAX – JavaScript 标准参考教程(alpha)</a></li><li><a href="https://segmentfault.com/a/1190000018935873?utm_source=tag-newest" target="_blank" rel="noopener">原生 javaScript 实现 Ajax 和 jQuery 实现 Ajax</a></li><li><a href="https://segmentfault.com/a/1190000015938472" target="_blank" rel="noopener">回调、使用 Promise 封装 ajax()、Promise 入门</a></li><li><a href="https://www.jianshu.com/p/7762515f8d1a" target="_blank" rel="noopener">Fetch</a></li><li><a href="http://www.axios-js.com/" target="_blank" rel="noopener">axios-易用、简洁且高效的 http 库</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 面试 </tag>
            
            <tag> Ajax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 类型判断</title>
      <link href="/2020/01/07/code-typeof/"/>
      <url>/2020/01/07/code-typeof/</url>
      
        <content type="html"><![CDATA[<blockquote><p>学习<a href="https://github.com/mqyqingfeng/Blog/issues/28" target="_blank" rel="noopener">JavaScript 专题之类型判断(上)</a>的文章总结，其实就是照抄，哈哈哈哈…顺便几一句文章里的话：所有这些点，都必须脚踏实地在具体应用场景下去分析、去选择，要让场景说话。</p></blockquote><a id="more"></a><h2 id="typeof"><a href="#typeof" class="headerlink" title="typeof"></a>typeof</h2><p>最新的 ECMAScript 标准定义了 8 种数据类型：</p><p>7 种原始类型:</p><ul><li>Boolean</li><li>Null</li><li>Undefined</li><li>Number</li><li>String</li><li>Symbol</li><li>BigInt</li></ul><p>和 Object</p><p>使用 typeof 检测类型如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"Number"</span>; <span class="comment">// number</span></span><br><span class="line"><span class="string">"String"</span>; <span class="comment">// string</span></span><br><span class="line"><span class="string">"Boolean"</span>; <span class="comment">// boolean</span></span><br><span class="line"><span class="string">"Undefined"</span>; <span class="comment">// undefined</span></span><br><span class="line"><span class="string">"Null"</span>; <span class="comment">// object</span></span><br><span class="line"><span class="string">"Symbol"</span>; <span class="comment">// symbol</span></span><br><span class="line"><span class="string">"BigInt"</span>; <span class="comment">// bigint</span></span><br><span class="line"><span class="string">"Object"</span>; <span class="comment">// object</span></span><br></pre></td></tr></table></figure><p>所以 typeof 能检测出七种基本类型的值，但是，除此之外 Object 下还有很多细分的类型呐，如 Array、Function、Date、RegExp、Error 等。</p><p>如果用 typeof 去检测这些类型，返回的都是 object，除了 Function：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="keyword">var</span> error = <span class="keyword">new</span> <span class="built_in">Error</span>();</span><br><span class="line"><span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> date); <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> error); <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> fn); <span class="comment">// function</span></span><br></pre></td></tr></table></figure><h2 id="Object-prototype-toString"><a href="#Object-prototype-toString" class="headerlink" title="Object.prototype.toString"></a>Object.prototype.toString</h2><p>所有，该如何区分 object 呢？我们用<code>Object.prototype.toString</code>。</p><p>规范：当 toString 方法被调用的时候，下面的步骤会被执行：</p><ul><li>如果 this 值是 undefined，就返回 <code>[object Undefined]</code></li><li>如果 this 的值是 null，就返回 <code>[object Null]</code></li><li>让 O 成为 <code>ToObject(this)</code> 的结果</li><li>让 class 成为 O 的内部属性 <code>[[Class]]</code> 的值</li><li>最后返回由 <code>&quot;[object &quot;</code> 和 <code>class</code> 和 <code>&quot;]&quot;</code> 三个部分组成的字符串</li></ul><p>通过规范，我们至少知道了调用 <code>Object.prototype.toString</code> 会返回一个由 <code>&quot;[object &quot; 和 class 和 &quot;]&quot;</code> 组成的字符串，而 class 是要判断的对象的内部属性。</p><p>我们可以了解到这个 class 值就是识别对象类型的关键！</p><p>正是因为这种特性，我们可以用 <code>Object.prototype.toString</code> 方法识别出更多类型！</p><p>先看下常见的 15 种（ES6 新增：Symbol Set Map，还有 BigInt）：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> number = <span class="number">1</span>; <span class="comment">// [object Number]</span></span><br><span class="line"><span class="keyword">var</span> string = <span class="string">"123"</span>; <span class="comment">// [object String]</span></span><br><span class="line"><span class="keyword">var</span> boolean = <span class="literal">true</span>; <span class="comment">// [object Boolean]</span></span><br><span class="line"><span class="keyword">var</span> und = <span class="literal">undefined</span>; <span class="comment">// [object Undefined]</span></span><br><span class="line"><span class="keyword">var</span> nul = <span class="literal">null</span>; <span class="comment">// [object Null]</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;; <span class="comment">// [object Object]</span></span><br><span class="line"><span class="keyword">var</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]; <span class="comment">// [object Array]</span></span><br><span class="line"><span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="comment">// [object Date]</span></span><br><span class="line"><span class="keyword">var</span> error = <span class="keyword">new</span> <span class="built_in">Error</span>(); <span class="comment">// [object Error]</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/a/g</span>; <span class="comment">// [object RegExp]</span></span><br><span class="line"><span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;&#125;; <span class="comment">// [object Function]</span></span><br><span class="line"><span class="keyword">var</span> symb = <span class="built_in">Symbol</span>(<span class="string">"test"</span>); <span class="comment">// [object Symbol]</span></span><br><span class="line"><span class="keyword">var</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>(); <span class="comment">// [object Set]</span></span><br><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>(); <span class="comment">// [object Map]</span></span><br><span class="line"><span class="keyword">var</span> bigI = BigInt(<span class="number">1</span>); <span class="comment">// [object BigInt]</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = <span class="built_in">arguments</span>.length; i &lt; l; i++) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="built_in">arguments</span>[i]));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">checkType(</span><br><span class="line">  number,</span><br><span class="line">  string,</span><br><span class="line">  boolean,</span><br><span class="line">  und,</span><br><span class="line">  nul,</span><br><span class="line">  obj,</span><br><span class="line">  array,</span><br><span class="line">  date,</span><br><span class="line">  error,</span><br><span class="line">  reg,</span><br><span class="line">  func,</span><br><span class="line">  symb,</span><br><span class="line">  set,</span><br><span class="line">  map,</span><br><span class="line">  bigI</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>除了以上 15 种，还有以下 3 种：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="built_in">Math</span>)); <span class="comment">// [object Math]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="built_in">JSON</span>)); <span class="comment">// [object JSON]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="built_in">arguments</span>)); <span class="comment">// [object Arguments]</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">fn();</span><br></pre></td></tr></table></figure><h2 id="type-API"><a href="#type-API" class="headerlink" title="type API"></a>type API</h2><p>写一个 type 函数能检测各种类型的值，如果是基本类型，就使用 typeof，引用类型就使用 toString。</p><p>此外鉴于 typeof 的结果是小写，我也希望所有的结果都是小写。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> class2type = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="string">"Boolean Number String Function Array Date RegExp Object Error Null Undefined"</span></span><br><span class="line">  .split(<span class="string">" "</span>)</span><br><span class="line">  .map(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">    class2type[<span class="string">"[object "</span> + item + <span class="string">"]"</span>] = item.toLowerCase(); <span class="comment">// e.g. '[object Boolean]': 'boolean'</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">type</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj + <span class="string">""</span>; <span class="comment">// IE6</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> obj === <span class="string">"object"</span> || <span class="keyword">typeof</span> obj === <span class="string">"function"</span></span><br><span class="line">    ? class2type[<span class="built_in">Object</span>.prototype.toString.call(obj)] || <span class="string">"object"</span></span><br><span class="line">    : <span class="keyword">typeof</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里<code>class2type[Object.prototype.toString.call(obj)] || &quot;object&quot;</code>的 object，为了 ES6 新增的 Symbol、Map、Set 等类型返回 object。</p><p>当然也可以添加进去，返回的就是对应的类型：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> class2type = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="string">"Boolean Number String Function Array Date RegExp Object Error Null Undefined Symbol Set Map BigInt"</span></span><br><span class="line">  .split(<span class="string">" "</span>)</span><br><span class="line">  .map(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">    class2type[<span class="string">"[object "</span> + item + <span class="string">"]"</span>] = item.toLowerCase();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">type</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj + <span class="string">""</span>; <span class="comment">// IE6</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> obj === <span class="string">"object"</span> || <span class="keyword">typeof</span> obj === <span class="string">"function"</span></span><br><span class="line">    ? class2type[<span class="built_in">Object</span>.prototype.toString.call(obj)]</span><br><span class="line">    : <span class="keyword">typeof</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="isFunction"><a href="#isFunction" class="headerlink" title="isFunction"></a>isFunction</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFunction</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> type(obj) === <span class="string">"function"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="isArray"><a href="#isArray" class="headerlink" title="isArray"></a>isArray</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isArray =</span><br><span class="line">  <span class="built_in">Array</span>.isArray ||</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> type(obj) === <span class="string">"array"</span>;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure><h2 id="plainObject"><a href="#plainObject" class="headerlink" title="plainObject"></a>plainObject</h2><p><code>plainObject</code> 来自于 jQuery，可以翻译成纯粹的对象，所谓”纯粹的对象”，就是该对象是通过 “{}” 或 “new Object” 创建的，该对象含有零个或者多个键值对。</p><p>之所以要判断是不是 <code>plainObject</code>，是为了跟其他的 JavaScript 对象如 null，数组，宿主对象（documents）等作区分，因为这些用 typeof 都会返回 object。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上节中写 type 函数时，用来存放 toString 映射结果的对象</span></span><br><span class="line"><span class="keyword">var</span> class2type = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相当于 Object.prototype.toString</span></span><br><span class="line"><span class="keyword">var</span> toString = class2type.toString;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相当于 Object.prototype.hasOwnProperty</span></span><br><span class="line"><span class="keyword">var</span> hasOwn = class2type.hasOwnProperty;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPlainObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> proto, Ctor;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 排除掉明显不是obj的以及一些宿主对象如Window</span></span><br><span class="line">  <span class="keyword">if</span> (!obj || toString.call(obj) !== <span class="string">"[object Object]"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * getPrototypeOf es5 方法，获取 obj 的原型</span></span><br><span class="line"><span class="comment">   * 以 new Object 创建的对象为例的话</span></span><br><span class="line"><span class="comment">   * obj.__proto__ === Object.prototype</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  proto = <span class="built_in">Object</span>.getPrototypeOf(obj);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 没有原型的对象是纯粹的，Object.create(null) 就在这里返回 true</span></span><br><span class="line">  <span class="keyword">if</span> (!proto) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 以下判断通过 new Object 方式创建的对象</span></span><br><span class="line"><span class="comment">   * 判断 proto 是否有 constructor 属性，如果有就让 Ctor 的值为 proto.constructor</span></span><br><span class="line"><span class="comment">   * 如果是 Object 函数创建的对象，Ctor 在这里就等于 Object 构造函数</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  Ctor = hasOwn.call(proto, <span class="string">"constructor"</span>) &amp;&amp; proto.constructor;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在这里判断 Ctor 构造函数是不是 Object 构造函数，用于区分自定义构造函数和 Object 构造函数</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="keyword">typeof</span> Ctor === <span class="string">"function"</span> &amp;&amp;</span><br><span class="line">    hasOwn.toString.call(Ctor) === hasOwn.toString.call(<span class="built_in">Object</span>)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="EmptyObject"><a href="#EmptyObject" class="headerlink" title="EmptyObject"></a>EmptyObject</h2><p>jQuery 提供了 <code>isEmptyObject</code> 方法来判断是否是空对象，代码简单：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isEmptyObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name;</span><br><span class="line">  <span class="comment">// 判断是否有属性，for 循环一旦执行，就说明有属性，有属性就会返回 false</span></span><br><span class="line">  <span class="keyword">for</span> (name <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(isEmptyObject(&#123;&#125;)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isEmptyObject([])); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isEmptyObject(<span class="literal">null</span>)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isEmptyObject(<span class="literal">undefined</span>)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isEmptyObject(<span class="number">1</span>)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isEmptyObject(<span class="string">""</span>)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isEmptyObject(<span class="literal">true</span>)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h2 id="Window-对象"><a href="#Window-对象" class="headerlink" title="Window 对象"></a>Window 对象</h2><p>Window 对象作为客户端 JavaScript 的全局对象，它有一个 window 属性指向自身。我们可以利用这个特性判断是否是 Window 对象。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isWindow</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> obj !== <span class="literal">null</span> &amp;&amp; obj === obj.window;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="isArrayLike"><a href="#isArrayLike" class="headerlink" title="isArrayLike"></a>isArrayLike</h2><p>如果 isArrayLike 返回 true，至少要满足三个条件之一：</p><ul><li>是数组</li><li>长度为 0</li><li>lengths 属性是大于 0 的数字类型，并且 <code>obj[length - 1]</code>必须存在</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isArrayLike</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// obj 必须有 length属性</span></span><br><span class="line">  <span class="keyword">var</span> length = !!obj &amp;&amp; <span class="string">"length"</span> <span class="keyword">in</span> obj &amp;&amp; obj.length;</span><br><span class="line">  <span class="keyword">var</span> typeRes = type(obj);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 排除掉函数和 Window 对象</span></span><br><span class="line">  <span class="keyword">if</span> (typeRes === <span class="string">"function"</span> || isWindow(obj)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    typeRes === <span class="string">"array"</span> ||</span><br><span class="line">    length === <span class="number">0</span> ||</span><br><span class="line">    (<span class="keyword">typeof</span> length === <span class="string">"number"</span> &amp;&amp; length &gt; <span class="number">0</span> &amp;&amp; length - <span class="number">1</span> <span class="keyword">in</span> obj)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="isElement"><a href="#isElement" class="headerlink" title="isElement"></a>isElement</h2><p>判断是不是 DOM 元素</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isElement</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !!(obj &amp;&amp; obj.nodeType === <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(isElement(div)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isElement(<span class="string">""</span>)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="原文地址"><a href="#原文地址" class="headerlink" title="原文地址"></a>原文地址</h2><ul><li><a href="https://github.com/mqyqingfeng/Blog/issues/28" target="_blank" rel="noopener">JavaScript 专题之类型判断(上)</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/30" target="_blank" rel="noopener">JavaScript 专题之类型判断(下)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 面试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 数组去重的几种方式</title>
      <link href="/2020/01/07/code-unique/"/>
      <url>/2020/01/07/code-unique/</url>
      
        <content type="html"><![CDATA[<blockquote><p>数组去重，老生常谈，把学习到的多种方式进行归纳总结</p></blockquote><a id="more"></a><h2 id="双层循环"><a href="#双层循环" class="headerlink" title="双层循环"></a>双层循环</h2><p>第一种：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, arrLen = arr.length; i &lt; arrLen; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>, resLen = result.length; j &lt; resLen; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (arr[i] === result[j]) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (j === result.length) &#123;</span><br><span class="line">      result.push(arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第二种：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> arrary = [].concat(arr); <span class="comment">// 避免修改原数组，存个副本</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = arrary.length; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = i + <span class="number">1</span>; j &lt; len; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (arrary[i] === arrary[j]) &#123;</span><br><span class="line">        arrary.splice(j, <span class="number">1</span>); <span class="comment">// splice() 修改原数组，所以需要手动修改长度</span></span><br><span class="line">        len--;</span><br><span class="line">        j--;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arrary;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="indexOf-方法"><a href="#indexOf-方法" class="headerlink" title="indexOf 方法"></a>indexOf 方法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = arr.length; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> current = arr[i];</span><br><span class="line">    <span class="keyword">if</span> (result.indexOf(current) === <span class="number">-1</span>) &#123;</span><br><span class="line">      result.push(current);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="filter-indexOf-方法"><a href="#filter-indexOf-方法" class="headerlink" title="filter + indexOf 方法"></a>filter + indexOf 方法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = arr.filter(<span class="function"><span class="keyword">function</span>(<span class="params">item, index, arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> arr.indexOf(item) === index;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">let</span> unique = <span class="function"><span class="params">arr</span> =&gt;</span></span><br><span class="line">  arr.filter(<span class="function">(<span class="params">item, index, arr</span>) =&gt;</span> arr.indexOf(item) === index);</span><br></pre></td></tr></table></figure><p>如果我们对一个已经排好序的数组去重，这种方法效率肯定高于使用 indexOf：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> unique = <span class="function"><span class="params">arr</span> =&gt;</span></span><br><span class="line">  arr</span><br><span class="line">    .concat()</span><br><span class="line">    .sort()</span><br><span class="line">    .filter(<span class="function">(<span class="params">item, index, arr</span>) =&gt;</span> !index || item !== arr[index - <span class="number">1</span>]);</span><br></pre></td></tr></table></figure><p>不过对于下面这种就会失效：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="string">"1"</span>, <span class="number">1</span>, <span class="string">"1"</span>];</span><br><span class="line"><span class="comment">//输出 [ 1, '1', 1, '1', 2, 3 ]</span></span><br></pre></td></tr></table></figure><h2 id="Object-键值对"><a href="#Object-键值对" class="headerlink" title="Object 键值对"></a>Object 键值对</h2><p>利用一个空的 Object 对象，我们把数组的值存成 Object 的 key 值，比如 <code>Object[value1] = true</code>，在判断另一个值的时候，如果 <code>Object[value2]</code>存在的话，就说明该值是重复的。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> unique = <span class="function"><span class="params">arr</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> arr.filter(<span class="function"><span class="params">item</span> =&gt;</span></span><br><span class="line">    obj.hasOwnProperty(<span class="keyword">typeof</span> item + <span class="built_in">JSON</span>.stringify(item))</span><br><span class="line">      ? <span class="literal">false</span></span><br><span class="line">      : (obj[<span class="keyword">typeof</span> item + <span class="built_in">JSON</span>.stringify(item)] = <span class="literal">true</span>)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>注意：</p><ol><li><code>typeof item + item</code> 是为了区分 1 还是 ‘1’</li><li><code>typeof item + JSON.stringify(item)</code> 是为了区分 <code>{value: 1}, {value: 1}</code></li></ol><p>如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="string">"1"</span>, &#123; <span class="attr">value</span>: <span class="number">1</span> &#125;, &#123; <span class="attr">value</span>: <span class="number">1</span> &#125;];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> getObjType = <span class="function"><span class="params">arr</span> =&gt;</span> arr.map(<span class="function"><span class="params">item</span> =&gt;</span> <span class="keyword">typeof</span> item + <span class="built_in">JSON</span>.stringify(item));</span><br><span class="line"></span><br><span class="line">getObjType(arr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ["number1", "string"1"", "object&#123;"value":1&#125;", "object&#123;"value":1&#125;"]</span></span><br></pre></td></tr></table></figure><h2 id="Set-集合-和-Map-集合"><a href="#Set-集合-和-Map-集合" class="headerlink" title="Set 集合 和 Map 集合"></a>Set 集合 和 Map 集合</h2><p>ES6 去重方式已经是非常的精简：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Set</span></span><br><span class="line"><span class="keyword">let</span> unique = <span class="function"><span class="params">arr</span> =&gt;</span> <span class="built_in">Array</span>.from(<span class="keyword">new</span> <span class="built_in">Set</span>(arr))</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> unique = <span class="function"><span class="params">arr</span> =&gt;</span> [...new <span class="built_in">Set</span>(arr)]</span><br><span class="line"></span><br><span class="line"><span class="comment">// Map</span></span><br><span class="line"><span class="keyword">let</span> unique = <span class="function"><span class="params">arr</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> seen = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">  <span class="keyword">return</span> arr.filter(<span class="function"><span class="params">item</span> =&gt;</span> !seen.has(item) &amp;&amp; seen.set(item, <span class="literal">true</span>));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h2><ul><li><a href="https://github.com/mqyqingfeng/Blog/issues/27" target="_blank" rel="noopener">JavaScript 专题之数组去重</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 面试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sass 日常使用总结</title>
      <link href="/2019/12/31/css-sass/"/>
      <url>/2019/12/31/css-sass/</url>
      
        <content type="html"><![CDATA[<blockquote><p>世界上最成熟、最稳定、最强大的专业级CSS扩展语言！ - Sass 官网<br>简单汇总一下 sass 的日常使用，又简单地看了一下 Bootstrap@4 里应用的一个 Demo。</p></blockquote><a id="more"></a><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>我本地结合 gulp+sass 自动化工具使用，主要如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install node-sass gulp-sass --save-dev</span><br></pre></td></tr></table></figure><p><code>gulpfile.js</code> 文件主要配置如下，详情可以参考<a href="https://github.com/yangtao2o/gulp-project/tree/master/src/mygulp" target="_blank" rel="noopener">这里</a>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest, watch &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"><span class="keyword">const</span> sass = <span class="built_in">require</span>(<span class="string">"gulp-sass"</span>);</span><br><span class="line">sass.compiler = <span class="built_in">require</span>(<span class="string">"node-sass"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scss</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> src(scssGlobSrc)</span><br><span class="line">    .pipe(sass(&#123; <span class="attr">outputStyle</span>: <span class="string">"expanded"</span> &#125;).on(<span class="string">"error"</span>, sass.logError))</span><br><span class="line">    .pipe(dest(<span class="string">"dist/sass"</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.scss = scss;</span><br></pre></td></tr></table></figure><p>启动：<code>gulp scss</code>。</p><ul><li><a href="https://www.sass.hk/install/" target="_blank" rel="noopener">如何安装 Sass</a></li></ul><h2 id="四种编译排版"><a href="#四种编译排版" class="headerlink" title="四种编译排版"></a>四种编译排版</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*未编译样式*/</span></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  &amp;-title &#123;</span><br><span class="line">    <span class="selector-tag">height</span>: 30<span class="selector-tag">px</span>;</span><br><span class="line">    <span class="selector-tag">line-height</span>: 30<span class="selector-tag">px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>nested 编译排版格式</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*命令行内容*/</span></span><br><span class="line"><span class="selector-tag">sass</span> <span class="selector-tag">style</span><span class="selector-class">.scss</span><span class="selector-pseudo">:style.css</span> <span class="selector-tag">--style</span> <span class="selector-tag">nested</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*编译过后样式*/</span></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box-title</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>expanded 编译排版格式</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*命令行内容*/</span></span><br><span class="line"><span class="selector-tag">sass</span> <span class="selector-tag">style</span><span class="selector-class">.scss</span><span class="selector-pseudo">:style.css</span> <span class="selector-tag">--style</span> <span class="selector-tag">expanded</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*编译过后样式*/</span></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box-title</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>compact 编译排版格式</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*命令行内容*/</span></span><br><span class="line"><span class="selector-tag">sass</span> <span class="selector-tag">style</span><span class="selector-class">.scss</span><span class="selector-pseudo">:style.css</span> <span class="selector-tag">--style</span> <span class="selector-tag">compact</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*编译过后样式*/</span></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box-title</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>compressed 编译排版格式</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*命令行内容*/</span></span><br><span class="line"><span class="selector-tag">sass</span> <span class="selector-tag">style</span><span class="selector-class">.scss</span><span class="selector-pseudo">:style.css</span> <span class="selector-tag">--style</span> <span class="selector-tag">compressed</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*编译过后样式*/</span></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box-title</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="静默注释"><a href="#静默注释" class="headerlink" title="静默注释"></a>静默注释</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="comment">// 这种注释内容不会出现在生成的css文件中</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">  <span class="comment">/* 这种注释内容会出现在生成的css文件中 */</span></span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">  <span class="comment">/* 这种注释内容会出现在生成的css文件中 */</span></span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用变量"><a href="#使用变量" class="headerlink" title="使用变量"></a>使用变量</h2><p>非常简单明了，变量申明：<code>$color: #4a4a4a;</code>，变量引用：<code>color: $color;</code>，具体例子演示如下：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$bg-color</span>: <span class="number">#f90</span>;</span><br><span class="line"><span class="variable">$font-color</span>: <span class="number">#444</span>;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="variable">$bg-color</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="variable">$font-color</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.selected</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="variable">$font-color</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#f90</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#444</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.selected</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#444</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="嵌套-CSS-规则"><a href="#嵌套-CSS-规则" class="headerlink" title="嵌套 CSS 规则"></a>嵌套 CSS 规则</h2><p>文档：在 Sass 中，你可以像俄罗斯套娃那样在规则块中嵌套规则块。sass 在输出 css 时会帮你把这些嵌套规则处理好，避免你的重复书写。</p><p>看个例子，基本就知道什么意思：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ul</span> &#123;</span><br><span class="line">  <span class="selector-tag">li</span> &#123;</span><br><span class="line">    <span class="selector-tag">a</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="variable">$font-color</span>;</span><br><span class="line">      &amp;:hover &#123;</span><br><span class="line">        <span class="attribute">color</span>: red;</span><br><span class="line">      &#125;</span><br><span class="line">      &amp;::after &#123;</span><br><span class="line">        <span class="attribute">content</span>: <span class="string">"..."</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ul</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#444</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ul</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ul</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">"..."</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>够简洁，不过有一些嵌套规则，需要稍稍留意，比如：</p><ul><li>父选择器的标识符<code>&amp;</code></li><li>群组选择器的嵌套</li><li>子组合选择器和同层组合选择器：<code>&gt;、+ 和 ~</code></li><li>属性嵌套</li></ul><h3 id="父选择器的标识符"><a href="#父选择器的标识符" class="headerlink" title="父选择器的标识符"></a>父选择器的标识符</h3><p>父选择器的标识符<code>&amp;</code>，记住<code>&amp;</code>是爸爸，你可以在爸爸的后边，也可以在爸爸的前边，随你，哈哈哈哈：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nav</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="variable">$font-color</span>;</span><br><span class="line">  <span class="comment">/* Dad after */</span></span><br><span class="line">  &amp;:hover &#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* Dad before */</span></span><br><span class="line">  <span class="selector-class">.header</span> &amp; &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#000</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nav</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#444</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Dad after */</span></span><br><span class="line"><span class="selector-tag">nav</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Dad before */</span></span><br><span class="line"><span class="selector-class">.header</span> <span class="selector-tag">nav</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Dad 是爸爸们：<code>nav a</code>，什么场景能用到<code>Dad before</code>？想想<code>nav a</code>是通用样式，我想给 header 组件单独<code>nav a</code>的样式，即<code>.header nav a</code>，即<code>.header &amp;</code>。</p><p>当然，还可以这样用：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.main</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: black;</span><br><span class="line">  &amp;-sidebar &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// css</span></span><br><span class="line"><span class="selector-class">.main</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.main-sidebar</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="群组选择器的嵌套"><a href="#群组选择器的嵌套" class="headerlink" title="群组选择器的嵌套"></a>群组选择器的嵌套</h3><p>文档例子：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="selector-tag">h1</span>,</span><br><span class="line">  <span class="selector-tag">h2</span>,</span><br><span class="line">  <span class="selector-tag">h3</span> &#123;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">0.8em</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">nav</span>,</span><br><span class="line"><span class="selector-tag">aside</span> &#123;</span><br><span class="line">  <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: blue;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> <span class="selector-tag">h1</span>,</span><br><span class="line"><span class="selector-class">.container</span> <span class="selector-tag">h2</span>,</span><br><span class="line"><span class="selector-class">.container</span> <span class="selector-tag">h3</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">0.8em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">nav</span> <span class="selector-tag">a</span>,</span><br><span class="line"><span class="selector-tag">aside</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>名字就已经告诉咱们这个规则的要点是：群组。大括号<code>{</code>前端的都可以是一个群组，比如<code>.container</code>，比如<code>nav, aside</code>，不论多少。</p><p>做为群组的任何一员，有权利获取子嗣，而且还得跟其他群组成员一模一样，若 Ta 有 三个（<code>h1, h2, h3</code>）子嗣，那群组的任何一员也得各自有三个子嗣；Ta 如果只有一个（<code>a</code>）子嗣，即使群组人很多，也得每个成员一人一个。</p><p>演练：有三个组件<code>header article footer</code>，我希望字体颜色有默认值，链接例外，并且有 hover 变化。</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.header</span>,</span><br><span class="line"><span class="selector-class">.acticle</span>,</span><br><span class="line"><span class="selector-class">.footer</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="variable">$font-color</span>;</span><br><span class="line">  <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line">    &amp;:hover &#123;</span><br><span class="line">      <span class="attribute">color</span>: red;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.header</span>,</span><br><span class="line"><span class="selector-class">.acticle</span>,</span><br><span class="line"><span class="selector-class">.footer</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#444</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.header</span> <span class="selector-tag">a</span>,</span><br><span class="line"><span class="selector-class">.acticle</span> <span class="selector-tag">a</span>,</span><br><span class="line"><span class="selector-class">.footer</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.header</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>,</span><br><span class="line"><span class="selector-class">.acticle</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>,</span><br><span class="line"><span class="selector-class">.footer</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="子组合和同层组合"><a href="#子组合和同层组合" class="headerlink" title="子组合和同层组合"></a>子组合和同层组合</h3><p>子组合选择器 <code>&gt;</code> 和同层组合选择器 <code>+、~</code>，和 CSS 的规则一致。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 选择article 后的同层所有 article 元素 */</span></span><br><span class="line"><span class="selector-tag">article</span> ~ <span class="selector-tag">article</span> &#123;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1px</span> dashed <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 选择nav元素后紧跟的article元素 */</span></span><br><span class="line"><span class="selector-tag">nav</span> + <span class="selector-tag">article</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 选择article下的所有命中section选择器的元素 */</span></span><br><span class="line"><span class="selector-tag">article</span> &gt; <span class="selector-tag">section</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#eee</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>文档例子：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">article</span> &#123;</span><br><span class="line">  ~ article &#123;</span><br><span class="line">    <span class="selector-tag">border-top</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">dashed</span> <span class="selector-id">#ccc</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  &gt; <span class="selector-tag">section</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#eee</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">dl</span> &gt; &#123;</span><br><span class="line">    dt &#123;</span><br><span class="line">      <span class="selector-tag">color</span>: <span class="selector-id">#333</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">dd</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="number">#555</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">nav</span> + &amp; &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">article</span> ~ <span class="selector-tag">article</span> &#123;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1px</span> dashed <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">article</span> &gt; <span class="selector-tag">section</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#eee</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">article</span> <span class="selector-tag">dl</span> &gt; <span class="selector-tag">dt</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">article</span> <span class="selector-tag">dl</span> &gt; <span class="selector-tag">dd</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#555</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">nav</span> + <span class="selector-tag">article</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="嵌套属性"><a href="#嵌套属性" class="headerlink" title="嵌套属性"></a>嵌套属性</h3><blockquote><p>规则：把属性名从中划线-的地方断开，在根属性后边添加一个冒号<code>:</code>，紧跟一个<code>{ }</code>块，把子属性部分写在这个<code>{ }</code>块中。就像 css 选择器嵌套一样，sass 会把你的子属性一一解开，把根属性和子属性部分通过中划线<code>-</code>连接起来，最后生成的效果与你手动一遍遍写的 css 样式一样：</p></blockquote><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nav</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: &#123;</span><br><span class="line">    style: solid;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#ccc</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">nav</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span> &#123;</span><br><span class="line">    left: <span class="number">0px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// css</span></span><br><span class="line"><span class="selector-tag">nav</span> &#123;</span><br><span class="line">  <span class="attribute">border-style</span>: solid;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">nav</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一句话：我要把<code>border-style</code>里的<code>-</code>打断，拆散左右，并替换成<code>:</code>，重新使用<code>{}</code>嵌套使用，宗旨就是不破不立，有破才有立，把所有重复的东西统统归并，只写关键部位。</p><h2 id="Rules"><a href="#Rules" class="headerlink" title="@-Rules"></a>@-Rules</h2><h3 id="import-导入"><a href="#import-导入" class="headerlink" title="@import 导入"></a>@import 导入</h3><p>在单独使用 css 的 <code>@import</code> 规则导入文件，是不及 <code>link</code> 的效率，比如加载字体库，有次在项目中就吃过这个亏，那会发誓打死我也不用这个规则。</p><p>sass 的<code>@import</code> 规则是在生成 css 文件时就把相关文件导入进来，所以，和 css 的<code>@import</code>没有什么关系，放心食用。</p><p>但是由于 sass 兼容原生的 css，所以它也支持原生的 CSS<code>@import</code>，比如导入文件或者 url 是以 <code>.css</code>结尾的。</p><p>使用：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 常用方法</span></span><br><span class="line">@<span class="keyword">import</span> <span class="string">"header"</span>;</span><br><span class="line">@<span class="keyword">import</span> <span class="string">"footer"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多个导入</span></span><br><span class="line">@<span class="keyword">import</span> <span class="string">"rounded-corners"</span>, <span class="string">"text-shadow"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 嵌套导入</span></span><br><span class="line"><span class="selector-class">.blue-theme</span> &#123;</span><br><span class="line">  @<span class="keyword">import</span> <span class="string">"blue-theme"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果将文件命名为 <code>_colors.scss</code>，便不会编译<code>_colours.css</code> 文件，但是导入时依然是<code>@import &quot;colors&quot;;</code>。</p><h3 id="media-媒体查询"><a href="#media-媒体查询" class="headerlink" title="@media 媒体查询"></a>@media 媒体查询</h3><p>Sass 中 @media 指令与 CSS 中用法一样，不过还允许其在 CSS 规则中嵌套，编译时，@media 将被编译到文件的最外层，包含嵌套的父选择器。</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  @<span class="keyword">media</span> screen and (orientation: landscape) &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 拼接 and */</span></span><br><span class="line">@<span class="keyword">media</span> screen &#123;</span><br><span class="line">  <span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">    @<span class="keyword">media</span> (max-width: 1140px) &#123;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">960px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.other</span> &#123;</span><br><span class="line">    @<span class="keyword">media</span> (max-width: 640px) &#123;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> screen and (orientation: landscape) &#123;</span><br><span class="line">  <span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 拼接 and */</span></span><br><span class="line">@<span class="keyword">media</span> screen and (max-width: <span class="number">1140px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">960px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> screen and (max-width: <span class="number">640px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.other</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="extend"><a href="#extend" class="headerlink" title="@extend"></a>@extend</h3><p>和其他语言一样，就是继承。比如代码中的<code>.error</code>，以及同级<code>.intrusion</code>，都会被继承：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.error</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> <span class="number">#f00</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fdd</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.error</span><span class="selector-class">.intrusion</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: url(<span class="string">"/image/hacked.png"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.seriousError</span> &#123;</span><br><span class="line">  @<span class="keyword">extend</span> .error;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">3px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.error</span>,</span><br><span class="line"><span class="selector-class">.seriousError</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> <span class="number">#f00</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fdd</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.error</span><span class="selector-class">.intrusion</span>,</span><br><span class="line"><span class="selector-class">.intrusion</span><span class="selector-class">.seriousError</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">"/image/hacked.png"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.seriousError</span> &#123;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">3px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="控制指令"><a href="#控制指令" class="headerlink" title="控制指令"></a>控制指令</h2><h3 id="if"><a href="#if" class="headerlink" title="@if"></a>@if</h3><p>和 JavaScript 的 if 一样：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$type</span>: monster;</span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  @<span class="keyword">if</span> <span class="variable">$type</span> == ocean &#123;</span><br><span class="line">    <span class="attribute">color</span>: blue;</span><br><span class="line">  &#125; @<span class="keyword">else</span> if <span class="variable">$type</span> == monster &#123;</span><br><span class="line">    <span class="attribute">color</span>: green;</span><br><span class="line">  &#125; @<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: black;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="for"><a href="#for" class="headerlink" title="@for"></a>@for</h3><p>区别在于 through 与 to 的含义：through 包含最后一位，而 to 不包含：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">for</span> <span class="variable">$i</span> from 1 to 3 &#123;</span><br><span class="line">  <span class="selector-class">.list-</span>#&#123;<span class="variable">$i</span>&#125; &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">1em</span> * <span class="variable">$i</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">for</span> <span class="variable">$i</span> from 1 through 3 &#123;</span><br><span class="line">  <span class="selector-class">.item-</span>#&#123;<span class="variable">$i</span>&#125; &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">2rem</span> * <span class="variable">$i</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.list-1</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.list-2</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">2em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item-1</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">2rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item-2</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">4rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item-3</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">6rem</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="each"><a href="#each" class="headerlink" title="@each"></a>@each</h3><p>类似于 JavaScript 的 <code>for...in</code>：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">each</span> <span class="variable">$kind</span> in small, middle, large &#123;</span><br><span class="line">  .#&#123;<span class="variable">$kind</span>&#125;-<span class="attribute">icon</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: url(<span class="string">"/images/#&#123;$kind&#125;-icon.png"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.small-icon</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">"/images/small-icon.png"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.middle-icon</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">"/images/middle-icon.png"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.large-icon</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">"/images/large-icon.png"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="混合器"><a href="#混合器" class="headerlink" title="混合器"></a>混合器</h2><p>混合器使用<code>@mixin</code>标识符定义，通过<code>@include</code>来使用这个混合器，用来解决大段重用的代码。</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">mixin</span> clearfix &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  &amp;:after &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">"."</span>;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">clear</span>: both;</span><br><span class="line">    <span class="attribute">visibility</span>: hidden;</span><br><span class="line">  &#125;</span><br><span class="line">  * <span class="selector-tag">html</span> &amp; &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.clearfix</span> &#123;</span><br><span class="line">  @<span class="keyword">include</span> clearfix;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.clearfix</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">"."</span>;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">clear</span>: both;</span><br><span class="line">  <span class="attribute">visibility</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">* <span class="selector-tag">html</span> <span class="selector-class">.clearfix</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最强大的一点就是如同函数一般，可以传参，不仅可以指定默认值，并且可以使用关键词参数，这样就不用管参数前后顺序了：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">mixin</span> border-value(<span class="variable">$width</span>: 1px, <span class="variable">$color</span>: <span class="number">#333</span>, <span class="variable">$style</span>: solid) &#123;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="variable">$width</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="variable">$color</span>;</span><br><span class="line">  <span class="attribute">border-style</span>: <span class="variable">$style</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*不传参*/</span></span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  @<span class="keyword">include</span> border-value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*传参*/</span></span><br><span class="line"><span class="selector-tag">h2</span> &#123;</span><br><span class="line">  @<span class="keyword">include</span> border-value(<span class="number">2px</span>, <span class="number">#666</span>, dashed);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*关键词传参*/</span></span><br><span class="line"><span class="selector-tag">h3</span> &#123;</span><br><span class="line">  @<span class="keyword">include</span> border-value(<span class="variable">$style</span>: dashed, <span class="variable">$width</span>: 3px, <span class="variable">$color</span>: <span class="number">#999</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*不传参*/</span></span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#333</span>;</span><br><span class="line">  <span class="attribute">border-style</span>: solid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*传参*/</span></span><br><span class="line"><span class="selector-tag">h2</span> &#123;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#666</span>;</span><br><span class="line">  <span class="attribute">border-style</span>: dashed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*关键词传参*/</span></span><br><span class="line"><span class="selector-tag">h3</span> &#123;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#999</span>;</span><br><span class="line">  <span class="attribute">border-style</span>: dashed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="函数指令"><a href="#函数指令" class="headerlink" title="函数指令"></a>函数指令</h2><p>与 mixin 相同，也可以传递若干个全局变量给函数作为参数。一个函数可以含有多条语句，需要调用 <code>@return</code> 输出结果。</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid-width</span>: <span class="number">40px</span>;</span><br><span class="line"><span class="variable">$gutter-width</span>: <span class="number">10px</span>;</span><br><span class="line"></span><br><span class="line">@function grid-width(<span class="variable">$n</span>) &#123;</span><br><span class="line">  @return <span class="variable">$n</span> * <span class="variable">$grid-width</span> + (<span class="variable">$n</span> - 1) * <span class="variable">$gutter-width</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sidebar1</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: grid-width(<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sidebar2</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: grid-width(<span class="variable">$n</span>: <span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.sidebar1</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">240px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sidebar2</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">490px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SassScript"><a href="#SassScript" class="headerlink" title="SassScript"></a>SassScript</h2><h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>SassScript 支持 6 种主要的数据类型：</p><ul><li>数字，<code>1, 2, 13, 10px</code></li><li>字符串，有引号字符串与无引号字符串，<code>&quot;foo&quot;, &#39;bar&#39;, baz</code></li><li>颜色，<code>blue, #04a3f9, rgba(255,0,0,0.5)</code></li><li>布尔型，<code>true, false</code></li><li>空值，<code>null</code></li><li>数组 (list)，用空格或逗号作分隔符，<code>1.5em 1em 0 2em, Helvetica, Arial, sans-serif</code></li><li>maps, 相当于 JavaScript 的 object，<code>(key1: value1, key2: value2)</code></li></ul><h3 id="运算"><a href="#运算" class="headerlink" title="运算"></a>运算</h3><p>SassScript 支持数字的加减乘除、取整等运算 <code>(+, -, *, /, %)</code>，关系运算 <code>&lt;, &gt;, &lt;=, &gt;=</code> 也可用于数字运算，相等运算 <code>==</code>, <code>!=</code> 可用于所有数据类型。</p><h3 id="插值语句"><a href="#插值语句" class="headerlink" title="插值语句 #{}"></a>插值语句 #{}</h3><p>通过 <code>#{}</code> 插值语句可以在选择器或属性名中使用变量，避免 Sass 运行运算表达式。</p><h2 id="Bootstrap-4"><a href="#Bootstrap-4" class="headerlink" title="Bootstrap@4"></a>Bootstrap@4</h2><ul><li><a href="https://getbootstrap.com/" target="_blank" rel="noopener">Bootstrap v4.4.1</a></li></ul><p>入口文件 <code>bootstrap.scss</code>的引入组件很多，我们就挑一个看看，比如下面是我们最终的 float 内容：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.float-left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.float-right</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: right <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.float-none</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> (min-width: <span class="number">576px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.float-sm-left</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: left <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.float-sm-right</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: right <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.float-sm-none</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: none <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> (min-width: <span class="number">768px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.float-md-left</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: left <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.float-md-right</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: right <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.float-md-none</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: none <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> (min-width: <span class="number">992px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.float-lg-left</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: left <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.float-lg-right</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: right <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.float-lg-none</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: none <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> (min-width: <span class="number">1200px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.float-xl-left</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: left <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.float-xl-right</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: right <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.float-xl-none</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: none <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，我们去看看 bootstrap 是如何实现的：</p><h3 id="第一步：找路"><a href="#第一步：找路" class="headerlink" title="第一步：找路"></a>第一步：找路</h3><p>根据 <code>bootstrap.scss</code>里的内容<code>@import &quot;mixins&quot;;</code>，进入当前目录下的<code>_mixins.scss</code>，看到<code>@import &quot;mixins/float&quot;;</code>，所以继续打开<code>mixins</code> 目录下的 <code>_float.scss</code>。</p><h3 id="第二步：内容"><a href="#第二步：内容" class="headerlink" title="第二步：内容"></a>第二步：内容</h3><p><code>_float.scss</code>所有内容如下：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stylelint-disable declaration-no-important</span></span><br><span class="line"></span><br><span class="line">@<span class="keyword">each</span> <span class="variable">$breakpoint</span> in map-keys(<span class="variable">$grid-breakpoints</span>) &#123;</span><br><span class="line">  @<span class="keyword">include</span> media-breakpoint-up(<span class="variable">$breakpoint</span>) &#123;</span><br><span class="line">    <span class="variable">$infix</span>: breakpoint-infix(<span class="variable">$breakpoint</span>, <span class="variable">$grid-breakpoints</span>);</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.float</span>#&#123;<span class="variable">$infix</span>&#125;-<span class="attribute">left</span> &#123;</span><br><span class="line">      <span class="attribute">float</span>: left <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.float</span>#&#123;<span class="variable">$infix</span>&#125;-<span class="attribute">right</span> &#123;</span><br><span class="line">      <span class="attribute">float</span>: right <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.float</span>#&#123;<span class="variable">$infix</span>&#125;-<span class="attribute">none</span> &#123;</span><br><span class="line">      <span class="attribute">float</span>: none <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接着，有三个地方，我不知道是什么，如<code>map-keys()</code>，<code>media-breakpoint-up()</code>，<code>breakpoint-infix()</code>。</p><h3 id="第三步：解惑"><a href="#第三步：解惑" class="headerlink" title="第三步：解惑"></a>第三步：解惑</h3><ul><li><code>map-keys()</code> 返回 map 里面所有的 key：</li></ul><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid-breakpoints</span>: (</span><br><span class="line">  xs: <span class="number">0</span>,</span><br><span class="line">  sm: <span class="number">576px</span>,</span><br><span class="line">  md: <span class="number">768px</span>,</span><br><span class="line">  lg: <span class="number">992px</span>,</span><br><span class="line">  xl: <span class="number">1200px</span></span><br><span class="line">) !default;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">each</span> <span class="variable">$breakpoint</span> in map-keys(<span class="variable">$grid-breakpoints</span>) &#123;</span><br><span class="line">  .#&#123;<span class="variable">$breakpoint</span>&#125; &#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// css</span></span><br><span class="line"><span class="selector-class">.xs</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sm</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.md</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.lg</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.xl</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>资料：<a href="https://www.cnblogs.com/whqet/p/Sassmap.html" target="_blank" rel="noopener">Sass map 详解</a></p><ul><li><code>media-breakpoint-up()</code>，自定义函数，主要是根据媒体查询给出不同的结果</li></ul><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Media of at least the minimum breakpoint width. No query for the smallest breakpoint.</span></span><br><span class="line"><span class="comment">// Makes the @content apply to the given breakpoint and wider.</span></span><br><span class="line">@<span class="keyword">mixin</span> media-breakpoint-up(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>: <span class="variable">$grid-breakpoints</span>) &#123;</span><br><span class="line">  <span class="variable">$min</span>: breakpoint-min(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>);</span><br><span class="line">  @<span class="keyword">if</span> <span class="variable">$min</span> &#123;</span><br><span class="line">    @<span class="keyword">media</span> (min-width: <span class="variable">$min</span>) &#123;</span><br><span class="line">      @<span class="keyword">content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; @<span class="keyword">else</span> &#123;</span><br><span class="line">    @<span class="keyword">content</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里<code>breakpoint-min()</code>也是个函数：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Minimum breakpoint width. Null for the smallest (first) breakpoint.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    &gt;&gt; breakpoint-min(sm, (xs: 0, sm: 576px, md: 768px, lg: 992px, xl: 1200px))</span></span><br><span class="line"><span class="comment">//    576px</span></span><br><span class="line">@function breakpoint-min(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>: <span class="variable">$grid-breakpoints</span>) &#123;</span><br><span class="line">  <span class="variable">$min</span>: map-get(<span class="variable">$breakpoints</span>, <span class="variable">$name</span>);</span><br><span class="line">  @return if(<span class="variable">$min</span> != 0, <span class="variable">$min</span>, null);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里的<code>map-get</code>同 <code>map-keys</code>用法，返回 map 里面指定可以的 <code>value</code>：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$min-num</span>: breakpoint-min(sm, <span class="variable">$grid-breakpoints</span>);</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> (min-width: <span class="variable">$min-num</span>) &#123;</span><br><span class="line">  <span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#444</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// css</span></span><br><span class="line">@<span class="keyword">media</span> (min-width: 576px) &#123;</span><br><span class="line">  <span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#444</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@content</code>用在<code>mixin</code>里面的，当定义一个<code>mixin</code>后，并且设置了<code>@content</code>之后，、<code>@include</code>的时候可以传入相应的内容到<code>mixin</code>里面：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$color</span>: white;</span><br><span class="line">@<span class="keyword">mixin</span> colors(<span class="variable">$color</span>: blue) &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="variable">$color</span>;</span><br><span class="line">  @<span class="keyword">content</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="variable">$color</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.colors</span> &#123;</span><br><span class="line">  @<span class="keyword">include</span> colors &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="variable">$color</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// css</span></span><br><span class="line"><span class="selector-class">.colors</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: blue;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">border-color</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>资料：<a href="https://segmentfault.com/q/1010000004119350" target="_blank" rel="noopener">sass 语法中的@content</a></p><ul><li><code>breakpoint-infix()</code>，自定义函数：</li></ul><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Returns a blank string if smallest breakpoint, otherwise returns the name with a dash in front.</span></span><br><span class="line"><span class="comment">// Useful for making responsive utilities.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    &gt;&gt; breakpoint-infix(xs, (xs: 0, sm: 576px, md: 768px, lg: 992px, xl: 1200px))</span></span><br><span class="line"><span class="comment">//    ""  (Returns a blank string)</span></span><br><span class="line"><span class="comment">//    &gt;&gt; breakpoint-infix(sm, (xs: 0, sm: 576px, md: 768px, lg: 992px, xl: 1200px))</span></span><br><span class="line"><span class="comment">//    "-sm"</span></span><br><span class="line">@function breakpoint-infix(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>: <span class="variable">$grid-breakpoints</span>) &#123;</span><br><span class="line">  @return if(breakpoint-min(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>) == null, <span class="string">""</span>, <span class="string">"-#&#123;$name&#125;"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据注释我们演示一下：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$min-value-sm</span>: breakpoint-infix(sm, <span class="variable">$grid-breakpoints</span>);</span><br><span class="line"><span class="variable">$min-value-xs</span>: breakpoint-infix(xs, <span class="variable">$grid-breakpoints</span>);</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.float</span>#&#123;<span class="variable">$min-value-sm</span>&#125;-<span class="attribute">left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.float</span>#&#123;<span class="variable">$min-value-xs</span>&#125;-<span class="attribute">left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// css</span></span><br><span class="line"><span class="selector-class">.float-sm-left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.float-left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="整合"><a href="#整合" class="headerlink" title="整合"></a>整合</h3><p>最后，我们把所有关于 float 的内容组合在一起：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid-breakpoints</span>: (</span><br><span class="line">  xs: <span class="number">0</span>,</span><br><span class="line">  sm: <span class="number">576px</span>,</span><br><span class="line">  md: <span class="number">768px</span>,</span><br><span class="line">  lg: <span class="number">992px</span>,</span><br><span class="line">  xl: <span class="number">1200px</span></span><br><span class="line">) !default;</span><br><span class="line"></span><br><span class="line">@function breakpoint-min(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>: <span class="variable">$grid-breakpoints</span>) &#123;</span><br><span class="line">  <span class="variable">$min</span>: map-get(<span class="variable">$breakpoints</span>, <span class="variable">$name</span>);</span><br><span class="line">  @return if(<span class="variable">$min</span> != 0, <span class="variable">$min</span>, null);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@function breakpoint-infix(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>: <span class="variable">$grid-breakpoints</span>) &#123;</span><br><span class="line">  @return if(breakpoint-min(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>) == null, <span class="string">""</span>, <span class="string">"-#&#123;$name&#125;"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">mixin</span> media-breakpoint-up(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>: <span class="variable">$grid-breakpoints</span>) &#123;</span><br><span class="line">  <span class="variable">$min</span>: breakpoint-min(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>);</span><br><span class="line">  @<span class="keyword">if</span> <span class="variable">$min</span> &#123;</span><br><span class="line">    @<span class="keyword">media</span> (min-width: <span class="variable">$min</span>) &#123;</span><br><span class="line">      @<span class="keyword">content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; @<span class="keyword">else</span> &#123;</span><br><span class="line">    @<span class="keyword">content</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">each</span> <span class="variable">$breakpoint</span> in map-keys(<span class="variable">$grid-breakpoints</span>) &#123;</span><br><span class="line">  @<span class="keyword">include</span> media-breakpoint-up(<span class="variable">$breakpoint</span>) &#123;</span><br><span class="line">    <span class="variable">$infix</span>: breakpoint-infix(<span class="variable">$breakpoint</span>, <span class="variable">$grid-breakpoints</span>);</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.float</span>#&#123;<span class="variable">$infix</span>&#125;-<span class="attribute">left</span> &#123;</span><br><span class="line">      <span class="attribute">float</span>: left <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.float</span>#&#123;<span class="variable">$infix</span>&#125;-<span class="attribute">right</span> &#123;</span><br><span class="line">      <span class="attribute">float</span>: right <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.float</span>#&#123;<span class="variable">$infix</span>&#125;-<span class="attribute">none</span> &#123;</span><br><span class="line">      <span class="attribute">float</span>: none <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样直接就可以在环境里跑起来了。</p>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS </tag>
            
            <tag> SASS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于 React 状态管理那些事</title>
      <link href="/2019/12/29/react-state/"/>
      <url>/2019/12/29/react-state/</url>
      
        <content type="html"><![CDATA[<p>目的：采用状态管理的多种方式：实现一个计数器，可以加一，减一， 置零。<br><a id="more"></a></p><h2 id="React-state"><a href="#React-state" class="headerlink" title="React state"></a>React state</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      value: <span class="number">0</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleClick(actions) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (actions) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"INCREASE"</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.setState(<span class="function">(<span class="params">state, props</span>) =&gt;</span> (&#123;</span><br><span class="line">          value: ++state.value</span><br><span class="line">        &#125;));</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"DECREASE"</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.setState(<span class="function">(<span class="params">state, props</span>) =&gt;</span> (&#123;</span><br><span class="line">          value: --state.value</span><br><span class="line">        &#125;));</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">          value: <span class="number">0</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;p&gt;&#123;<span class="keyword">this</span>.state.value&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;() =&gt; this.handleClick("INCREASE")&#125;&gt;+1&lt;/</span>button&gt;</span><br><span class="line">        &lt;button onClick=&#123;() =&gt; <span class="keyword">this</span>.handleClick(<span class="string">"DECREASE"</span>)&#125;&gt;<span class="number">-1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;() =&gt; this.handleClick("RESET")&#125;&gt;0&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="Flux"><a href="#Flux" class="headerlink" title="Flux"></a>Flux</h2><h2 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h2><p>第一步：创建 reducer</p><ul><li>可以使用单独的一个 reducer,也可以将多个 reducer 合并为一个 reducer，即：combineReducers()</li><li>action 发出命令后将 state 放入 reucer 加工函数中，返回新的 state,对 state 进行加工处理</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reducer = <span class="function">(<span class="params">state = &#123; counter: <span class="number">0</span> &#125;, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"INCREASE"</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: state.counter + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"DECREASE"</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: state.counter - <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>第二步：创建 action</p><ul><li>用户是接触不到 state 的，只能有 view 触发，所以，这个 action 可以理解为指令，需要发出多少动作就有多少指令</li><li>action 是一个对象，必须有一个叫 type 的参数，定义 action 类型</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  increase: <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">"INCREASE"</span> &#125;),</span><br><span class="line">  decrease: <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">"DECREASE"</span> &#125;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>第三步：创建的 store，使用 createStore 方法</p><ul><li>store 可以理解为有多个加工机器的总工厂</li><li>提供 subscribe，dispatch，getState 这些方法。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"></span><br><span class="line">store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(store.getState()));</span><br><span class="line"></span><br><span class="line">store.dispatch(actions.increase()); <span class="comment">// &#123;counter: 1&#125;</span></span><br><span class="line">store.dispatch(actions.increase()); <span class="comment">// &#123;counter: 2&#125;</span></span><br><span class="line">store.dispatch(actions.increase()); <span class="comment">// &#123;counter: 3&#125;</span></span><br><span class="line">store.dispatch(actions.decrease()); <span class="comment">// &#123;counter: 2&#125;</span></span><br></pre></td></tr></table></figure><p>具体代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducer = <span class="function">(<span class="params">state = &#123; counter: <span class="number">0</span> &#125;, action = &#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; type &#125; = action;</span><br><span class="line">  <span class="keyword">const</span> &#123; counter &#125; = state;</span><br><span class="line">  <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"INCREASE"</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: counter + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"DECREASE"</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: counter - <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: <span class="number">0</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">CounterRedux</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      counter: <span class="number">0</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.unsubscribe = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.unsubscribe = store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        counter: store.getState().counter</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillUnmount() &#123;</span><br><span class="line">    <span class="comment">// 取消订阅</span></span><br><span class="line">    <span class="keyword">this</span>.unsubscribe();</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;&#123;<span class="keyword">this</span>.state.counter&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;() =&gt; store.dispatch(&#123; type: "INCREASE" &#125;)&#125;&gt;+1&lt;/</span>button&gt;</span><br><span class="line">        &lt;button onClick=&#123;() =&gt; store.dispatch(&#123; <span class="attr">type</span>: <span class="string">"DECREASE"</span> &#125;)&#125;&gt;<span class="number">-1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;() =&gt; store.dispatch(&#123; type: "RESET" &#125;)&#125;&gt;0&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>action 可以单独出来：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  increase: <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">"INCREASE"</span> &#125;),</span><br><span class="line">  decrease: <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">"DECREASE"</span> &#125;),</span><br><span class="line">  reset: <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">"RESET"</span> &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 触发</span></span><br><span class="line">&lt;button onClick=&#123;() =&gt; store.dispatch(actions.increase())&#125;&gt;+<span class="number">1</span>&lt;<span class="regexp">/button&gt;;</span></span><br></pre></td></tr></table></figure><p>主要是为了展示 redux 的一个工作流程，并没有把状态挂载在最顶层，详细完整版可以参考阮一峰老师的代码：<a href="https://github.com/reduxjs/redux/tree/master/examples/counter" target="_blank" rel="noopener">Redux Counter Example</a>。</p><p>Redux 的工作流程图，<a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html" target="_blank" rel="noopener">阮一峰博客文章</a>摘录:</p><p><img src="http://www.ruanyifeng.com/blogimg/asset/2016/bg2016091802.jpg" alt="Redux-Flow"></p><h2 id="React-Redux"><a href="#React-Redux" class="headerlink" title="React-Redux"></a>React-Redux</h2><p>Redux 是一款状态管理库，并且提供了 react-redux 库来与 React 亲密配合，这两者的关系如下图：</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/24/166a3e1533df9e8d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="react-redux流程图"></p><p>继续实现计数器，完整 Demo 可以看<a href="https://github.com/yangtao2o/myreact/tree/master/myredux/react-redux-counter" target="_blank" rel="noopener">这里</a>。</p><p>src 目录下大体结构：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">├── actions</span><br><span class="line">│   └── counter.jsx</span><br><span class="line">├── components</span><br><span class="line">│   └── app.jsx</span><br><span class="line">├── reducers</span><br><span class="line">│   └── counter.jsx</span><br><span class="line">└── store</span><br><span class="line">    └── app.jsx</span><br><span class="line">├── index.jsx</span><br></pre></td></tr></table></figure><p>首先，看入口文件 <code>index.js</code>:</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">"./reducers/counter.jsx"</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">"./store/app.jsx"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;<span class="regexp">/Provider&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById("root")</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><p>Provider 组件，其实就是 Context 实现的，提供一个状态供跨组件使用，只需要把 store 给他传过去，所有的子组件就可以通过 props 属性拿到状态值。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Context = React.createContext();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Provider</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 将React-redux中的Provide包装了react提供的API生成的Context.Provider</span></span><br><span class="line">  <span class="comment">//&lt;Provider store=&#123;xxxx&#125;&gt;&lt;/Provider&gt;，将store挂载在contex上</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Context.Provider value=&#123;&#123; <span class="attr">store</span>: <span class="keyword">this</span>.props.store &#125;&#125;&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.props.children&#125; <span class="comment">//子组件</span></span><br><span class="line">      &lt;<span class="regexp">/Context.Provider&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>Reducer 函数，它接受 Action 和当前 State 作为参数，返回一个新的 State，内容和之前的几乎差不多：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">"./reducers/counter.jsx"</span>;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./reducers/counter.jsx</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state = &#123; counter: <span class="number">0</span> &#125;, action = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; counter &#125; = state;</span><br><span class="line">  <span class="keyword">const</span> &#123; type &#125; = action;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"INCREASE"</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: counter + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"DECREASE"</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: counter - <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: <span class="number">0</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React-Redux 的核心之一 connect 方法，用于从 UI 组件生成容器组件。connect 方法接受两个参数：<code>mapStateToProps</code> 和 <code>mapDispatchToProps</code>。它们定义了 UI 组件的业务逻辑。前者负责输入逻辑，即将 state 映射到 UI 组件的参数（props），后者负责输出逻辑，即将用户对 UI 组件的操作映射成 Action。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">"./store/app.jsx"</span>;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./store/app.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">"./../components/app.jsx"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  increaseAction,</span><br><span class="line">  decreaseAction,</span><br><span class="line">  resetAction</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">"./../actions/counter.jsx"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mapStateToProps用户自己定义需要的状态</span></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function"><span class="params">state</span> =&gt;</span> (&#123; <span class="attr">counter</span>: state.counter &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function"><span class="params">dispatch</span> =&gt;</span> (&#123;</span><br><span class="line">  onIncreaseHandle: <span class="function"><span class="params">()</span> =&gt;</span> dispatch(increaseAction),</span><br><span class="line">  onDecreaseHandle: <span class="function"><span class="params">()</span> =&gt;</span> dispatch(decreaseAction),</span><br><span class="line">  onResetHandle: <span class="function"><span class="params">()</span> =&gt;</span> dispatch(resetAction)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(App);</span><br></pre></td></tr></table></figure><p>Action 的 type 属性：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./../actions/counter.jsx</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> increaseAction = &#123; <span class="attr">type</span>: <span class="string">"INCREASE"</span> &#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> decreaseAction = &#123; <span class="attr">type</span>: <span class="string">"DECREASE"</span> &#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> resetAction = &#123; <span class="attr">type</span>: <span class="string">"RESET"</span> &#125;;</span><br></pre></td></tr></table></figure><p>接着，我们看一下熟悉的 App 组件应该怎么写：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import App from "./../components/app.jsx";</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;</span><br><span class="line">      counter,</span><br><span class="line">      onIncreaseHandle,</span><br><span class="line">      onDecreaseHandle,</span><br><span class="line">      onResetHandle</span><br><span class="line">    &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;&#123;counter&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;onIncreaseHandle&#125;&gt;+1&lt;/</span>button&gt;</span><br><span class="line">        &lt;button onClick=&#123;onDecreaseHandle&#125;&gt;<span class="number">-1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;onResetHandle&#125;&gt;0&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure><p>前期做了许多工作，这里如同从父组件里获取 props 属性般获取、触发等行为，所有 store 里的 state 都通过 connect 方法给处理了：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connect(mapStateToProps, mapDispatchToProps)(App);</span><br></pre></td></tr></table></figure><p>到这里，计数器基本的功能都好了，我的 <a href="https://github.com/yangtao2o/myreact/tree/master/myredux/react-redux-counter" target="_blank" rel="noopener">Demo</a>，阮一峰老师的 <a href="https://github.com/jackielii/simplest-redux-example/blob/master/index.js" target="_blank" rel="noopener">Demo</a>，以及讲解的文章，<a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_three_react-redux.html" target="_blank" rel="noopener">Redux 入门教程（三）：React-Redux 的用法</a>，<a href="https://juejin.im/post/5bcfce9ff265da0aa5294a25" target="_blank" rel="noopener">让 react 用起来更得心应手——（react-redux）</a>。</p><h2 id="React-Hooks"><a href="#React-Hooks" class="headerlink" title="React Hooks"></a>React Hooks</h2><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html" target="_blank" rel="noopener">Redux 入门教程（一）：基本用法</a></li><li><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_three_react-redux.html" target="_blank" rel="noopener">Redux 入门教程（三）：React-Redux 的用法</a></li><li><a href="https://juejin.im/post/5bcfce9ff265da0aa5294a25" target="_blank" rel="noopener">让 react 用起来更得心应手——（react-redux）</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 前端框架 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试 </tag>
            
            <tag> react </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS 异步处理的几种方式·请求篇</title>
      <link href="/2019/12/29/async-method-2/"/>
      <url>/2019/12/29/async-method-2/</url>
      
        <content type="html"><![CDATA[<h2 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h2><ul><li><a href="https://github.com/mqyqingfeng/Blog/issues/98" target="_blank" rel="noopener">ES6 系列之我们来聊聊 Promise</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/101" target="_blank" rel="noopener">ES6 系列之异步处理实战</a></li><li><a href="https://github.com/mqyqingfeng/Blog#es6-%E7%B3%BB%E5%88%97%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener">ES6 系列 - 冴羽的博客</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试 </tag>
            
            <tag> ES6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS 异步处理的几种方式·红灯篇</title>
      <link href="/2019/12/29/async-method-1/"/>
      <url>/2019/12/29/async-method-1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>题目：红灯三秒亮一次，绿灯一秒亮一次，黄灯两秒亮一次，不断交替循环</p></blockquote><a id="more"></a><p>先定义下红绿灯：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">red</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"red"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">green</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"green"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">yellow</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"yellow"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>异步编程的语法目标，就是怎样让它更像同步编程,有以下几种：</p><ul><li>回调函数实现</li><li>事件监听 event</li><li>发布订阅 Publish/Subscribe</li><li>Promise 和 Generator</li><li>Async/await</li></ul><h2 id="一、回调函数"><a href="#一、回调函数" class="headerlink" title="一、回调函数"></a>一、回调函数</h2><p>这是最常见的一种方式，把函数作为参数送入，然后回调。</p><p>第一版：简单明了</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"wait for about 3 seconds..."</span>);</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    red();</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      green();</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        yellow();</span><br><span class="line">        step();</span><br><span class="line">      &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">step();</span><br></pre></td></tr></table></figure><p>第二版：封装定时器</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> light = <span class="function">(<span class="params">timmer, cb</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    cb();</span><br><span class="line">  &#125;, timmer);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  light(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">    red();</span><br><span class="line">    light(<span class="number">1000</span>, () =&gt; &#123;</span><br><span class="line">      green();</span><br><span class="line">      light(<span class="number">2000</span>, () =&gt; &#123;</span><br><span class="line">        yellow();</span><br><span class="line">        step();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">typeof</span> cb === <span class="string">"function"</span> &amp;&amp; cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">step(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"wait for about 3 seconds..."</span>));</span><br></pre></td></tr></table></figure><h2 id="二、事件监听"><a href="#二、事件监听" class="headerlink" title="二、事件监听"></a>二、事件监听</h2><p>采用事件驱动模式。任务的执行不取决于代码的顺序，而取决于某个事件是否发生。</p><p>第一版：监听一个事件，然后触发这个事件，并且执行事件里的回调函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 Node events 模块</span></span><br><span class="line"><span class="keyword">const</span> events = <span class="built_in">require</span>(<span class="string">"events"</span>);</span><br><span class="line"><span class="keyword">const</span> emitter = <span class="keyword">new</span> events.EventEmitter();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听</span></span><br><span class="line">emitter.on(<span class="string">"lightEvent"</span>, str =&gt; <span class="built_in">console</span>.log(str));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发</span></span><br><span class="line">emitter.emit(<span class="string">"lightEvent"</span>, <span class="string">"red"</span>);</span><br><span class="line">emitter.emit(<span class="string">"lightEvent"</span>, <span class="string">"green"</span>);</span><br><span class="line">emitter.emit(<span class="string">"lightEvent"</span>, <span class="string">"yellow"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="comment">// red</span></span><br><span class="line"><span class="comment">// green</span></span><br><span class="line"><span class="comment">// yellow</span></span><br></pre></td></tr></table></figure><p>第二版：加个顺序执行</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 Node events 模块</span></span><br><span class="line"><span class="keyword">const</span> events = <span class="built_in">require</span>(<span class="string">"events"</span>);</span><br><span class="line"><span class="keyword">const</span> emitter = <span class="keyword">new</span> events.EventEmitter();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> lightHandler = <span class="function">(<span class="params">timmer, cb</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    cb();</span><br><span class="line">  &#125;, timmer);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听</span></span><br><span class="line">emitter.on(<span class="string">"lightEvent"</span>, str =&gt; <span class="built_in">console</span>.log(str));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  lightHandler(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">    emitter.emit(<span class="string">"lightEvent"</span>, <span class="string">"red"</span>);</span><br><span class="line">    lightHandler(<span class="number">1000</span>, () =&gt; &#123;</span><br><span class="line">      emitter.emit(<span class="string">"lightEvent"</span>, <span class="string">"green"</span>);</span><br><span class="line">      lightHandler(<span class="number">2000</span>, () =&gt; &#123;</span><br><span class="line">        emitter.emit(<span class="string">"lightEvent"</span>, <span class="string">"yellow"</span>);</span><br><span class="line">        step();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">step();</span><br></pre></td></tr></table></figure><p>依旧是回调执行，我们继续远征吧。</p><h2 id="三、发布-订阅"><a href="#三、发布-订阅" class="headerlink" title="三、发布/订阅"></a>三、发布/订阅</h2><blockquote><p>“事件”，完全可以理解成”信号”。</p><p>我们假定，存在一个”信号中心”，某个任务执行完成，就向信号中心”发布”（publish）一个信号，其他任务可以向信号中心”订阅”（subscribe）这个信号，从而知道什么时候自己可以开始执行。这就叫做”发布/订阅模式”（publish-subscribe pattern），又称”观察者模式”（observer pattern）。 - 阮一峰</p></blockquote><p>订阅者（Subscriber）把自己想订阅的事件注册（Subscribe）到调度中心（Event Channel），当发布者（Publisher）发布该事件（Publish Event）到调度中心，也就是该事件触发时，由调度中心统一调度（Fire Event）订阅者注册到调度中心的处理代码。</p><p>第一版：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> publisher = &#123;</span><br><span class="line">  <span class="comment">// 缓存列表</span></span><br><span class="line">  lists: &#123;&#125;,</span><br><span class="line">  <span class="comment">// 订阅</span></span><br><span class="line">  subscribe: <span class="function"><span class="keyword">function</span>(<span class="params">event, handler</span>) </span>&#123;</span><br><span class="line">    (<span class="keyword">this</span>.lists[event] || (<span class="keyword">this</span>.lists[event] = [])).push(handler);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 发布</span></span><br><span class="line">  publish: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> event = [].shift.call(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">const</span> events = <span class="keyword">this</span>.lists[event];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!events || events.length === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    events.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      item.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订阅</span></span><br><span class="line">publisher.subscribe(<span class="string">"lightEvent"</span>, red);</span><br><span class="line">publisher.subscribe(<span class="string">"lightEvent"</span>, green);</span><br><span class="line">publisher.subscribe(<span class="string">"lightEvent"</span>, yellow);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布</span></span><br><span class="line">publisher.publish(<span class="string">"lightEvent"</span>);</span><br></pre></td></tr></table></figure><p>第二版：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> publisher = &#123;</span><br><span class="line">  <span class="comment">// 缓存列表</span></span><br><span class="line">  lists: &#123;&#125;,</span><br><span class="line">  <span class="comment">// 订阅</span></span><br><span class="line">  subscribe: <span class="function"><span class="keyword">function</span>(<span class="params">event, handler</span>) </span>&#123;</span><br><span class="line">    (<span class="keyword">this</span>.lists[event] || (<span class="keyword">this</span>.lists[event] = [])).push(handler);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 取消订阅</span></span><br><span class="line">  unsubscribe: <span class="function"><span class="keyword">function</span>(<span class="params">event, handler</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> events = <span class="keyword">this</span>.lists[event];</span><br><span class="line">    <span class="keyword">if</span> (!events) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!handler) &#123;</span><br><span class="line">      events &amp;&amp; (events.length = <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      events.forEach(<span class="function">(<span class="params">item, i</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (item === handler) &#123;</span><br><span class="line">          events.splice(i, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 发布</span></span><br><span class="line">  publish: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> event = [].shift.call(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">const</span> events = <span class="keyword">this</span>.lists[event];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!events || events.length === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    events.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      item.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> lightHandler = <span class="function">(<span class="params">timmer, cb</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    cb();</span><br><span class="line">  &#125;, timmer);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> colorHandler = <span class="function"><span class="params">color</span> =&gt;</span> <span class="built_in">console</span>.log(color);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订阅</span></span><br><span class="line">publisher.subscribe(<span class="string">"redEvent"</span>, colorHandler);</span><br><span class="line">publisher.subscribe(<span class="string">"greenEvent"</span>, colorHandler);</span><br><span class="line">publisher.subscribe(<span class="string">"yellowEvent"</span>, colorHandler);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  lightHandler(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">    publisher.publish(<span class="string">"redEvent"</span>, <span class="string">"red"</span>);</span><br><span class="line">    lightHandler(<span class="number">1000</span>, () =&gt; &#123;</span><br><span class="line">      publisher.publish(<span class="string">"greenEvent"</span>, <span class="string">"green"</span>);</span><br><span class="line">      lightHandler(<span class="number">2000</span>, () =&gt; &#123;</span><br><span class="line">        publisher.publish(<span class="string">"yellowEvent"</span>, <span class="string">"yellow"</span>);</span><br><span class="line">        step();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">step();</span><br></pre></td></tr></table></figure><h2 id="三、Promise"><a href="#三、Promise" class="headerlink" title="三、Promise"></a>三、Promise</h2><p>直接上代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> light = <span class="function">(<span class="params">timmer, cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      cb();</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, timmer);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> step = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">Promise</span>.resolve()</span><br><span class="line">    .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> light(<span class="number">3000</span>, red);</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> light(<span class="number">1000</span>, green);</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> light(<span class="number">2000</span>, yellow);</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      step();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">step();</span><br></pre></td></tr></table></figure><h2 id="四、Generator"><a href="#四、Generator" class="headerlink" title="四、Generator"></a>四、Generator</h2><p>Promise 的写法减少了好多回调，但是仍有回调的存在，这次尝试使用 Generator，看是否能够避免回调。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> light = <span class="function">(<span class="params">timmer, cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      cb();</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, timmer);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> light(<span class="number">3000</span>, red);</span><br><span class="line">  <span class="keyword">yield</span> light(<span class="number">1000</span>, green);</span><br><span class="line">  <span class="keyword">yield</span> light(<span class="number">3000</span>, yellow);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> iterator = gen();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> step = <span class="function">(<span class="params">gen, iterator</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> s = iterator.next();</span><br><span class="line">  <span class="comment">// 返回 &#123; value: Promise &#123; &lt;pending&gt; &#125;, done: false &#125;</span></span><br><span class="line">  <span class="keyword">if</span> (s.done) &#123;</span><br><span class="line">    step(gen, gen());</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// value 返回 Promise 对象</span></span><br><span class="line">    s.value.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      step(gen, iterator);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">step(gen, iterator);</span><br></pre></td></tr></table></figure><h2 id="五、Async-await"><a href="#五、Async-await" class="headerlink" title="五、Async/await"></a>五、Async/await</h2><p>有了 Generator 做铺垫，<code>async/await</code> 就比较容易理解了：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> light = <span class="function">(<span class="params">timmer, cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      cb();</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, timmer);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">step</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">await</span> light(<span class="number">3000</span>, red);</span><br><span class="line">  <span class="keyword">await</span> light(<span class="number">1000</span>, green);</span><br><span class="line">  <span class="keyword">await</span> light(<span class="number">2000</span>, yellow);</span><br><span class="line">  step();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">step();</span><br></pre></td></tr></table></figure><p>同步写法，容易理解，和我们的线性思考方式一致，<code>async/await</code>是 <code>ES2017</code> 的方案。</p><h2 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h2><ul><li><a href="https://www.cnblogs.com/dojo-lzz/p/5495671.html" target="_blank" rel="noopener">一道关于 Promise 应用的面试题</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/98" target="_blank" rel="noopener">ES6 系列之我们来聊聊 Promise</a></li><li><a href="http://www.ruanyifeng.com/blog/2012/12/asynchronous%EF%BC%BFjavascript.html" target="_blank" rel="noopener">Javascript 异步编程的 4 种方法</a></li><li><a href="https://juejin.im/post/5cd97d75e51d453a69177ecc" target="_blank" rel="noopener">JavaScript | 异步处理</a></li><li><a href="https://www.cnblogs.com/pingfan1990/p/4661841.html" target="_blank" rel="noopener">nodejs 事件的监听与事件的触发</a></li><li><a href="https://www.codercto.com/a/81223.html" target="_blank" rel="noopener">JavaScript 发布-订阅模式</a></li><li><a href="https://www.jb51.net/article/154921.htm" target="_blank" rel="noopener">JavaScript 实现与使用发布/订阅模式详解</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试 </tag>
            
            <tag> ES6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>探一下 NodeList 和 HTMLCollection</title>
      <link href="/2019/12/03/html-nodelist/"/>
      <url>/2019/12/03/html-nodelist/</url>
      
        <content type="html"><![CDATA[<blockquote><p>主要区别是，NodeList 可以包含各种类型的节点，HTMLCollection 只能包含 HTML 元素节点。</p></blockquote><a id="more"></a><h2 id="NodeList-接口"><a href="#NodeList-接口" class="headerlink" title="NodeList 接口"></a>NodeList 接口</h2><p>NodeList 实例是一个类似数组的对象，它的成员是节点对象。通过以下方法可以得到 NodeList 实例。</p><ul><li>Node.childNodes</li><li>document.querySelectorAll() 等节点搜索方法</li></ul><p>NodeList 实例很像数组，可以使用 length 属性和 forEach 方法。但是，它不是数组，不能使用 pop 或 push 之类数组特有的方法。</p><p>如果 NodeList 实例要使用数组方法，可以将其转为真正的数组。</p><p>除了使用 forEach 方法遍历 NodeList 实例，还可以使用 for 循环。</p><ul><li>NodeList.prototype.length，length 属性返回 NodeList 实例包含的节点数量</li><li>NodeList.prototype.forEach()，遍历 NodeList 的所有成员</li><li>NodeList.prototype.item()，item 方法接受一个整数值作为参数，表示成员的位置，返回该位置上的成员。</li></ul><p>下面三个方法，都返回一个 ES6 的遍历器对象，<code>for...of</code> 可获取每一个成员信息：</p><ul><li>NodeList.prototype.keys()，返回键名的遍历器</li><li>NodeList.prototype.values()，返回键值的遍历器</li><li>NodeList.prototype.entries()，返回的遍历器</li></ul><h2 id="HTMLCollection-接口"><a href="#HTMLCollection-接口" class="headerlink" title="HTMLCollection 接口"></a>HTMLCollection 接口</h2><p>HTMLCollection 是一个节点对象的集合，只能包含元素节点（element），不能包含其他类型的节点。</p><p>它的返回值是一个类似数组的对象，但是与 NodeList 接口不同，HTMLCollection 没有 forEach 方法，只能使用 for 循环遍历。</p><p>返回 HTMLCollection 实例的，主要是一些 Document 对象的集合属性，比如 document.links、document.forms、document.images 等。</p><ul><li>HTMLCollection.prototype.length</li><li>HTMLCollection.prototype.item()</li><li>HTMLCollection.prototype.namedItem()，参数是一个字符串，表示 id 属性或 name 属性的值，返回对应的元素节点。如果没有对应的节点，则返回 null。</li></ul><h2 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h2><p>共同点：</p><ul><li>类数组对象，有 length 属性</li><li>共同的方法：item，可以通过 item(index) 或者 item(id) 来访问返回结果中的元素</li><li>实时变动的（live），document 上的更改会反映到相关对象上（例外：document.querySelectorAll 返回的 NodeList 不是实时的）</li></ul><p>区别：</p><ul><li>NodeList 可以包含任何节点类型，HTMLCollection 只包含元素节点（elementNode），elementNode 就是 HTML 中的标签</li><li>HTMLCollection 比 NodeList 多一项方法：namedItem，可以通过传递 id 或 name 属性来获取节点信息</li></ul><p>参考资料：</p><ul><li><a href="http://wangdoc.com/javascript/dom/nodelist.html" target="_blank" rel="noopener">NodeList 接口，HTMLCollection 接口</a></li><li><a href="https://www.jianshu.com/p/f6ff5ebe45fd" target="_blank" rel="noopener">HTMLCollection vs. NodeList</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Html </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Html </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>将 Hexo 和 Vuepress 静态资源推送至 Ubuntu</title>
      <link href="/2019/11/27/ubuntu-aliyun/"/>
      <url>/2019/11/27/ubuntu-aliyun/</url>
      
        <content type="html"><![CDATA[<blockquote><p>由于已经开通的 Hexo 和 Vuepress 博客，都挂在 github 的免费服务器上，加载速度不堪忍睹，所以打算挂在阿里云的服务器上，过程可以用举步维艰来形容。</p></blockquote><a id="more"></a><h2 id="使用-ssh-远程登录"><a href="#使用-ssh-远程登录" class="headerlink" title="使用 ssh 远程登录"></a>使用 ssh 远程登录</h2><ul><li>Ubuntu 常用命令：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新源列表</span></span><br><span class="line">apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 SSH</span></span><br><span class="line">apt-get install openssh-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 SSH 服务是否启动</span></span><br><span class="line">ps -e | grep ssh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止、重启</span></span><br><span class="line">service ssh stop</span><br><span class="line">service ssh start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 ip</span></span><br><span class="line">ifconfig</span><br></pre></td></tr></table></figure><p>使用 ssh 登录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@47.101.33.81</span><br></pre></td></tr></table></figure><p>由于之前我远程登录过 CentOS，所以换成 Ubuntu 之后，再次远程登录，就会出现如下无法连接信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">~ ❯❯❯ ssh root@47.101.33.81</span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @</span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!</span><br><span class="line">Someone could be eavesdropping on you right now (man-in-the-middle attack)!</span><br><span class="line">It is also possible that a host key has just been changed.</span><br><span class="line">The fingerprint <span class="keyword">for</span> the ECDSA key sent by the remote host is</span><br><span class="line">SHA256:neXCznmpgVyF/0YSiDxOjD/8A1+4ND2D9+fZjUozbzc.</span><br><span class="line">Please contact your system administrator.</span><br><span class="line">Add correct host key <span class="keyword">in</span> /Users/yangtao/.ssh/known_hosts to get rid of this message.</span><br><span class="line">Offending ECDSA key <span class="keyword">in</span> /Users/yangtao/.ssh/known_hosts:5</span><br><span class="line">ECDSA host key <span class="keyword">for</span> 47.101.33.81 has changed and you have requested strict checking.</span><br><span class="line">Host key verification failed.</span><br></pre></td></tr></table></figure><p>所以，根据提示，我就进入目录下，删除了之前保留的信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~ ❯❯❯ vim /Users/yangtao/.ssh/known_hosts</span><br></pre></td></tr></table></figure><p>然后，保存，再次登录，就会重新设置，也就远程登录成功。</p><h2 id="在-Ubuntu-18-04-上安装和配置-Nginx"><a href="#在-Ubuntu-18-04-上安装和配置-Nginx" class="headerlink" title="在 Ubuntu 18.04 上安装和配置 Nginx"></a>在 Ubuntu 18.04 上安装和配置 Nginx</h2><h3 id="安装-Nginx"><a href="#安装-Nginx" class="headerlink" title="安装 Nginx"></a>安装 Nginx</h3><p>我习惯 fish，可以预装一下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt install fish</span><br><span class="line"></span><br><span class="line">root@istaotao:~<span class="comment"># fish</span></span><br><span class="line">Welcome to fish, the friendly interactive shell</span><br></pre></td></tr></table></figure><p>注：如果遇到权限问题，需要 <code>sudo</code>，如：<code>sudo apt install fish</code>。</p><p>Nginx 的软件包在 Ubuntu 默认软件仓库中可用。 安装非常简单，只需键入以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install nginx</span><br></pre></td></tr></table></figure><p>检查 Nginx 服务的状态：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status nginx</span><br></pre></td></tr></table></figure><p>查看版本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@istaotao ~<span class="comment"># nginx -v</span></span><br><span class="line">nginx version: nginx/1.14.0 (Ubuntu)</span><br></pre></td></tr></table></figure><p>然后访问公网 ip，或者域名，就可以看到欢迎界面，如果长时间没有响应，说明你的服务器应该没有开启 80 端口。</p><p>参考：<a href="https://segmentfault.com/q/1010000009437407" target="_blank" rel="noopener">阿里云 ubuntu nginx 无法访问，求解答</a></p><h3 id="使用-systemctl-管理-Nginx-服务"><a href="#使用-systemctl-管理-Nginx-服务" class="headerlink" title="使用 systemctl 管理 Nginx 服务"></a>使用 systemctl 管理 Nginx 服务</h3><p>您可以像任何其他 systemd 单位一样管理 Nginx 服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 要停止Nginx服务，请运行：</span></span><br><span class="line">systemctl stop nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 要再次启动，请键入：</span></span><br><span class="line">systemctl start nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新启动Nginx服务：</span></span><br><span class="line">systemctl restart nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在进行一些配置更改后重新加载Nginx服务：</span></span><br><span class="line">systemctl reload nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果你想禁用Nginx服务在启动时启动：</span></span><br><span class="line">systemctl <span class="built_in">disable</span> nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 并重新启用它：</span></span><br><span class="line">systemctl <span class="built_in">enable</span> nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查Web服务器是否在运行</span></span><br><span class="line">systemctl status nginx</span><br></pre></td></tr></table></figure><p>也可以使用 service 管理 Nginx 服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 停止Nginx服务，请运行：</span></span><br><span class="line">service nginx stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 要再次启动，请键入：</span></span><br><span class="line">service nginx start</span><br><span class="line"></span><br><span class="line"><span class="comment">#重新启动Nginx服务：</span></span><br><span class="line">service nginx restart</span><br><span class="line"></span><br><span class="line"><span class="comment">#在进行一些配置更改后重新加载Nginx服务：</span></span><br><span class="line">service nginx reload</span><br></pre></td></tr></table></figure><h3 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h3><p>获得应用程序配置文件的列表：<code>ufw app list</code>，查看状态：<code>ufw status</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@istaotao ~<span class="comment"># ufw app list</span></span><br><span class="line">Available applications:</span><br><span class="line">  Nginx Full</span><br><span class="line">  Nginx HTTP</span><br><span class="line">  Nginx HTTPS</span><br><span class="line">  OpenSSH</span><br></pre></td></tr></table></figure><h3 id="Nginx-文件和目录说明"><a href="#Nginx-文件和目录说明" class="headerlink" title="Nginx 文件和目录说明"></a>Nginx 文件和目录说明</h3><p>nginx 服务器配置文件：</p><ul><li><strong>/etc/nginx</strong></li></ul><p>Nginx 配置目录。所有的 Nginx 配置文件都驻留在这里。</p><ul><li><strong>/etc/nginx/nginx.conf</strong></li></ul><p>主要的 Nginx 配置文件。  这可以修改，以更改 Nginx 全局配置。</p><ul><li><strong>/etc/nginx/sites-available/</strong></li></ul><p>可存储每个站点服务器块的目录。  除非将 Nginx 链接到<code>sites-enabled了sites-enabled</code>目录，否则 Nginx 不会使用此目录中的配置文件。  通常，所有服务器块配置都在此目录中完成，然后通过链接到其他目录启用。</p><ul><li><strong>/etc/nginx/sites-enabled/</strong></li></ul><p>存储启用的每个站点服务器块的目录。  通常，这些是通过链接到 sites-available 目录中的配置文件创建的。</p><ul><li><strong>/etc/nginx/snippets</strong></li></ul><p>这个目录包含可以包含在 Nginx 配置其他地方的配置片段。  可重复配置的片段可以重构为片段。</p><p>nginx 服务器日志文件：</p><ul><li><strong>/var/log/nginx/access.log</strong></li></ul><p>除非 Nginx 配置为其他方式，否则每个对您的 Web 服务器的请求都会记录在此日志文件中。</p><ul><li><strong>/var/log/nginx/error.log</strong></li></ul><p>任何 Nginx 错误都会记录在这个日志中。</p><h3 id="虚拟站点的设置"><a href="#虚拟站点的设置" class="headerlink" title="虚拟站点的设置"></a>虚拟站点的设置</h3><p>Ubuntu 18.04 上的 Nginx 默认启用了一个服务器模块，该模块被配置为在<code>/var/www/html</code>目录下提供文档内容。</p><p>接下来，我们模拟一个虚拟网点。</p><p>创建<code>example.com</code>目录，使用<code>-p</code>标志创建任何必需的父目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /var/www/example.com/html</span><br></pre></td></tr></table></figure><p>使用\$USER 环境变量分配目录的所有权：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R <span class="variable">$USER</span>:<span class="variable">$USER</span> /var/www/example.com/html/</span><br></pre></td></tr></table></figure><p>修改目录的权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod -R 755 /var/www/example.com/html/</span><br></pre></td></tr></table></figure><p>创建一个 index.html 页面：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/www/example.com/html/index.html</span><br></pre></td></tr></table></figure><p>如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome to Example.com!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Success! The example.com server block is working!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在不直接修改默认配置文件的情况下，可以在<code>/etc/nginx/sites-available/</code>上创建一个新文件<code>example.com</code>，并将如下内容复制到<code>example.com</code>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        listen [::]:80;</span><br><span class="line"></span><br><span class="line">        root /var/www/example.com/html;</span><br><span class="line">        index index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">        server_name example.com www.example.com;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                try_files $uri $uri/ =404;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>操作方法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/nginx/sites-available/</span><br><span class="line">touch example.com</span><br><span class="line">vim example.com</span><br></pre></td></tr></table></figure><p>常规复制完毕之后，按<code>:</code>之后，接着按<code>wq</code>，vim 就可以保存退出了。</p><p>创建一个软链接，连到默认启动<code>sites-enabled</code>目录来启用该文件，该目录是 Nginx 在启动过程中读取的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /etc/nginx/sites-available/example.com /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure><p>现在启用两个服务器模块并将其配置为基于<code>listen</code>和<code>server_name</code>指令响应请求：</p><p><strong>example.com</strong> ：将响应<code>example.com</code>和<code>www.example.com</code>请求。</p><p><strong>default</strong> ：将响应端口<code>80</code>上与其他两个块不匹配的任何请求。</p><p>为了避免添加额外的服务器名称可能导致的哈希桶内存问题，有必要调整<code>/etc/nginx/nginx.conf</code>文件中的单个值。</p><p>修改配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure><p>找到<code>server_names_hash_bucket_size 64</code>指令并删除 # 符号以取消注释该行：</p><p>接下来，测试以确保您的 Nginx 文件中没有语法错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br><span class="line"></span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br></pre></td></tr></table></figure><p>重启 nginx：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure><p>然后，需要在本地 hosts 文件添加对应 host：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ip 换成自己的阿里云 ip</span><br><span class="line">47.101.33.81 www.example.com</span><br></pre></td></tr></table></figure><p>这样，不出意外的话，就可以通过 <code>http://example.com</code>来访问刚刚设置的内容，而访问<code>http://47.101.33.81</code>，依旧是默认的内容。</p><h2 id="hexo-部署到服务器上"><a href="#hexo-部署到服务器上" class="headerlink" title="hexo 部署到服务器上"></a>hexo 部署到服务器上</h2><p>整个流程就是本地将 *.md 渲染成静态文件，然后 Git 推送到服务器的 repository,服务器再通过 git-hooks 同步网站根目录。</p><p><img src="https://ae01.alicdn.com/kf/H1aadf5b0baac42aaa45b753358768293V.jpg" alt="hexo的架构"></p><h3 id="服务器配置"><a href="#服务器配置" class="headerlink" title="服务器配置"></a>服务器配置</h3><p>主要使用 <code>git hooks</code> 来实现自动化部署。以下步骤为其他博客完整内容，但是我是直接在 root 下操作的，所以关于权限等问题，是直接略过的，等后期熟悉了再加上。</p><h4 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h4><p>安装 git：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure><h4 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h4><p>创建一个 git 用户，用来运行 git 服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo adduser git</span><br></pre></td></tr></table></figure><p>虽说现在的仓库只有我们自己在使用，新建一个 git 用户显得不是很有必要，但是为了安全起见，还是建议使用单独的 git 用户来专门运行 git 服务。</p><h4 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h4><p>创建证书登录，把自己电脑的公钥，也就是 <code>~/.ssh/id_rsa.pub</code> 文件里的内容添加到服务器的 <code>/home/git/.ssh/authorized_keys</code> 文件中，添加公钥之后可以防止每次 push 都输入密码。</p><p>如果你之前没有生成过公钥，则可能就没有 id_rsa.pub 文件，具体的生成方法，可以<a href="https://help.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent" target="_blank" rel="noopener">Generating a new SSH key and adding it to the ssh-agent</a>。</p><h4 id="第四步"><a href="#第四步" class="headerlink" title="第四步"></a>第四步</h4><p>初始化 Git 仓库，我是将其放在 <code>/var/repo/hexo.git</code> 目录下的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /var/repo</span><br><span class="line"><span class="built_in">cd</span> /var/repo</span><br><span class="line">sudo git init --bare hexo.git</span><br></pre></td></tr></table></figure><p>使用 <code>--bare</code> 参数，Git 就会创建一个裸仓库，裸仓库没有工作区，我们不会在裸仓库上进行操作，它只为共享而存在。</p><h4 id="第五步"><a href="#第五步" class="headerlink" title="第五步"></a>第五步</h4><p>配置 git hooks，关于 hooks 的详情内容可以<a href="https://git-scm.com/book/zh/v2/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git-%E9%92%A9%E5%AD%90" target="_blank" rel="noopener">自定义 Git - Git 钩子</a>。</p><p>我们这里要使用的是 <code>post-receive</code> 的 hook，这个 hook 会在整个 git 操作过程完结以后被运行。</p><p>在 <code>hexo.git/hooks</code> 目录下新建一个 <code>post-receive</code> 文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/repo/blog.git/hooks</span><br><span class="line">vim post-receive</span><br></pre></td></tr></table></figure><p>在 <code>post-receive</code> 文件中写入如下内容：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">git --work-tree=/var/www/hexo --git-dir=/var/repo/hexo.git checkout -f</span><br></pre></td></tr></table></figure><p>注意，<code>/var/www/hexo</code> 要换成你自己的部署目录，一般可能都是 <code>/var/www/html</code>。上面那句 git 命令可以在我们每次 push 完之后，把部署目录更新到博客的最新生成状态。这样便可以完成达到自动部署的目的了。</p><p>不要忘记设置这个文件的可执行权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x post-receive</span><br></pre></td></tr></table></figure><h4 id="第六步"><a href="#第六步" class="headerlink" title="第六步"></a>第六步</h4><p>改变 hexo.git 目录的拥有者为 git 用户：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R git:git blog.git</span><br></pre></td></tr></table></figure><h4 id="第七步"><a href="#第七步" class="headerlink" title="第七步"></a>第七步</h4><p>禁用 git 用户的 shell 登录权限。</p><p>出于安全考虑，我们要让 git 用户不能通过 shell 登录。可以编辑 <code>/etc/passwd</code> 来实现，在 <code>/etc/passwd</code> 中找到类似下面的一行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git:x:1001:1001:,,,:/home/git:/bin/bash</span><br></pre></td></tr></table></figure><p>将其改为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git:x:1001:1001:,,,:/home/git:/usr/bin/git-shell</span><br></pre></td></tr></table></figure><p>这样 git 用户可以通过 ssh 正常使用 git，但是无法登录 sehll。</p><h4 id="第八步"><a href="#第八步" class="headerlink" title="第八步"></a>第八步</h4><p>修改 nginx 配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/sites-enabled/default</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改默认目录为自己的目录</span></span><br><span class="line">root /var/www/hexo/;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存退出</span></span><br><span class="line">Esc</span><br><span class="line">:wq</span><br></pre></td></tr></table></figure><p>至此，服务器端的配置就完成了。</p><h3 id="本地配置"><a href="#本地配置" class="headerlink" title="本地配置"></a>本地配置</h3><p>修改 Hexo 博客站点配置文件 _config.yml, 如下修改:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">git</span></span><br><span class="line"><span class="attr">  repo:</span> <span class="string">root@47.101.33.81:/var/repo/hexo.git</span></span><br><span class="line"><span class="attr">  branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><p>repo 格式：用户名@域名或 IP 地址:/var/repo/hexo.git，如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># root 域名</span><br><span class="line">root@istaotao.com:/var/repo/hexo.git</span><br><span class="line"></span><br><span class="line"># root ip</span><br><span class="line">root@47.101.33.81:/var/repo/hexo.git</span><br><span class="line"></span><br><span class="line"># git 域名</span><br><span class="line">git@istaotao.com:/var/repo/hexo.git</span><br></pre></td></tr></table></figure><p>然后就是 hexo 的常规操作了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清楚缓存</span></span><br><span class="line">hexo clean</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建并部署</span></span><br><span class="line">hexo g -d</span><br></pre></td></tr></table></figure><p>可以多部署几次，然后去 <code>/var/www/hexo</code> 看是否已经有对应内容，如果推送完之后，提示已无更新内容可提交，可以改写东西，重新构建部署等步骤，多试几次。</p><p>到这里，基本完成 Hexo 推送到 ubuntu 的任务, 通过服务器 IP 或者域名应该就可以看到博客的内容了。</p><h2 id="vuepress-部署到服务器上"><a href="#vuepress-部署到服务器上" class="headerlink" title="vuepress 部署到服务器上"></a>vuepress 部署到服务器上</h2><p>有了部署 Hexo 的经验，再部署 vuepress，就简单多了。</p><p>我的想法是：hexo 做首页，vuepress 做子页内容，比如：<code>http:yangtao.site/vuepress</code>。所以，建立 git hooks 就应该可以了。</p><h3 id="服务端配置"><a href="#服务端配置" class="headerlink" title="服务端配置"></a>服务端配置</h3><p>第一步：修改 nginx 配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/sites-enabled/default</span><br></pre></td></tr></table></figure><p>找到 <code>location / {</code>，然后在其后面，输入一段：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 找到如下</span><br><span class="line">location / &#123;</span><br><span class="line">    # First attempt to serve request as file, then</span><br><span class="line">    # as directory, then fall back to displaying a 404.</span><br><span class="line">    try_files $uri $uri/ =404;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 输入如下</span><br><span class="line">location /vuepress &#123;</span><br><span class="line">    root /var/www/;</span><br><span class="line">    try_files $uri $uri/ =404;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在<code>var/www</code>下新建 vuepress 目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/www/</span><br><span class="line">mkdir vuepress</span><br></pre></td></tr></table></figure><p>这样，对用要访问的目录已经创建好了。</p><p>注：以上操作都是在 root 权限下操作的，如果是其他用户，记得该加 sudo 的加 sudo，该修改文件权限就修改。</p><p>第二步：建立 git hooks</p><p>如同建立 <code>hexo.git</code> 一样：</p><p>初始化：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/repo</span><br><span class="line">git init --bare vuepress.git</span><br></pre></td></tr></table></figure><p>建立 <code>post-receive</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> vuepress.git/hooks/</span><br><span class="line">touch post-receive</span><br></pre></td></tr></table></figure><p>并写入：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">git --work-tree=/var/www/vuepress --git-dir=/var/repo/vuepress.git checkout -f</span><br></pre></td></tr></table></figure><p>设置这个文件的可执行权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x post-receive</span><br></pre></td></tr></table></figure><p>好了，服务端的配置差不多就这些。</p><h3 id="本地配置-1"><a href="#本地配置-1" class="headerlink" title="本地配置"></a>本地配置</h3><p>具体的可以参考<a href="https://vuepress.vuejs.org/zh/guide/deploy.html#github-pages" target="_blank" rel="noopener">官方部署方法</a>。</p><p>第一步：根目录下创建执行脚本<code>deploy.sh</code>:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保脚本抛出遇到的错误</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成静态文件</span></span><br><span class="line">npm run build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入生成的文件夹</span></span><br><span class="line"><span class="built_in">cd</span> docs/.vuepress/dist</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果是发布到自定义域名</span></span><br><span class="line"><span class="comment"># echo 'www.example.com' &gt; CNAME</span></span><br><span class="line"></span><br><span class="line">git init</span><br><span class="line">git add -A</span><br><span class="line">git commit -m <span class="string">'deploy'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果发布到 https://&lt;USERNAME&gt;.github.io</span></span><br><span class="line"><span class="comment"># git push -f git@github.com:&lt;USERNAME&gt;/&lt;USERNAME&gt;.github.io.git master</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果发布到 https://&lt;USERNAME&gt;.github.io/&lt;REPO&gt;</span></span><br><span class="line"><span class="comment"># git push -f git@github.com:&lt;USERNAME&gt;/&lt;REPO&gt;.git master:gh-pages</span></span><br><span class="line"></span><br><span class="line">git push -f root@47.101.33.81:/var/repo/vuepress.git master</span><br><span class="line"><span class="built_in">cd</span> -</span><br></pre></td></tr></table></figure><p>第二步：修改<code>config.js</code>的基准 url</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  base: <span class="string">"/vuepress/"</span> <span class="comment">// 基准 URL</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>这样，访问 <code>http://47.101.33.81/vuepress</code>，就可以正常访问,这里非常关键，如果是根目录，直接去掉 vuepress，重新构建部署。</p><p>第三步：部署线上</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sh deploy.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始自动构建、部署...</span></span><br><span class="line"><span class="comment"># 输入服务端密码...</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># success</span></span><br></pre></td></tr></table></figure><p>注意：可以多部署几次，访问资源如有问题，估计是第二步出问题了，可以排查哪里出错了。</p><p>好了，截止到现在，访问<code>http://47.101.33.81</code>，访问的是 hexo 的博客资源，而访问<code>http://47.101.33.81/vuepress</code>，访问的是 vuepress 的博客资源。</p><p>主要是 nginx 的配置文件，以及 git hooks 的建立，还有本地部署文件的建设，一个简单的个人网站算是颤颤巍巍地站起来了。</p><h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><h3 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h3><ul><li><a href="https://www.imooc.com/learn/170" target="_blank" rel="noopener">在 Ubuntu Server 下搭建 LAMP 环境</a> - 让你理解 LAMP 环境各个组件之间的关系与作用，并能掌握从无到有的在 Ubuntu Server 操作系统下搭建 LAMP 环境、配置虚拟主机、数据库远程维护等常见的服务器搭建维护技能</li><li><a href="https://www.imooc.com/learn/1049" target="_blank" rel="noopener">优雅玩转 Vim</a> - 本课程系统提炼 vim 的精华、通过抛砖引玉把它展现到你的面前，更能让你的工作如虎添翼、事半功倍。</li><li><a href="https://www.imooc.com/learn/1129" target="_blank" rel="noopener">玩转 Vim 从放弃到爱不释手</a> - 本课程从 vim 最基础的操作和概念开始讲起，带领大家学会使用和配置 vim，安装强大的 vim 插件，真正掌握编辑器之神 vim 的使用。</li><li><a href="https://www.imooc.com/learn/1004" target="_blank" rel="noopener">项目上线流程</a> - 主要讲解了一个项目想要发布到公网的流程，包括服务器的购买、以及域名的购买，以及需要注意的事项。</li><li><a href="https://www.imooc.com/learn/175" target="_blank" rel="noopener">Linux 达人养成计划 I</a> - 课程以 CentOS 操作系统为例，为你带来 Linux 的简介、系统安装和常用命令等内容。让您在轻松的氛围中感受到 Linux 之美。</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.jianshu.com/p/849343f679aa" target="_blank" rel="noopener">Nginx 使用及配置</a></li><li><a href="https://www.jianshu.com/p/ac27fdb0b86a" target="_blank" rel="noopener">在 Ubuntu 18.04 上安装和配置 Nginx</a></li><li><a href="https://blog.csdn.net/fengfeng0328/article/details/82828224" target="_blank" rel="noopener">Ubuntu18.04 搭建 nginx 服务器</a></li><li><a href="https://www.pingfangushi.com/posts/35448/" target="_blank" rel="noopener">阿里云 Ubuntu 16.04 系统下安装 Nginx</a></li><li><a href="https://www.cnblogs.com/CgenJ/archive/2011/07/28/2119454.html" target="_blank" rel="noopener">Linux 系统下如何查看及修改文件读写权限</a></li><li><a href="https://www.cnblogs.com/chenlogin/p/6245958.html" target="_blank" rel="noopener">vim 基本操作</a></li><li><a href="https://segmentfault.com/q/1010000009437407" target="_blank" rel="noopener">阿里云 ubuntu nginx 无法访问，求解答</a></li><li><a href="https://segmentfault.com/a/1190000010680022" target="_blank" rel="noopener">Hexo 个人博客部署到 CentOS 个人服务器</a></li><li><a href="https://www.jianshu.com/p/e1ccd49b4e5d" target="_blank" rel="noopener">Hexo 部署在阿里云服务器上</a></li><li><a href="https://www.jianshu.com/p/e03e363713f9" target="_blank" rel="noopener">通过 Git 将 Hexo 博客部署到服务器</a></li><li><a href="http://www.swiftyper.com/2016/04/17/deploy-hexo-with-git-hook/" target="_blank" rel="noopener">使用 Git Hook 自动部署 Hexo 到个人 VPS</a></li><li><a href="https://yq.aliyun.com/articles/603815" target="_blank" rel="noopener">超详细动手搭建一个 Vuepress 站点及开启 PWA 与自动部署</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 服务端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习冴羽的 JS 深入系列·下篇</title>
      <link href="/2019/11/27/js-series-3/"/>
      <url>/2019/11/27/js-series-3/</url>
      
        <content type="html"><![CDATA[<blockquote><p>主要是讲述了创建对象、继承的多种方式及其各自的优缺点</p></blockquote><a id="more"></a><h2 id="创建对象的多种方式以及优缺点"><a href="#创建对象的多种方式以及优缺点" class="headerlink" title="创建对象的多种方式以及优缺点"></a>创建对象的多种方式以及优缺点</h2><p>这篇文章更像是笔记，因为《JavaScript 高级程序设计》写得真是太好了！</p><h3 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPerson</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">  o.name = name;</span><br><span class="line">  o.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = createPerson(<span class="string">"kevin"</span>);</span><br></pre></td></tr></table></figure><p>缺点：对象无法识别，因为所有的实例都指向一个原型</p><h3 id="构造函数模式"><a href="#构造函数模式" class="headerlink" title="构造函数模式"></a>构造函数模式</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">"kevin"</span>);</span><br></pre></td></tr></table></figure><p>优点：实例可以识别为一个特定的类型</p><p>缺点：每次创建实例时，每个方法都要被创建一次</p><ul><li>构造函数模式优化</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.getName = getName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">"kevin"</span>);</span><br></pre></td></tr></table></figure><p>优点：解决了每个方法都要被重新创建的问题</p><p>缺点：全局命名变量太多</p><h3 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.name = <span class="string">"keivn"</span>;</span><br><span class="line">Person.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person();</span><br></pre></td></tr></table></figure><p>优点：方法不会重新创建</p><p>缺点：1. 所有的属性和方法都共享； 2. 不能初始化参数；</p><ul><li>原型模式优化 1</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype = &#123;</span><br><span class="line">  name: <span class="string">"kevin"</span>,</span><br><span class="line">  getName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person();</span><br></pre></td></tr></table></figure><p>优点：封装性好了一点</p><p>缺点：重写了原型，丢失了 constructor 属性</p><ul><li>原型模式优化 2</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype = &#123;</span><br><span class="line">  <span class="keyword">constructor</span>: Person,</span><br><span class="line">  name: "kevin",</span><br><span class="line">  getName: function() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person();</span><br></pre></td></tr></table></figure><p>优点：实例可以通过 constructor 属性找到所属构造函数</p><p>缺点：原型模式该有的缺点还是有</p><h3 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h3><p>构造函数模式与原型模式双剑合璧。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype = &#123;</span><br><span class="line">  <span class="keyword">constructor</span>: Person,</span><br><span class="line">  getName: function() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person();</span><br></pre></td></tr></table></figure><p>优点：该共享的共享，该私有的私有，使用最广泛的方式</p><p>缺点：有的人就是希望全部都写在一起，即更好的封装性</p><ul><li>动态原型模式</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span>.getName != <span class="string">"function"</span>) &#123;</span><br><span class="line">    Person.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person();</span><br></pre></td></tr></table></figure><p>注意：使用动态原型模式时，不能用对象字面量重写原型</p><p>解释下为什么：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span>.getName != <span class="string">"function"</span>) &#123;</span><br><span class="line">    Person.prototype = &#123;</span><br><span class="line">      <span class="keyword">constructor</span>: Person,</span><br><span class="line">      getName: function() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">"kevin"</span>);</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person(<span class="string">"daisy"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 报错 并没有该方法</span></span><br><span class="line">person1.getName();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注释掉上面的代码，这句是可以执行的。</span></span><br><span class="line">person2.getName();</span><br></pre></td></tr></table></figure><p>为了解释这个问题，假设开始执行<code>var person1 = new Person(&#39;kevin&#39;)</code>。</p><p>如果对 new 和 apply 的底层执行过程不是很熟悉，可以阅读底部相关链接中的文章。</p><p>我们回顾下 new 的实现步骤：</p><p>首先新建一个对象，然后将对象的原型指向 <code>Person.prototype</code>，然后 <code>Person.apply(obj)</code>返回这个对象。</p><p>注意这个时候，回顾下 apply 的实现步骤，会执行 <code>obj.Person</code> 方法，这个时候就会执行 if 语句里的内容，注意构造函数的 prototype 属性指向了实例的原型，使用字面量方式直接覆盖 <code>Person.prototype</code>，并不会更改实例的原型的值，person1 依然是指向了以前的原型，而不是 <code>Person.prototype</code>。而之前的原型是没有 getName 方法的，所以就报错了！</p><p>如果你就是想用字面量方式写代码，可以尝试下这种：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span>.getName != <span class="string">"function"</span>) &#123;</span><br><span class="line">    Person.prototype = &#123;</span><br><span class="line">      <span class="keyword">constructor</span>: Person,</span><br><span class="line">      getName: function() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Person(name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">"kevin"</span>);</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person(<span class="string">"daisy"</span>);</span><br><span class="line"></span><br><span class="line">person1.getName(); <span class="comment">// kevin</span></span><br><span class="line">person2.getName(); <span class="comment">// daisy</span></span><br></pre></td></tr></table></figure><h3 id="寄生构造函数模式"><a href="#寄生构造函数模式" class="headerlink" title="寄生构造函数模式"></a>寄生构造函数模式</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">  o.name = name;</span><br><span class="line">  o.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">"kevin"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(person1 <span class="keyword">instanceof</span> Person); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(person1 <span class="keyword">instanceof</span> <span class="built_in">Object</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>寄生构造函数模式，我个人认为应该这样读：寄生-构造函数-模式，也就是说寄生在构造函数的一种方法。</p><p>也就是说打着构造函数的幌子挂羊头卖狗肉，你看创建的实例使用 instanceof 都无法指向构造函数！</p><p>这样方法可以在特殊情况下使用。比如我们想创建一个具有额外方法的特殊数组，但是又不想直接修改 Array 构造函数，我们可以这样写：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SpecialArray</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> values = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = <span class="built_in">arguments</span>.length; i &lt; len; i++) &#123;</span><br><span class="line">    values.push(<span class="built_in">arguments</span>[i]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  values.toPipedString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.join(<span class="string">"|"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> values;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> colors = <span class="keyword">new</span> SpecialArray(<span class="string">"red"</span>, <span class="string">"blue"</span>, <span class="string">"green"</span>);</span><br><span class="line"><span class="keyword">var</span> colors2 = SpecialArray(<span class="string">"red2"</span>, <span class="string">"blue2"</span>, <span class="string">"green2"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(colors);</span><br><span class="line"><span class="built_in">console</span>.log(colors.toPipedString()); <span class="comment">// red|blue|green</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(colors2);</span><br><span class="line"><span class="built_in">console</span>.log(colors2.toPipedString()); <span class="comment">// red2|blue2|green2</span></span><br></pre></td></tr></table></figure><p>你会发现，其实所谓的寄生构造函数模式就是比工厂模式在创建对象的时候，多使用了一个 new，实际上两者的结果是一样的。</p><p>但是作者可能是希望能像使用普通 Array 一样使用 SpecialArray，虽然把 SpecialArray 当成函数也一样能用，但是这并不是作者的本意，也变得不优雅。</p><p>在可以使用其他模式的情况下，不要使用这种模式。</p><p>但是值得一提的是，上面例子中的循环：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = <span class="built_in">arguments</span>.length; i &lt; len; i++) &#123;</span><br><span class="line">  values.push(<span class="built_in">arguments</span>[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以替换成：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">values.push.apply(values, <span class="built_in">arguments</span>);</span><br></pre></td></tr></table></figure><h3 id="稳妥构造函数模式"><a href="#稳妥构造函数模式" class="headerlink" title="稳妥构造函数模式"></a>稳妥构造函数模式</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">  o.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = person(<span class="string">"kevin"</span>);</span><br><span class="line"></span><br><span class="line">person1.sayName(); <span class="comment">// kevin</span></span><br><span class="line"></span><br><span class="line">person1.name = <span class="string">"daisy"</span>;</span><br><span class="line"></span><br><span class="line">person1.sayName(); <span class="comment">// kevin</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person1.name); <span class="comment">// daisy</span></span><br></pre></td></tr></table></figure><p>所谓稳妥对象，指的是没有公共属性，而且其方法也不引用 this 的对象。</p><p>与寄生构造函数模式有两点不同：</p><ul><li>新创建的实例方法不引用 this</li><li>不使用 new 操作符调用构造函数</li><li>稳妥对象最适合在一些安全的环境中。</li></ul><p>稳妥构造函数模式也跟工厂模式一样，无法识别对象所属类型。</p><p>原文链接：<a href="https://github.com/mqyqingfeng/Blog/issues/15" target="_blank" rel="noopener">JavaScript 深入之创建对象的多种方式以及优缺点</a></p><h2 id="继承的多种方式和优缺点"><a href="#继承的多种方式和优缺点" class="headerlink" title="继承的多种方式和优缺点"></a>继承的多种方式和优缺点</h2><h3 id="原型链继承"><a href="#原型链继承" class="headerlink" title="原型链继承"></a>原型链继承</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Parent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">'Yang'</span>;</span><br><span class="line">&#125;</span><br><span class="line">Parent.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">Child.prototype = <span class="keyword">new</span> Parent();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myself = <span class="keyword">new</span> Child();</span><br><span class="line">myself.getName();  <span class="comment">// 'Yang'</span></span><br></pre></td></tr></table></figure><p>问题：</p><ul><li>引用类型的属性被所有实例共享</li><li>在创建 Child 的实例时，不能向Parent传参</li></ul><h3 id="借用构造函数-经典继承"><a href="#借用构造函数-经典继承" class="headerlink" title="借用构造函数(经典继承)"></a>借用构造函数(经典继承)</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Parent</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  Parent.call(<span class="keyword">this</span>, name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> myself1 = <span class="keyword">new</span> Child(<span class="string">'Yang'</span>);</span><br><span class="line"><span class="keyword">var</span> myself2 = <span class="keyword">new</span> Child(<span class="string">'Wang'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(myself1.name)  <span class="comment">// 'Yang'</span></span><br><span class="line"><span class="built_in">console</span>.log(myself2.name)  <span class="comment">// 'Wang'</span></span><br></pre></td></tr></table></figure><p>优点：</p><ul><li>避免了引用类型的属性被所有实例共享</li><li>可以在 Child 中向 Parent 传参</li></ul><p>缺点：</p><ul><li>方法都在构造函数中定义，每次创建实例都会创建一遍方法</li></ul><h3 id="组合继承"><a href="#组合继承" class="headerlink" title="组合继承"></a>组合继承</h3><p>原型链继承和经典继承双剑合璧。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Parent</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.colors = [<span class="string">'red'</span>, <span class="string">'blue'</span>, <span class="string">'green'</span>];</span><br><span class="line">&#125;</span><br><span class="line">Parent.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  Parent.call(<span class="keyword">this</span>, name);</span><br><span class="line">  <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line">Child.prototype = <span class="keyword">new</span> Parent();</span><br><span class="line">Child.prototype.constructor = Child;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> child1 = <span class="keyword">new</span> Child(<span class="string">'yang'</span>, <span class="number">27</span>);</span><br><span class="line">child1.colors.push(<span class="string">'white'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(child1.name);  <span class="comment">// "yang"</span></span><br><span class="line"><span class="built_in">console</span>.log(child1.age);  <span class="comment">// 27</span></span><br><span class="line"><span class="built_in">console</span>.log(child1.colors);  <span class="comment">// ["red", "blue", "green", "white"]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> child2 = <span class="keyword">new</span> Child(<span class="string">'ming'</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(child2.name);  <span class="comment">// "ming"</span></span><br><span class="line"><span class="built_in">console</span>.log(child2.age);  <span class="comment">// 20</span></span><br><span class="line"><span class="built_in">console</span>.log(child2.colors);  <span class="comment">// ["red", "blue", "green"]</span></span><br><span class="line">child2.getName();  <span class="comment">// "ming"</span></span><br></pre></td></tr></table></figure><p>优点：融合原型链继承和构造函数的优点，是 JavaScript 中最常用的继承模式。</p><h3 id="原型式继承"><a href="#原型式继承" class="headerlink" title="原型式继承"></a>原型式继承</h3><p>就是 ES5 <code>[Object.create](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/create)</code> 的模拟实现，将传入的对象作为创建的对象的原型。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createObj</span>(<span class="params">proto</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">  F.prototype = proto;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>缺点：包含引用类型的属性值始终都会共享相应的值，这点跟原型链继承一样。</p><h3 id="寄生式继承"><a href="#寄生式继承" class="headerlink" title="寄生式继承"></a>寄生式继承</h3><p>创建一个仅用于封装继承过程的函数，该函数在内部以某种形式来做增强对象，最后返回对象。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createObj</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> clone = <span class="built_in">Object</span>.create(o);</span><br><span class="line">  clone.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'hi'</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> clone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>缺点：跟借用构造函数模式一样，每次创建对象都会创建一遍方法。</p><h3 id="寄生组合式继承"><a href="#寄生组合式继承" class="headerlink" title="寄生组合式继承"></a>寄生组合式继承</h3><p>组合继承最大的缺点是会调用两次父构造函数。</p><ul><li>设置子类型实例的原型的时候：<code>Child.prototype = new Parent();</code></li><li>创建子类型实例的时候：<code>Parent.call(this, name);</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">object</span>(<span class="params">proto</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">  F.prototype = proto;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">prototype</span>(<span class="params">child, parent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> prototype = object(parent.prototype);</span><br><span class="line">  child.prototype.constructor = child;</span><br><span class="line">  child.prototype = prototype;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">prototype(Child, Parent);</span><br></pre></td></tr></table></figure><p>引用《JavaScript高级程序设计》中对寄生组合式继承的夸赞就是：</p><blockquote><p>这种方式的高效率体现它只调用了一次 Parent 构造函数，并且因此避免了在 Parent.prototype 上面创建不必要的、多余的属性。与此同时，原型链还能保持不变；因此，还能够正常使用 instanceof 和 isPrototypeOf。开发人员普遍认为寄生组合式继承是引用类型最理想的继承范式。</p></blockquote><p>原文链接：<a href="https://github.com/mqyqingfeng/Blog/issues/16" target="_blank" rel="noopener">JavaScript深入之继承的多种方式和优缺点</a></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习冴羽的 JS 深入系列·中篇</title>
      <link href="/2019/11/27/js-series-2/"/>
      <url>/2019/11/27/js-series-2/</url>
      
        <content type="html"><![CDATA[<blockquote><p>主要实现 call、apply、new、bind 等实现思路</p></blockquote><a id="more"></a><h2 id="call-和-apply-的模拟实现"><a href="#call-和-apply-的模拟实现" class="headerlink" title="call 和 apply 的模拟实现"></a>call 和 apply 的模拟实现</h2><h3 id="call"><a href="#call" class="headerlink" title="call"></a>call</h3><p><code>call()</code>在使用一个指定的 this 值和若干个指定的参数值的前提下，调用某个函数或方法。该方法的语法和作用与 apply() 方法类似，只有一个区别，就是 call() 方法接受的是一个参数列表，而 apply() 方法接受的是一个包含多个参数的数组。</p><p>使用 call 方法调用函数并且指定上下文的 ‘this’</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> value = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  value: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.value);</span><br><span class="line">&#125;</span><br><span class="line">foo(); <span class="comment">// 1</span></span><br><span class="line">foo.call(obj); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><p>使用 call 方法调用父构造函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Tao</span>(<span class="params">name, age, job</span>) </span>&#123;</span><br><span class="line">  Person.call(<span class="keyword">this</span>, name, age);</span><br><span class="line">  <span class="keyword">this</span>.job = job;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> tao = <span class="keyword">new</span> Tao(<span class="string">"yangtao"</span>, <span class="number">27</span>, <span class="string">"Teacher"</span>);</span><br></pre></td></tr></table></figure><p>所以我们模拟的步骤可以分为：</p><ul><li>将函数设为对象的属性</li><li>执行该函数</li><li>删除该函数</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类似于：</span></span><br><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line">  value: <span class="number">1</span>,</span><br><span class="line">  bar: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">foo.bar(); <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一步</span></span><br><span class="line">foo.fn = bar;</span><br><span class="line"><span class="comment">// 第二步</span></span><br><span class="line">foo.fn();</span><br><span class="line"><span class="comment">// 第三步</span></span><br><span class="line"><span class="keyword">delete</span> foo.fn;</span><br></pre></td></tr></table></figure><p>第一版：绑定 this</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.mycall = <span class="function"><span class="keyword">function</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  context.fn = <span class="keyword">this</span>;</span><br><span class="line">  context.fn();</span><br><span class="line">  <span class="keyword">delete</span> context.fn;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 测试一下</span></span><br><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line">  value: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bar.mycall(foo); <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如下所示</span></span><br><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line">  value: <span class="number">1</span>,</span><br><span class="line">  bar: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">foo.bar();</span><br></pre></td></tr></table></figure><p>第二版：给定参数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.mycall = <span class="function"><span class="keyword">function</span>(<span class="params">context, name, age</span>) </span>&#123;</span><br><span class="line">  context.fn = <span class="keyword">this</span>;</span><br><span class="line">  context.fn();</span><br><span class="line">  <span class="keyword">var</span> args = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>, l = <span class="built_in">arguments</span>.length; i &lt; l; i++) &#123;</span><br><span class="line">    args.push(<span class="string">"arguments["</span> + i + <span class="string">"]"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">eval</span>(<span class="string">"context.fn("</span> + args + <span class="string">")"</span>);</span><br><span class="line">  <span class="keyword">delete</span> context.fn;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>第三版：传参为 null 和返回结果</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.mycall = <span class="function"><span class="keyword">function</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> context = context || <span class="built_in">window</span>;</span><br><span class="line">  <span class="comment">//获取调用call的函数，用this可以获取</span></span><br><span class="line">  context.fn = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">var</span> args = []; <span class="comment">// ["arguments[1]", "arguments[2]"]</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>, l = <span class="built_in">arguments</span>.length; i &lt; l; i++) &#123;</span><br><span class="line">    args.push(<span class="string">"arguments["</span> + i + <span class="string">"]"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 把传给call的参数传递给了context.fn函数</span></span><br><span class="line">  <span class="comment">// context.fn(args.join(','));</span></span><br><span class="line">  <span class="comment">// context.fn(...args)</span></span><br><span class="line">  <span class="keyword">var</span> result = <span class="built_in">eval</span>(<span class="string">"context.fn("</span> + args + <span class="string">")"</span>);</span><br><span class="line">  <span class="keyword">delete</span> context.fn;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>第四版：考虑 context，以及 context.fn 的可能性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.mycall = <span class="function"><span class="keyword">function</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 这一步如果不强制是 object 类型，可以省略</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> context != <span class="string">"object"</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Arguments error"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> context = context || <span class="built_in">window</span>;</span><br><span class="line">  <span class="keyword">var</span> args = [],</span><br><span class="line">    reslut;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">"fn"</span> <span class="keyword">in</span> context &amp;&amp; context.hasOwnProperty(<span class="string">"fn"</span>)) &#123;</span><br><span class="line">    <span class="keyword">var</span> fn = context.fn;</span><br><span class="line">    <span class="keyword">var</span> fnFlag = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  context.fn = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>, l = <span class="built_in">arguments</span>.length; i &lt; l; i++) &#123;</span><br><span class="line">    args.push(<span class="string">"arguments["</span> + i + <span class="string">"]"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  result = <span class="built_in">eval</span>(<span class="string">"context.fn("</span> + args + <span class="string">")"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (fnFlag) &#123;</span><br><span class="line">    context.fn = fn;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">delete</span> context.fn;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h3><p><code>apply()</code>同<code>call()</code>，只不过将多个参数值，以数组的形式传入而已。</p><p>用 apply 将数组添加到另一个数组：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="string">"a"</span>, <span class="string">"b"</span>];</span><br><span class="line"><span class="keyword">var</span> arr2 = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">arr.push.apply(arr, arr2);</span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">// ["a", "b", 1, 2]</span></span><br></pre></td></tr></table></figure><p>使用 apply 和内置函数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nums = [<span class="number">1</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">var</span> max = <span class="built_in">Math</span>.max.apply(<span class="literal">null</span>, nums); <span class="comment">// 10</span></span><br><span class="line"><span class="keyword">var</span> min = <span class="built_in">Math</span>.min.apply(<span class="literal">null</span>, nums); <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6 写法：</span></span><br><span class="line"><span class="keyword">var</span> max = <span class="built_in">Math</span>.max(...nums); <span class="comment">// 10</span></span><br><span class="line"><span class="keyword">var</span> min = <span class="built_in">Math</span>.min(...nums); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.myapply = <span class="function"><span class="keyword">function</span>(<span class="params">context, arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> context = context || <span class="built_in">window</span>;</span><br><span class="line">  <span class="keyword">var</span> reslut;</span><br><span class="line"></span><br><span class="line">  context.fn = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!arr) &#123;</span><br><span class="line">    reslut = context.fn();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> args = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = arr.length; i &lt; l; i++) &#123;</span><br><span class="line">      args.push(<span class="string">"arr["</span> + i + <span class="string">"]"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">"context.fn("</span> + args + <span class="string">")"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">delete</span> context.fn;</span><br><span class="line">  <span class="keyword">return</span> reslut;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>原文链接：<a href="https://github.com/mqyqingfeng/Blog/issues/11" target="_blank" rel="noopener">JavaScript 深入之 call 和 apply 的模拟实现</a></p><h2 id="bind-的模拟实现"><a href="#bind-的模拟实现" class="headerlink" title="bind 的模拟实现"></a>bind 的模拟实现</h2><blockquote><p><code>bind()</code>方法会创建一个新函数。当这个新函数被调用，bind()第一个参数将作为它运行时的 this，之后的一系列参数将会在传递的实参前传入，作为它的参数。 — 来自于 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/bind" target="_blank" rel="noopener">MDN</a></p></blockquote><p>创建绑定函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> value = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  value: <span class="number">2</span>,</span><br><span class="line">  getValue: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> getV = obj.getValue;</span><br><span class="line">getV(); <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">var</span> getV2 = obj.getValue.bind(obj);</span><br><span class="line">getV2(); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><p>配合 setTimeout</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> value = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.value = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">Fn.prototype.getValue = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// setTimeout(this.msg, 1000);  // 1</span></span><br><span class="line">  setTimeout(<span class="keyword">this</span>.msg.bind(<span class="keyword">this</span>), <span class="number">1000</span>); <span class="comment">//2</span></span><br><span class="line">&#125;;</span><br><span class="line">Fn.prototype.msg = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"value: "</span>, <span class="keyword">this</span>.value);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> myFn = <span class="keyword">new</span> Fn();</span><br><span class="line">myFn.getValue();</span><br></pre></td></tr></table></figure><p>由此我们可以首先得出 bind 函数的两个特点：</p><ul><li>返回一个函数</li><li>可以传入参数</li></ul><p>第一版：返回函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.mybind = <span class="function"><span class="keyword">function</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> self.apply(context);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  value: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bindFoo = foo.mybind(obj);</span><br><span class="line">bindFoo(); <span class="comment">//1</span></span><br></pre></td></tr></table></figure><p>第二版：传参</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.mybind = <span class="function"><span class="keyword">function</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// 获取除了第一个参数的剩余参数</span></span><br><span class="line">  <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 这里获取的是返回函数调用时传入的参数</span></span><br><span class="line">    <span class="keyword">var</span> bindArgs = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">return</span> self.apply(context, args.concat(bindArgs));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  value: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.value);</span><br><span class="line">  <span class="built_in">console</span>.log(name);</span><br><span class="line">  <span class="built_in">console</span>.log(age);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bindFoo = foo.mybind(obj, <span class="string">"yang"</span>);</span><br><span class="line">bindFoo(<span class="number">27</span>);</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// yang</span></span><br><span class="line"><span class="comment">// 27</span></span><br></pre></td></tr></table></figure><p>第三版：构造函数效果</p><p>bind 还有一个特点，就是:一个绑定函数也能使用 new 操作符创建对象：这种行为就像把原函数当成构造器。提供的 this 值被忽略，同时调用时的参数被提供给模拟函数。</p><p>也就是说，当 bind 返回的函数作为构造函数的时候，bind 时指定的 this 值会失效，但传入的参数依然生效。</p><p>所以我们可以通过修改返回的函数的原型来实现：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.mybind = <span class="function"><span class="keyword">function</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">var</span> fBound = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bindArgs = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="comment">// 当作为构造函数时，this 指向实例，此时结果为 true，将绑定函数的 this 指向该实例，可以让实例获得来自绑定函数的值</span></span><br><span class="line">    <span class="comment">// 以上面的是 demo 为例，如果改成 `this instanceof fBound ? null : context`，实例只是一个空对象，将 null 改成 this ，实例会具有 habit 属性</span></span><br><span class="line">    <span class="comment">// 当作为普通函数时，this 指向 window，此时结果为 false，将绑定函数的 this 指向 context</span></span><br><span class="line">    <span class="keyword">return</span> self.apply(</span><br><span class="line">      <span class="keyword">this</span> <span class="keyword">instanceof</span> fBound ? <span class="keyword">this</span> : context,</span><br><span class="line">      args.concat(bindArgs)</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 修改返回函数的 prototype 为绑定函数的 prototype，实例就可以继承绑定函数的原型中的值</span></span><br><span class="line">  fBound.prototype = <span class="keyword">this</span>.prototype;</span><br><span class="line">  <span class="keyword">return</span> fBound;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>优化：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.mybind = <span class="function"><span class="keyword">function</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span> !== <span class="string">"function"</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">"Function.prototype.bind - what is trying to be bound is not callable"</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> fNOP = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> fBound = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bindArgs = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">return</span> self.apply(</span><br><span class="line">      <span class="keyword">this</span> <span class="keyword">instanceof</span> fNOP ? <span class="keyword">this</span> : context,</span><br><span class="line">      args.concat(bindArgs)</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  fNOP.prototype = <span class="keyword">this</span>.prototype;</span><br><span class="line">  fBound.prototype = <span class="keyword">new</span> fNOP();</span><br><span class="line">  <span class="keyword">return</span> fBound;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>那别忘了做个兼容：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.bind = <span class="built_in">Function</span>.prototype.bind || <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    ……</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>原文链接：<a href="https://github.com/mqyqingfeng/Blog/issues/12" target="_blank" rel="noopener">JavaScript 深入之 bind 的模拟实现</a></p><h2 id="new-的模拟实现"><a href="#new-的模拟实现" class="headerlink" title="new 的模拟实现"></a>new 的模拟实现</h2><p>new 运算符创建一个用户定义的对象类型的实例或具有构造函数的内置对象类型之一。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.age = age;</span><br><span class="line">  <span class="keyword">this</span>.habit = <span class="string">"Games"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"I am "</span> + <span class="keyword">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">"Yang"</span>, <span class="string">"27"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person1.name); <span class="comment">// Yang</span></span><br><span class="line"><span class="built_in">console</span>.log(person1.habit); <span class="comment">// Games</span></span><br><span class="line"></span><br><span class="line">person1.getName(); <span class="comment">// I am Yang</span></span><br></pre></td></tr></table></figure><p>由上可知，实例 person1 可以：</p><ul><li>访问到 Person 构造函数里的属性</li><li>访问到 Person.prototype 中的属性</li></ul><h3 id="初步实现"><a href="#初步实现" class="headerlink" title="初步实现"></a>初步实现</h3><p>分析：</p><p>因为 new 的结果是一个新对象，所以在模拟实现的时候，我们也要建立一个新对象，这个新对象会具有构造函数里的属性。</p><p>实例的 <code>__proto__</code> 属性会指向构造函数的 <code>prototype</code>，也正是因为建立起这样的关系，实例可以访问原型上的属性。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">objectFactory</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 用new Object() 的方式新建了一个对象 obj</span></span><br><span class="line">  <span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 取出第一个参数，就是我们要传入的构造函数</span></span><br><span class="line">  <span class="comment">// 此外因为 shift 会修改原数组，所以 arguments 会被去除第一个参数</span></span><br><span class="line">  <span class="keyword">var</span> Constructor = [].shift.call(<span class="built_in">arguments</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将 obj 的原型指向构造函数，这样 obj 就可以访问到构造函数原型中的属性</span></span><br><span class="line">  obj.__proto__ = Constructor.prototype;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用 apply，改变构造函数 this 的指向到新建的对象，这样 obj 就可以访问到构造函数中的属性</span></span><br><span class="line">  Constructor.apply(obj, <span class="built_in">arguments</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回 obj</span></span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="返回值效果实现"><a href="#返回值效果实现" class="headerlink" title="返回值效果实现"></a>返回值效果实现</h3><p>需要判断返回的值是不是一个对象，如果是一个对象，我们就返回这个对象，如果没有，我们该返回什么就返回什么</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">objectFactory</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">  <span class="keyword">var</span> Constructor = [].shift.call(<span class="built_in">arguments</span>);</span><br><span class="line"></span><br><span class="line">  obj.__proto__ = Constructor.prototype;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> ret = Constructor.apply(obj, <span class="built_in">arguments</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> ret === <span class="string">"object"</span> ? ret : obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>原文链接：<a href="https://github.com/mqyqingfeng/Blog/issues/13" target="_blank" rel="noopener">JavaScript 深入之 new 的模拟实现</a></p><h2 id="类数组对象与-arguments"><a href="#类数组对象与-arguments" class="headerlink" title="类数组对象与 arguments"></a>类数组对象与 arguments</h2><p>类数组对象从读写、获取长度、遍历三个方面看，和数组貌似是一样的，但是无法直接使用数组的方法，需要借助 call 或 apply：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> likeArr = &#123;</span><br><span class="line">  <span class="number">0</span>: <span class="string">"a"</span>,</span><br><span class="line">  <span class="number">1</span>: <span class="string">"b"</span>,</span><br><span class="line">  <span class="number">2</span>: <span class="string">"c"</span>,</span><br><span class="line">  length: <span class="number">3</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Array</span>.prototype.slice.call(likeArr, <span class="number">0</span>); <span class="comment">// ["a", "b", "c"]</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.join.call(likeArr, <span class="string">"&amp;"</span>); <span class="comment">// "a&amp;b&amp;c"</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.map.call(likeArr, item =&gt; item.toUpperCase()); <span class="comment">// ["A", "B", "C"]</span></span><br></pre></td></tr></table></figure><h3 id="类数组转数组"><a href="#类数组转数组" class="headerlink" title="类数组转数组"></a>类数组转数组</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// slice</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.slice.call(likeArr);</span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="built_in">Array</span>.from(likeArr);</span><br><span class="line"><span class="comment">// apply</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.concat.apply([], likeArr);</span><br><span class="line"><span class="comment">// splice，会改变 linkeArr</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.splice.call(likeArr, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><h3 id="Arguments"><a href="#Arguments" class="headerlink" title="Arguments"></a>Arguments</h3><p><code>Arguments</code> 对象只定义在函数体中，包括了函数的参数和其他属性。在函数体中，arguments 指代该函数的 Arguments 对象。</p><p>Arguments 对象的 length 属性，表示实参的长度。</p><p>Arguments 对象的 callee 属性，通过它可以调用函数自身。</p><p>将参数从一个函数传递到另一个函数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 apply 将 foo 的参数传递给 bar</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  bar.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a, b, c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure><p>使用 ES6 的<code>...</code>运算符，我们可以轻松转成数组。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params">...arguments</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>); <span class="comment">// [1, 2, 3]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure><p>arguments 的应用其实很多，如果要总结这些场景的话，暂时能想到的包括：</p><ul><li>参数不定长</li><li>函数柯里化</li><li>递归调用</li><li>函数重载</li></ul><p>原文链接：<a href="https://github.com/mqyqingfeng/Blog/issues/14" target="_blank" rel="noopener">JavaScript 深入之类数组对象与 arguments</a></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习冴羽的 JS 深入系列·上篇</title>
      <link href="/2019/11/27/js-series-1/"/>
      <url>/2019/11/27/js-series-1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>主要讲述什么是原型，什么是原型链，以及分别总结执行上下文的三个重要属性：变量对象、作用域链、this，还有闭包等难以理解的知识点。</p></blockquote><a id="more"></a><h2 id="从原型到原型链"><a href="#从原型到原型链" class="headerlink" title="从原型到原型链"></a>从原型到原型链</h2><h3 id="图示总结"><a href="#图示总结" class="headerlink" title="图示总结"></a>图示总结</h3><p><code>prototype</code>：每一个函数都有一个<code>prototype</code>属性，该属性指向了一个对象，此对象为调用该函数而创建的实例的原型</p><p><img src="https://ae01.alicdn.com/kf/Hacfcf286c7a7419db3e4c0932fb535923.png" alt="构造函数和实例原型的关系图"></p><p><code>__proto__</code>：每一个对象（除 null）都具有一个属性：<code>__proto__</code>，这个属性指向该对象的原型</p><p><img src="https://ae01.alicdn.com/kf/H0167f64ea5a14d00977d7347f3771ce7T.png" alt="实例与实例原型的关系图"></p><p><code>constructor</code>：每个原型都有一个<code>constructor</code>属性指向关联的构造函数</p><p><img src="https://ae01.alicdn.com/kf/Hb2d428716f6341b58ac36eefd3ab7398b.png" alt="constructor"></p><p><code>Object</code>：原型对象是通过 <code>Object</code> 构造函数生成的，最后<code>Object.prototype.__proto__ = null</code></p><p><img src="https://ae01.alicdn.com/kf/H162bf41c88784952a445c19c5ce3159e5.png" alt="原型链示意图"></p><p>原型链：由相互关联的原型(<strong>proto</strong>)组成的链状结构就是原型链，即图中蓝色的这条线</p><p><img src="https://ae01.alicdn.com/kf/H46dd0d5cd87243f4beb2d4c3e974a1e5K.png" alt="原型链"></p><h3 id="代码总结"><a href="#代码总结" class="headerlink" title="代码总结"></a>代码总结</h3><p>每个函数都有一个 prototype 属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.name = <span class="string">"Jake"</span>;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person();</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person();</span><br><span class="line">person1.name; <span class="comment">// 'Jake'</span></span><br><span class="line">person2.name; <span class="comment">// 'Jake'</span></span><br></pre></td></tr></table></figure><p>每一个 JavaScript 对象(除了 null )都具有的一个属性，叫<strong>proto</strong>，这个属性会指向该对象的原型。</p><p>构造函数的 prototype 属性，指向了调用该构造函数而创建的实例的原型 person.<strong>proto</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">person.__proto__ === Person.prototype; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>每个原型都有一个 constructor 属性指向关联的构造函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person.prototype.constructor === Person; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>原型对象就是通过 Object 构造函数生成的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person.prototype.__proto__ === <span class="built_in">Object</span>.prototype; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>Object.prototype.<strong>proto</strong> 的值为 null，即 Object.prototype 没有原型，终止查找</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.__proto__; <span class="comment">// null</span></span><br></pre></td></tr></table></figure><p>原文地址：<a href="https://github.com/mqyqingfeng/Blog/issues/2" target="_blank" rel="noopener">JavaScript 深入之从原型到原型链</a></p><h2 id="词法作用域和动态作用域"><a href="#词法作用域和动态作用域" class="headerlink" title="词法作用域和动态作用域"></a>词法作用域和动态作用域</h2><p>javascript 采用的是<code>词法作用域(lexical scoping)</code>，函数的作用域是在函数定义的时候就决定了，而不是调用的时候才决定</p><ul><li>词法作用域，即静态作用域，函数的作用域在函数定义的时候就决定了</li><li>动态作用域，函数的作用域是在函数调用的时候才决定</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scope = <span class="string">"global scope"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkscope</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> scope = <span class="string">"local scope"</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> scope;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> f();</span><br><span class="line">&#125;</span><br><span class="line">checkscope(); <span class="comment">// "local scope"</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scope = <span class="string">"global scope"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkscope</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> scope = <span class="string">"local scope"</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> scope;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br><span class="line">checkscope()(); <span class="comment">// "local scope"</span></span><br></pre></td></tr></table></figure><p>因为 JavaScript 采用的是词法作用域，函数的作用域基于函数创建的位置。</p><p>而引用《JavaScript 权威指南》的回答就是：</p><p>JavaScript 函数的执行用到了作用域链，这个作用域链是在函数定义的时候创建的。嵌套的函数 f() 定义在这个作用域链里，其中的变量 scope 一定是局部变量，不管何时何地执行函数 f()，这种绑定在执行 f() 时依然有效。</p><p>原文链接：<a href="https://github.com/mqyqingfeng/Blog/issues/3" target="_blank" rel="noopener">JavaScript 深入之词法作用域和动态作用域</a></p><h2 id="执行上下文栈"><a href="#执行上下文栈" class="headerlink" title="执行上下文栈"></a>执行上下文栈</h2><p>JavaScript 的可执行代码(executable code)的类型有哪些：</p><ul><li>全局代码</li><li>函数代码</li><li>eval 代码</li></ul><p>函数那么多，如何管理创建的那么多执行上下文呢？</p><p>所以 JavaScript 引擎创建了执行上下文栈（<code>Execution context stack，ECS</code>）来管理执行上下文。</p><p>当执行一个函数的时候，就会创建一个<code>执行上下文(execution context)</code>，并且压入<code>执行上下文栈(Execution context stack, ESC)</code></p><p>当函数执行完毕的时候，会将函数的<code>执行上下文栈</code>中弹出。</p><p>其实，这里就会联想到 <code>push pop 栈堆</code>(后进先出-LIFO)。</p><p>模拟执行上下文栈：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 执行上下文栈是一个数组 ECStack，整个应用程序结束的时候，才会被清空</span></span><br><span class="line">ECStack = [</span><br><span class="line">  <span class="comment">// 程序结束之前， ECStack 最底部永远有个 globalContext</span></span><br><span class="line">  globalContext <span class="comment">// 全局执行上下文</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>运行如下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"fun3"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  fun3();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  fun2();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fun1();</span><br></pre></td></tr></table></figure><p>伪代码模拟执行：(根据 push pop 原理，后进先出)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ECStack.push(<span class="xml"><span class="tag">&lt;<span class="name">fun1</span>&gt;</span> functionContext);  // 压入fun1上下文，发现了 fun2 被调用</span></span><br><span class="line">ECStack.push(&lt;fun2&gt; functionContext);  // 继续压入fun2上下文，发现了 fun3 被调用</span><br><span class="line">ECStack.push(&lt;fun3&gt; functionContext);  // 继续压入fun3上下文，并执行 fun3</span><br><span class="line">ECStack.pop();  // fun3 执行结束，并弹出</span><br><span class="line">ECStack.pop();  // fun2 执行结束，并弹出</span><br><span class="line">ECStack.pop();  // fun1 执行结束，并弹出</span><br><span class="line">// javascript接着执行下面的代码，但是ECStack底层永远有个globalContext</span><br></pre></td></tr></table></figure><p>原文链接：<a href="https://github.com/mqyqingfeng/Blog/issues/4" target="_blank" rel="noopener">JavaScript 深入之执行上下文栈</a></p><h2 id="变量对象"><a href="#变量对象" class="headerlink" title="变量对象"></a>变量对象</h2><p>1、全局上下文的变量对象初始化：全局对象</p><p>2、函数上下文的变量对象初始化：只包括<code>Arguments</code>对象</p><p>3、进入执行上下文时：给变量对象添加形参、函数声明、变量声明等初始的属性值</p><p>4、代码执行阶段：再次修改变量对象的属性值</p><h3 id="执行过程"><a href="#执行过程" class="headerlink" title="执行过程"></a>执行过程</h3><p>执行上下文过程可分为：进入执行上下文和代码执行（分析-执行）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> b = <span class="number">2</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">  <span class="keyword">var</span> d = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">  b = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>进入执行上下文过程：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">AO = &#123;</span><br><span class="line">  <span class="built_in">arguments</span>: &#123;</span><br><span class="line">    <span class="number">0</span>: <span class="number">1</span>,</span><br><span class="line">    length: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="literal">undefined</span>,</span><br><span class="line">  c: reference <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">  d: <span class="literal">undefined</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码执行阶段：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">AO = &#123;</span><br><span class="line">  <span class="built_in">arguments</span>: &#123;</span><br><span class="line">    <span class="number">0</span>: <span class="number">1</span>,</span><br><span class="line">    length: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="number">3</span>,</span><br><span class="line">  c: reference <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">  d: reference to FunctionExpression <span class="string">"d"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>总结：未进入执行阶段之前，<code>变量对象(VO)</code>中的属性都不能访问！但是进入执行阶段之后，<code>变量对象(VO)</code>转变为了<code>活动对象(AO)</code>，里面的属性都能被访问了，然后开始进行执行阶段的操作。它们其实都是同一个对象，只是处于执行上下文的不同生命周期。</p><p>最后，函数是“第一等公民”，记住这个，变量名称和函数名称相同的声明，优先执行函数声明。</p><p>原文链接：<a href="https://github.com/mqyqingfeng/Blog/issues/5" target="_blank" rel="noopener">JavaScript 深入之变量对象</a></p><h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2><p>对于每个执行上下文，都有三个重要属性：</p><ul><li>变量对象(Variable object，VO)</li><li>作用域链(Scope chain)</li><li>this</li></ul><p>下面让我们以一个函数的创建和激活两个时期来讲解作用域链是如何创建和变化的。</p><h3 id="函数创建"><a href="#函数创建" class="headerlink" title="函数创建"></a>函数创建</h3><p>由上节内容可知：函数的作用域在函数定义的时候就决定了。</p><p>这是因为函数有一个内部属性 [[scope]]，当函数创建的时候，就会保存所有父变量对象到其中，你可以理解 [[scope]] 就是所有父变量对象的层级链，但是注意：[[scope]] 并不代表完整的作用域链！</p><p>如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 各自的 [[scope]]:</span></span><br><span class="line">foo.[[scope]] = [</span><br><span class="line">  globalContext.VO</span><br><span class="line">];</span><br><span class="line">bar.[[scope]] = [</span><br><span class="line">  fooContext.AO   <span class="comment">// 保存父变量</span></span><br><span class="line">  globalContext.VO</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="函数激活"><a href="#函数激活" class="headerlink" title="函数激活"></a>函数激活</h3><p>当函数激活时，进入函数上下文，创建 VO/AO 后，就会将活动对象添加到作用链的前端。</p><p>这时候执行上下文的作用域链，我们命名为 Scope：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Scope = [AO].concat([[Scope]]);</span><br></pre></td></tr></table></figure><p>至此，作用域链创建完毕。</p><h3 id="综合分析"><a href="#综合分析" class="headerlink" title="综合分析"></a>综合分析</h3><p>以下面的例子为例，结合着之前讲的变量对象和执行上下文栈，我们来总结一下函数执行上下文中作用域链和变量对象的创建过程：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scope = <span class="string">"global scope"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkscope</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> scope2 = <span class="string">"local scope"</span>;</span><br><span class="line">  <span class="keyword">return</span> scope2;</span><br><span class="line">&#125;</span><br><span class="line">checkscope();</span><br></pre></td></tr></table></figure><p>执行过程如下：</p><p>1.checkscope 函数被创建，保存作用域链到 内部属性[[scope]]</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">checkscope.[[scope]] = [</span><br><span class="line">    globalContext.VO</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>2.执行 checkscope 函数，创建 checkscope 函数执行上下文，checkscope 函数执行上下文被压入执行上下文栈</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ECStack = [checkscopeContext, globalContext];</span><br></pre></td></tr></table></figure><p>3.checkscope 函数并不立刻执行，开始做准备工作，第一步：复制函数[[scope]]属性创建作用域链</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">checkscopeContext = &#123;</span><br><span class="line">    Scope: checkscope.[[scope]],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.第二步：用 arguments 创建活动对象，随后初始化活动对象，加入形参、函数声明、变量声明</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">checkscopeContext = &#123;</span><br><span class="line">    AO: &#123;</span><br><span class="line">        <span class="built_in">arguments</span>: &#123;</span><br><span class="line">            length: <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        scope2: <span class="literal">undefined</span></span><br><span class="line">    &#125;，</span><br><span class="line">    Scope: checkscope.[[scope]],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5.第三步：将活动对象压入 checkscope 作用域链顶端</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">checkscopeContext = &#123;</span><br><span class="line">  AO: &#123;</span><br><span class="line">    <span class="built_in">arguments</span>: &#123;</span><br><span class="line">      length: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    scope2: <span class="literal">undefined</span></span><br><span class="line">  &#125;,</span><br><span class="line">  Scope: [AO, [[Scope]]]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>6.准备工作做完，开始执行函数，随着函数的执行，修改 AO 的属性值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">checkscopeContext = &#123;</span><br><span class="line">  AO: &#123;</span><br><span class="line">    <span class="built_in">arguments</span>: &#123;</span><br><span class="line">      length: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    scope2: <span class="string">"local scope"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  Scope: [AO, [[Scope]]]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>7.查找到 scope2 的值，返回后函数执行完毕，函数上下文从执行上下文栈中弹出</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ECStack = [globalContext];</span><br></pre></td></tr></table></figure><p>原文链接：<a href="https://github.com/mqyqingfeng/Blog/issues/6" target="_blank" rel="noopener">JavaScript 深入之作用域链</a></p><h2 id="从-ECMAScript-规范解读-this"><a href="#从-ECMAScript-规范解读-this" class="headerlink" title="从 ECMAScript 规范解读 this"></a>从 ECMAScript 规范解读 this</h2><blockquote><p>作者曰：在写文章之初，我就面临着这些问题，最后还是放弃从多个情形下给大家讲解 this 指向的思路，而是追根溯源的从 ECMASciript 规范讲解 this 的指向，尽管从这个角度写起来和读起来都比较吃力，但是一旦多读几遍，明白原理，绝对会给你一个全新的视角看待 this 。</p></blockquote><p>原文链接：<a href="https://github.com/mqyqingfeng/Blog/issues/7" target="_blank" rel="noopener">JavaScript 深入之从 ECMAScript 规范解读 this</a></p><h2 id="执行上下文"><a href="#执行上下文" class="headerlink" title="执行上下文"></a>执行上下文</h2><p>对于每个执行上下文，都有三个重要属性：</p><ul><li>变量对象(Variable object，VO)</li><li>作用域链(Scope chain)</li><li>this</li></ul><p>原文链接：<a href="https://github.com/mqyqingfeng/Blog/issues/8" target="_blank" rel="noopener">JavaScript 深入之执行上下文</a></p><h2 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h2><p>闭包是指那些能够访问自由变量的函数。</p><p>自由变量是指在函数中使用的，但既不是参数也不是函数的局部变量的变量。</p><p>那么，闭包 = 函数 + 函数能够访问的自由变量。</p><p>看这道刷题必刷，面试必考的闭包题：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  data[i] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data[<span class="number">0</span>]();</span><br><span class="line">data[<span class="number">1</span>]();</span><br><span class="line">data[<span class="number">2</span>]();</span><br></pre></td></tr></table></figure><p>循环结束后</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">data[<span class="number">0</span>] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;;</span><br><span class="line">data[<span class="number">1</span>] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;;</span><br><span class="line">data[<span class="number">2</span>] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>执行<code>data[0]()，data[1]()，data[2]()</code>时，i=3,所以都打印 3</p><p>让我们改成闭包看看：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  data[i] = (<span class="function"><span class="keyword">function</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(i);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;)(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data[<span class="number">0</span>]();</span><br><span class="line">data[<span class="number">1</span>]();</span><br><span class="line">data[<span class="number">2</span>]();</span><br></pre></td></tr></table></figure><p>原文链接：<a href="https://github.com/mqyqingfeng/Blog/issues/9" target="_blank" rel="noopener">JavaScript 深入之闭包</a></p><h2 id="参数按值传递"><a href="#参数按值传递" class="headerlink" title="参数按值传递"></a>参数按值传递</h2><p>ECMAScript 中所有函数的参数都是按值传递的。 — 《JavaScript 高级程序设计-第三版》</p><p>即，把函数外部的值复制给函数内部的参数，就和把值从一个变量复制给另一个变量一样。</p><p>但是通俗地理解，参数如果是基本类型是按值传递，参数如果是引用类型就按共享传递。</p><p>共享传递是指，在传递对象的时候，传递对象的引用的副本。</p><p>例子一：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> value = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">  v = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(v); <span class="comment">//2</span></span><br><span class="line">&#125;</span><br><span class="line">foo(value);</span><br><span class="line"><span class="built_in">console</span>.log(value); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><p>内存分布如下：</p><p>改变前：</p><table><br>  <tr><br>    <td colspan="2" align="center">栈内存</td><br>    <td colspan="2" align="center">堆内存</td><br>  </tr><br>  <tr><br>    <td>value</td><br>    <td>1</td><br>    <td></td><br>    <td></td><br>  </tr><br>  <tr><br>    <td>v</td><br>    <td>1</td><br>    <td></td><br>    <td></td><br>  </tr><br></table><p>改变后：</p><table><br>  <tr><br>    <td colspan="2" align="center">栈内存</td><br>    <td colspan="2" align="center">堆内存</td><br>  </tr><br>  <tr><br>    <td>value</td><br>    <td>1</td><br>    <td></td><br>    <td></td><br>  </tr><br>  <tr><br>    <td>v</td><br>    <td>2</td><br>    <td></td><br>    <td></td><br>  </tr><br></table><p>例子二：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  value: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">  o.value = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(o.value); <span class="comment">//2</span></span><br><span class="line">&#125;</span><br><span class="line">foo(obj);</span><br><span class="line"><span class="built_in">console</span>.log(obj.value); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><p>内存分布如下：</p><p>改变前：</p><table><br>  <tr><br>    <td colspan="2" align="center">栈内存</td><br>    <td align="center">堆内存</td><br>  </tr><br>  <tr><br>    <td>obj，o</td><br>    <td>指针地址</td><br>    <td>{value: 1}</td><br>  </tr><br></table><p>改变后：</p><table><br>  <tr><br>    <td colspan="2" align="center">栈内存</td><br>    <td align="center">堆内存</td><br>  </tr><br>  <tr><br>    <td>obj，o</td><br>    <td>指针地址</td><br>    <td>{value: 2}</td><br>  </tr><br></table><p>例子三：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  value: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">  o = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(o); <span class="comment">//2</span></span><br><span class="line">&#125;</span><br><span class="line">foo(obj);</span><br><span class="line"><span class="built_in">console</span>.log(obj.value); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><p>内存分布如下：</p><p>改变前：</p><table><br>  <tr><br>    <td colspan="2" align="center">栈内存</td><br>    <td align="center">堆内存</td><br>  </tr><br>  <tr><br>    <td>obj，o</td><br>    <td>指针地址</td><br>    <td>{value: 1}</td><br>  </tr><br></table><p>改变后：</p><table><br>  <tr><br>    <td colspan="2" align="center">栈内存</td><br>    <td align="center">堆内存</td><br>  </tr><br>  <tr><br>    <td>obj</td><br>    <td>指针地址</td><br>    <td>{value: 1}</td><br>  </tr><br>  <tr><br>    <td>o</td><br>    <td>2</td><br>    <td></td><br>  </tr><br></table><p>以上解释来自：<a href="https://github.com/mqyqingfeng/Blog/issues/10#issuecomment-305645497" target="_blank" rel="noopener">sunsl516 commented</a> on 2 Jun 2017.</p><p>原文链接：<a href="https://github.com/mqyqingfeng/Blog/issues/10" target="_blank" rel="noopener">JavaScript 深入之参数按值传递</a></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常见的 web 攻击方式</title>
      <link href="/2019/11/12/web-safety/"/>
      <url>/2019/11/12/web-safety/</url>
      
        <content type="html"><![CDATA[<h3 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h3><blockquote><p>SQL 注入（SQLi）是一种注入攻击，，可以执行恶意 SQL 语句。它通过将任意 SQL 代码插入数据库查询，使攻击者能够完全控制 Web 应用程序后面的数据库服务器。</p></blockquote><a id="more"></a><p>犯罪分子可能会利用它来未经授权访问用户的敏感数据：客户信息，个人数据，商业机密，知识产权等。SQL 注入攻击是最古老，最流行，最危险的 Web 应用程序漏洞之一。</p><p><em>如何防止 SQL 注入攻击？</em></p><ul><li><p>不要使用动态 SQL<br>避免将用户提供的输入直接放入 SQL 语句中；最好使用准备好的语句和参数化查询，这样更安全。</p></li><li><p>不要将敏感数据保留在纯文本中<br>加密存储在数据库中的私有/机密数据；这样可以提供了另一级保护，以防攻击者成功地排出敏感数据。</p></li><li><p>限制数据库权限和特权<br>将数据库用户的功能设置为最低要求；这将限制攻击者在设法获取访问权限时可以执行的操作。</p></li><li><p>避免直接向用户显示数据库错误<br>攻击者可以使用这些错误消息来获取有关数据库的信息。</p></li><li><p>对访问数据库的 Web 应用程序使用 Web 应用程序防火墙（WAF）<br>这为面向 Web 的应用程序提供了保护，它可以帮助识别 SQL 注入尝试；根据设置，它还可以帮助防止 SQL 注入尝试到达应用程序（以及数据库）。</p></li><li><p>定期测试与数据库交互的 Web 应用程序<br>这样做可以帮助捕获可能允许 SQL 注入的新错误或回归。</p></li><li><p>将数据库更新为最新的可用修补程序</p></li></ul><p>原文：<a href="https://www.php.cn/mysql-tutorials-416424.html" target="_blank" rel="noopener">什么是 SQL 注入？如何防止 SQL 注入攻击？</a></p><p>比如 node 博客里使用 mysql.escape()来防止注入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">`</span></span><br><span class="line"><span class="string">  select username, realname from users where username=<span class="subst">$&#123;mysql.<span class="built_in">escape</span>(</span></span></span><br><span class="line"><span class="string"><span class="subst">    username</span></span></span><br><span class="line"><span class="string"><span class="subst">  )&#125;</span> and password=<span class="subst">$&#123;mysql.<span class="built_in">escape</span>(password)&#125;</span>;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure><h3 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h3><blockquote><p>XSS（Cross Site Script，跨站脚本攻击）是向网页中注入恶意脚本（CSS 代码、JavaScript 代码等），用户浏览网页时在用户浏览器中执行恶意脚本的一种攻击方式。如盗取用户 cookie，破坏页面结构、重定向到其他网站等。</p></blockquote><p>防范 XSS（永远不要相信用户的输入，必须对输入的数据作过滤处理）主要有两方面：</p><ul><li>消毒：对危险字符进行转义</li><li>HttpOnly：防范 XSS 攻击者窃取 Cookie 数据</li></ul><p>比如 node 博客里：新建文章的时候，标题里输入<code>&lt;script&gt;alert(&#39;我是一段js代码&#39;)&lt;/script&gt;</code>，然后点击提交，就会直接弹出来。</p><p>node 使用 xss：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> title = xss(blogData.title);</span><br><span class="line"></span><br><span class="line"><span class="comment">// title</span></span><br><span class="line"><span class="comment">// &amp;lt;script&amp;gt;alert('我是一段js代码')&amp;lt;/script&amp;gt;</span></span><br></pre></td></tr></table></figure><h3 id="CSRF-攻击"><a href="#CSRF-攻击" class="headerlink" title="CSRF 攻击"></a>CSRF 攻击</h3><blockquote><p>CSRF 攻击（Cross Site Request Forgery，跨站请求伪造）是攻击者通过跨站请求，以合法的用户身份进行非法操作（如转账或发帖等）。</p></blockquote><p>这里先说一下，http 是无状态的。服务器端和浏览器端的身份判断一般是通过 cookie。 后端会根据请求者传递的 cookie 信息判断请求者的身份。 攻击者的请求只要是带上了目标用户的 cookie，就可以合法请求。</p><ul><li><p>跨站：<br>请求来源很可能来自其他网站，也有可能来自本站</p></li><li><p>伪造：<br>请求并非用户的意愿</p></li><li><p>实现：<br>利用跨域标签 img iframe 等在 b 网站发送往 a 网站 get 请求，会带上 a 网站的 cookie，由此可见对于数据修改的请求最好不要用 get。</p><p>如果你在 a 站登录了，又访问了恶意网站 b，而 b 上面有一个恶意 img 标签的 get 请求，那你的数据可能就被删除了。 而跨域的 ajax 请求因为同源策略，不会带上 cookie，但是也能请求到结果，后端会处理这个请求，不过因为没有携带 cookie 信息，后端拿 不到登录状态，很多操作不会成功。跨域请求的结果也会发到客户端，不过由于同源策略的限制，浏览器读取不到这个响应结果。</p><p>伪造 form 表单提交。那么，post 请求就安全了吗？form 表单是跨域的。并且可以提交 post 请求。我们在 b 网站伪造一个 form 表单自动提交到 a 网站。</p></li><li><p>预防：<br>最好的办法是带 token，任何请求都带上 token，这样伪站可以发请求，但是无法拿到 token，后端收到的就不带 token 就可以判定非法了。</p></li></ul><p>原文：<a href="https://blog.csdn.net/liusaint1992/article/details/80865350" target="_blank" rel="noopener">常见的 web 攻击方式及预防</a></p><h3 id="密码加密"><a href="#密码加密" class="headerlink" title="密码加密"></a>密码加密</h3><ul><li>文档：<a href="nodejs.cn/api/crypto.html">crypto（加密）</a></li></ul><p>crypto 模块提供了加密功能，包括对 OpenSSL 的哈希、HMAC、加密、解密、签名、以及验证功能的一整套封装。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">"crypto"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> secret = <span class="string">"abcdefg"</span>;</span><br><span class="line"><span class="keyword">const</span> hash = crypto</span><br><span class="line">  .createHmac(<span class="string">"sha256"</span>, secret)</span><br><span class="line">  .update(<span class="string">"I love cupcakes"</span>)</span><br><span class="line">  .digest(<span class="string">"hex"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(hash);</span><br><span class="line"><span class="comment">// 打印:</span></span><br><span class="line"><span class="comment">//   c0fa1bc00531bd78ef38c628449c5102aeabd49b5dc3a2a516ea6ea959d6658e</span></span><br></pre></td></tr></table></figure><h4 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h4><p>md5：不是一种加密算法，是用来做文件校验的</p><p>作用：让大容量信息在数字签名软件签署私人秘钥前被”压缩”成一种保密格式，也就是把一个任意长度的字节串变换成一定长度的十六进制数字串（32个字符）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SECRET_KEY = <span class="string">'WJiol_8776#'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// md5 加密</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">md5</span>(<span class="params">content</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> crypto.createHash(<span class="string">'md5'</span>).update(content).digest(<span class="string">'hex'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加密函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genPassword</span>(<span class="params">password</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> md5(<span class="string">`password=<span class="subst">$&#123;password&#125;</span>&amp;key=<span class="subst">$&#123;SECRET_KEY&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(genPassword(<span class="string">'123456'</span>))</span><br><span class="line"><span class="comment">// 4d4994bde299f6168c65f24c852897b7</span></span><br></pre></td></tr></table></figure><h4 id="HMAC"><a href="#HMAC" class="headerlink" title="HMAC"></a>HMAC</h4><p>进一步提升MD5加密安全性：是一个”秘钥”，对明文进行加密，并做”两次散列”，但使用它得到的还是32个字符</p><p>利用哈希算法，以一个秘钥和一个信息为输入，生成一个消息摘要作为输出</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SECRET_KEY = <span class="string">'WJiol_8776#'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Hmac 加密</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hmac</span>(<span class="params">content</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> crypto.createHmac(<span class="string">'md5'</span>, SECRET_KEY).update(content).digest(<span class="string">'hex'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'hamc: '</span>, hmac(<span class="string">'123456'</span>))</span><br><span class="line"><span class="comment">// 7d37b577bcd2a492820846e475b933f9</span></span><br></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://cloud.tencent.com/developer/information/sql%E6%94%BB%E5%87%BB" target="_blank" rel="noopener">sql 攻击</a></li><li><a href="https://cloud.tencent.com/developer/article/1455178" target="_blank" rel="noopener">SQL 注入和 XSS 攻击</a></li><li><a href="https://www.php.cn/mysql-tutorials-416424.html" target="_blank" rel="noopener">什么是 SQL 注入？如何防止 SQL 注入攻击？</a></li><li><a href="https://cloud.tencent.com/developer/article/1198977" target="_blank" rel="noopener">什么是 XSS 攻击？什么是 SQL 注入攻击？什么是 CSRF 攻击？</a></li><li><a href="https://blog.csdn.net/qq_41033290/article/details/91381962" target="_blank" rel="noopener">如何预防 SQL 注入和 XSS 攻击</a> - 代码讲解更直观</li><li><a href="http://www.sosout.com/2018/09/05/cryptojs-tutorial.html" target="_blank" rel="noopener">前端加密 JS 库–CryptoJS 使用指南 </a></li><li><a href="https://www.jianshu.com/p/92195252c2e0" target="_blank" rel="noopener">nodeJS：MD5加密</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>当复制一个对象的副本所导致的“Object大案”</title>
      <link href="/2019/10/05/js-object/"/>
      <url>/2019/10/05/js-object/</url>
      
        <content type="html"><![CDATA[<blockquote><p>用 forEach 来复制一个对象的副本<br><a id="more"></a></p></blockquote><h2 id="用-forEach-来复制一个对象的副本"><a href="#用-forEach-来复制一个对象的副本" class="headerlink" title="用 forEach 来复制一个对象的副本"></a>用 forEach 来复制一个对象的副本</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对象复制函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">copy</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> copy = <span class="built_in">Object</span>.create(<span class="built_in">Object</span>.getPrototypeOf(obj));</span><br><span class="line">  <span class="keyword">var</span> propNames = <span class="built_in">Object</span>.getOwnPropertyNames(obj);</span><br><span class="line"></span><br><span class="line">  propNames.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> desc = <span class="built_in">Object</span>.getOwnPropertyDescriptor(obj, name);</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(copy, name, desc);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> copy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> copyObj1 = &#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> copyObj2 = copy(copyObj1);</span><br><span class="line"><span class="built_in">console</span>.log(copyObj2); <span class="comment">// &#123; a: 1, b: 2 &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(copyObj2 === copyObj1); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="Object-create"><a href="#Object-create" class="headerlink" title="Object.create"></a>Object.create</h2><blockquote><p><code>Object.create(proto[, propertiesObject])</code>方法创建一个新对象，使用现有的对象来提供新创建的对象的<strong>proto</strong></p></blockquote><h2 id="Object-getPrototypeOf"><a href="#Object-getPrototypeOf" class="headerlink" title="Object.getPrototypeOf"></a>Object.getPrototypeOf</h2><h2 id="Object-getOwnPropertyNames"><a href="#Object-getOwnPropertyNames" class="headerlink" title="Object.getOwnPropertyNames"></a>Object.getOwnPropertyNames</h2><h2 id="Object-getOwnPropertyDescriptor"><a href="#Object-getOwnPropertyDescriptor" class="headerlink" title="Object.getOwnPropertyDescriptor"></a>Object.getOwnPropertyDescriptor</h2><h2 id="Object-defineProperty"><a href="#Object-defineProperty" class="headerlink" title="Object.defineProperty"></a>Object.defineProperty</h2><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">copy</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Object.create()方法创建一个新对象，使用现有的对象来提供新创建的对象的__proto__</span></span><br><span class="line">  <span class="comment">// Object.getPrototypeOf(object)方法返回指定对象的原型（内部[[Prototype]]属性的值</span></span><br><span class="line">  <span class="keyword">var</span> copy = <span class="built_in">Object</span>.create(<span class="built_in">Object</span>.getPrototypeOf(obj));</span><br><span class="line">  <span class="comment">// Object.getOwnPropertyNames(obj)方法返回一个由指定对象的所有自身属性的属性名（包括不可枚举属性但不包括Symbol值作为名称的属性）组成的数组</span></span><br><span class="line">  <span class="keyword">var</span> propNames = <span class="built_in">Object</span>.getOwnPropertyNames(obj);</span><br><span class="line"></span><br><span class="line">  propNames.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Object.getOwnPropertyDescriptor(obj, prop)方法返回指定对象上一个自有属性对应的属性描述符。</span></span><br><span class="line">    <span class="comment">// （自有属性指的是直接赋予该对象的属性，不需要从原型链上进行查找的属性）</span></span><br><span class="line">    <span class="keyword">var</span> desc = <span class="built_in">Object</span>.getOwnPropertyDescriptor(obj, name);</span><br><span class="line">    <span class="comment">// Object.defineProperty(obj, prop, descriptor)方法会直接在一个对象上定义一个新属性，</span></span><br><span class="line">    <span class="comment">// 或者修改一个对象的现有属性， 并返回这个对象</span></span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(copy, name, desc);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> copy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach#%E5%AF%B9%E8%B1%A1%E5%A4%8D%E5%88%B6%E5%87%BD%E6%95%B0" target="_blank" rel="noopener">Array.prototype.forEach() 是如何使用 ECMAScript 5 Object.* 元属性（meta property ）函数工作</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/for...of" target="_blank" rel="noopener">for…of</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/some" target="_blank" rel="noopener">Array.prototype.some()</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/every" target="_blank" rel="noopener">Array.prototype.every()</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/create" target="_blank" rel="noopener">Object.create()</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/keys" target="_blank" rel="noopener">Object.keys()</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="noopener">Object.defineProperty()</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptor" target="_blank" rel="noopener">Object.getOwnPropertyDescriptor()</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyNames" target="_blank" rel="noopener">Object.getOwnPropertyNames()</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/GetPrototypeOf" target="_blank" rel="noopener">Object.getPrototypeOf()</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git 提交的正确姿势：Commit message 编写指南</title>
      <link href="/2019/09/26/git-commit/"/>
      <url>/2019/09/26/git-commit/</url>
      
        <content type="html"><![CDATA[<h2 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h2><p>Header 部分只有一行，包括三个字段：type（必需）、scope（可选）和 subject（必需）</p><ul><li>feat：新功能（feature）</li><li>fix：修补 bug</li><li>docs：文档（documentation）</li><li>style： 格式（不影响代码运行的变动）</li><li>refactor：重构（即不是新增功能，也不是修改 bug 的代码变动）</li><li>test：增加测试</li><li>chore：构建过程或辅助工具的变动<a id="more"></a></li></ul><h3 id="提交信息规范"><a href="#提交信息规范" class="headerlink" title="提交信息规范"></a>提交信息规范</h3><p>我们对项目的 git 提交信息格式进行统一格式约定，每条提交信息由 <code>type</code>+<code>subject</code> 组成，这将提升项目日志的可读性。</p><ul><li><code>type</code> 用于表述此次提交信息的意义，首写字母大写，包括但不局限于如下类型：<ul><li><code>Build</code>：基础构建系统或依赖库的变化</li><li><code>Ci</code>：CI 构建系统及其脚本变化</li><li><code>Docs</code>：文档内容变化</li><li><code>Feat</code>：新功能</li><li><code>Fix</code>：Bug 修复</li><li><code>Perf</code>：性能优化</li><li><code>Refactor</code>：重构（即不是新增功能，也不是修改 Bug 的代码变动）</li><li><code>Style</code>：格式（不影响代码运行的变动）</li><li><code>Revert</code>：代码回滚</li><li><code>Release</code>：版本发布</li></ul></li><li><code>subject</code> 用于简要描述修改变更的内容，如 <code>Update code highlighting in readme.md</code>。<ul><li>句尾不要使用符号。</li><li>使用现在时、祈使句语气。</li></ul></li></ul><h3 id="标签规范"><a href="#标签规范" class="headerlink" title="标签规范"></a>标签规范</h3><p>为了方便维护人员和用户能够快速找到他们想要查看的问题，我们使用“标签”功能对 Pull requests 和 Issues 进行分类。</p><p>如果您不确定某个标签的含义，或者不知道将哪些标签应用于 PR 或 issue，千万别错过这个。</p><p>Issue 的标签：</p><ul><li>类型<ul><li><code>Bug</code>: 检测到需要进行确认的 Bug</li><li><code>Feature Request</code>: 提出了新功能请求的 Issue</li><li><code>Question</code>: 提出疑问的 Issue</li><li><code>Meta</code>: 表明使用条款变更的 Issue</li><li><code>Support</code>: 被标记为支持请求的 Issue</li><li><code>Polls</code>: 发起投票的 Issue</li></ul></li><li>结果<ul><li><code>Duplicate</code>: 重复提及的 Issue</li><li><code>Irrelevant</code>: 与 NexT 主题无关的 Issue</li><li><code>Expected Behavior</code>: 与预期行为相符的 Issue</li><li><code>Need More Info</code>: 需要更多信息的 Issue</li><li><code>Need Verify</code>: 需要开发人员或用户确认 Bug 或解决方法的 Issue</li><li><code>Verified</code>: 已经被确认的 Issue</li><li><code>Can&#39;t Reproduce</code>: 无法复现的 Issue</li><li><code>Solved</code>: 已经解决的 Issue</li><li><code>Stale</code>: 由于长期无人回应被封存的 Issue</li></ul></li></ul><p>Pull Request 的标签：</p><ul><li><code>Breaking Change</code>: 产生重大变动的 Pull Request</li><li><code>Bug Fix</code>: 修复相关 Bug 的 Pull Request</li><li><code>New Feature</code>: 添加了新功能的 Pull Request</li><li><code>Feature</code>: 为现有功能提供选项或加成的 Pull Request</li><li><code>i18n</code>: 更新了翻译的 Pull Request</li><li><code>Work in Progress</code>: 仍在进行改动和完善的 Pull Request</li><li><code>Skip Release</code>: 无需在 Release Note 中展现的 Pull Request</li></ul><p>两者兼有：</p><ul><li><code>Roadmap</code>: 与 NexT 主题发展相关的 Issue 或者 Pull Request</li><li><code>Help Wanted</code>: 需要帮助的 Issue 或者 Pull Request</li><li><code>Discussion</code>: 需要进行讨论的 Issue 或者 Pull Request</li><li><code>Improvement</code>: 需要改进的 Issue 或者改进了 NexT 主题的 Pull Request</li><li><code>Performance</code>: 提出性能问题的 Issue 或者提高了 NexT 主题性能的 Pull Request</li><li><code>Hexo</code>: 与 Hexo 和 Hexo 插件相关的 Issue 或者 Pull Request</li><li><code>Template Engine</code>: 与模版引擎相关的 Issue 或者 Pull Request</li><li><code>CSS</code>: 与 NexT 主题 CSS 文件相关的 Issue 或者 Pull Request</li><li><code>Fonts</code>: 与 NexT 主题字体相关的 Issue 或者 Pull Request</li><li><code>PJAX</code>: 与 PJAX 相关的 Issue 或者 Pull Request</li><li><code>3rd Party Plugin</code>: 与第三方插件和服务相关的 Issue 或者 Pull Request</li><li><code>Docs</code>: 与文档说明相关的 Issue 或者 Pull Request</li><li><code>Configurations</code>: 与 NexT 主题设置相关的 Issue 或者 Pull Request</li></ul><h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><ul><li><a href="https://www.cnblogs.com/daysme/p/7722474.html" target="_blank" rel="noopener">Git 提交的正确姿势：Commit message 编写指南</a></li><li><a href="https://github.com/theme-next/hexo-theme-next/blob/master/docs/zh-CN/CONTRIBUTING.md" target="_blank" rel="noopener">Next 主题贡献规范</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 开发工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端性能优化</title>
      <link href="/2019/09/06/web-speed/"/>
      <url>/2019/09/06/web-speed/</url>
      
        <content type="html"><![CDATA[<blockquote><p>重定向 → 拉取缓存 →DNS 查询 → 建立 TCP 链接 → 发起请求 → 接收响应 → 处理 HTML 元素 → 元素加载完成</p></blockquote><a id="more"></a><h2 id="网络传输性能优化"><a href="#网络传输性能优化" class="headerlink" title="网络传输性能优化"></a>网络传输性能优化</h2><h3 id="浏览器缓存"><a href="#浏览器缓存" class="headerlink" title="浏览器缓存"></a>浏览器缓存</h3><blockquote><p>缓存一般分为强缓存和协商缓存，主要区别是：使用本地缓存的时候，是否需要向服务器验证本地缓存是否依旧有效。</p></blockquote><h4 id="强缓存"><a href="#强缓存" class="headerlink" title="强缓存"></a>强缓存</h4><p>主要通过 http 请求头中的 Cache-Control 和 Expire 两个字段控制</p><p>一般，我们会设置 Cache-Control 的值为“public, max-age=xxx”，表示在 xxx 秒内再次访问该资源，均使用本地的缓存，不再向服务器发起请求。</p><h4 id="协商缓存"><a href="#协商缓存" class="headerlink" title="协商缓存"></a>协商缓存</h4><p>每次都向服务器验证一下缓存的有效性</p><h4 id="前端缓存方案"><a href="#前端缓存方案" class="headerlink" title="前端缓存方案"></a>前端缓存方案</h4><ul><li>HTML：使用协商缓存</li><li>CSS JS Image：使用强缓存，文件名带上 hash 值</li></ul><p>浏览器默认的缓存是放在内存内的，但我们知道，内存里的缓存会因为进程的结束或者说浏览器的关闭而被清除，而存在硬盘里的缓存才能够被长期保留下去。很多时候，我们在 network 面板中各请求的 size 项里，会看到两种不同的状态：from memory cache 和 from disk cache，前者指缓存来自内存，后者指缓存来自硬盘。而控制缓存存放位置的，不是别人，就是我们在服务器上设置的 Etag 字段。在浏览器接收到服务器响应后，会检测响应头部（Header），如果有 Etag 字段，那么浏览器就会将本次缓存写入硬盘中。</p><h3 id="资源打包压缩"><a href="#资源打包压缩" class="headerlink" title="资源打包压缩"></a>资源打包压缩</h3><blockquote><p>网络性能优化措施归结为三大方面：减少请求数、减小请求资源体积、提升网络传输速率</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp grunt webpack parcel</span><br></pre></td></tr></table></figure><h3 id="图片资源优化"><a href="#图片资源优化" class="headerlink" title="图片资源优化"></a>图片资源优化</h3><ul><li>不要在 HTML 里缩放图像</li><li>使用雪碧图（CSS Sprite）- <code>webpack-spritesmith</code></li><li>使用字体图标（iconfont）- icomoon</li><li>使用 WebP - 图片压缩体积大约只有 JPEG 的 2/3，并能节省大量的服务器带宽资源和数据空间</li></ul><h3 id="网络传输性能检测工具"><a href="#网络传输性能检测工具" class="headerlink" title="网络传输性能检测工具"></a>网络传输性能检测工具</h3><ul><li><code>Page Speed | PageSpeed Insights</code></li></ul><h3 id="使用-CDN"><a href="#使用-CDN" class="headerlink" title="使用 CDN"></a>使用 CDN</h3><h2 id="页面渲染性能优化"><a href="#页面渲染性能优化" class="headerlink" title="页面渲染性能优化"></a>页面渲染性能优化</h2><h3 id="浏览器渲染过程（webkit）"><a href="#浏览器渲染过程（webkit）" class="headerlink" title="浏览器渲染过程（webkit）"></a>浏览器渲染过程（webkit）</h3><ul><li>《Webkit 技术内幕》</li></ul><blockquote><p>浏览器的解释器，是包括在渲染引擎内的，我们常说的 Chrome（现在使用的是 Blink 引擎）和 Safari 使用的 Webkit 引擎，Firefox 使用的 Gecko 引擎，指的就是渲染引擎。而在渲染引擎内，还包括着我们的 HTML 解释器（渲染时用于构造 DOM 树）、CSS 解释器（渲染时用于合成 CSS 规则）还有我们的 JS 解释器。不过后来，由于 JS 的使用越来越重要，工作越来越繁杂，所以 JS 解释器也渐渐独立出来，成为了单独的 JS 引擎，就像众所周知的 V8 引擎，我们经常接触的 Node.js 也是用的它。</p></blockquote><h3 id="DOM-渲染层与-GPU-硬件加速"><a href="#DOM-渲染层与-GPU-硬件加速" class="headerlink" title="DOM 渲染层与 GPU 硬件加速"></a>DOM 渲染层与 GPU 硬件加速</h3><ul><li>① 浏览器会先获取 DOM 树并依据样式将其分割成多个独立的渲染层</li><li>②CPU 将每个层绘制进绘图中</li><li>③ 将位图作为纹理上传至 GPU（显卡）绘制</li><li>④GPU 将所有的渲染层缓存（如果下次上传的渲染层没有发生变化，GPU 就不需要对其进行重绘）并复合多个渲染层最终形成我们的图像</li></ul><h3 id="重排和重绘"><a href="#重排和重绘" class="headerlink" title="重排和重绘"></a>重排和重绘</h3><p>不论是重排还是重绘，都会阻塞浏览器。要提高网页性能，就要降低重排和重绘的频率和成本，近可能少地触发重新渲染。</p><p>重排是由 CPU 处理的，而重绘是由 GPU 处理的，CPU 的处理效率远不及 GPU，并且重排一定会引发重绘，而重绘不一定会引发重排。所以在性能优化工作中，我们更应当着重减少重排的发生。</p><h4 id="重排-reflow"><a href="#重排-reflow" class="headerlink" title="重排 reflow"></a>重排 reflow</h4><p>渲染层内的元素布局发生修改，都会导致页面重写排列。</p><p>比如：窗口的尺寸发生变化、删除或添加 DOM 元素；修改了影响元素盒子大小的 css 属性（width height padding…）</p><h4 id="重绘-repaint"><a href="#重绘-repaint" class="headerlink" title="重绘 repaint"></a>重绘 repaint</h4><p>绘制，所有对元素的视觉表现属性的修改，都会引起重绘。</p><h3 id="优化策略"><a href="#优化策略" class="headerlink" title="优化策略"></a>优化策略</h3><ul><li>CSS 属性读写分离</li><li>通过切换 class 或者 style.csstext 属性去批量操作元素样式</li><li>DOM 元素离线更新</li><li>将没用的元素设为不可见：visibility: hidden，减少重绘的压力</li><li>压缩 DOM 的深度：少用 DOM 完成页面样式，多使用伪元素或者 box-shadow 取代。</li><li>图片在渲染前指定大小：因为 img 元素是内联元素，所以在加载图片后会改变宽高，严重的情况会导致整个页面重排，所以最好在渲染前就指定其大小，或者让其脱离文档流。</li><li>对页面中可能发生大量重排重绘的元素单独触发渲染层，使用 GPU 分担 CPU 压力。（慎重）</li></ul><h2 id="JS-阻塞性能"><a href="#JS-阻塞性能" class="headerlink" title="JS 阻塞性能"></a>JS 阻塞性能</h2><h2 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h2><h3 id="Node-js-处理-IO-密集型请求"><a href="#Node-js-处理-IO-密集型请求" class="headerlink" title="Node.js 处理 IO 密集型请求"></a>Node.js 处理 IO 密集型请求</h3><ul><li><a href="https://mp.weixin.qq.com/s?__biz=MzAxOTc0NzExNg==&amp;mid=2665513044&amp;idx=1&amp;sn=9b8526e9d641b970ee5ddac02dae3c57&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">Node.js : 我只需要一个店小二</a></li></ul><p>node 的核心是事件驱动，通过 loop 去异步处理用户请求，相对于传统的后端服务，他们都是将用户的每个请求分配到异步队列中进行处理。</p><p>事件驱动的优势：在高并发 IO 时，不会造成堵塞。</p><p>Frond-End(Browser) <- nodejs="" -=""> Back-End(Java Server)</-></p><h3 id="pm2-实现-Node-js“多线程”"><a href="#pm2-实现-Node-js“多线程”" class="headerlink" title="pm2 实现 Node.js“多线程”"></a>pm2 实现 Node.js“多线程”</h3><ul><li><a href="https://www.zhihu.com/question/19653241/answer/15993549" target="_blank" rel="noopener">使用 Node.js 的优势和劣势都有哪些？</a></li></ul><p>pm2。这是它的官网：pm2.keymetrics.io/</p><p>它是一款 node.js 进程管理器，具体的功能，就是能在你的计算机里的每一个内核都启动一个 node.js 服务。</p><p>也就是说如果你的电脑或者服务器是多核处理器（现在也少见单核了吧），它就能启动多个 node.js 服务，并且它能够自动控制负载均衡，会自动将用户的请求分发至压力小的服务进程上处理。</p><h3 id="nginx-搭建反向代理"><a href="#nginx-搭建反向代理" class="headerlink" title="nginx 搭建反向代理"></a>nginx 搭建反向代理</h3><h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><ul><li><a href="https://juejin.im/post/5c136bd16fb9a049d37efc47" target="_blank" rel="noopener">前端缓存最佳实践</a></li><li><a href="https://juejin.im/post/5b6fa8c86fb9a0099910ac91" target="_blank" rel="noopener">网站性能优化实战——从 12.67s 到 1.06s 的故事</a></li><li><a href="https://juejin.im/post/5ae081aaf265da0b767d263a" target="_blank" rel="noopener">你应该知道的前端——缓存</a></li><li>《大型网站性能监测、分析与优化》</li><li><a href="https://www.cnblogs.com/xianyulaodi/p/5755079.html" target="_blank" rel="noopener">【原】雅虎前端优化的 35 条军规</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MacOS如何使用 tree 生成目录结构</title>
      <link href="/2019/09/02/tool-tree/"/>
      <url>/2019/09/02/tool-tree/</url>
      
        <content type="html"><![CDATA[<h2 id="Homebrew安装"><a href="#Homebrew安装" class="headerlink" title="Homebrew安装"></a>Homebrew安装</h2><p><a href="https://brew.sh/" target="_blank" rel="noopener">homebrew官网</a></p><p><a href="[https://www.jianshu.com/p/de6f1d2d37bf](https://www.jianshu.com/p/de6f1d2d37bf">Homebrew介绍和使用</a></p><a id="more"></a><p>根据官网的方法安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/ruby -e <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>"</span></span><br></pre></td></tr></table></figure></p><p>比如我的：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">==&gt; This script will install:</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/brew</span><br><span class="line">/usr/<span class="built_in">local</span>/share/doc/homebrew</span><br><span class="line">/usr/<span class="built_in">local</span>/share/man/man1/brew.1</span><br><span class="line">/usr/<span class="built_in">local</span>/share/zsh/site-functions/_brew</span><br><span class="line">/usr/<span class="built_in">local</span>/etc/bash_completion.d/brew</span><br><span class="line">/usr/<span class="built_in">local</span>/Homebrew</span><br><span class="line"></span><br><span class="line">Press RETURN to <span class="built_in">continue</span> or any other key to abort</span><br></pre></td></tr></table></figure></p><p>一路按照提示操作即可，不出意外的话，就安装成功了:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ brew -v</span><br><span class="line">Homebrew 2.1.9</span><br><span class="line">Homebrew/homebrew-core (git revision c8ff; last commit 2019-08-01)</span><br><span class="line">Homebrew/homebrew-cask (git revision 04bff; last commit 2019-08-02)</span><br></pre></td></tr></table></figure></p><h2 id="Tree-安装"><a href="#Tree-安装" class="headerlink" title="Tree 安装"></a>Tree 安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install tree</span><br></pre></td></tr></table></figure><p>常用命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载</span></span><br><span class="line">brew install tree</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个文件夹下的所有文件</span></span><br><span class="line">tree -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只显示文件夹</span></span><br><span class="line">tree -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示项目的层级，如三级</span></span><br><span class="line">tree -L 3  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤，如除node_modules文件</span></span><br><span class="line">tree -I <span class="string">"node_modules"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">tree &gt; tree.md</span><br><span class="line"></span><br><span class="line"><span class="comment"># Help</span></span><br><span class="line">tree --<span class="built_in">help</span></span><br></pre></td></tr></table></figure></p><p>最后，我的输出：<code>tree -I &quot;node_modules&quot; &gt; tree.md</code><br>查看 <code>tree.md</code> 的内容如下：<br><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">├── dist</span><br><span class="line">├── package.json</span><br><span class="line">├── src</span><br><span class="line">│   ├── app.scss</span><br><span class="line">│   ├── font-awesome</span><br><span class="line">│   │   ├── fonts</span><br><span class="line">│   │   │   ├── FontAwesome.otf</span><br><span class="line">│   │   │   ├── fontawesome-webfont.eot</span><br><span class="line">│   │   │   ├── fontawesome-webfont.svg</span><br><span class="line">│   │   │   ├── fontawesome-webfont.ttf</span><br><span class="line">│   │   │   ├── fontawesome-webfont.woff</span><br><span class="line">│   │   │   └── fontawesome-webfont.woff2</span><br><span class="line">│   │   └── scss</span><br><span class="line">│   │       ├── _animated.scss</span><br><span class="line">│   │       ├── _bordered-pulled.scss</span><br><span class="line">│   │       ├── _core.scss</span><br><span class="line">│   │       ├── _fixed-width.scss</span><br><span class="line">│   │       ├── _icons.scss</span><br><span class="line">│   │       ├── _larger.scss</span><br><span class="line">│   │       ├── _list.scss</span><br><span class="line">│   │       ├── _mixins.scss</span><br><span class="line">│   │       ├── _path.scss</span><br><span class="line">│   │       ├── _rotated-flipped.scss</span><br><span class="line">│   │       ├── _screen-reader.scss</span><br><span class="line">│   │       ├── _stacked.scss</span><br><span class="line">│   │       ├── _variables.scss</span><br><span class="line">│   │       └── font-awesome.scss</span><br><span class="line">│   ├── index.html</span><br><span class="line">│   ├── index.js</span><br><span class="line">│   ├── index.jsx</span><br><span class="line">│   ├── react.png</span><br><span class="line">│   └── style.css</span><br><span class="line">├── tree.md</span><br><span class="line">├── webpack.config.js</span><br><span class="line">└── yarn.lock</span><br><span class="line"></span><br><span class="line">5 directories, 31 files</span><br></pre></td></tr></table></figure></p><h2 id="tree命令行参数"><a href="#tree命令行参数" class="headerlink" title="tree命令行参数"></a>tree命令行参数</h2><table><thead><tr><th>命令行参数</th><th>含义</th></tr></thead><tbody><tr><td>-a</td><td>显示所有文件和目录。</td></tr><tr><td>-A</td><td>使用ASNI绘图字符显示树状图而非以ASCII字符组合。</td></tr><tr><td>-C</td><td>在文件和目录清单加上色彩，便于区分各种类型。</td></tr><tr><td>-d</td><td>显示目录名称而非内容。</td></tr><tr><td>-D</td><td>列出文件或目录的更改时间。</td></tr><tr><td>-f</td><td>在每个文件或目录之前，显示完整的相对路径名称。</td></tr><tr><td>-F</td><td>在末尾追加描述性字符，如 ls -F</td></tr><tr><td>-g</td><td>列出文件或目录的所属群组名称，没有对应的名称时，则显示群组识别码。</td></tr><tr><td>-i</td><td>不以阶梯状列出文件或目录名称。</td></tr><tr><td>-I</td><td>不显示符合范本样式的文件或目录名称。</td></tr><tr><td>-l</td><td>如遇到性质为符号连接的目录，直接列出该连接所指向的原始目录。</td></tr><tr><td>-n</td><td>不在文件和目录清单加上色彩。</td></tr><tr><td>-N</td><td>直接列出文件和目录名称，包括控制字符。</td></tr><tr><td>-p</td><td>列出权限标示。</td></tr><tr><td>-P</td><td>只显示符合范本样式的文件或目录名称。</td></tr><tr><td>-q</td><td>用”?”号取代控制字符，列出文件和目录名称。</td></tr><tr><td>-s</td><td>列出文件或目录大小。</td></tr><tr><td>-t</td><td>用文件和目录的更改时间排序。</td></tr><tr><td>-u</td><td>列出文件或目录的拥有者名称，没有对应的名称时，则显示用户识别码。</td></tr><tr><td>-x</td><td>将范围局限在现行的文件系统中，若指定目录下的某些子目录，其存放于另一个文件系统上，则将该子目录予以排除在寻找范围外。</td></tr></tbody></table><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://www.cnblogs.com/ayseeing/p/4097066.html" target="_blank" rel="noopener">mac tree命令</a></li><li><a href="https://blog.csdn.net/qq673318522/article/details/53713903" target="_blank" rel="noopener">Mac使用tree生成目录结构</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 开发工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MacOS </tag>
            
            <tag> 终端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习 React 的一些记录日志</title>
      <link href="/2019/08/24/react-doc/"/>
      <url>/2019/08/24/react-doc/</url>
      
        <content type="html"><![CDATA[<blockquote><p>学习 React 的一些记录日志<br><a id="more"></a></p></blockquote><h2 id="Video-Course"><a href="#Video-Course" class="headerlink" title="Video Course"></a>Video Course</h2><h3 id="初级"><a href="#初级" class="headerlink" title="初级"></a>初级</h3><ul><li><a href="https://www.imooc.com/learn/1045" target="_blank" rel="noopener">基于实例的 react16 傻瓜课程</a> — 用一系列有趣的、简洁明快的实例由浅入深的阐述了 React 的特色，概念和基本使用</li><li><a href="https://www.imooc.com/learn/1023" target="_blank" rel="noopener">react16.4 快速上手</a> — 通过 Todolist 功能的实现，给大家讲解了 React 组件间的通信方式</li></ul><h3 id="中级"><a href="#中级" class="headerlink" title="中级"></a>中级</h3><ul><li><a href="https://www.imooc.com/learn/1061" target="_blank" rel="noopener">react 16 实现订单列表及评价功能</a> — 介绍了从项目创建、到组件划分、再到组件及页面逻辑实现的开发流程</li><li><a href="https://www.imooc.com/learn/944" target="_blank" rel="noopener">react 组件</a> — 比较详细地讲解组件和生命周期</li></ul><h3 id="高级"><a href="#高级" class="headerlink" title="高级"></a>高级</h3><ul><li><a href="https://www.imooc.com/learn/953" target="_blank" rel="noopener">react响应用户输入</a> — 学习如何让数据逻辑与 UI 的结合使用、react 的事件处理机制以及 react 对 DOM 模型的操作</li><li><a href="https://www.imooc.com/learn/971" target="_blank" rel="noopener">react知识点综合运用实例</a> — 综合实例操作</li><li><a href="https://www.imooc.com/learn/1075" target="_blank" rel="noopener">react高级教程之高阶组件</a> — 高阶组件的应用：代理和继承</li></ul><h2 id="Document"><a href="#Document" class="headerlink" title="Document"></a>Document</h2><ul><li><a href="https://zh-hans.reactjs.org/docs/getting-started.html" target="_blank" rel="noopener">React 官方文档</a></li><li><a href="https://ant.design/docs/react/introduce-cn" target="_blank" rel="noopener">Ant Design of React</a> — antd 是基于 Ant Design 设计体系的 React UI 组件库，主要用于研发企业级中后台产品。</li><li><a href="https://pro.ant.design/docs/getting-started-cn" target="_blank" rel="noopener">Ant Design Pro</a> — 是一个企业级中后台前端/设计解决方案</li><li><a href="https://mobile.ant.design/docs/react/introduce-cn" target="_blank" rel="noopener">Ant Design Mobile of React</a> — 是 Ant Design 的移动规范的 React 实现，服务于蚂蚁及口碑无线业务</li><li><a href="https://www.webpackjs.com/concepts/" target="_blank" rel="noopener">webpack 官方文档</a></li><li><a href="https://typescript.bootcss.com/tutorials/react-&amp;-webpack.html" target="_blank" rel="noopener">React 与 webpack</a></li></ul><h2 id="Learning-Materials"><a href="#Learning-Materials" class="headerlink" title="Learning Materials"></a>Learning Materials</h2><ul><li><a href="https://hulufei.gitbooks.io/react-tutorial/content/index.html" target="_blank" rel="noopener">《react 入门教程》</a></li><li><a href="http://www.ruanyifeng.com/blog/2015/03/react.html" target="_blank" rel="noopener">《react 入门实例教程》</a> — 阮一峰</li><li><a href="https://ts.xcatliu.com/" target="_blank" rel="noopener">《typescript 热门教程》</a></li><li><a href="https://zhuanlan.zhihu.com/p/23412169" target="_blank" rel="noopener">《6 周学习计划，攻克 javascript 难关(react/redux/es6 etc.)》</a></li></ul><h2 id="My-Learning"><a href="#My-Learning" class="headerlink" title="My Learning"></a>My Learning</h2><h3 id="入门学习-React-的几个例子"><a href="#入门学习-React-的几个例子" class="headerlink" title="入门学习 React 的几个例子"></a>入门学习 React 的几个例子</h3><blockquote><p><a href="https://github.com/yangtao2o/myreact/tree/master/demo" target="_blank" rel="noopener">Demo 地址，戳我</a></p></blockquote><ol><li><a href="https://github.com/yangtao2o/myreact/blob/master/demo/01/index.html" target="_blank" rel="noopener">ReactDOM.render()</a></li><li><a href="https://github.com/yangtao2o/myreact/blob/master/demo/02/index.html" target="_blank" rel="noopener">Use Array in JSX</a></li><li><a href="https://github.com/yangtao2o/myreact/blob/master/demo/03/index.html" target="_blank" rel="noopener">组件</a></li><li><a href="https://github.com/yangtao2o/myreact/blob/master/demo/04/index.html" target="_blank" rel="noopener">this.props.children</a></li><li><a href="https://github.com/yangtao2o/myreact/blob/master/demo/05/index.html" target="_blank" rel="noopener">PropTypes</a></li><li><a href="https://github.com/yangtao2o/myreact/blob/master/demo/06/index.html" target="_blank" rel="noopener">获取真实的 DOM 节点</a></li><li><a href="https://github.com/yangtao2o/myreact/blob/master/demo/07/index.html" target="_blank" rel="noopener">this.state</a></li><li><a href="https://github.com/yangtao2o/myreact/blob/master/demo/08/index.html" target="_blank" rel="noopener">表单</a></li><li><a href="https://github.com/yangtao2o/myreact/blob/master/demo/09/index.html" target="_blank" rel="noopener">组件的生命周期</a></li><li><a href="https://istaotao.com/myreact/demo/10/" target="_blank" rel="noopener">使用 Promise 获取 Github 的数据</a></li><li><a href="https://istaotao.com/myreact/demo/11/" target="_blank" rel="noopener">Todo List</a></li><li><a href="https://istaotao.com/myreact/demo/12/" target="_blank" rel="noopener">井字棋（Tic Tac Toe）</a></li></ol><h3 id="Nextjs-—-配合-React-打造静态化和服务端渲染应用"><a href="#Nextjs-—-配合-React-打造静态化和服务端渲染应用" class="headerlink" title="Nextjs — 配合 React 打造静态化和服务端渲染应用"></a>Nextjs — 配合 React 打造静态化和服务端渲染应用</h3><p><strong><a href="https://github.com/yangtao2o/myreact/tree/master/nextjs/01-hello-next" target="_blank" rel="noopener">Nextjs</a></strong></p><ul><li>Demo1: 学习官方文档</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> nextjs/01-hello-next</span><br><span class="line">npm install</span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure><h2 id="My-Project"><a href="#My-Project" class="headerlink" title="My Project"></a>My Project</h2><ul><li><a href="https://github.com/yangtao2o/myreact/tree/master/product/01-ttt" target="_blank" rel="noopener">学习「井字游戏」</a></li><li><a href="https://github.com/yangtao2o/myreact/tree/master/product/02-news-app" target="_blank" rel="noopener">学习体验 Ant Design of React</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 前端框架 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> react </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>入门 Webpack@3 的配置过程</title>
      <link href="/2019/08/05/webpack-v3/"/>
      <url>/2019/08/05/webpack-v3/</url>
      
        <content type="html"><![CDATA[<blockquote><p>入门 Webpack@3 的配置过程<br><a id="more"></a></p></blockquote><h2 id="Webpack"><a href="#Webpack" class="headerlink" title="Webpack"></a>Webpack</h2><ul><li><a href="https://webpack.docschina.org/guides/" target="_blank" rel="noopener">webpack 指南</a></li><li><a href="https://www.jianshu.com/p/0e01ca947e50" target="_blank" rel="noopener">React 的 Webpack 配置</a></li></ul><p><em>PS：</em> 文章结尾有完整实例启动方法：<a href="https://github.com/yangtao2o/happymmall/tree/webpack%403-react" target="_blank" rel="noopener">Github地址</a></p><p>本次配置练习主要是针对 <code>webpack-v3</code>，切换分支至 <code>webpack@3-react</code> ，每一次 <code>Commits</code>，基本上对应着相应的文件配置，可以对照着瞅瞅。</p><h2 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h2><h4 id="配置-Webpack"><a href="#配置-Webpack" class="headerlink" title="配置 Webpack"></a>配置 Webpack</h4><p>准备环境：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">➜  happymmall git:(webpack@3-react) ✗ node -v</span><br><span class="line">v11.13.0</span><br><span class="line">➜  happymmall git:(webpack@3-react) ✗ npm -v</span><br><span class="line">6.10.1</span><br><span class="line">➜  happymmall git:(webpack@3-react) ✗ git --version</span><br><span class="line">git version 2.17.2 (Apple Git-113)</span><br><span class="line">➜  happymmall git:(webpack@3-react) ✗ yarn -v</span><br><span class="line">1.17.3</span><br></pre></td></tr></table></figure><h5 id="安装-yarn"><a href="#安装-yarn" class="headerlink" title="安装 yarn"></a>安装 <a href="https://yarn.bootcss.com/docs/install/#mac-stable" target="_blank" rel="noopener">yarn</a></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># homebrew 安装</span></span><br><span class="line">brew install yarn</span><br><span class="line"></span><br><span class="line"><span class="comment"># npm/cnpm 安装</span></span><br><span class="line">npm install cnpm -g</span><br><span class="line">cnpm install yarn -g</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试是否安装成功</span></span><br><span class="line">➜  ~ yarn --version</span><br><span class="line">1.17.3</span><br></pre></td></tr></table></figure><p>常用命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yarn init  <span class="comment"># 初始化</span></span><br><span class="line">yarn add [package]  <span class="comment"># 添加依赖包</span></span><br><span class="line">yarn add [package] --dev   <span class="comment"># 添加到 devDependencies</span></span><br><span class="line">yarn remove [package]  <span class="comment"># 删除依赖包</span></span><br><span class="line">yarn install   <span class="comment"># 安装所有依赖包</span></span><br></pre></td></tr></table></figure><h5 id="安装-webpack-3"><a href="#安装-webpack-3" class="headerlink" title="安装 webpack@3"></a>安装 webpack@3</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn init</span><br><span class="line">yarn add webpack@3.10.0 --dev</span><br></pre></td></tr></table></figure><p>根目录新建 <code>webpack.config.js</code>,并新建 <code>src/index.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">"./src/index.js"</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">"dist"</span>),</span><br><span class="line">    filename: <span class="string">"app.js"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Hello, world"</span>);</span><br></pre></td></tr></table></figure><p>运行：<code>node_modules/.bin/webpack</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  happymmall git:(webpack@3-react) ✗ node_modules/.bin/webpack</span><br><span class="line">Hash: 62e68b9cc366c7b50ac6</span><br><span class="line">Version: webpack 3.10.0</span><br><span class="line">Time: 34ms</span><br><span class="line"> Asset    Size  Chunks             Chunk Names</span><br><span class="line">app.js  2.5 kB       0  [emitted]  main</span><br><span class="line">   [0] ./src/index.js 28 bytes &#123;0&#125; [built]</span><br></pre></td></tr></table></figure><p>打开 <code>dist/app.js</code>，搜索 <code>Hello</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Hello, world'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;)</span><br><span class="line"><span class="comment">/******/</span> ]);</span><br></pre></td></tr></table></figure><p>一个简单的文件就此打包成功，开心吧…</p><h4 id="配置-HMTL-模板"><a href="#配置-HMTL-模板" class="headerlink" title="配置 HMTL 模板"></a>配置 HMTL 模板</h4><p>文档：<a href="https://webpack.js.org/plugins/html-webpack-plugin/#root" target="_blank" rel="noopener">HtmlWebpackPlugin</a> 简化了 HTML 文件的创建，以便为你的 webpack 包提供服务。这对于在文件名中包含每次会随着编译而发生变化哈希的 webpack bundle 尤其有用。</p><p>安装 html-webpack-plugin</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add html-webpack-plugin@2.30.1 --dev</span><br></pre></td></tr></table></figure><p>新建：<code>src/index.html</code>, 并初始化一个 html 内容，然后配置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">"./src/index.js"</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">"dist"</span>),</span><br><span class="line">    filename: <span class="string">"app.js"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">"./src/index.html"</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>接着跑一下：<code>node_modules/.bin/webpack</code>，不出意外的话，dist 下会出现一个 index.html，打开查看就会发现，不仅有我们自己指定的内容，还把<code>app.js</code>也自动引入了，这波操作够可以。</p><h4 id="Babel-处理脚本"><a href="#Babel-处理脚本" class="headerlink" title="Babel 处理脚本"></a>Babel 处理脚本</h4><p>文档：<a href="https://www.webpackjs.com/loaders/babel-loader/" target="_blank" rel="noopener">babel-loader</a></p><p>安装 babel</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add babel-loader@7.1.2 babel-core@6.26.0 babel-preset-env@1.6.1 --dev</span><br></pre></td></tr></table></figure><p>设置 config 文件：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      exclude: <span class="regexp">/(node_modules)/</span>, <span class="comment">// 忽略此文件</span></span><br><span class="line">      use: &#123;</span><br><span class="line">        loader: <span class="string">"babel-loader"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          presets: [<span class="string">"env"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后修改 <code>src/index.js</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">"people"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Man</span> <span class="keyword">extends</span> <span class="title">People</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">super</span>(name);</span><br><span class="line">    <span class="keyword">this</span>.age = <span class="number">27</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行：<code>node_modules/.bin/webpack</code>，然后再去<code>dist/app.js</code>，就会发现已经转译成功：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> People = <span class="function"><span class="keyword">function</span> <span class="title">People</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  _classCallCheck(<span class="keyword">this</span>, People);</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">"people"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Man = (<span class="function"><span class="keyword">function</span>(<span class="params">_People</span>) </span>&#123;</span><br><span class="line">  _inherits(Man, _People);</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Man</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    _classCallCheck(<span class="keyword">this</span>, Man);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> _this = _possibleConstructorReturn(</span><br><span class="line">      <span class="keyword">this</span>,</span><br><span class="line">      (Man.__proto__ || <span class="built_in">Object</span>.getPrototypeOf(Man)).call(<span class="keyword">this</span>, name)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    _this.age = <span class="number">27</span>;</span><br><span class="line">    <span class="keyword">return</span> _this;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Man;</span><br><span class="line">&#125;)(People);</span><br></pre></td></tr></table></figure><h4 id="配置-React"><a href="#配置-React" class="headerlink" title="配置 React"></a>配置 React</h4><p>安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add babel-preset-react@6.24.1 --dev</span><br><span class="line">yarn add react@16.2.0 react-dom@16.2.0</span><br></pre></td></tr></table></figure><p>设置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.jsx$/</span>,</span><br><span class="line">      exclude: <span class="regexp">/(node_modules)/</span>,</span><br><span class="line">      use: &#123;</span><br><span class="line">        loader: <span class="string">"babel-loader"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          presets: [<span class="string">"env"</span>, <span class="string">"react"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这时候的入口文件也需要更改下测试</span></span><br><span class="line">entry: <span class="string">'./src/index.jsx'</span>,</span><br></pre></td></tr></table></figure><p>然后修改 <code>src/index.js</code> 为 <code>src/index.jsx</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, React.<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>));</span><br></pre></td></tr></table></figure><p>运行：<code>node_modules/.bin/webpack</code>，然后再去<code>dist/app.js</code>，查找如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">_reactDom2.default.render(</span><br><span class="line">  _react2.default.createElement(<span class="string">"h1"</span>, <span class="literal">null</span>, <span class="string">"Hello, React."</span>),</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>那么，表示解析 .jsx 成功。</p><h4 id="解析-CSS"><a href="#解析-CSS" class="headerlink" title="解析 CSS"></a>解析 CSS</h4><p>安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add style-loader@0.19.1 css-loader@0.28.8 --dev</span><br></pre></td></tr></table></figure><p>设置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">  use: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 index.jsx 里添加：<code>import &#39;./style.css&#39;;</code>，在<code>style.css</code>添加一些：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接着跑一下：<code>node_modules/.bin/webpack</code>，再接着去 dist 下的 app.js 找找：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module</span></span><br><span class="line">exports.push([<span class="built_in">module</span>.i, <span class="string">"body &#123;\n  color: red;\n  font-size: 16px;\n&#125;"</span>, <span class="string">""</span>]);</span><br></pre></td></tr></table></figure><p>嗯，已经被解析并添加到 app.js 文件中。但是，我们有时候需要大量的 css 文件，并需要 js 解析，那就需要个插件单独处理：<a href="https://webpack.js.org/plugins/extract-text-webpack-plugin/#root" target="_blank" rel="noopener">ExtractTextWebpackPlugin</a>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add extract-text-webpack-plugin@3.0.2 --dev</span><br></pre></td></tr></table></figure><p>设置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">    template: <span class="string">"./src/index.html"</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="comment">// Add</span></span><br><span class="line">  <span class="keyword">new</span> ExtractTextWebpackPlugin(<span class="string">"styles.css"</span>),</span><br><span class="line">],</span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    <span class="comment">// Add</span></span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">      use: ExtractTextWebpackPlugin.extract(&#123;</span><br><span class="line">        fallback: <span class="string">"style-loader"</span>,</span><br><span class="line">        use: <span class="string">"css-loader"</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后跑一下，dist 下就会出现我们设置的 <code>styles.css</code> 文件，并且会自动添加至 <code>index.html</code>:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"style.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br></pre></td></tr></table></figure><h4 id="解析-scss"><a href="#解析-scss" class="headerlink" title="解析 scss"></a>解析 scss</h4><p>安装: sass-loader node-sass</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add sass-loader@6.0.6 node-sass@4.7.2 --dev</span><br></pre></td></tr></table></figure><p>设置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">  use: ExtractTextWebpackPlugin.extract(&#123;</span><br><span class="line">    fallback: <span class="string">"style-loader"</span>,</span><br><span class="line">    use: [<span class="string">"css-loader"</span>, <span class="string">"sass-loader"</span>]</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这时候，我们去 src 下新建一个 <code>app.scss</code>:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  h1 &#123;</span><br><span class="line">    <span class="selector-tag">color</span>: <span class="selector-tag">blue</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>并且在 <code>index.jsx</code> 中引入：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"./style.css"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./app.scss"</span>;</span><br></pre></td></tr></table></figure><p>接着，跑一下看看，刷~的一声，打开 dist 下的 <code>styles.css</code>，看看是不是我们引入的内容：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span> <span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试通过，完美！</p><h4 id="处理图片资源"><a href="#处理图片资源" class="headerlink" title="处理图片资源"></a>处理图片资源</h4><p>安装：<a href="https://webpack.js.org/loaders/url-loader/#root" target="_blank" rel="noopener">url-loader</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add file-loader@1.1.6 url-loader@0.6.2 --dev</span><br></pre></td></tr></table></figure><p>设置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">  use: [</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'url-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        limit: <span class="number">8192</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同样的 src 下找张图片，测试下是否通过，在 <code>index.jsx</code> 里添加：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ImgSrc <span class="keyword">from</span> <span class="string">"./react.png"</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h1&gt;Hello, React.&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;img src=&#123;ImgSrc&#125; alt="react" /</span>&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById("root")</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><p>然后跑一下，发现：如果图片大于 limit 的设置（8kb=8192/1024kb）就会出现在 dist 目录下，否则会以 base64 格式直接引入使用。</p><h4 id="处理-fonts-字体"><a href="#处理-fonts-字体" class="headerlink" title="处理 fonts 字体"></a>处理 fonts 字体</h4><p>先下载个<a href="http://www.fontawesome.com.cn/get-started/" target="_blank" rel="noopener">Font Awesome</a>试试水：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add font-awesome</span><br></pre></td></tr></table></figure><p>设置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.(woff|woff2|eot|ttf|otf|svg)$/</span>,</span><br><span class="line">  use: [</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'url-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        limit: <span class="number">8192</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后按照以下几个步骤来试水：</p><ul><li>复制 <code>font-awesome/</code> 目录到你的项目中</li><li>只保留 fonts 文件 和 scss 文件里的内容，其他可以删除</li><li>最后去你的主文件：<code>app.scss</code> 添加它：</li></ul><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$fa-font-path</span>: <span class="string">"./font-awesome/fonts"</span>;</span><br><span class="line">@<span class="keyword">import</span> <span class="string">"./font-awesome/scss/font-awesome.scss"</span>;</span><br></pre></td></tr></table></figure><p>接着我们跑一下：<code>node_modules/.bin/webpack</code>，dist 下瞬间就会出现一堆文件，表示测试通过。</p><h4 id="公共模块"><a href="#公共模块" class="headerlink" title="公共模块"></a>公共模块</h4><p><a href="https://webpack.docschina.org/plugins/commons-chunk-plugin/#%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener">CommonsChunkPlugin</a>插件，是一个可选的用于建立一个独立文件(又称作 chunk)的功能，这个文件包括多个入口 chunk 的公共模块。</p><p>先访问缓存中的公共代码，加快浏览器的访问速度。</p><p>设置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">"webpack"</span>);</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">  name: <span class="string">'commons'</span>, <span class="comment">// 公共 chunk 的名称</span></span><br><span class="line">  filename: <span class="string">'js/base.js'</span>  <span class="comment">// 公共 chunk 的文件名</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure><h4 id="使用-webpack-dev-server"><a href="#使用-webpack-dev-server" class="headerlink" title="使用 webpack-dev-server"></a>使用 webpack-dev-server</h4><p><code>webpack-dev-server</code> 为你提供了一个简单的 <code>web server</code>，并且具有 <code>live reloading</code>(实时重新加载) 功能。</p><p>安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add webpack-dev-server@2.9.7 --dev</span><br></pre></td></tr></table></figure><p>修改配置文件，告诉 <code>dev server</code>，从什么位置查找文件：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">  contentBase: <span class="string">'./dist'</span>,</span><br><span class="line">  port: <span class="number">8082</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接着去 <code>package.json</code>里添加一个可以直接运行 <code>dev server</code> 的 script：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "start": "webpack-dev-server --open",</span><br><span class="line">  "build": "webpack"</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>这样就不用每次都去访问 <code>node_modules/.bin/webpack</code> 了，直接启动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动 dev server</span></span><br><span class="line">npm start</span><br><span class="line"><span class="comment"># 打包构建</span></span><br><span class="line">npm run build</span><br></pre></td></tr></table></figure><h4 id="清理-dist-文件夹"><a href="#清理-dist-文件夹" class="headerlink" title="清理 /dist 文件夹"></a>清理 /dist 文件夹</h4><p>需求：每次 <code>build</code> 的时候，发现 <code>/dist</code> 下的文件一直会堆砌，能不能每次构建的时候，只生成项目中真正在使用的文件？</p><p>方法：在每次构建前清理 <code>/dist</code> 文件夹，这样只会生成用到的文件。</p><p>使用 <code>clean-webpack-plugin</code> 插件来进行清理:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add clean-webpack-plugin --dev</span><br></pre></td></tr></table></figure><p>设置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">"clean-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> CleanWebpackPlugin();</span><br></pre></td></tr></table></figure><h4 id="模块热替换-HMR"><a href="#模块热替换-HMR" class="headerlink" title="模块热替换 HMR"></a>模块热替换 HMR</h4><p>需求：在开发环境下，可不可以每次保存之后，不用刷新浏览器，就自动更新了呢？</p><p>方法：<a href="https://webpack.docschina.org/guides/hot-module-replacement/" target="_blank" rel="noopener">模块热替换</a>(<code>hot module replacement</code> 或 <code>HMR</code>)，只更新改动的文件。</p><p>设置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">"webpack"</span>);</span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">],</span><br><span class="line">devServer: &#123;</span><br><span class="line">  contentBase: <span class="string">'./dist'</span>,</span><br><span class="line">  hot: <span class="literal">true</span>,  <span class="comment">// 开启</span></span><br><span class="line">  port: <span class="number">8082</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样，重启服务，然后修改 <code>index.jsx</code> 文件，就会发现自动更新了，妈妈再也不用担心我的 F5 了…</p><h4 id="启动-Server"><a href="#启动-Server" class="headerlink" title="启动 Server"></a>启动 Server</h4><p><code>webpack-dev-middleware</code> 是一个封装器(<code>wrapper</code>)，它可以把 <code>webpack</code> 处理过的文件发送到一个 <code>server</code>。</p><p>安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add webpack-dev-middleware@2.0.6 --dev</span><br><span class="line">yarn add express --dev</span><br></pre></td></tr></table></figure><p>根目录新建一个 <code>server.js</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">"webpack"</span>);</span><br><span class="line"><span class="keyword">const</span> webpackDevMiddleware = <span class="built_in">require</span>(<span class="string">"webpack-dev-middleware"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">"./webpack.config.js"</span>);</span><br><span class="line"><span class="keyword">const</span> compiler = webpack(config);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 告诉 express 使用 webpack-dev-middleware，</span></span><br><span class="line"><span class="comment">// 以及将 webpack.config.js 配置文件作为基础配置</span></span><br><span class="line">app.use(</span><br><span class="line">  webpackDevMiddleware(compiler, &#123;</span><br><span class="line">    publicPath: config.output.publicPath</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用配置文件的端口号</span></span><br><span class="line">app.listen(config.devServer.port, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Example app listening on port <span class="subst">$&#123;config.devServer.port&#125;</span>!\n`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>我们将会在 server 脚本使用 publicPath，以确保文件资源能够正确地 serve 在 <a href="http://localhost:8082" target="_blank" rel="noopener">http://localhost:8082</a> 下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">  path: path.resolve(__dirname, <span class="string">"dist"</span>),</span><br><span class="line">  filename: <span class="string">"app.js"</span>,</span><br><span class="line">  publicPath: <span class="string">'/'</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>接着，添加一个 <code>npm script</code>：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"server": "node server.js"</span><br></pre></td></tr></table></figure><p>跑一下：<code>npm run server</code>，访问 <code>http://localhost:8082/</code>，完美运行。</p><h4 id="最后的配置文件"><a href="#最后的配置文件" class="headerlink" title="最后的配置文件"></a>最后的配置文件</h4><p>webpack.config.js:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">"webpack"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> ExtractTextWebpackPlugin = <span class="built_in">require</span>(<span class="string">"extract-text-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">"clean-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">"./src/index.jsx"</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">"dist"</span>),</span><br><span class="line">    filename: <span class="string">"app.js"</span>,</span><br><span class="line">    publicPath: <span class="string">"/"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    contentBase: <span class="string">"./dist"</span>,</span><br><span class="line">    hot: <span class="literal">true</span>,</span><br><span class="line">    port: <span class="number">8082</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">"./src/index.html"</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> ExtractTextWebpackPlugin(<span class="string">"styles.css"</span>),</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: <span class="string">"commons"</span>,</span><br><span class="line">      filename: <span class="string">"js/base.js"</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">  ],</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(js|jsx)$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/(node_modules)/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">"babel-loader"</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            presets: [<span class="string">"env"</span>, <span class="string">"react"</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(sc|c)ss$/</span>,</span><br><span class="line">        use: ExtractTextWebpackPlugin.extract(&#123;</span><br><span class="line">          fallback: <span class="string">"style-loader"</span>,</span><br><span class="line">          use: [<span class="string">"css-loader"</span>, <span class="string">"sass-loader"</span>]</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">"url-loader"</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">8192</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(woff|woff2|eot|ttf|otf|svg)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">"url-loader"</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">8192</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="项目目录结构"><a href="#项目目录结构" class="headerlink" title="项目目录结构"></a>项目目录结构</h4><p>关于 tree 的使用总结：<a href="https://www.jianshu.com/p/6b57f6e40d64" target="_blank" rel="noopener">MacOS 如何使用 tree 生成目录结构</a></p><p>常用命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载</span></span><br><span class="line">brew install tree</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个文件夹下的所有文件</span></span><br><span class="line">tree -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只显示文件夹</span></span><br><span class="line">tree -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示项目的层级，如三级</span></span><br><span class="line">tree -L 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤，如除node_modules文件</span></span><br><span class="line">tree -I <span class="string">"node_modules"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">tree &gt; tree.md</span><br><span class="line"></span><br><span class="line"><span class="comment"># Help</span></span><br><span class="line">tree --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后，我的输出：</span></span><br><span class="line">tree -I <span class="string">"node_modules"</span> &gt; tree.md</span><br></pre></td></tr></table></figure><p>tree.md 的内容为：</p><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">├── dist</span><br><span class="line">├── package.json</span><br><span class="line">├── server.js</span><br><span class="line">├── src</span><br><span class="line">│   ├── app.scss</span><br><span class="line">│   ├── font-awesome</span><br><span class="line">│   │   ├── fonts</span><br><span class="line">│   │   │   ├── FontAwesome.otf</span><br><span class="line">│   │   │   ├── fontawesome-webfont.eot</span><br><span class="line">│   │   │   ├── fontawesome-webfont.svg</span><br><span class="line">│   │   │   ├── fontawesome-webfont.ttf</span><br><span class="line">│   │   │   ├── fontawesome-webfont.woff</span><br><span class="line">│   │   │   └── fontawesome-webfont.woff2</span><br><span class="line">│   │   └── scss</span><br><span class="line">│   │   ├── \_animated.scss</span><br><span class="line">│   │   ├── \_bordered-pulled.scss</span><br><span class="line">│   │   ├── \_core.scss</span><br><span class="line">│   │   ├── \_fixed-width.scss</span><br><span class="line">│   │   ├── \_icons.scss</span><br><span class="line">│   │   ├── \_larger.scss</span><br><span class="line">│   │   ├── \_list.scss</span><br><span class="line">│   │   ├── \_mixins.scss</span><br><span class="line">│   │   ├── \_path.scss</span><br><span class="line">│   │   ├── \_rotated-flipped.scss</span><br><span class="line">│   │   ├── \_screen-reader.scss</span><br><span class="line">│   │   ├── \_stacked.scss</span><br><span class="line">│   │   ├── \_variables.scss</span><br><span class="line">│   │   └── font-awesome.scss</span><br><span class="line">│   ├── index.html</span><br><span class="line">│   ├── index.js</span><br><span class="line">│   ├── index.jsx</span><br><span class="line">│   ├── react.png</span><br><span class="line">│   └── style.css</span><br><span class="line">├── tree.md</span><br><span class="line">├── webpack.config.js</span><br><span class="line">└── yarn.lock</span><br><span class="line"></span><br><span class="line">5 directories, 32 files</span><br></pre></td></tr></table></figure><h4 id="项目启动"><a href="#项目启动" class="headerlink" title="项目启动"></a>项目启动</h4><blockquote><p>项目里的每一次 <code>Commits</code>，基本上对应着相应的文件配置，可以对照着瞅瞅。</p></blockquote><p>克隆一份项目</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/yangtao2o/happymmall.git</span><br></pre></td></tr></table></figure><p>进入目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> happymmall</span><br></pre></td></tr></table></figure><p>切换分支至 webpack@3-react</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜  happymmall git:(master) git checkout webpack@3-react</span><br></pre></td></tr></table></figure><p>下载依赖包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜  happymmall git:(webpack@3-react) yarn install</span><br></pre></td></tr></table></figure><p>启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜  happymmall git:(webpack@3-react) npm start</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 前端框架 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>入门学习 React 一些实例</title>
      <link href="/2019/08/02/react-demo/"/>
      <url>/2019/08/02/react-demo/</url>
      
        <content type="html"><![CDATA[<blockquote><p>这是几个入门学习 React 的小 Demo，帮助自己学习了解 React 的运行机制，结合 <a href="https://zh-hans.reactjs.org/docs/getting-started.html" target="_blank" rel="noopener">React官方文档</a>，会更佳噢…</p></blockquote><a id="more"></a><h2 id="DEMO-目录"><a href="#DEMO-目录" class="headerlink" title="DEMO 目录"></a>DEMO 目录</h2><ol><li><a href="https://istaotao.com/myreact/demo/01/" target="_blank" rel="noopener">ReactDOM.render()</a></li><li><a href="https://istaotao.com/myreact/demo/02/" target="_blank" rel="noopener">Use Array in JSX</a></li><li><a href="https://istaotao.com/myreact/demo/03/" target="_blank" rel="noopener">组件</a></li><li><a href="https://istaotao.com/myreact/demo/04/" target="_blank" rel="noopener">this.props.children</a></li><li><a href="https://istaotao.com/myreact/demo/05/" target="_blank" rel="noopener">PropTypes</a></li><li><a href="https://istaotao.com/myreact/demo/06/" target="_blank" rel="noopener">获取真实的 DOM 节点</a></li><li><a href="https://istaotao.com/myreact/demo/07/" target="_blank" rel="noopener">this.state</a></li><li><a href="https://istaotao.com/myreact/demo/08/" target="_blank" rel="noopener">表单</a></li><li><a href="https://istaotao.com/myreact/demo/09/" target="_blank" rel="noopener">组件的生命周期</a></li><li><a href="https://istaotao.com/myreact/demo/10/" target="_blank" rel="noopener">使用 Promise 获取 Github 的数据</a></li><li><a href="https://istaotao.com/myreact/demo/11/" target="_blank" rel="noopener">Todo List</a></li><li><a href="https://istaotao.com/myreact/demo/12/" target="_blank" rel="noopener">井字棋（Tic Tac Toe）</a></li></ol><p>引入资源 <a href="https://babeljs.io/en/setup/#installation" target="_blank" rel="noopener">With babel-standalone</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"output"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;!-- Load Babel --&gt;</span><br><span class="line">&lt;!-- v6 &lt;script src=<span class="string">"https://unpkg.com/babel-standalone@6/babel.min.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span> --&gt;</span><br><span class="line">&lt;script src=<span class="string">"https://unpkg.com/@babel/standalone/babel.min.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;!-- Your custom script here --&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/babel"</span>&gt;</span><br><span class="line"><span class="keyword">const</span> getMessage = <span class="function"><span class="params">()</span> =&gt;</span> <span class="string">"Hello World"</span>;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'output'</span>).innerHTML = getMessage();</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Demo01-ReactDOM-render"><a href="#Demo01-ReactDOM-render" class="headerlink" title="Demo01: ReactDOM.render()"></a>Demo01: ReactDOM.render()</h3><p><a href="https://istaotao.com/myreact/demo/01/" target="_blank" rel="noopener">Demo</a> / <a href="https://github.com/yangtao2o/myreact/blob/master/demo/01/index.html" target="_blank" rel="noopener">Source</a></p><p>初始化咱先 Hello 一下，使用 jsx 语法，碰到代码块使用（{ }）包起来，碰到 html 标签，就使用（&lt; /&gt;）:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> names = [<span class="string">"AAA"</span>, <span class="string">"BBB"</span>, <span class="string">"CCC"</span>];</span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &#123;names.map(<span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Hello, &#123;name&#125;!<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">    &#125;)&#125;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById("example")</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><h3 id="Demo02-Use-Array-in-JSX"><a href="#Demo02-Use-Array-in-JSX" class="headerlink" title="Demo02: Use Array in JSX"></a>Demo02: Use Array in JSX</h3><p><a href="https://istaotao.com/myreact/demo/02/" target="_blank" rel="noopener">Demo</a> / <a href="https://github.com/yangtao2o/myreact/blob/master/demo/02/index.html" target="_blank" rel="noopener">Source</a></p><p>如果 JavaScript 的变量是个数组，会展开这个数组的所有项.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">key</span>=<span class="string">"h1"</span>&gt;</span>Hello,<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>, &lt;h2 key=<span class="string">"h2"</span>&gt;React is awesome!<span class="xml"><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>];</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;arr&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">"example"</span>));</span><br></pre></td></tr></table></figure><h3 id="Demo03-组件"><a href="#Demo03-组件" class="headerlink" title="Demo03: 组件"></a>Demo03: 组件</h3><p><a href="https://istaotao.com/myreact/demo/03/" target="_blank" rel="noopener">Demo</a> / <a href="https://github.com/yangtao2o/myreact/blob/master/demo/03/index.html" target="_blank" rel="noopener">Source</a></p><p>变量 HelloMsg 是一个组件类。模板插入 <hellomsg> 时，会自动生成 HelloMsg 的一个实例。所有组件类都必须有自己的 render 方法，用于输出组件。</hellomsg></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloMsg</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;HelloMsg name=<span class="string">"Dataozi"</span> /&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">"example"</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="Demo04-this-props-children"><a href="#Demo04-this-props-children" class="headerlink" title="Demo04: this.props.children"></a>Demo04: this.props.children</h3><p><a href="https://istaotao.com/myreact/demo/04/" target="_blank" rel="noopener">Demo</a> / <a href="https://github.com/yangtao2o/myreact/blob/master/demo/04/index.html" target="_blank" rel="noopener">Source</a></p><p><code>this.props</code> 对象的属性与组件的属性一一对应，但是有一个例外，就是 <code>this.props.children</code> 属性。</p><p>ps: 注意大小写 <code>React.Children</code>、<code>React.Component</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NotesList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ol&gt;</span><br><span class="line">        &#123;React.Children.map(<span class="keyword">this</span>.props.children, <span class="function"><span class="keyword">function</span>(<span class="params">child</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;child&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br><span class="line">        &#125;)&#125;</span><br><span class="line">      &lt;<span class="regexp">/ol&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">ReactDOM.render(</span></span><br><span class="line"><span class="regexp">  &lt;NotesList&gt;</span></span><br><span class="line"><span class="regexp">    &lt;span&gt;Hello&lt;/</span>span&gt;</span><br><span class="line">    &lt;span&gt;World&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &lt;span&gt;React&lt;/</span>span&gt;</span><br><span class="line">  &lt;<span class="regexp">/NotesList&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById("example")</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><h3 id="Demo05-PropTypes"><a href="#Demo05-PropTypes" class="headerlink" title="Demo05: PropTypes"></a>Demo05: PropTypes</h3><p><a href="https://istaotao.com/myreact/demo/05/" target="_blank" rel="noopener">Demo</a> / <a href="https://github.com/yangtao2o/myreact/blob/master/demo/05/index.html" target="_blank" rel="noopener">Source</a></p><ul><li><a href="https://react.docschina.org/docs/typechecking-with-proptypes.html" target="_blank" rel="noopener">使用 PropTypes 进行类型检查</a></li></ul><p>React 内置了一些类型检查的功能。要在组件的 props 上进行类型检查，你只需配置特定的 propTypes 属性:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = &#123;</span><br><span class="line">  tilte: <span class="string">"Hello"</span>,</span><br><span class="line">  age: <span class="number">19</span>,</span><br><span class="line">  isStudent: <span class="literal">true</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTitle</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">    tilte: PropTypes.string,</span><br><span class="line">    age: PropTypes.number,</span><br><span class="line">    isStudent: PropTypes.bool</span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;&#123;<span class="keyword">this</span>.props.data.tilte&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;h2&gt;&#123;this.props.data.age&#125;&lt;/</span>h2&gt;</span><br><span class="line">        &lt;h3&gt;&#123;<span class="keyword">this</span>.props.data.isStudent ? <span class="string">"Yes"</span> : <span class="string">"No"</span>&#125;&lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyTitle</span> <span class="attr">data</span>=<span class="string">&#123;data&#125;</span> /&gt;</span>, document.getElementById("root"));</span></span><br></pre></td></tr></table></figure><p>还可以通过配置特定的 defaultProps 属性来定义 props 的默认值：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DefaultTitle</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;this.props.title&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//指定 props 的默认值：</span></span><br><span class="line">DefaultTitle.defaultProps = &#123;</span><br><span class="line">  title: <span class="string">"Hello React!"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">DefaultTitle</span> /&gt;</span>, document.getElementById("root2"));</span></span><br></pre></td></tr></table></figure><h3 id="Demo06-获取真实的-DOM-节点"><a href="#Demo06-获取真实的-DOM-节点" class="headerlink" title="Demo06: 获取真实的 DOM 节点"></a>Demo06: 获取真实的 DOM 节点</h3><p><a href="https://istaotao.com/myreact/demo/06/" target="_blank" rel="noopener">Demo</a> / <a href="https://github.com/yangtao2o/myreact/blob/master/demo/06/index.html" target="_blank" rel="noopener">Source</a></p><ul><li><a href="https://zh-hans.reactjs.org/docs/refs-and-the-dom.html" target="_blank" rel="noopener">Refs and the DOM</a></li></ul><p>Refs 提供了一种方式，允许我们访问 DOM 节点或在 render 方法中创建的 React 元素。</p><ul><li>创建 Refs: Refs 是由<code>React.createRef()</code>创建的，并通过 ref 属性附加到 React 元素（比如 input）</li><li>访问 Refs: 当 ref 被传递给 render 中的元素时，对该节点的引用可以在 ref 的 current 属性中被访问，<code>this.myTextFocus.current.focus();</code></li></ul><p><strong><em>你不能在函数组件上使用 ref 属性，因为它们没有实例</em></strong></p><p>组件 MyComponent 的子节点有一个文本输入框，用于获取用户的输入。这时就必须获取真实的 DOM 节点，虚拟 DOM 是拿不到用户输入的。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="comment">// 创建一个 ref 来存储 myTextFocus 的 DOM 元素</span></span><br><span class="line">    <span class="keyword">this</span>.myTextFocus = React.createRef();</span><br><span class="line">    <span class="keyword">this</span>.handerClick = <span class="keyword">this</span>.handerClick.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  handerClick() &#123;</span><br><span class="line">    <span class="comment">// 直接使用原生 API 使 text 输入框获得焦点</span></span><br><span class="line">    <span class="comment">// 通过 "current" 来访问 DOM 节点</span></span><br><span class="line">    <span class="keyword">this</span>.myTextFocus.current.focus();</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="comment">// 告诉 React 我们想把 &lt;input&gt; ref 关联到</span></span><br><span class="line">    <span class="comment">// 构造器里创建的 `myTextFocus` 上</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input type=<span class="string">"text"</span> ref=&#123;<span class="keyword">this</span>.myTextFocus&#125; /&gt;</span><br><span class="line">        &lt;input type=<span class="string">"button"</span> value=<span class="string">"点击聚焦"</span> onClick=&#123;<span class="keyword">this</span>.handerClick&#125; /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;MyComponent /</span>&gt;, <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>));</span><br></pre></td></tr></table></figure><h3 id="Demo07-this-state"><a href="#Demo07-this-state" class="headerlink" title="Demo07: this.state"></a>Demo07: this.state</h3><p><a href="https://istaotao.com/myreact/demo/07/" target="_blank" rel="noopener">Demo</a> / <a href="https://github.com/yangtao2o/myreact/blob/master/demo/07/index.html" target="_blank" rel="noopener">Source</a></p><ul><li><a href="https://zh-hans.reactjs.org/docs/state-and-lifecycle.html" target="_blank" rel="noopener">State &amp; 生命周期</a></li></ul><p>学习如何封装真正可复用的 Clock 组件。它将设置自己的计时器并每秒更新一次。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clock</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123; <span class="attr">date</span>: <span class="keyword">new</span> <span class="built_in">Date</span>() &#125;; <span class="comment">//为 this.state 赋初值</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="comment">// Clock初次被渲染到DOM时，为其挂载一个计时器</span></span><br><span class="line">    <span class="keyword">this</span>.timerID = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.tick(), <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentWillUnmount() &#123;</span><br><span class="line">    <span class="comment">// Clock被删除时，卸载其计时器</span></span><br><span class="line">    clearInterval(<span class="keyword">this</span>.timerID);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  tick() &#123;</span><br><span class="line">    <span class="comment">// 使用 this.setState() 来时刻更新组件 state</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">date</span>: <span class="keyword">new</span> <span class="built_in">Date</span>() &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;Hello, React!<span class="xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">        &lt;h2&gt;现在是北京时间：&#123;<span class="keyword">this</span>.state.date.toLocaleTimeString()&#125;&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Clock</span> /&gt;</span>, document.getElementById("root"));</span></span><br></pre></td></tr></table></figure><h3 id="Demo08-表单"><a href="#Demo08-表单" class="headerlink" title="Demo08: 表单"></a>Demo08: 表单</h3><p><a href="https://istaotao.com/myreact/demo/08/" target="_blank" rel="noopener">Demo</a> / <a href="https://github.com/yangtao2o/myreact/blob/master/demo/08/index.html" target="_blank" rel="noopener">Source</a></p><ul><li><a href="https://zh-hans.reactjs.org/docs/forms.html" target="_blank" rel="noopener">表单</a></li></ul><p>受控组件：渲染表单的 React 组件还控制着用户输入过程中表单发生的操作，被 React 以这种方式控制取值的表单输入元素就叫做“受控组件”。</p><p>即：表单数据是由 React 组件来管理的。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NameForm</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      <span class="comment">// 唯一数据源</span></span><br><span class="line">      value: <span class="string">""</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.handleChange = <span class="keyword">this</span>.handleChange.bind(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.handleSubmit = <span class="keyword">this</span>.handleSubmit.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  handleChange(event) &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      value: event.target.value <span class="comment">// 显示的值将随着用户输入而更新</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  handleSubmit(event) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state.value) &#123;</span><br><span class="line">      alert(<span class="string">"接受到的name值是："</span> + <span class="keyword">this</span>.state.value);</span><br><span class="line">    &#125;</span><br><span class="line">    event.preventDefault();</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;form onSubmit=&#123;<span class="keyword">this</span>.handleSubmit&#125;&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          type=<span class="string">"text"</span></span><br><span class="line">          value=&#123;<span class="keyword">this</span>.state.value&#125;</span><br><span class="line">          onChange=&#123;<span class="keyword">this</span>.handleChange&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;input type=<span class="string">"submit"</span> value=<span class="string">"提交"</span> /&gt;</span><br><span class="line">      &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;NameForm /</span>&gt;, <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>));</span><br></pre></td></tr></table></figure><p><a href="https://zh-hans.reactjs.org/docs/uncontrolled-components.html" target="_blank" rel="noopener">非受控组件</a>：表单数据将交由 DOM 节点来处理，即使用 ref 来从 DOM 节点中获取表单数据</p><p><a href="https://istaotao.com/myreact/demo/08-1/" target="_blank" rel="noopener">Demo</a> / <a href="https://github.com/yangtao2o/myreact/blob/master/demo/08-1/index.html" target="_blank" rel="noopener">Source</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NameForm</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.input = React.createRef();</span><br><span class="line">    <span class="keyword">this</span>.handleSubmit = <span class="keyword">this</span>.handleSubmit.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  handleSubmit(event) &#123;</span><br><span class="line">    alert(<span class="string">"接受到的name值是："</span> + <span class="keyword">this</span>.input.current.value);</span><br><span class="line">    event.preventDefault();</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;form onSubmit=&#123;<span class="keyword">this</span>.handleSubmit&#125;&gt;</span><br><span class="line">        &lt;input type=<span class="string">"text"</span> ref=&#123;<span class="keyword">this</span>.input&#125; /&gt;</span><br><span class="line">        &lt;input type=<span class="string">"submit"</span> value=<span class="string">"提交"</span> /&gt;</span><br><span class="line">      &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;NameForm /</span>&gt;, <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>));</span><br></pre></td></tr></table></figure><h3 id="Demo09-组件的生命周期"><a href="#Demo09-组件的生命周期" class="headerlink" title="Demo09: 组件的生命周期"></a>Demo09: 组件的生命周期</h3><p><a href="https://istaotao.com/myreact/demo/09/" target="_blank" rel="noopener">Demo</a> / <a href="https://github.com/yangtao2o/myreact/blob/master/demo/09/index.html" target="_blank" rel="noopener">Source</a></p><ul><li><a href="https://zh-hans.reactjs.org/docs/react-component.html" target="_blank" rel="noopener">组件的生命周期</a></li><li><a href="http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/" target="_blank" rel="noopener">生命周期图谱速查表</a></li><li><a href="https://www.yuque.com/ant-design/course/lifemethods" target="_blank" rel="noopener">React 的生命周期</a> — Ant Design 语雀</li></ul><p>主要路线顺序：挂载 - 更新 - 卸载 - 错误处理</p><p><strong>挂载</strong></p><p>当组件实例被创建并插入 DOM 中时，其生命周期调用如下：</p><ul><li>consctructor() — React 组件的构造函数，不初始化 state 或不进行方法绑定，则不需要</li><li>static getDerivedStateFromProps() — 不常用</li><li>render() — 唯一必须实现的方法，并且应该是纯函数</li><li>componentDidMount() — 依赖于 DOM 节点的初始化应该在这里</li></ul><p><strong>更新</strong></p><p>当组件的 props 或 state 发生变化时，会触发更新：</p><ul><li>static getDerivedStateFromProps()</li><li>shouldComponentUpdate()</li><li>render()</li><li>getSnapshotBeforeUpdate() — 不常用</li><li>componentDidUpdate() — 在更新后会被立即调用</li></ul><p><strong>卸载</strong></p><p>当组件从 DOM 中移除时：</p><ul><li>componentWillUnmount() — 会在组件卸载及销毁之前直接调用</li></ul><p><strong>错误处理</strong></p><p>当渲染过程，生命周期，或子组件的构造函数中抛出错误时：</p><ul><li>static getDerivedStateFromError()</li><li>componentDidCatch()</li></ul><p>过期的生命周期方法：</p><ul><li>UNSAFE_componentWillMount() — 挂载前调用，目前使用 constructor()初始化 state</li><li>UNSAFE_componentWillReceiveProps()</li><li>UNSAFE_componentWillUpdate()</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hello</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      fontSize: <span class="number">12</span>,</span><br><span class="line">      opacity: <span class="number">0.01</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.timerID = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> opacity = <span class="keyword">this</span>.state.opacity;</span><br><span class="line">      <span class="keyword">let</span> fontSize = <span class="keyword">this</span>.state.fontSize;</span><br><span class="line">      opacity += <span class="number">0.02</span>;</span><br><span class="line">      fontSize += <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> (opacity &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        opacity = <span class="number">0.01</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (fontSize &gt;= <span class="number">63</span>) &#123;</span><br><span class="line">        fontSize = <span class="number">12</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        fontSize,</span><br><span class="line">        opacity</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;, <span class="number">100</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillUnmount() &#123;</span><br><span class="line">    clearInterval(<span class="keyword">this</span>.timerID);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;h1</span><br><span class="line">        style=&#123;&#123; <span class="attr">opacity</span>: <span class="keyword">this</span>.state.opacity, <span class="attr">fontSize</span>: <span class="keyword">this</span>.state.fontSize &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        Hello, &#123;<span class="keyword">this</span>.props.name&#125;</span><br><span class="line">      &lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;Hello name="React" /</span>&gt;, <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>));</span><br></pre></td></tr></table></figure><h3 id="Demo10-使用-Promise-获取-Github-的数据"><a href="#Demo10-使用-Promise-获取-Github-的数据" class="headerlink" title="Demo10: 使用 Promise 获取 Github 的数据"></a>Demo10: 使用 Promise 获取 Github 的数据</h3><p><a href="https://istaotao.com/myreact/demo/10/" target="_blank" rel="noopener">Demo</a> / <a href="https://github.com/yangtao2o/myreact/blob/master/demo/10/index.html" target="_blank" rel="noopener">Source</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;ReportList</span><br><span class="line">    promise=&#123;$.getJSON(</span><br><span class="line">      <span class="string">"https://api.github.com/search/repositories?q=javascript&amp;sort=stars"</span></span><br><span class="line">    )&#125;</span><br><span class="line">  /&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>从 Github 的 API 抓取数据，然后将 Promise 对象作为属性，传给 ReportList 组件。</p><p>如果 Promise 对象正在抓取数据（pending 状态），组件显示”loading…”；</p><p>如果 Promise 对象报错（rejected 状态），组件显示报错信息；</p><p>如果 Promise 对象抓取数据成功（fulfilled 状态），组件显示获取的数据。</p><p><a href="https://istaotao.com/myreact/demo/11/" target="_blank" rel="noopener">在这里查看完整 Demo</a>/<a href="https://github.com/yangtao2o/myreact/blob/master/demo/11/index.html" target="_blank" rel="noopener">源码</a> — 谷歌浏览器有时候会报跨域的问题，可以使用火狐等浏览器试看</p><h2 id="接下来来几个混合实战吧"><a href="#接下来来几个混合实战吧" class="headerlink" title="接下来来几个混合实战吧"></a>接下来来几个混合实战吧</h2><h3 id="Demo11-Todo-List"><a href="#Demo11-Todo-List" class="headerlink" title="Demo11: Todo List"></a>Demo11: Todo List</h3><p><a href="https://istaotao.com/myreact/demo/11/" target="_blank" rel="noopener">Demo</a> / <a href="https://github.com/yangtao2o/myreact/blob/master/demo/11/index.html" target="_blank" rel="noopener">Source</a></p><ul><li><a href="https://codepen.io/marekdano/pen/bVNYpq" target="_blank" rel="noopener">React todo list</a></li></ul><p>主要练习使用 <code>props</code> 和 <code>state</code>，使用 state 保存现有的待办事项列表及用户的一些操作（删除、完成）等。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoApp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      items: []</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.addItem = <span class="keyword">this</span>.addItem.bind(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.deleteItem = <span class="keyword">this</span>.deleteItem.bind(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.doneItem = <span class="keyword">this</span>.doneItem.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  addItem(item) &#123;</span><br><span class="line">    <span class="keyword">const</span> newItem = &#123;</span><br><span class="line">      text: item.text,</span><br><span class="line">      id: <span class="built_in">Date</span>.now(),</span><br><span class="line">      done: <span class="literal">false</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      items: <span class="keyword">this</span>.state.items.concat(newItem)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  deleteItem(index) &#123;</span><br><span class="line">    <span class="keyword">this</span>.state.items.splice(index, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      items: <span class="keyword">this</span>.state.items</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  doneItem(index) &#123;</span><br><span class="line">    <span class="keyword">const</span> items = <span class="keyword">this</span>.state.items;</span><br><span class="line">    <span class="keyword">const</span> todo = items[index];</span><br><span class="line">    items.splice(index, <span class="number">1</span>);</span><br><span class="line">    todo.done = !todo.done;</span><br><span class="line">    todo.done ? items.unshift(todo) : items.push(todo);</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; items &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;h1&gt;TODO&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;TodoList</span></span><br><span class="line"><span class="regexp">          items=&#123;this.state.items&#125;</span></span><br><span class="line"><span class="regexp">          deleteClick=&#123;this.deleteItem&#125;</span></span><br><span class="line"><span class="regexp">          doneClick=&#123;this.doneItem&#125;</span></span><br><span class="line"><span class="regexp">        /</span>&gt;</span><br><span class="line">        &lt;TodoForm addItem=&#123;<span class="keyword">this</span>.addItem&#125; items=&#123;<span class="keyword">this</span>.state.items&#125; /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Demo12-井字棋（Tic-Tac-Toe）"><a href="#Demo12-井字棋（Tic-Tac-Toe）" class="headerlink" title="Demo12: 井字棋（Tic Tac Toe）"></a>Demo12: 井字棋（Tic Tac Toe）</h3><p><a href="https://istaotao.com/myreact/demo/12/" target="_blank" rel="noopener">Demo</a> / <a href="https://github.com/yangtao2o/myreact/blob/master/demo/12/index.html" target="_blank" rel="noopener">Source</a></p><ul><li><a href="https://codepen.io/gaearon/pen/gWWZgR?editors=0010" target="_blank" rel="noopener">Tic Tac Toe</a></li><li><a href="https://zh-hans.reactjs.org/tutorial/tutorial.html#inspecting-the-starter-code" target="_blank" rel="noopener">井字棋游戏教程文档</a></li><li><a href="https://www.bbsmax.com/A/8Bz8kVodxg/" target="_blank" rel="noopener">React 的井字过三关</a></li></ul><h4 id="tic-tac-toe-三连棋-游戏的功能"><a href="#tic-tac-toe-三连棋-游戏的功能" class="headerlink" title="tic-tac-toe(三连棋)游戏的功能"></a>tic-tac-toe(三连棋)游戏的功能</h4><ul><li>能够判定玩家何时获胜</li><li>能够记录游戏进程</li><li>允许玩家查看游戏的历史记录，也可以查看任意一个历史版本的游戏棋盘状态</li><li>在游戏历史记录列表显示每一步棋的坐标，格式为 (列号, 行号)</li><li>在历史记录列表中加粗显示当前选择的项目</li><li>当无人获胜时，显示一个平局的消息</li><li style="list-style: none"><input type="checkbox"> 使用两个循环来渲染出棋盘的格子，而不是在代码里写死（hardcode）</li><li style="list-style: none"><input type="checkbox"> 添加一个可以升序或降序显示历史记录的按钮</li><li style="list-style: none"><input type="checkbox"> 每当有人获胜时，高亮显示连成一线的 3 颗棋子</li></ul><h2 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h2><ul><li><a href="http://www.ruanyifeng.com/blog/2015/03/react.html" target="_blank" rel="noopener">React 入门实例教程</a> — 阮一峰</li><li><a href="https://github.com/ruanyf/react-demos" target="_blank" rel="noopener">react-demos</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 前端框架 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> react </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nodejs 日常杂记</title>
      <link href="/2019/07/10/node-learning/"/>
      <url>/2019/07/10/node-learning/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Node.js® is a JavaScript runtime built on <code>Chrome&#39;s V8 JavaScript engine</code>. Node.js uses an <code>event-driven</code>, <code>non-blocking I/O model</code> that makes it lightweight and efficient. Node.js’ package ecosystem, <code>npm</code>, is the largest ecosystem of open source libraries in the world.</p></blockquote><a id="more"></a><h2 id="学习书籍-视频"><a href="#学习书籍-视频" class="headerlink" title="学习书籍|视频"></a>学习书籍|视频</h2><ul><li><a href="https://www.runoob.com/nodejs/nodejs-tutorial.html" target="_blank" rel="noopener">菜鸟教程</a> - 文档</li><li><a href="http://nqdeng.github.io/7-days-nodejs/#1.1" target="_blank" rel="noopener">7-days-nodejs</a> - 文章</li><li><a href="https://github.com/alsotang/node-lessons" target="_blank" rel="noopener">《Node.js 包教不包会》</a> – 文章</li><li>《了不起的 Node.js：将 JavaScript 进行到底》- 书籍</li><li>《新时期的 Node.js 入门》- 书籍</li><li><a href="https://coding.imooc.com/class/320.html" target="_blank" rel="noopener">Node.js 从零开发 Web Server 博客项目 前端晋升全栈工程师必备</a> - 视频</li></ul><h2 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h2><ul><li><a href="https://cnodejs.org/getstart" target="_blank" rel="noopener">Node.js 入门</a></li><li><a href="https://nodejs.org/en/" target="_blank" rel="noopener">Node.js 官方文档</a></li><li><a href="https://cnodejs.org/" target="_blank" rel="noopener">CNode：Node.js 专业中文社区</a></li><li><a href="https://segmentfault.com/a/1190000013933520" target="_blank" rel="noopener">【全文】狼叔：如何正确的学习 Node.js</a></li><li><a href="http://www.expressjs.com.cn/guide/routing.html" target="_blank" rel="noopener">Express-4.x 官方指南</a></li><li><a href="https://www.jianshu.com/p/406f6df0f916" target="_blank" rel="noopener">react 全家桶+express 实战个人博客系列教程</a></li><li><a href="https://www.jianshu.com/p/c65ecdcffed1" target="_blank" rel="noopener">详解如何从零开始搭建 Express+Vue 开发环境</a></li><li><a href="https://www.jianshu.com/p/4940ae61b752" target="_blank" rel="noopener">vue 项目-前端 Vue 后台 express</a></li><li><a href="https://segmentfault.com/a/1190000015866331" target="_blank" rel="noopener">【实战】用 express+MongoDB 搭建一个完整的前端项目</a></li><li><a href="https://www.jianshu.com/p/92fa50ea0b84" target="_blank" rel="noopener">基于 Vue+express 的博客项目</a></li></ul><h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><ul><li><a href="https://cnodejs.org/topic/560dbc826a1ed28204a1e7de" target="_blank" rel="noopener">Node.js 最新技术栈之 Promise 篇</a> - 2015</li><li><a href="https://blog.coding.net/blog/how-do-promises-work" target="_blank" rel="noopener">理解 Promise 的工作原理</a></li><li><a href="http://liubin.org/promises-book/" target="_blank" rel="noopener">JavaScript Promise 迷你书（中文版）</a></li></ul><h2 id="周边大咖"><a href="#周边大咖" class="headerlink" title="周边大咖"></a>周边大咖</h2><ul><li><a href="https://github.com/sindresorhus/awesome-nodejs" target="_blank" rel="noopener">wesome-nodejs</a></li><li>@justjavac 大神的<a href="https://github.com/justjavac/free-programming-books-zh_CN/#%E7%BD%AE%E9%A1%B6" target="_blank" rel="noopener">免费的计算机编程类中文书籍</a></li><li><a href="https://github.com/i5ting/How-to-learn-node-correctly" target="_blank" rel="noopener">【知乎 Live】狼叔：如何正确的学习 Node.js</a></li></ul><h2 id="学习日志"><a href="#学习日志" class="headerlink" title="学习日志"></a>学习日志</h2><ul><li><a href="https://github.com/yangtao2o/nodejs-learn/blob/master/doc/http.md" target="_blank" rel="noopener">Http</a></li><li><a href="https://github.com/yangtao2o/nodejs-learn/blob/master/doc/tcp.md" target="_blank" rel="noopener">Tcp</a></li><li><a href="https://github.com/yangtao2o/nodejs-learn/blob/master/doc/connect.md" target="_blank" rel="noopener">Connect</a></li><li><a href="https://github.com/yangtao2o/nodejs-learn/blob/master/doc/event.md" target="_blank" rel="noopener">Event</a></li><li><a href="https://github.com/yangtao2o/nodejs-learn/blob/master/doc/express-init.md" target="_blank" rel="noopener">Express-init</a></li><li><a href="https://github.com/yangtao2o/nodejs-learn/blob/master/doc/express-spider.md" target="_blank" rel="noopener">Express-spider</a></li><li><a href="https://github.com/yangtao2o/nodejs-learn/blob/master/doc/express-spider-more.md" target="_blank" rel="noopener">Express-spider-more</a></li><li><a href="https://github.com/yangtao2o/nodejs-learn/tree/master/cnodejs" target="_blank" rel="noopener">npm package</a> 积累</li></ul><h2 id="Node-相关"><a href="#Node-相关" class="headerlink" title="Node 相关"></a>Node 相关</h2><ul><li><a href="https://github.com/yangtao2o/node-express-mongodb/blob/master/doc/doc-01-init.md" target="_blank" rel="noopener">网站初始化，实现 GET 和 POST 的 Ajax 请求</a></li><li><a href="https://github.com/yangtao2o/node-express-mongodb/blob/master/doc/doc-02-login.md" target="_blank" rel="noopener">登录模块</a></li><li><a href="https://github.com/yangtao2o/node-express-mongodb/blob/master/doc/doc-02-login.md" target="_blank" rel="noopener">上传图片模块</a></li><li><a href="https://github.com/yangtao2o/node-blog-express-koa2" target="_blank" rel="noopener">node-blog-express-koa2</a></li><li><a href="https://github.com/yangtao2o/node-express-mongodb" target="_blank" rel="noopener">node-express-mongodb</a></li><li><a href="https://github.com/yangtao2o/node-express-spider" target="_blank" rel="noopener">node-express-spider</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>使用 superagent 与 cheerio 完成简单爬虫</title>
      <link href="/2019/07/06/node-express-spider/"/>
      <url>/2019/07/06/node-express-spider/</url>
      
        <content type="html"><![CDATA[<h2 id="爬一下-CNode-专业中文社区"><a href="#爬一下-CNode-专业中文社区" class="headerlink" title="爬一下 CNode 专业中文社区"></a>爬一下 CNode 专业中文社区</h2><a id="more"></a><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"><span class="keyword">const</span> superagent = <span class="built_in">require</span>(<span class="string">"superagent"</span>);</span><br><span class="line"><span class="keyword">const</span> cheerio = <span class="built_in">require</span>(<span class="string">"cheerio"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> PORT = process.env.PORT || <span class="number">8000</span>;</span><br><span class="line"><span class="keyword">const</span> URL = <span class="string">"https://cnodejs.org"</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 当在浏览器中访问 http://localhost:8000/ 时，输出 CNode(https://cnodejs.org/ ) 社区首页的所有帖子标题和链接，以 json 的形式。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">app.get(<span class="string">"/"</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 使用 superagent 获取 url</span></span><br><span class="line">  superagent.get(URL, (err, sres) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> next(err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> $ = cheerio.load(sres.text);</span><br><span class="line">    <span class="keyword">const</span> items = [];</span><br><span class="line">    <span class="keyword">const</span> $target = $(<span class="string">"#topic_list .topic_title"</span>);</span><br><span class="line">    <span class="keyword">let</span> itemsHtml = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    $target.each(<span class="function">(<span class="params">i, item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> $<span class="keyword">this</span> = $(item);</span><br><span class="line">      items.push(&#123;</span><br><span class="line">        title: $<span class="keyword">this</span>.attr(<span class="string">"title"</span>),</span><br><span class="line">        url: URL + $<span class="keyword">this</span>.attr(<span class="string">"href"</span>)</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"items---&gt;"</span>, items); <span class="comment">// 以 JSON 格式打印</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (items) &#123;</span><br><span class="line">      $(items).each(<span class="function">(<span class="params">i, item</span>) =&gt;</span> &#123;</span><br><span class="line">        itemsHtml += <span class="string">`&lt;li&gt;&lt;a href="<span class="subst">$&#123;item.url&#125;</span>" title="<span class="subst">$&#123;item.title&#125;</span>"&gt;<span class="subst">$&#123;item.title&#125;</span>&lt;/a&gt;&lt;/li&gt;`</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">      itemsHtml = <span class="string">`&lt;ol id="listItem"&gt;<span class="subst">$&#123;itemsHtml&#125;</span>&lt;/ol&gt;`</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      itemsHtml = <span class="string">`&lt;p&gt;暂时还获取不到数据...&lt;/p&gt;`</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res.send(itemsHtml);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(PORT, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"App is listening at port "</span> + PORT);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="并发请求处理"><a href="#并发请求处理" class="headerlink" title="并发请求处理"></a>并发请求处理</h2><p>输出 <a href="https://cnodejs.org/" target="_blank" rel="noopener">CNode</a> 社区首页的所有主题的标题，链接和第一条评论，以 json 的格式。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"><span class="keyword">const</span> superagent = <span class="built_in">require</span>(<span class="string">"superagent"</span>);</span><br><span class="line"><span class="keyword">const</span> cheerio = <span class="built_in">require</span>(<span class="string">"cheerio"</span>);</span><br><span class="line"><span class="keyword">const</span> morgan = <span class="built_in">require</span>(<span class="string">"morgan"</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">async</span> = <span class="built_in">require</span>(<span class="string">"async"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> PORT = process.env.PORT || <span class="number">8000</span>;</span><br><span class="line"><span class="keyword">const</span> URL = <span class="string">"https://cnodejs.org"</span>;</span><br><span class="line"></span><br><span class="line">app.set(<span class="string">"view engine"</span>, <span class="string">"ejs"</span>);</span><br><span class="line">app.use(morgan(<span class="string">"dev"</span>));</span><br><span class="line">app.use(express.json());</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 控制并发请求</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">"/"</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"loading..."</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`正在请求<span class="subst">$&#123;URL&#125;</span>`</span>);</span><br><span class="line">  superagent.get(URL).end(<span class="function">(<span class="params">err, sres</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> topicUrls = [];</span><br><span class="line">    <span class="keyword">const</span> $ = cheerio.load(sres.text);</span><br><span class="line">    <span class="keyword">let</span> concurrencyCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> fetchUrl = <span class="function">(<span class="params">url, callback</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> getItem = &#123;&#125;;</span><br><span class="line">      superagent.get(url).end(<span class="function">(<span class="params">err, sres</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> $ = cheerio.load(sres.text);</span><br><span class="line">        concurrencyCount++;</span><br><span class="line"></span><br><span class="line">        getItem = &#123;</span><br><span class="line">          href: url,</span><br><span class="line">          title: $(<span class="string">".topic_full_title"</span>)</span><br><span class="line">            .text()</span><br><span class="line">            .replace(<span class="regexp">/[\r\n]/g</span>, <span class="string">""</span>),</span><br><span class="line">          comment: $(<span class="string">".reply_content"</span>)</span><br><span class="line">            .eq(<span class="number">0</span>)</span><br><span class="line">            .text()</span><br><span class="line">            .replace(<span class="regexp">/[\ \r\n]/g</span>, <span class="string">""</span>)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(</span><br><span class="line">          <span class="string">`\r\n正在请求第 <span class="subst">$&#123;concurrencyCount&#125;</span> 条的数据data:\r\n<span class="subst">$&#123;[</span></span></span><br><span class="line"><span class="string"><span class="subst">            <span class="built_in">JSON</span>.stringify(getItem)</span></span></span><br><span class="line"><span class="string"><span class="subst">          ]&#125;</span>`</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        callback(<span class="literal">null</span>, getItem);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    $(<span class="string">"#topic_list .topic_title"</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">idx, element</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> $element = $(element);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> href = URL + $element.attr(<span class="string">"href"</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`正在获取第 <span class="subst">$&#123;idx + <span class="number">1</span>&#125;</span> 条列表的url：<span class="subst">$&#123;href&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">      topicUrls.push(href);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (topicUrls.length &lt; <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`\r\n开始并发请求...\r\n`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span>.mapLimit(</span><br><span class="line">      topicUrls,</span><br><span class="line">      <span class="number">3</span>,</span><br><span class="line">      (url, callback) =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.time(<span class="string">"delay"</span>);</span><br><span class="line">        fetchUrl(url, callback);</span><br><span class="line">        <span class="built_in">console</span>.timeEnd(<span class="string">"delay"</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      (err, results) =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"\r获取到的数据: \r\n"</span>, results);</span><br><span class="line">        res.json(results);</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(PORT, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"App is listening at port "</span> + PORT);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="优化下"><a href="#优化下" class="headerlink" title="优化下"></a>优化下</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"><span class="keyword">const</span> superagent = <span class="built_in">require</span>(<span class="string">"superagent"</span>);</span><br><span class="line"><span class="keyword">const</span> cheerio = <span class="built_in">require</span>(<span class="string">"cheerio"</span>);</span><br><span class="line"><span class="keyword">const</span> morgan = <span class="built_in">require</span>(<span class="string">"morgan"</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">async</span> = <span class="built_in">require</span>(<span class="string">"async"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PORT = process.env.PORT || <span class="number">3000</span>;</span><br><span class="line"><span class="keyword">const</span> URL = <span class="string">"https://cnodejs.org"</span>;</span><br><span class="line"><span class="keyword">const</span> ALLNUMS = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> TIEMS = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">app.set(<span class="string">"view engine"</span>, <span class="string">"ejs"</span>);</span><br><span class="line">app.use(morgan(<span class="string">"dev"</span>));</span><br><span class="line">app.use(express.json());</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 控制并发请求</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">"/"</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"loading..."</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`正在请求<span class="subst">$&#123;URL&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> getHomePageUrls = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    superagent.get(URL).end(<span class="function">(<span class="params">err, sres</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> reject(err);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> topicUrls = [];</span><br><span class="line">      <span class="keyword">const</span> $ = cheerio.load(sres.text);</span><br><span class="line"></span><br><span class="line">      $(<span class="string">"#topic_list .topic_title"</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">idx, element</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> $element = $(element);</span><br><span class="line">        <span class="keyword">const</span> href = URL + $element.attr(<span class="string">"href"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`正在获取第 <span class="subst">$&#123;idx + <span class="number">1</span>&#125;</span> 条列表的url：<span class="subst">$&#123;href&#125;</span>`</span>);</span><br><span class="line">        topicUrls.push(href);</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">if</span> (topicUrls.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        resolve(topicUrls.slice(<span class="number">0</span>, ALLNUMS));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> concurrencyCount = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> fetchUrl = <span class="function">(<span class="params">url, callback</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> getItem = &#123;&#125;;</span><br><span class="line">    superagent.get(url).end(<span class="function">(<span class="params">err, sres</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(err);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> $ = cheerio.load(sres.text);</span><br><span class="line">      concurrencyCount++;</span><br><span class="line"></span><br><span class="line">      getItem = &#123;</span><br><span class="line">        href: url,</span><br><span class="line">        title: $(<span class="string">".topic_full_title"</span>)</span><br><span class="line">          .text()</span><br><span class="line">          .replace(<span class="regexp">/[\ \r\n]/g</span>, <span class="string">""</span>),</span><br><span class="line">        comment: $(<span class="string">".reply_content"</span>)</span><br><span class="line">          .eq(<span class="number">0</span>)</span><br><span class="line">          .text()</span><br><span class="line">          .replace(<span class="regexp">/[\ \r\n]/g</span>, <span class="string">""</span>)</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">console</span>.log(</span><br><span class="line">        <span class="string">`\r\n正在请求第 <span class="subst">$&#123;concurrencyCount&#125;</span> 条的数据data:\r\n<span class="subst">$&#123;[</span></span></span><br><span class="line"><span class="string"><span class="subst">          <span class="built_in">JSON</span>.stringify(getItem)</span></span></span><br><span class="line"><span class="string"><span class="subst">        ]&#125;</span>`</span></span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      callback(<span class="literal">null</span>, getItem);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Promise</span>.race([getHomePageUrls])</span><br><span class="line">    .then(<span class="function"><span class="params">itemUrls</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`\r\n开始并发 <span class="subst">$&#123;TIEMS&#125;</span> 次请求...\r\n`</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">async</span>.mapLimit(</span><br><span class="line">        itemUrls,</span><br><span class="line">        TIEMS,</span><br><span class="line">        (url, callback) =&gt; &#123;</span><br><span class="line">          <span class="built_in">console</span>.time(<span class="string">"delay"</span>);</span><br><span class="line">          fetchUrl(url, callback);</span><br><span class="line">          <span class="built_in">console</span>.timeEnd(<span class="string">"delay"</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        (err, results) =&gt; &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">"\r获取到的数据: \r\n"</span>, results);</span><br><span class="line">          res.json(results);</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.error(err));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(PORT, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"App is listening at port "</span> + PORT);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nodejs系列之Events</title>
      <link href="/2019/06/25/node-events/"/>
      <url>/2019/06/25/node-events/</url>
      
        <content type="html"><![CDATA[<h2 id="Node-js-事件循环"><a href="#Node-js-事件循环" class="headerlink" title="Node.js 事件循环"></a>Node.js 事件循环</h2><p>Node.js 是单进程单线程应用程序，但是因为 V8 引擎提供的异步执行回调接口，通过这些接口可以处理大量的并发，所以性能非常高。</p><a id="more"></a><p>Node.js 几乎每一个 API 都是支持回调函数的。</p><p>Node.js 基本上所有的事件机制都是用设计模式中观察者模式实现。</p><p>Node.js 单线程类似进入一个while(true)的事件循环，直到没有事件观察者退出，每个异步事件都生成一个事件观察者，如果有事件发生就调用该回调函数.</p><p><code>EventEmitter</code> 提供了多个属性，如<code>on</code>和<code>emit</code>。</p><p><code>on</code> 函数用于绑定事件函数，<code>emit</code> 属性用于触发一个事件。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> events = <span class="built_in">require</span>(<span class="string">'events'</span>)</span><br><span class="line"><span class="comment">// 创建 eventEmitter 对象</span></span><br><span class="line"><span class="keyword">const</span> eventEmitter = <span class="keyword">new</span> events.EventEmitter()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定 connection 事件处理程序</span></span><br><span class="line">eventEmitter.on(<span class="string">'connection'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'建立连接...'</span>)</span><br><span class="line">  <span class="comment">// 触发 dataReceived 事件</span></span><br><span class="line">  eventEmitter.emit(<span class="string">'dataReceived'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定 dataReceived 事件处理程序</span></span><br><span class="line">eventEmitter.on(<span class="string">'dataReceived'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'接收数据中...'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发 connection 事件</span></span><br><span class="line">eventEmitter.emit(<span class="string">'connection'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"数据接收完毕！"</span>);</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜ node 02-event.js</span><br><span class="line">建立连接...</span><br><span class="line">接收数据中...</span><br><span class="line">数据接收完毕！</span><br></pre></td></tr></table></figure><p>EventEmitter 类写法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> EventEmitter = <span class="built_in">require</span>(<span class="string">'events'</span>);</span><br><span class="line"><span class="comment">// class 继承</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyEmitter</span> <span class="keyword">extends</span> <span class="title">EventEmitter</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> myEmitter = <span class="keyword">new</span> MyEmitter();</span><br><span class="line"></span><br><span class="line">myEmitter.on(<span class="string">'event'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'触发事件'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">myEmitter.emit(<span class="string">'event'</span>);</span><br></pre></td></tr></table></figure><h2 id="EventEmitter-类"><a href="#EventEmitter-类" class="headerlink" title="EventEmitter 类"></a>EventEmitter 类</h2><p>Node.js 所有的异步 I/O 操作在完成时都会发送一个事件到事件队列。</p><p>Node.js 里面的许多对象都会分发事件：一个 <code>net.Server</code> 对象会在每次有新连接时触发一个事件， 一个 <code>fs.readStream</code> 对象会在文件被打开的时候触发一个事件。 所有这些产生事件的对象都是 <code>events.EventEmitter</code> 的实例。</p><p>EventEmitter 类由 events 模块定义：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> EventEmitter = <span class="built_in">require</span>(<span class="string">'events'</span>);</span><br><span class="line"><span class="keyword">const</span> myEmitter = <span class="keyword">new</span> EventEmitter();</span><br></pre></td></tr></table></figure><p><code>EventEmitter</code> 的每个事件由一个事件名和若干个参数组成，事件名是一个字符串，通常表达一定的语义。</p><p>对于每个事件，<code>EventEmitter</code> 支持 若干个事件监听器。</p><p>当事件触发时，注册到这个事件的事件监听器被依次调用，事件参数作为回调函数参数传递。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> EventEmitter = <span class="built_in">require</span>(<span class="string">'events'</span>);</span><br><span class="line"><span class="keyword">const</span> myEmitter = <span class="keyword">new</span> EventEmitter();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一个监听器。</span></span><br><span class="line">myEmitter.on(<span class="string">'event'</span>, <span class="function"><span class="keyword">function</span> <span class="title">firstListener</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'第一个监听器'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 第二个监听器。</span></span><br><span class="line">myEmitter.on(<span class="string">'event'</span>, <span class="function"><span class="keyword">function</span> <span class="title">secondListener</span>(<span class="params">arg1, arg2</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`第二个监听器中的事件有参数 <span class="subst">$&#123;arg1&#125;</span>、<span class="subst">$&#123;arg2&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 第三个监听器</span></span><br><span class="line">myEmitter.on(<span class="string">'event'</span>, <span class="function"><span class="keyword">function</span> <span class="title">thirdListener</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> parameters = args.join(<span class="string">', '</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`第三个监听器中的事件有参数 <span class="subst">$&#123;parameters&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(myEmitter.listeners(<span class="string">'event'</span>));</span><br><span class="line"></span><br><span class="line">myEmitter.emit(<span class="string">'event'</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure><p>myEmitter 为事件 event 注册了三个个事件监听器，然后触发 event 事件，输出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">第一个监听器</span><br><span class="line">第二个监听器中的事件有参数 1、2</span><br><span class="line">第三个监听器中的事件有参数 1, 2, 3, 4, 5</span><br></pre></td></tr></table></figure><p><code>EventEmitter</code> 提供了多个属性，初了绑定事件函数的<code>on</code>和触发事件函数的<code>emit</code>，还有如下一些属性：</p><ul><li><p>addListener(event, listener)<br>为指定事件添加一个监听器到监听器数组的尾部，<code>emitter.on(eventName, listener)</code> 的别名。</p></li><li><p>once(event, listener)<br>为指定事件注册一个单次监听器，即 监听器最多只会触发一次，触发后立刻解除该监听器</p></li><li><p>removeListener(event, listener)<br>移除指定事件的某个监听器，监听器必须是该事件已经注册过的监听器</p></li><li><p>removeAllListeners([event])<br>移除所有事件的所有监听器， 如果指定事件，则移除指定事件的所有监听器</p></li><li><p>setMaxListeners(n)<br>默认情况下， EventEmitters 如果你添加的监听器超过 10 个就会输出警告信息。 setMaxListeners 函数用于提高监听器的默认限制的数量。</p></li><li><p>listeners(event)<br>返回名为 eventName 的事件的监听器数组的副本</p></li><li><p>on(event, listener)<br>为指定事件注册一个监听器，接受一个字符串 event 和一个回调函数</p></li><li><p>off(eventName, listener)<br><code>removeListener()</code> 的别名</p></li><li><p>emit(event, [arg1], [arg2], […])<br>按监听器的顺序执行执行每个监听器，如果事件有注册监听返回 true，否则返回 false</p></li><li><p>listenerCount(eventName)<br>返回正在监听的名为 eventName 的事件的监听器的数量</p></li></ul><p>练习下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> EventEmitter = <span class="built_in">require</span>(<span class="string">'events'</span>)</span><br><span class="line"><span class="keyword">const</span> myEmitter = <span class="keyword">new</span> EventEmitter()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> listener1 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'监听器1启动'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> listener2 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'监听器2启动'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myEmitter.on(<span class="string">'event'</span>, listener1)</span><br><span class="line">myEmitter.on(<span class="string">'event'</span>, listener2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> listeners = myEmitter.listenerCount(<span class="string">'event'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`现在有<span class="subst">$&#123;listeners&#125;</span>个监听器正在监听事件`</span>)</span><br><span class="line"></span><br><span class="line">myEmitter.emit(<span class="string">'event'</span>)</span><br><span class="line"></span><br><span class="line">myEmitter.off(<span class="string">'event'</span>, listener1)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'监听器1已被移除'</span>)</span><br><span class="line"></span><br><span class="line">myEmitter.emit(<span class="string">'event'</span>)</span><br><span class="line"></span><br><span class="line">listeners = myEmitter.listenerCount(<span class="string">'event'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`现在有 <span class="subst">$&#123;listeners&#125;</span> 个监听器正在监听事件`</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'End!'</span>)</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[nodemon] starting `node 04-event.js`</span><br><span class="line">现在有2个监听器正在监听事件</span><br><span class="line">监听器1启动</span><br><span class="line">监听器2启动</span><br><span class="line">监听器1已被移除</span><br><span class="line">监听器2启动</span><br><span class="line">现在有 1 个监听器正在监听事件</span><br><span class="line">End!</span><br></pre></td></tr></table></figure><h2 id="错误事件"><a href="#错误事件" class="headerlink" title="错误事件"></a>错误事件</h2><p>当 EventEmitter 实例出错时，应该触发 ‘error’ 事件。 这些在 Node.js 中被视为特殊情况。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> EventEmitter = <span class="built_in">require</span>(<span class="string">'events'</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyEmitter</span> <span class="keyword">extends</span> <span class="title">EventEmitter</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myEmitter = <span class="keyword">new</span> MyEmitter();</span><br><span class="line">myEmitter.emit(<span class="string">'error'</span>, <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'错误信息'</span>));</span><br></pre></td></tr></table></figure><p>如果没有为 ‘error’ 事件注册监听器，则当 ‘error’ 事件触发时，会抛出错误、打印堆栈跟踪、并退出 Node.js 进程。</p><p>所以最佳实践是，应该始终为 ‘error’ 事件注册监听器：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myEmitter = <span class="keyword">new</span> MyEmitter();</span><br><span class="line">myEmitter.on(<span class="string">'error'</span>, (err) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">'错误信息'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">myEmitter.emit(<span class="string">'error'</span>, <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'错误'</span>));</span><br><span class="line"><span class="comment">// 打印: 错误信息</span></span><br></pre></td></tr></table></figure><h2 id="Node-应用程序是如何工作的"><a href="#Node-应用程序是如何工作的" class="headerlink" title="Node 应用程序是如何工作的"></a>Node 应用程序是如何工作的</h2><p>创建一个 input.txt ,文件内容如：<code>www.runoob.com</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 阻塞</span></span><br><span class="line"><span class="comment">// 在文件读取完后才执行完程序</span></span><br><span class="line"><span class="keyword">const</span> getData = fs.readFileSync(<span class="string">'test/input.txt'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(getData.toString())</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'阻塞程序运行结束'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非阻塞</span></span><br><span class="line"><span class="comment">// 不需要等待文件读取完，这样就可以在读取文件时同时执行接下来的代码，大大提高了程序的性能</span></span><br><span class="line">fs.readFile(<span class="string">'test/input.txt'</span>, (err, data) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span>(err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.error(err)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(data.toString())</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'非阻塞程序运行结束'</span>)</span><br></pre></td></tr></table></figure><p>如果没发生错误，readFileSync 或者 readFile 跳过 err 对象的输出，文件内容就通过回调函数输出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">www.runoob.com</span><br><span class="line">阻塞程序运行结束</span><br><span class="line">非阻塞程序运行结束</span><br><span class="line">www.runoob.com</span><br></pre></td></tr></table></figure><p>接下来我们删除 input.txt 文件，执行结果如下所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; [Error: ENOENT: no such file or directory, open <span class="string">'input.txt'</span>] errno: -2, code: <span class="string">'ENOENT'</span>, syscall: <span class="string">'open'</span>, path: <span class="string">'input.txt'</span> &#125;</span><br></pre></td></tr></table></figure><h2 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h2><ul><li>菜鸟教程之 <a href="https://www.runoob.com/nodejs/nodejs-event.html" target="_blank" rel="noopener">Node.js 学习</a></li><li>官方文档之 <a href="http://nodejs.cn/api/events.html" target="_blank" rel="noopener">events（事件触发器）</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nodejs系列之HTTP</title>
      <link href="/2019/06/14/node-http/"/>
      <url>/2019/06/14/node-http/</url>
      
        <content type="html"><![CDATA[<blockquote><p>超文本传输协议，是一种 Web 协议，属于 TCP 上层的协议。</p></blockquote><p>HTTP 模块式 Node 的核心模块，主要提供了一系列用于网络传输的 API。</p><a id="more"></a><p>HTTP 消息头如下所示(键是小写的，值不能被修改)：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"content-length"</span>: <span class="string">"123"</span>,</span><br><span class="line">  <span class="attr">"content-type"</span>: <span class="string">"text/plain"</span>,</span><br><span class="line">  <span class="attr">"connection"</span>: <span class="string">"keep-alive"</span>,</span><br><span class="line">  <span class="attr">"host"</span>: <span class="string">"mysite.com"</span>,</span><br><span class="line">  <span class="attr">"accept"</span>: <span class="string">"*/*"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="创建-HTTP-服务器"><a href="#创建-HTTP-服务器" class="headerlink" title="创建 HTTP 服务器"></a>创建 HTTP 服务器</h2><p>使用 NodeJS 内置的 http 模块简单实现一个 HTTP 服务器:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"></span><br><span class="line">http</span><br><span class="line">  .createServer(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">    response.writeHead(<span class="number">200</span>, &#123; <span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span> &#125;);</span><br><span class="line">    response.end(<span class="string">"Hello World!"</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure><p>以上程序创建了一个 HTTP 服务器并监听 3000 端口，打开浏览器访问该端口<code>http://127.0.0.1:3000/</code>就能够看到效果。</p><p>使用 createServer 创建一个 HTTP 服务器，该方法返回一个 http.server 类的实例。</p><p>createServer 方法包含了一个匿名的回调函数，该函数有两个参数 request，response，它们是 IncomingMessage 和 ServerResponse 的实例。</p><p>分别表示 HTTP 的 request 和 response 对象，当服务器创建完成后，Node 进程开始循环监听 3000 端口。</p><p>http.server 类定义了一系列的事件，如 connection 和 request 事件。</p><h2 id="处理-HTTP-请求"><a href="#处理-HTTP-请求" class="headerlink" title="处理 HTTP 请求"></a>处理 HTTP 请求</h2><h3 id="method，URL-和-header"><a href="#method，URL-和-header" class="headerlink" title="method，URL 和 header"></a>method，URL 和 header</h3><p>Node 将相关的信息封装在一个对象（request）中，该对象是 IncomingMessage 的实例。</p><p>获取 method、URL：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> method = req.method;</span><br><span class="line"><span class="keyword">const</span> url = req.url;</span><br></pre></td></tr></table></figure><p>比如访问<code>http://127.0.0.1:8000/index.html?name=tao</code>，就会输出：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"method"</span>: <span class="string">"GET"</span>,</span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"/index.html?name=tao"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>URL 的值为去除网站服务器地址之外的完整值。</p><h3 id="header"><a href="#header" class="headerlink" title="header"></a>header</h3><p>获取 HTTP header 信息：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> headers = req.headers;</span><br><span class="line"><span class="keyword">const</span> userAgent = headers[<span class="string">"user-agent"</span>];</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"host"</span>: <span class="string">"127.0.0.1:8000"</span>,</span><br><span class="line">    <span class="attr">"user-agent"</span>: <span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:68.0) Gecko/20100101 Firefox/68.0"</span>,</span><br><span class="line">    <span class="attr">"accept"</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span>,</span><br><span class="line">    <span class="attr">"accept-language"</span>: <span class="string">"zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2"</span>,</span><br><span class="line">    <span class="attr">"accept-encoding"</span>: <span class="string">"gzip, deflate"</span>,</span><br><span class="line">    <span class="attr">"connection"</span>: <span class="string">"keep-alive"</span>,</span><br><span class="line">    <span class="attr">"upgrade-insecure-requests"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="attr">"cache-control"</span>: <span class="string">"max-age=0"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"userAgent"</span>: <span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:68.0) Gecko/20100101 Firefox/68.0"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>header 是一个 JSON 对象，可以对属性名进行单独索引。</p><h3 id="request-body"><a href="#request-body" class="headerlink" title="request body"></a>request body</h3><p>Node 使用 stream 处理 HTTP 的请求体，并且注册了两个事件：data 和 end。</p><p>获取完整的 HTTP 内容体：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> body = [];</span><br><span class="line"></span><br><span class="line">request.on(<span class="string">"data"</span>, chunk =&gt; &#123;</span><br><span class="line">  body.push(chunk);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">request.on(<span class="string">"end"</span>, () =&gt; &#123;</span><br><span class="line">  body = Buffer.concat(body).toString();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="Response-对象"><a href="#Response-对象" class="headerlink" title="Response 对象"></a>Response 对象</h2><h2 id="get-post-请求"><a href="#get-post-请求" class="headerlink" title="get/post 请求"></a>get/post 请求</h2><p>综上所述，我们来组织一个简易的 get、post 请求实例：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">"querystring"</span>);</span><br><span class="line"></span><br><span class="line">http</span><br><span class="line">  .createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> method = req.method;</span><br><span class="line">    <span class="keyword">const</span> url = req.url;</span><br><span class="line">    <span class="keyword">const</span> path = url.split(<span class="string">"?"</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">const</span> query = querystring.parse(url.split(<span class="string">"?"</span>)[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">const</span> headers = req.headers;</span><br><span class="line">    <span class="keyword">const</span> userAgent = headers[<span class="string">"user-agent"</span>];</span><br><span class="line">    <span class="keyword">const</span> resData = &#123;</span><br><span class="line">      method,</span><br><span class="line">      url,</span><br><span class="line">      path,</span><br><span class="line">      query,</span><br><span class="line">      headers,</span><br><span class="line">      userAgent</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    res.setHeader(<span class="string">"Content-type"</span>, <span class="string">"application/json"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">"GET"</span>) &#123;</span><br><span class="line">      res.end(<span class="built_in">JSON</span>.stringify(resData));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">"POST"</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> postData = [];</span><br><span class="line"></span><br><span class="line">      req.on(<span class="string">"data"</span>, chunk =&gt; &#123;</span><br><span class="line">        postData.push(chunk);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      req.on(<span class="string">"end"</span>, () =&gt; &#123;</span><br><span class="line">        resData.postData = Buffer.concat(postData).toString();</span><br><span class="line">        res.end(<span class="built_in">JSON</span>.stringify(resData));</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .listen(<span class="number">8000</span>);</span><br></pre></td></tr></table></figure><p>比如<code>POST</code>请求 <code>http://127.0.0.1:8000/api/blog?ip=2</code>，然后使用 Postman 工具测试结果如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"method"</span>: <span class="string">"POST"</span>,</span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"/api/blog?ip=2"</span>,</span><br><span class="line">  <span class="attr">"path"</span>: <span class="string">"/api/blog"</span>,</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"ip"</span>: <span class="string">"2"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"content-type"</span>: <span class="string">"application/json"</span>,</span><br><span class="line">    <span class="attr">"cache-control"</span>: <span class="string">"no-cache"</span>,</span><br><span class="line">    <span class="attr">"postman-token"</span>: <span class="string">"9e6cb382-8551-4a3f-b352-0581bb377cbc"</span>,</span><br><span class="line">    <span class="attr">"user-agent"</span>: <span class="string">"PostmanRuntime/7.6.0"</span>,</span><br><span class="line">    <span class="attr">"accept"</span>: <span class="string">"*/*"</span>,</span><br><span class="line">    <span class="attr">"host"</span>: <span class="string">"127.0.0.1:8000"</span>,</span><br><span class="line">    <span class="attr">"accept-encoding"</span>: <span class="string">"gzip, deflate"</span>,</span><br><span class="line">    <span class="attr">"content-length"</span>: <span class="string">"62"</span>,</span><br><span class="line">    <span class="attr">"connection"</span>: <span class="string">"keep-alive"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"userAgent"</span>: <span class="string">"PostmanRuntime/7.6.0"</span>,</span><br><span class="line">  <span class="attr">"postData"</span>: <span class="string">"&#123;\n\t\"title\": \"你说什么\",\n\t\"content\": \"我知道你知道\"\n&#125;"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><p><a href="http://nodejs.cn/api/http.html" target="_blank" rel="noopener">http</a> 模块提供两种使用方式：</p><ol><li>作为服务端使用时，创建一个 HTTP 服务器，监听 HTTP 客户端请求并返回响应。</li><li>作为客户端使用时，发起一个 HTTP 客户端请求，获取服务端响应。</li></ol><h3 id="一个简单的-Web-服务器"><a href="#一个简单的-Web-服务器" class="headerlink" title="一个简单的 Web 服务器"></a>一个简单的 Web 服务器</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">const</span> qs = <span class="built_in">require</span>(<span class="string">"querystring"</span>);</span><br><span class="line"></span><br><span class="line">http</span><br><span class="line">  .createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"/"</span> == req.url) &#123;</span><br><span class="line">      res.writeHead(<span class="number">200</span>, &#123; <span class="string">"Content-Type"</span>: <span class="string">"text/html"</span> &#125;);</span><br><span class="line">      res.end(</span><br><span class="line">        [</span><br><span class="line">          <span class="string">'&lt;form method="POST" action="/url"&gt;'</span>,</span><br><span class="line">          <span class="string">"&lt;h1&gt;My Form&lt;/h1&gt;"</span>,</span><br><span class="line">          <span class="string">"&lt;fieldset&gt;"</span>,</span><br><span class="line">          <span class="string">"&lt;label&gt;Personal information&lt;/label&gt;"</span>,</span><br><span class="line">          <span class="string">"&lt;p&gt;What is your name?&lt;/p&gt;"</span>,</span><br><span class="line">          <span class="string">'&lt;input type="text" name="name" /&gt;'</span>,</span><br><span class="line">          <span class="string">"&lt;p&gt;&lt;button&gt;Submit&lt;/button&gt;&lt;/p&gt;"</span>,</span><br><span class="line">          <span class="string">"&lt;/fieldset&gt;"</span>,</span><br><span class="line">          <span class="string">"&lt;/form&gt;"</span></span><br><span class="line">        ].join(<span class="string">""</span>)</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"/url"</span> == req.url &amp;&amp; <span class="string">"POST"</span> == req.method) &#123;</span><br><span class="line">      <span class="keyword">var</span> body = <span class="string">""</span>;</span><br><span class="line">      req.on(<span class="string">"data"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">        body += chunk;</span><br><span class="line">      &#125;);</span><br><span class="line">      req.on(<span class="string">"end"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        res.writeHead(<span class="number">200</span>, &#123; <span class="string">"Content-Type"</span>: <span class="string">"text/html"</span> &#125;);</span><br><span class="line">        res.end(</span><br><span class="line">          <span class="string">"&lt;p&gt;Content-type: "</span> +</span><br><span class="line">            req.headers[<span class="string">"content-type"</span>] +</span><br><span class="line">            <span class="string">"&lt;/p&gt;"</span> +</span><br><span class="line">            <span class="string">"&lt;p&gt;Data: "</span> +</span><br><span class="line">            qs.parse(body).name +</span><br><span class="line">            <span class="string">"&lt;/p&gt;"</span></span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      res.writeHead(<span class="number">404</span>);</span><br><span class="line">      res.end(<span class="string">"Not Found."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure><h3 id="一个-Twitter-Web-客户端"><a href="#一个-Twitter-Web-客户端" class="headerlink" title="一个 Twitter Web 客户端"></a>一个 Twitter Web 客户端</h3><p>创建服务器：app.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">const</span> qs = <span class="built_in">require</span>(<span class="string">"querystring"</span>);</span><br><span class="line"></span><br><span class="line">http</span><br><span class="line">  .createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body = <span class="string">""</span>;</span><br><span class="line">    req.on(<span class="string">"data"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">      body += chunk;</span><br><span class="line">    &#125;);</span><br><span class="line">    req.on(<span class="string">"end"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      res.writeHead(<span class="number">200</span>);</span><br><span class="line">      res.end(<span class="string">"Done"</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"\n got name \033[90m"</span> + qs.parse(body).name + <span class="string">"\033[39m\n"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure><p>创建客户端：client.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">const</span> qs = <span class="built_in">require</span>(<span class="string">"querystring"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">send</span>(<span class="params">theName</span>) </span>&#123;</span><br><span class="line">  http</span><br><span class="line">    .request(</span><br><span class="line">      &#123;</span><br><span class="line">        host: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">        port: <span class="number">3000</span>,</span><br><span class="line">        url: <span class="string">"/"</span>,</span><br><span class="line">        method: <span class="string">"POST"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> body = <span class="string">""</span>;</span><br><span class="line">        res.setEncoding(<span class="string">"utf8"</span>);</span><br><span class="line">        res.on(<span class="string">"data"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">          body += chunk;</span><br><span class="line">        &#125;);</span><br><span class="line">        res.on(<span class="string">"end"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">"\n  \033[90m request complete! \033[39m"</span>);</span><br><span class="line">          process.stdout.write(<span class="string">"\n your name: "</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">    .end(qs.stringify(&#123; <span class="attr">name</span>: theName &#125;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">process.stdout.write(<span class="string">"\n your name: "</span>);</span><br><span class="line">process.stdin.resume();</span><br><span class="line">process.stdin.setEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">process.stdin.on(<span class="string">"data"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  send(name.replace(<span class="string">"\n"</span>, <span class="string">""</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>启动<code>node app.js</code>，再启动<code>node client.js</code></p><h2 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h2><p>HTTPS 是基于 TLS/SSL 的 HTTP 协议。在 Node.js 中，作为一个单独的模块实现。</p><p>HTTPS 模块与 HTTP 模块极为类似，区别在于 HTTPS 模块需要额外处理 SSL 证书。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> https = <span class="built_in">require</span>(<span class="string">"https"</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  key: fs.readFileSync(<span class="string">"test/fixtures/keys/agent2-key.pem"</span>),</span><br><span class="line">  cert: fs.readFileSync(<span class="string">"test/fixtures/keys/agent2-cert.pem"</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">https</span><br><span class="line">  .createServer(options, (req, res) =&gt; &#123;</span><br><span class="line">    res.writeHead(<span class="number">200</span>);</span><br><span class="line">    res.end(<span class="string">"hello world\n"</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .listen(<span class="number">8000</span>);</span><br></pre></td></tr></table></figure><h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p>处理 HTTP 请求时 url 模块使用率超高，因为该模块允许解析 URL、生成 URL，以及拼接 URL。</p><p>首先我们来看看一个完整的 URL 的各组成部分，输出如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; require(<span class="string">'url'</span>).parse(<span class="string">'http://user:pass@host.com:8080/p/a/t/h?query=string#hash'</span>);</span><br><span class="line">Url &#123;</span><br><span class="line">  protocol: <span class="string">'http:'</span>,</span><br><span class="line">  slashes: <span class="literal">true</span>,</span><br><span class="line">  auth: <span class="string">'user:pass'</span>,</span><br><span class="line">  host: <span class="string">'host.com:8080'</span>,</span><br><span class="line">  port: <span class="string">'8080'</span>,</span><br><span class="line">  hostname: <span class="string">'host.com'</span>,</span><br><span class="line">  <span class="built_in">hash</span>: <span class="string">'#hash'</span>,</span><br><span class="line">  search: <span class="string">'?query=string'</span>,</span><br><span class="line">  query: <span class="string">'query=string'</span>,</span><br><span class="line">  pathname: <span class="string">'/p/a/t/h'</span>,</span><br><span class="line">  path: <span class="string">'/p/a/t/h?query=string'</span>,</span><br><span class="line">  href: <span class="string">'http://user:pass@host.com:8080/p/a/t/h?query=string#hash'</span>&#125;</span><br></pre></td></tr></table></figure><p>当然，不完整的 url，也可以解析：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">"url"</span>);</span><br><span class="line"></span><br><span class="line">http</span><br><span class="line">  .createServer(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> body = [];</span><br><span class="line">    <span class="keyword">const</span> tmp = request.url; <span class="comment">// /foo/bar?a=b</span></span><br><span class="line"></span><br><span class="line">    response.writeHead(<span class="number">200</span>, &#123; <span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"url-parse"</span>, url.parse(tmp));</span><br><span class="line"></span><br><span class="line">    response.end(<span class="string">"Hello World"</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .listen(<span class="number">8000</span>);</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"protocol"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"slashes"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"auth"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"host"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"port"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"hostname"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"hash"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"search"</span>: <span class="string">"?a=b"</span>,</span><br><span class="line">  <span class="attr">"query"</span>: <span class="string">"a=b"</span>,</span><br><span class="line">  <span class="attr">"pathname"</span>: <span class="string">"/foo/bar"</span>,</span><br><span class="line">  <span class="attr">"path"</span>: <span class="string">"/foo/bar?a=b"</span>,</span><br><span class="line">  <span class="attr">"href"</span>: <span class="string">"/foo/bar?a=b"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>format 方法允许将一个 URL 对象转换为 URL 字符串</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> urlFormat = url.format(&#123;</span><br><span class="line">  protocol: <span class="string">"http:"</span>,</span><br><span class="line">  host: <span class="string">"www.example.com"</span>,</span><br><span class="line">  pathname: <span class="string">"/p/a/t/h"</span>,</span><br><span class="line">  search: <span class="string">"query=string"</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(&#123; urlFormat &#125;); <span class="comment">// &#123; urlFormat: 'http://www.example.com/p/a/t/h?query=string' &#125;</span></span><br></pre></td></tr></table></figure><h2 id="Query-String"><a href="#Query-String" class="headerlink" title="Query String"></a>Query String</h2><p><a href="http://nodejs.org/api/querystring.html" target="_blank" rel="noopener">querystring</a> 模块用于实现 URL 参数字符串与参数对象的互相转换</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">querystring.parse(<span class="string">"foo=bar&amp;baz=qux&amp;baz=quux&amp;corge"</span>);</span><br><span class="line"><span class="comment">// &#123; foo: 'bar', baz: [ 'qux', 'quux' ], corge: '' &#125;</span></span><br><span class="line"></span><br><span class="line">querystring.stringify(&#123; <span class="attr">foo</span>: <span class="string">"bar"</span>, <span class="attr">baz</span>: [<span class="string">"qux"</span>, <span class="string">"quux"</span>], <span class="attr">corge</span>: <span class="string">""</span> &#125;);</span><br><span class="line"><span class="comment">// 'foo=bar&amp;baz=qux&amp;baz=quux&amp;corge='</span></span><br></pre></td></tr></table></figure><h2 id="Zlib"><a href="#Zlib" class="headerlink" title="Zlib"></a>Zlib</h2><p>zlib 模块提供了数据压缩和解压的功能。当我们处理 HTTP 请求和响应时，可能需要用到这个模块。</p><h2 id="Net"><a href="#Net" class="headerlink" title="Net"></a>Net</h2><p>net 模块可用于创建 Socket 服务器或 Socket 客户端。</p><p>由于 Socket 在前端领域的使用范围还不是很广，这里先不涉及到 WebSocket 的介绍，仅仅简单演示一下如何从 Socket 层面来实现 HTTP 请求和响应。</p><h2 id="问题解答"><a href="#问题解答" class="headerlink" title="问题解答"></a>问题解答</h2><p>使用 NodeJS 操作网络，特别是操作 HTTP 请求和响应时会遇到一些惊喜，这里对一些常见问题做解答。</p><ul><li>为什么通过 headers 对象访问到的 HTTP 请求头或响应头字段不是驼峰的？</li></ul><p>从规范上讲，HTTP 请求头和响应头字段都应该是驼峰的。但现实是残酷的，不是每个 HTTP 服务端或客户端程序都严格遵循规范，所以 NodeJS 在处理从别的客户端或服务端收到的头字段时，都统一地转换为了小写字母格式，以便开发者能使用统一的方式来访问头字段，例如<code>headers[&#39;content-length&#39;]</code>。</p><ul><li>为什么 http 模块创建的 HTTP 服务器返回的响应是 chunked 传输方式的？</li></ul><p>因为默认情况下，使用<code>.writeHead</code>方法写入响应头后，允许使用<code>.write</code>方法写入任意长度的响应体数据，并使用<code>.end</code>方法结束一个响应。由于响应体数据长度不确定，因此 NodeJS 自动在响应头里添加了<code>Transfer-Encoding: chunked</code>字段，并采用 chunked 传输方式。但是当响应体数据长度确定时，可使用<code>.writeHead</code>方法在响应头里加上<code>Content-Length</code>字段，这样做之后 NodeJS 就不会自动添加<code>Transfer-Encoding</code>字段和使用 chunked 传输方式。</p><ul><li>为什么使用 http 模块发起 HTTP 客户端请求时，有时候会发生 socket hang up 错误？</li></ul><p>答： 发起客户端 HTTP 请求前需要先创建一个客户端。http 模块提供了一个全局客户端<code>http.globalAgent</code>，可以让我们使用<code>.request</code>或<code>.get</code>方法时不用手动创建客户端。但是全局客户端默认只允许 5 个并发 Socket 连接，当某一个时刻 HTTP 客户端请求创建过多，超过这个数字时，就会发生<code>socket hang up</code>错误。解决方法也很简单，通过<code>http.globalAgent.maxSockets</code>属性把这个数字改大些即可。另外，https 模块遇到这个问题时也一样通过<code>https.globalAgent.maxSockets</code>属性来处理。</p><h2 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h2><ul><li><a href="http://nqdeng.github.io/7-days-nodejs/#1.1" target="_blank" rel="noopener">7-days-nodejs</a> - 文章</li><li>《了不起的 Node.js：将 JavaScript 进行到底》- 书籍</li><li>《新时期的 Node.js 入门》- 书籍</li><li><a href="https://coding.imooc.com/class/320.html" target="_blank" rel="noopener">Node.js 从零开发 Web Server 博客项目 前端晋升全栈工程师必备</a> - 视频</li><li><a href="http://nodejs.cn/api/http.html" target="_blank" rel="noopener">http（HTTP）</a> - 官方文档</li></ul>]]></content>
      
      
      <categories>
          
          <category> Nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nodejs系列之TCP</title>
      <link href="/2019/06/12/node-tcp/"/>
      <url>/2019/06/12/node-tcp/</url>
      
        <content type="html"><![CDATA[<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>传输控制协议（TCP）是一个面向连接的协议，保证了两台计算机之间数据传输的可靠性和顺序。</p><p>Node HTTP 服务器是构建于 Node TCP 服务器之上的。</p><a id="more"></a><p>TCP 的特性：</p><ul><li>面向连接的通信和保证顺序的传递</li><li>面向字节 - ASCII、Unicode</li><li>可靠性</li><li>流控制</li><li>拥堵控制 - Qos</li></ul><p>Socket 是对 TCP 协议的一种封装方式，Socket本身不是协议，而是一个编程接口。</p><h2 id="telnet允许在终端手动建立一个TCP连接"><a href="#telnet允许在终端手动建立一个TCP连接" class="headerlink" title="telnet允许在终端手动建立一个TCP连接"></a>telnet允许在终端手动建立一个TCP连接</h2><h4 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h4><p>使用 Node.js 写一个web服务器，并监听 3000 端口，然后 <code>node app.js</code> 运行下是否正确<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'http'</span>).createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.writeHead(<span class="number">200</span>);</span><br><span class="line">  res.end(<span class="string">'Hello world'</span>);</span><br><span class="line">&#125;).listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure></p><h4 id="TCP连接"><a href="#TCP连接" class="headerlink" title="TCP连接"></a>TCP连接</h4><p>使用<code>telnet 127.0.0.1 3000</code>建立一个连接，然后输入<code>GET / HTTP/1.1</code>，回车两次，然后服务器端就出现了响应：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">~ telnet 127.0.0.1 3000</span><br><span class="line"></span><br><span class="line">Trying 127.0.0.1...</span><br><span class="line">Connected to localhost.</span><br><span class="line">Escape character is <span class="string">'^]'</span>.</span><br><span class="line">GET / HTTP/1.1</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Sun, 15 Sep 2019 06:20:43 GMT</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line"></span><br><span class="line">b</span><br><span class="line">Hello world</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">Connection closed by foreign host.</span><br></pre></td></tr></table></figure></p><p>总结：</p><ul><li>成功建立了一个 TCP 连接</li><li>创建了一个HTTP请求</li><li>接收到一个HTTP响应</li><li>到达的数据和在Node.js中写的一样</li></ul><h2 id="基于TCP的聊天程序"><a href="#基于TCP的聊天程序" class="headerlink" title="基于TCP的聊天程序"></a>基于TCP的聊天程序</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> count = <span class="number">0</span>,</span><br><span class="line">  users = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = net.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">conn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> nickname;</span><br><span class="line"></span><br><span class="line">  conn.setEncoding(<span class="string">'utf8'</span>)</span><br><span class="line">  conn.write(</span><br><span class="line">    <span class="string">'\n &gt; 欢迎访问 \033[92mNode-Chat\033[39m!'</span></span><br><span class="line">  + <span class="string">'\n &gt; '</span> + count + <span class="string">'个其他用户已连接'</span></span><br><span class="line">  + <span class="string">'\n &gt; 请输入你的用户名并回车：'</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  count++</span><br><span class="line"></span><br><span class="line">  conn.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    data = data.replace(<span class="string">'\r\n'</span>, <span class="string">''</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!nickname) &#123;</span><br><span class="line">      <span class="keyword">if</span>(users[data]) &#123;</span><br><span class="line">        conn.write(<span class="string">'\033[93m&gt; 昵称已被使用，请重试：\033[39m '</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        nickname = data</span><br><span class="line">        users[nickname] = conn</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'users: '</span>, conn)</span><br><span class="line">        broadcast(<span class="string">'\033[90m &gt; '</span> + nickname + <span class="string">' 上线了\033[39m\n'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      broadcast(<span class="string">'\033[96m &gt; '</span> + nickname + <span class="string">':\033[39m '</span> + data + <span class="string">'\n'</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  conn.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    count--</span><br><span class="line">    <span class="keyword">delete</span> users[nickname]</span><br><span class="line">    broadcast(<span class="string">'\033[90m &gt; '</span> + nickname + <span class="string">' 下线了\033[39m\n'</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 向每一个用户发送信息</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">broadcast</span> (<span class="params">msg, exceptMyself</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> users) &#123;</span><br><span class="line">      <span class="keyword">if</span>(!exceptMyself || i != nickname) &#123;</span><br><span class="line">        users[i].write(msg)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'\033[96m  server listening on *: 3000\033[39m'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>单独运行：<code>telnet 127.0.0.1 3000</code>，比如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">~ telnet 127.0.0.1 3000</span><br><span class="line"></span><br><span class="line">Trying 127.0.0.1...</span><br><span class="line">Connected to localhost.</span><br><span class="line">Escape character is <span class="string">'^]'</span>.</span><br><span class="line"></span><br><span class="line"> &gt; 欢迎访问 Node-Chat!</span><br><span class="line"> &gt; 0个其他用户已连接</span><br><span class="line"> &gt; 请输入你的用户名并回车：XiaoMing</span><br><span class="line"> &gt; XiaoMing 上线了</span><br><span class="line">Hi </span><br><span class="line"> &gt; HanMeimei 上线了</span><br><span class="line"> &gt; HanMeimei: Hello</span><br><span class="line"> &gt; LiSi 上线了</span><br><span class="line"> &gt; LiSi: Ni hao ma?</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二位用户</span></span><br><span class="line"> &gt; 欢迎访问 Node-Chat!</span><br><span class="line"> &gt; 1个其他用户已连接</span><br><span class="line"> &gt; 请输入你的用户名并回车：HanMeimei</span><br><span class="line"> &gt; HanMeimei 上线了</span><br><span class="line">Hello</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第三位用户</span></span><br><span class="line"> &gt; 欢迎访问 Node-Chat!</span><br><span class="line"> &gt; 2个其他用户已连接</span><br><span class="line"> &gt; 请输入你的用户名并回车：LiSi</span><br><span class="line"> &gt; LiSi 上线了</span><br><span class="line">Ni hao ma?</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nodejs系列之Connect</title>
      <link href="/2019/06/11/node-connect/"/>
      <url>/2019/06/11/node-connect/</url>
      
        <content type="html"><![CDATA[<p>Connect 是一个基于 HTTP 服务器的工具集，成为中间件（middleware）。</p><p>中间件，其实就是一个简单的 JavaScript 函数。除了处理 req 和 res 对象之外，还接受一个 next 函数来做流控制。</p><a id="more"></a><h2 id="一个简单的网站"><a href="#一个简单的网站" class="headerlink" title="一个简单的网站"></a>一个简单的网站</h2><p>初始化：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> connect = <span class="built_in">require</span>(<span class="string">"connect"</span>);</span><br><span class="line"><span class="keyword">var</span> serveStatic = <span class="built_in">require</span>(<span class="string">"serve-static"</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = connect();</span><br><span class="line"></span><br><span class="line">app.use(serveStatic(path.join(__dirname, <span class="string">"public-optimized"</span>)));</span><br><span class="line">app.use(serveStatic(path.join(__dirname, <span class="string">"public"</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">// respond to all requests</span></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.end(<span class="string">"Hello from Connect!\n"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//create node.js http server and listen on port</span></span><br><span class="line">http.createServer(app).listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure><p>中间件的使用，模拟登录登出：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> connect = <span class="built_in">require</span>(<span class="string">"connect"</span>);</span><br><span class="line"><span class="keyword">var</span> morgan = <span class="built_in">require</span>(<span class="string">"morgan"</span>);</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">"body-parser"</span>);</span><br><span class="line"><span class="keyword">var</span> cookieParser = <span class="built_in">require</span>(<span class="string">"cookie-parser"</span>);</span><br><span class="line"><span class="keyword">var</span> session = <span class="built_in">require</span>(<span class="string">"express-session"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> users = <span class="built_in">require</span>(<span class="string">"./config/users.json"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = connect();</span><br><span class="line"></span><br><span class="line"><span class="comment">// logger</span></span><br><span class="line">app.use(morgan(<span class="string">"dev"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// parse an HTML body into a string</span></span><br><span class="line">app.use(bodyParser());</span><br><span class="line"></span><br><span class="line">app.use(cookieParser());</span><br><span class="line"></span><br><span class="line">app.use(</span><br><span class="line">  session(&#123;</span><br><span class="line">    secret: <span class="string">"my site secret"</span></span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">"/"</span> == req.url &amp;&amp; req.session.logged_in) &#123;</span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123; <span class="string">"Content-Type"</span>: <span class="string">"text/html"</span> &#125;);</span><br><span class="line">    res.end(</span><br><span class="line">      <span class="string">`Welcome back, &lt;b&gt;<span class="subst">$&#123;req.session.name&#125;</span>&lt;/b&gt;&lt;a href="/logout"&gt;Logout&lt;/a&gt;`</span></span><br><span class="line">    );</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">"/"</span> == req.url &amp;&amp; <span class="string">"GET"</span> == req.method) &#123;</span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123; <span class="string">"Content-Type"</span>: <span class="string">"text/html"</span> &#125;);</span><br><span class="line">    res.end(</span><br><span class="line">      [</span><br><span class="line">        <span class="string">'&lt;form method="POST" action="/login"&gt;'</span>,</span><br><span class="line">        <span class="string">"&lt;h1&gt;Login&lt;/h1&gt;"</span>,</span><br><span class="line">        <span class="string">"&lt;fieldset&gt;"</span>,</span><br><span class="line">        <span class="string">"&lt;label&gt;Please log in&lt;/label&gt;"</span>,</span><br><span class="line">        <span class="string">'Username: &lt;input type="text" name="user" /&gt;&lt;br&gt;'</span>,</span><br><span class="line">        <span class="string">'Password: &lt;input type="password" name="password" /&gt;'</span>,</span><br><span class="line">        <span class="string">"&lt;p&gt;&lt;button&gt;Submit&lt;/button&gt;&lt;/p&gt;"</span>,</span><br><span class="line">        <span class="string">"&lt;/fieldset&gt;"</span>,</span><br><span class="line">        <span class="string">"&lt;/form&gt;"</span></span><br><span class="line">      ].join(<span class="string">""</span>)</span><br><span class="line">    );</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">"/login"</span> == req.url &amp;&amp; <span class="string">"POST"</span> == req.method) &#123;</span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123; <span class="string">"Content-Type"</span>: <span class="string">"text/html"</span> &#125;);</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      !users[req.body.user] ||</span><br><span class="line">      req.body.password != users[req.body.user].password</span><br><span class="line">    ) &#123;</span><br><span class="line">      res.end(<span class="string">'Bad username/password&lt;br&gt;&lt;a href="/"&gt;Back&lt;/a&gt;'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      req.session.logged_in = <span class="literal">true</span>;</span><br><span class="line">      req.session.name = users[req.body.user].name;</span><br><span class="line">      res.end(<span class="string">"Success!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">"/logout"</span> == req.url) &#123;</span><br><span class="line">    req.session.logged_in = <span class="literal">false</span>;</span><br><span class="line">    res.writeHead(<span class="number">200</span>);</span><br><span class="line">    res.end(<span class="string">"Logged out!"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//create node.js http server and listen on port</span></span><br><span class="line">http.createServer(app).listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js设计模式学习之单例模式</title>
      <link href="/2019/05/03/mode-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/05/03/mode-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>保证一个类仅有一个实例，并提供一个访问它的全局访问点</p></blockquote><a id="more"></a><h4 id="实现一个单例模式"><a href="#实现一个单例模式" class="headerlink" title="实现一个单例模式"></a>实现一个单例模式</h4><p>用一个变量标志当前是否已经为某个类型创建过对象，如果是，则下次直接返回之前创建的对象。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Singleton = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.instance = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Singleton.prototype.getName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Singleton.getInstance = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.instance) &#123;</span><br><span class="line">    <span class="keyword">this</span>.instance = <span class="keyword">new</span> Singleton(name);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = Singleton.getInstance(<span class="string">'Tony1'</span>);</span><br><span class="line"><span class="keyword">var</span> b = Singleton.getInstance(<span class="string">'Tony2'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a === b); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>通过 <code>Singleton.getInstance</code>来获取 Singleton 类的唯一对象，里边使用了 new 来获取，导致了这个类的“不透明性”。</p><h4 id="透明的单例模式"><a href="#透明的单例模式" class="headerlink" title="透明的单例模式"></a>透明的单例模式</h4><p>创建一个“透明”的单例类，就是让我们从这个类中创建对象的时候可以和使用其他普通类一样：<code>var aa = new CreateDiv(&#39;Sisi1&#39;);</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CreateDiv = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> instance;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> CreateDiv = <span class="function"><span class="keyword">function</span> (<span class="params">html</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (instance) &#123;</span><br><span class="line">      <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.html = html;</span><br><span class="line">    <span class="keyword">this</span>.init();</span><br><span class="line">    <span class="keyword">return</span> instance = <span class="keyword">this</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  CreateDiv.prototype.init = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">    div.innerHTML = <span class="keyword">this</span>.html;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> CreateDiv;</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> aa = <span class="keyword">new</span> CreateDiv(<span class="string">'Sisi1'</span>);</span><br><span class="line"><span class="keyword">var</span> bb = <span class="keyword">new</span> CreateDiv(<span class="string">'Sisi2'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(aa === bb);  <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>下面这段代码中，CreateDiv 的构造函数负责了两件事：创建对象和执行初始化 init 方法，及保证只有一个对象：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CreateDiv = <span class="function"><span class="keyword">function</span> (<span class="params">html</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (instance) &#123;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.html = html;</span><br><span class="line">  <span class="keyword">this</span>.init();</span><br><span class="line">  <span class="keyword">return</span> instance = <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>但是，如果我们要创建很多的div，这里的 <code>return instance = this;</code> 就需要删掉。</p><h4 id="用代理实现单例模式"><a href="#用代理实现单例模式" class="headerlink" title="用代理实现单例模式"></a>用代理实现单例模式</h4><p>这时候，为了避免上面不能复用的尴尬，通过引入代理类的方式，把负责管理单例的逻辑移交至代理类<code>ProxySingletonCreateDiv</code>，这样<code>CreateDiv</code>只是一个普通的类。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CreateDiv = <span class="function"><span class="keyword">function</span> (<span class="params">html</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.html = html;</span><br><span class="line">  <span class="keyword">this</span>.init();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">CreateDiv.prototype.init = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">  div.innerHTML = <span class="keyword">this</span>.html;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ProxySingletonCreateDiv = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> instance;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">html</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!instance) &#123;</span><br><span class="line">      instance = <span class="keyword">new</span> CreateDiv(html);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> aa = <span class="keyword">new</span> ProxySingletonCreateDiv(<span class="string">'Tony1'</span>);</span><br><span class="line"><span class="keyword">var</span> bb = <span class="keyword">new</span> ProxySingletonCreateDiv(<span class="string">'Tony2'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(aa === bb); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h4 id="JavaScript-中的单例模式"><a href="#JavaScript-中的单例模式" class="headerlink" title="JavaScript 中的单例模式"></a>JavaScript 中的单例模式</h4><p>单例模式的核心是：确保只有一个实例，并提供全局访问。</p><ol><li>使用命名空间</li></ol><p>对象字面量的方式: </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> namespace1 = &#123;</span><br><span class="line">  a: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  b: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">namespace1.a(); <span class="comment">//1</span></span><br></pre></td></tr></table></figure><p>把a和b都定义为 namespace1 的属性，减少了变量和全局作用域打交道的机会，还可以动态地创建命名空间：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> MyApp = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">MyApp.namespace = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> parts = name.split(<span class="string">'.'</span>);</span><br><span class="line">  <span class="keyword">var</span> current = MyApp;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> parts) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!current[parts[i]]) &#123;</span><br><span class="line">      current[parts[i]] = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    current = current[parts[i]];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyApp.namespace(<span class="string">'event'</span>);</span><br><span class="line">MyApp.namespace(<span class="string">'dom.style'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(MyApp);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相当于：</span></span><br><span class="line"><span class="keyword">var</span> MyApp = &#123;</span><br><span class="line">  event: &#123;&#125;,</span><br><span class="line">  dom: &#123;</span><br><span class="line">    style: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. 使用闭包封装私有变量</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">使用下划线约定私有变量 _name 和 _age。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="keyword">var</span> user = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _name = <span class="string">'Seven'</span>;</span><br><span class="line">  <span class="keyword">var</span> _age = <span class="number">27</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    getUserInfo: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> _name + <span class="string">'-'</span> + _age;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(user.getUserInfo()) <span class="comment">// Seven-27</span></span><br></pre></td></tr></table></figure><h4 id="惰性单例"><a href="#惰性单例" class="headerlink" title="惰性单例"></a>惰性单例</h4><p>宗旨：在需要的时候才创建对象！！！</p><p>栗子：QQ的登录浮窗</p><p>第一种方案：页面加载完成的时候便创建好浮窗。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> loginLayer = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">  div.innerHTML = <span class="string">'我是一个小小的悬浮框'</span>;</span><br><span class="line">  div.style.display = <span class="string">'none'</span>;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">  <span class="keyword">return</span> div;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'loginBtn'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  loginLayer.style.display = <span class="string">'block'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>但是，不管我们登录与否，都会创建悬浮窗，所以我们可以修改为：在点击登录的时候再创建悬浮窗。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> createLoginLayer = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">  div.innerHTML = <span class="string">'我是一个小小的悬浮框'</span>;</span><br><span class="line">  div.style.display = <span class="string">'none'</span>;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">  <span class="keyword">return</span> div;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'loginBtn'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> loginLayer = createLoginLayer();</span><br><span class="line">  loginLayer.style.display = <span class="string">'block'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这时候，虽然达到了惰性的目的，却失去了单例的效果，每次点击登录，都会创建一个新的悬浮窗。</p><p>所以我们需要一个变量来判断是否已经创建过悬浮窗：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> createLoginLayer = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> div;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!div) &#123; <span class="comment">// 判断是否已创建</span></span><br><span class="line">      div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">      div.innerHTML = <span class="string">'我是一个小小的悬浮框'</span>;</span><br><span class="line">      div.style.display = <span class="string">'none'</span>;</span><br><span class="line">      <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> div;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'loginBtn'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> loginLayer = createLoginLayer();</span><br><span class="line">  loginLayer.style.display = <span class="string">'block'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="通用的惰性单例"><a href="#通用的惰性单例" class="headerlink" title="通用的惰性单例"></a>通用的惰性单例</h4><p>虽然上面的悬浮框是一个可用的惰性单例，但是仍然违反了单一职责原则，如果我们要创建其他的标签，就需要把创建悬浮窗的函数复制一份，再修修改改，无法做到复用。</p><p>所以，我们需要把不变的部分隔离出来，进行抽象，无论创建什么标签，都是一样的逻辑：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj;</span><br><span class="line"><span class="keyword">if</span>(!obj) &#123;</span><br><span class="line">  obj = xxx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接着，继续：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> getSingle = <span class="function"><span class="keyword">function</span> (<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> result || (result = fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> createLoginLayer = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">  div.innerHTML = <span class="string">'我是一个小小的悬浮框'</span>;</span><br><span class="line">  div.style.display = <span class="string">'none'</span>;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">  <span class="keyword">return</span> div;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> createSingleLoginLayer = getSingle(createLoginLayer);</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'loginBtn'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> loginLayer = createSingleLoginLayer();</span><br><span class="line">  loginLayer.style.display = <span class="string">'block'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这时，我们创建其他标签就只需要关系如何创建该标签就可以：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> createIframe = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> iframe = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);</span><br><span class="line">  iframe.src = <span class="string">'https://baidu.com'</span>;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(iframe);</span><br><span class="line">  <span class="keyword">return</span> iframe;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> createSingleIframe = getSingle(createIframe);</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'loginBtn2'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  createSingleIframe();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><p>单例模式是一种简单却非常常用的模式，特别是惰性单例技术，在合适的时候才创建对象，并且只创建唯一的一个。</p><p><em>创建对象</em> 和 <em>管理单例</em> 的职责被分布在两个不同的方法中，两个方法组合起来才具有单例模式的威力。</p><p>学习资料：</p><ul><li>《JavaScript 设计模式与开发实践》第 4 章</li></ul><p>发布：</p><ul><li>掘金<a href="https://juejin.im/post/5ccb927a6fb9a0324936c2c6" target="_blank" rel="noopener">《js设计模式学习之单例模式》</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jQuery插件写法小结之重写轮播图功能</title>
      <link href="/2019/05/03/plugin-slide-photo/"/>
      <url>/2019/05/03/plugin-slide-photo/</url>
      
        <content type="html"><![CDATA[<blockquote><p>最近在维护老网站的时候，发现一些jQuery库的使用有些臃肿，并且大部分自定义的js文件很容易污染全局变量，所以想着重写下，虽然jQuery的辉煌时代已经过去了，但是他的思想，依旧灿烂（滚去维护去）</p></blockquote><a id="more"></a><h2 id="先举个栗子"><a href="#先举个栗子" class="headerlink" title="先举个栗子"></a>先举个栗子</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> methods = &#123;</span><br><span class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 可自定义扩展项</span></span><br><span class="line">      options = $.extend(</span><br><span class="line">        <span class="literal">true</span>,</span><br><span class="line">        &#123;&#125;, </span><br><span class="line">        $.fn.myPlugin.defaults,</span><br><span class="line">        options</span><br><span class="line">      );</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'options'</span>, options, <span class="keyword">this</span>)</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    getName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Name is '</span>, $.fn.myPlugin.defaults.name, <span class="string">'.'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    getAge: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Age is '</span>, $.fn.myPlugin.defaults.age, <span class="string">'.'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    show: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.style.display == <span class="string">"none"</span> &amp;&amp; (<span class="keyword">this</span>.style.display = <span class="string">''</span>)</span><br><span class="line">        <span class="keyword">if</span> (getComputedStyle(<span class="keyword">this</span>, <span class="string">''</span>).getPropertyValue(<span class="string">"display"</span>) == <span class="string">"none"</span>)</span><br><span class="line">          <span class="keyword">this</span>.style.display = defaultDisplay(<span class="keyword">this</span>.nodeName)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    hide: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.css(<span class="string">"display"</span>, <span class="string">"none"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 命名空间最好只有一个</span></span><br><span class="line">  $.fn.myPlugin = <span class="function"><span class="keyword">function</span>(<span class="params">method</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方法调用，可满足三种情况：1. method, 2. init, 3. error</span></span><br><span class="line">    <span class="keyword">if</span>(methods[method]) &#123;</span><br><span class="line">      <span class="keyword">return</span> methods[method].apply(<span class="keyword">this</span>, <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>));  <span class="comment">//将具有length属性的对象转成数组</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> method === <span class="string">'object'</span> || !method) &#123;</span><br><span class="line">      <span class="comment">// 如果没有参数或者参数</span></span><br><span class="line">      <span class="keyword">return</span> methods.init.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      $.error(<span class="string">'Method'</span> + method + <span class="string">'does not exist on jQuery.myPlugin.'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.fn.myPlugin.defaults =  &#123;</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'zhangsan'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="string">'20'</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)(jQuery)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* --- 测试 --- */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化init</span></span><br><span class="line">$(<span class="string">'#testPara'</span>).myPlugin()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改参数</span></span><br><span class="line">$(<span class="string">'#testPara'</span>).myPlugin(&#123;</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'wuwang'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="string">'27'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调取方法</span></span><br><span class="line">$(<span class="string">'#testPara'</span>).myPlugin(<span class="string">'hide'</span>)</span><br><span class="line">$(<span class="string">'#testPara'</span>).myPlugin(<span class="string">'show'</span>)</span><br></pre></td></tr></table></figure><p>简单易懂，但是五脏俱全，接下来简单说明：</p><h4 id="搞定复杂参数列表"><a href="#搞定复杂参数列表" class="headerlink" title="搞定复杂参数列表"></a>搞定复杂参数列表</h4><p>首先，我们一般传参如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a1, a2, a3, a4</span>) </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">foo(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br></pre></td></tr></table></figure><p>那如果不传参呐？</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foo(<span class="number">1</span>, <span class="literal">null</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br></pre></td></tr></table></figure><p>就需要如上使用 null 来站位，参数多了，保证你晕。</p><p>所以，我们使用 <strong>可选哈希参数（options hash）</strong>，如：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">foo(<span class="number">1</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="number">4</span>)</span><br><span class="line"><span class="comment">// 改成</span></span><br><span class="line">foo(<span class="number">1</span>, &#123;</span><br><span class="line">    a4: <span class="number">4</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>接着，我们使用 jQuery 的 $.extend() 工具函数合并可选参数，并设置默认值：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params">a1, options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> settings = $.extend(&#123;</span><br><span class="line">        a2: value2,</span><br><span class="line">        a3: value3,</span><br><span class="line">        a4: value4</span><br><span class="line">    &#125;, options || &#123;&#125; );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>最后，就有了栗子中形态：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> settings = $.extend(</span><br><span class="line">    <span class="literal">true</span>,  <span class="comment">// 是否为深拷贝</span></span><br><span class="line">    &#123;&#125;,    <span class="comment">// 使用源元素属性来扩展目标对象</span></span><br><span class="line">    $.fn.myPlugin.defaults,  <span class="comment">// 默认的一个对象，将属性添加到 target（即&#123;&#125;） 目标对象中</span></span><br><span class="line">    options  <span class="comment">// 多个源后会覆盖前面同名的属性</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>这样，就再也不会纠结参数的不传或者多个占位传参，挺好。</p><p>实际操作下：先看一个多个参数的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#btn'</span>).myPlugin(&#123;</span><br><span class="line">  <span class="string">'mynewname'</span>: <span class="string">'lisi'</span>,</span><br><span class="line">  <span class="string">'mynewage'</span>: <span class="number">22</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 打印settings： &#123;name: "zhangsan", age: "20", mynewname: "lisi", mynewage: 22&#125;</span></span><br></pre></td></tr></table></figure><p>再看一个：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#btn'</span>).myPlugin(&#123;</span><br><span class="line">  <span class="string">'name'</span>: <span class="string">'lisi'</span>,</span><br><span class="line">  <span class="string">'mynewage'</span>: <span class="number">22</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#123;name: "lisi", age: "20", mynewage: 22&#125;</span></span><br></pre></td></tr></table></figure></p><p>一看就懂，有则覆盖，无则添加，完美。</p><h4 id="统一命名空间"><a href="#统一命名空间" class="headerlink" title="统一命名空间"></a>统一命名空间</h4><p>由于是jQuery插件，都挂载在 jQuery 对象下，所以恰当命名空间的插件尽可能不与其他插件冲突，甚至是 jQuery 的核心库方法。</p><p>比如：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> defaults = &#123;&#125;  <span class="comment">// 定义默认项</span></span><br><span class="line">    <span class="keyword">var</span> methods = &#123;&#125;  <span class="comment">// 定义方法</span></span><br><span class="line">    $.fn.myPlugin = <span class="function"><span class="keyword">function</span>(<span class="params">method</span>) </span>&#123;&#125;  <span class="comment">// 定义 myPlugin 命名空间并赋值一个匿名函数</span></span><br><span class="line">&#125;(jQuery)</span><br></pre></td></tr></table></figure></p><h4 id="允许公开访问默认设置"><a href="#允许公开访问默认设置" class="headerlink" title="允许公开访问默认设置"></a>允许公开访问默认设置</h4><p>为了更加的定制化，我们需要暴露默认的设置，这样我们就可以修改设置了。</p><p>首先修改 defaults 变量，为了暴露给外部世界，需要把它赋值给 $.fn 属性。并且为了统一命名空间原则，需要把它作为 myPlugin 的属性，如：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$.fn.myPlugin.defaults =  &#123;</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'zhangsan'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="string">'20'</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>接着，当使用默认值来合并参数选项时，在项目中只出现一次，即在 init() 方法里，如：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> methods = &#123;</span><br><span class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 可自定义扩展项</span></span><br><span class="line">      options = $.extend(</span><br><span class="line">        <span class="literal">true</span>,</span><br><span class="line">        &#123;&#125;, </span><br><span class="line">        $.fn.myPlugin.defaults,</span><br><span class="line">        options</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>这样，当我们在浏览器里直接测试：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取</span></span><br><span class="line">$.fn.myPlugin.defaults.name   <span class="comment">// zhangsan</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改</span></span><br><span class="line">$.fn.myPlugin.defaults.name = <span class="string">'wangwu'</span></span><br><span class="line"><span class="comment">// "wangwu"</span></span><br></pre></td></tr></table></figure></p><h4 id="维护链式调用性"><a href="#维护链式调用性" class="headerlink" title="维护链式调用性"></a>维护链式调用性</h4><p>使用 <code>return this</code> ，可以维护链式调用性。</p><h4 id="Array-prototype-slice-call"><a href="#Array-prototype-slice-call" class="headerlink" title="Array.prototype.slice.call()"></a>Array.prototype.slice.call()</h4><p><code>Array.prototype.slice.call(arguments)</code>能将具有length属性的对象转成数组 （<code>arguments.toArray().slice()</code>）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a=&#123;<span class="attr">length</span>:<span class="number">2</span>,<span class="number">0</span>:<span class="string">'first'</span>,<span class="number">1</span>:<span class="string">'second'</span>&#125;;</span><br><span class="line"><span class="built_in">Array</span>.prototype.slice.call(a);   <span class="comment">//Array [ "first", "second" ]</span></span><br></pre></td></tr></table></figure><h2 id="再举个栗子"><a href="#再举个栗子" class="headerlink" title="再举个栗子"></a>再举个栗子</h2><p>项目中经常使用轮播图，我们就在前人的基础上，模仿一下吧（你就说是抄的不就行了麽）：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showPhoto</span>(<span class="params">options, index</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $photoElement = $(options.photoElement);</span><br><span class="line">        <span class="keyword">if</span> (!$photoElement.is(<span class="string">':animated'</span>)) &#123;</span><br><span class="line">          $photoElement.animate(&#123;</span><br><span class="line">            opacity: <span class="number">0.5</span></span><br><span class="line">          &#125;, <span class="number">0</span>).attr(</span><br><span class="line">            <span class="string">'src'</span>,</span><br><span class="line">            options.transformer(options.$thumbnails[index].src)</span><br><span class="line">          ).animate(&#123;</span><br><span class="line">            opacity: <span class="number">1</span></span><br><span class="line">          &#125;, <span class="number">800</span>);</span><br><span class="line">          options.current = index;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="keyword">var</span> methods = &#123;</span><br><span class="line">      init: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">         options = $.extend(</span><br><span class="line">            <span class="literal">true</span>, &#123;&#125;,</span><br><span class="line">            $.fn.slidePhoto.defaults,</span><br><span class="line">            options, &#123;</span><br><span class="line">               current: <span class="number">0</span>, <span class="comment">// 初始值为0</span></span><br><span class="line">               $thumbnails: <span class="keyword">this</span>.filter(<span class="string">'img'</span>), <span class="comment">//选出所有的图片</span></span><br><span class="line">               delay: options.delay &gt;= <span class="number">1000</span> ? options.delay : <span class="number">1000</span>,</span><br><span class="line">            &#125;</span><br><span class="line">         );</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 点击图片，切换对应大图</span></span><br><span class="line">         options.$thumbnails.click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            showPhoto(options, options.$thumbnails.index(<span class="keyword">this</span>));</span><br><span class="line">         &#125;);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 显示下一张</span></span><br><span class="line">         $(options.nextControl + <span class="string">', '</span> + options.photoElement).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> index = (options.current + <span class="number">1</span>) % options.$thumbnails.length; <span class="comment">// 取模</span></span><br><span class="line"></span><br><span class="line">            showPhoto(options, index);</span><br><span class="line">         &#125;);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 显示上一张</span></span><br><span class="line">         $(options.previousControl).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> index = options.current === <span class="number">0</span> ? options.$thumbnails.length - <span class="number">1</span> : options.current - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            showPhoto(options, index);</span><br><span class="line">         &#125;);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 显示第一张</span></span><br><span class="line">         $(options.firstControl).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            showPhoto(options, <span class="number">0</span>);</span><br><span class="line">         &#125;).triggerHandler(<span class="string">'click'</span>); <span class="comment">// 主要是初始时触发，触发被选元素上指定的事件，返回事件处理函数的返回值</span></span><br><span class="line"></span><br><span class="line">         <span class="comment">// 显示最后一张</span></span><br><span class="line">         $(options.lastControl).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            showPhoto(options, options.$thumbnails.length - <span class="number">1</span>);</span><br><span class="line">         &#125;)</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 自动播放</span></span><br><span class="line">         <span class="keyword">var</span> tick;</span><br><span class="line"></span><br><span class="line">         <span class="function"><span class="keyword">function</span> <span class="title">autoPlay</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            tick = <span class="built_in">window</span>.setInterval(</span><br><span class="line">               <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                  $(options.nextControl).triggerHandler(<span class="string">'click'</span>)</span><br><span class="line">               &#125;, options.delay);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment">// 鼠标移入移出状态</span></span><br><span class="line">         <span class="function"><span class="keyword">function</span> <span class="title">mouserStatus</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">            $(obj).mouseenter(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">               <span class="keyword">if</span> (tick) &#123;</span><br><span class="line">                  <span class="built_in">window</span>.clearInterval(tick);</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;).mouseleave(autoPlay);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (options.autoPlayControl) &#123;</span><br><span class="line">            autoPlay();</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 鼠标滑动暂停、播放</span></span><br><span class="line">         mouserStatus(options.photoElement);</span><br><span class="line">         mouserStatus(options.$thumbnails);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line">   $.fn.slidePhoto = <span class="function"><span class="keyword">function</span> (<span class="params">method</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (methods[method]) &#123;</span><br><span class="line">         <span class="keyword">return</span> methods[method].apply(<span class="keyword">this</span>, <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>));</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> ($.type(method) === <span class="string">'object'</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> methods.init.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         $.error(<span class="string">'Method '</span> + method + <span class="string">' does not exist on jQuery.slidePhoto'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line">   $.fn.slidePhoto.defaults = &#123;</span><br><span class="line">      photoElement: <span class="string">'img.photomatic-photo'</span>, <span class="comment">// 大图显示</span></span><br><span class="line">      transformer: <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> name.replace(<span class="string">'thumbnail'</span>, <span class="string">'photo'</span>); <span class="comment">// 将'thumbnail' 替换为 'photo'，即最终返回大图的src属性值</span></span><br><span class="line">      &#125;,</span><br><span class="line">      nextControl: <span class="literal">null</span>, <span class="comment">// 下一张</span></span><br><span class="line">      previousControl: <span class="literal">null</span>, <span class="comment">// 前一张</span></span><br><span class="line">      firstControl: <span class="literal">null</span>, <span class="comment">// 第一张</span></span><br><span class="line">      lastControl: <span class="literal">null</span>, <span class="comment">// 最后一张</span></span><br><span class="line">      autoPlayControl: <span class="literal">false</span>,</span><br><span class="line">      delay: <span class="number">3000</span> <span class="comment">// 延时</span></span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line">&#125;)(jQuery)</span><br></pre></td></tr></table></figure><p>用法：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#thumbnails-pane img'</span>).slidePhoto(&#123;</span><br><span class="line">    photoElement: <span class="string">'#photo-display'</span>,</span><br><span class="line">    previousControl: <span class="string">'#previous-button'</span>,</span><br><span class="line">    nextControl: <span class="string">'#next-button'</span>,</span><br><span class="line">    firstControl: <span class="string">'#first-button'</span>,</span><br><span class="line">    lastControl: <span class="string">'#last-button'</span>,</span><br><span class="line">    autoPlayControl: <span class="literal">true</span>,</span><br><span class="line">    delay: <span class="number">3000</span></span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure></p><p>参考：</p><ul><li>《jQuery实战 第三版》</li></ul>]]></content>
      
      
      <categories>
          
          <category> 工具库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js插件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初探 this、call 和 apply</title>
      <link href="/2019/05/03/js-this-apply-call/"/>
      <url>/2019/05/03/js-this-apply-call/</url>
      
        <content type="html"><![CDATA[<h3 id="this"><a href="#this" class="headerlink" title="this"></a>this</h3><blockquote><p>JavaScript 中 this 总是指向一个对象</p></blockquote><a id="more"></a><h4 id="this-的指向"><a href="#this-的指向" class="headerlink" title="this 的指向"></a>this 的指向</h4><ol><li>作为对象的方法调用</li></ol><p>this 指向该对象，如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  getA: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span> === obj); <span class="comment">// true</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a); <span class="comment">// 1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.getA();</span><br></pre></td></tr></table></figure><ol start="2"><li>作为普通函数调用</li></ol><p>当函数不作为对象的属性被调用时，普通函数的 this 总是指向全局对象，浏览器里就是 window 对象。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">"globalName"</span>;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  name: <span class="string">"tyang"</span>,</span><br><span class="line">  getName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> getName = obj.getName;</span><br><span class="line"><span class="built_in">console</span>.log(obj.getName()); <span class="comment">// tyang</span></span><br><span class="line"><span class="built_in">console</span>.log(getName()); <span class="comment">// globalName</span></span><br></pre></td></tr></table></figure><p><code>obj.getName()</code> 作为 obj 对象的属性被调用，this 指向 obj 对象;</p><p><code>getName()</code> 使用变量 getName 引用 obj.getName，此时是函数调用方式，this 指向全局 window;</p><p>在严格模式，情况有所不同：this 不会指向全局对象，而是 undefined：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">  "use strict"</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>); <span class="comment">// undefined</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func();</span><br></pre></td></tr></table></figure><p>当函数作为某个对象的方法调用时，this 等于那个对象。不过，匿名函数的执行环境具有全局性，因此其 this 对象通常指向 window。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gName = <span class="string">"The window"</span>;</span><br><span class="line"><span class="keyword">var</span> gObject = &#123;</span><br><span class="line">  gName: <span class="string">"My object"</span>,</span><br><span class="line">  getName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 返回一个匿名函数</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.gName;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(gObject.getName()()); <span class="comment">// 'The window'</span></span><br><span class="line"><span class="keyword">var</span> getNameFunc = gObject.getName();</span><br><span class="line"><span class="built_in">console</span>.log(getNameFunc()); <span class="comment">// 'The window'</span></span><br></pre></td></tr></table></figure><p>创建了一个全局对象 <code>gName</code>，这个对象包含一个方法 <code>getName()</code>， 这个方法返回一个匿名函数，这个匿名函数返回 <code>this.name</code>。因此调用 <code>gObject.getName()()</code> 会立即执行匿名函数，并返回一个字符串 <code>&#39;The window&#39;</code>。</p><p>为什么匿名函数没有取得包含作用域的 this 对象呢？</p><p>每个函数再被调用的时候，会自动取得两个特殊变量：this 和 arguments，内部函数在搜索这两个变量时，只会搜索到其活动对象为止，因此永远不可能直接访问外部函数中的这两个变量。</p><p>所以，可以在外部作用域中设置一个变量来保存 this 对象：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gName = <span class="string">"The window"</span>;</span><br><span class="line"><span class="keyword">var</span> gObject = &#123;</span><br><span class="line">  gName: <span class="string">"My object"</span>,</span><br><span class="line">  getName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="keyword">this</span>; <span class="comment">// 将 this 对象赋值给 that 变量</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> that.gName; <span class="comment">// that 引用着 gObject</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(gObject.getName()()); <span class="comment">// 'My object'</span></span><br></pre></td></tr></table></figure><p>当然，arguments 对象也可以如此使用：对该对象的引用保存到另一个闭包能够访问的变量中。</p><ol><li>构造器调用</li></ol><p>当使用 new 运算符调用函数时，该函数会返回一个对象，一般情况下，构造器里的 this 指向返回的这个对象，如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> MyClass = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">"Lisi"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> nameObj = <span class="keyword">new</span> MyClass();</span><br><span class="line"><span class="built_in">console</span>.log(nameObj.name); <span class="comment">// Lisi</span></span><br></pre></td></tr></table></figure><p>但是，当显式返回一个 object 类型的对象时，那最终会返回这个对象，并不是之前的 this：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> MyClass = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">"Lisi"</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// 如果这里不会烦 object 类型的数据，如：return 'wangwu'，就不会返回显式对象</span></span><br><span class="line">    name: <span class="string">"wangwu"</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> nameObj = <span class="keyword">new</span> MyClass();</span><br><span class="line"><span class="built_in">console</span>.log(nameObj.name); <span class="comment">// wangwu</span></span><br></pre></td></tr></table></figure><ol start="4"><li>Function.prototype.call 或 Function.prototype.apply 调用</li></ol><p>call 和 apply 可以动态地改变传入函数的 this：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> personObj = &#123;</span><br><span class="line">  name: <span class="string">"ytao"</span>,</span><br><span class="line">  age: <span class="string">"22"</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.name + <span class="keyword">this</span>.age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(person.call(personObj)); <span class="comment">// ytao22</span></span><br></pre></td></tr></table></figure><h4 id="丢失的-this"><a href="#丢失的-this" class="headerlink" title="丢失的 this"></a>丢失的 this</h4><p>我们一般会重写这个获取 id 的方法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> getId = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">getId(<span class="string">"divBox"</span>);</span><br></pre></td></tr></table></figure><p>那可不可以这样呢：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getId2 = <span class="built_in">document</span>.getElementById;</span><br><span class="line">getId2(<span class="string">"divBox"</span>); <span class="comment">// Uncaught TypeError: Illegal invocation</span></span><br></pre></td></tr></table></figure><p>结果直接报错，当 <code>getElementById</code> 方法作为 document 对象的属性被调用时， 方法内部的 this 是指向 document 的。如果 <code>getId2(&#39;divBox&#39;)</code>，相当于是普通函数调用，函数内部的 this 指向的是 window。</p><p>所以，按照这个思路，我们可以这样模拟一下它的实现：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById = (<span class="function"><span class="keyword">function</span>(<span class="params">func</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> func.apply(<span class="built_in">document</span>, <span class="built_in">arguments</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)(<span class="built_in">document</span>.getElementById);</span><br><span class="line"></span><br><span class="line">getId3 = <span class="built_in">document</span>.getElementById;</span><br><span class="line">getId3(<span class="string">"divBox"</span>);</span><br></pre></td></tr></table></figure><h3 id="call-和-apply"><a href="#call-和-apply" class="headerlink" title="call 和 apply"></a>call 和 apply</h3><blockquote><p>fun.apply(thisArg, [argsArray])</p><p>fun.call(thisArg, arg1, arg2, …)</p></blockquote><p>在函数式编程中，call 和 apply 方法尤为有用，两者用法一致，只是传参的形式上有所区别而已。</p><h4 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h4><p>apply() 接受两个参数，第一个参数指定了函数体内 this 对象，第二个是数组或者类数组，apply() 方法将这个集合中的元素作为参数传递给被调用的函数。</p><p>call() 方法的作用和 apply() 方法类似，区别就是 call()方法接受的是参数列表，而 apply()方法接受的是一个参数数组。</p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/apply" target="_blank" rel="noopener">Function​.prototype​.apply()</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/call" target="_blank" rel="noopener">Function​.prototype​.call()</a></li></ul><p>第一个参数为 null，函数体内的 this 会指向默认的宿主对象，但是在严格模式下，依然是 null。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> applyFunc = <span class="function"><span class="keyword">function</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span> === <span class="built_in">window</span>);</span><br><span class="line">&#125;;</span><br><span class="line">applyFunc.apply(<span class="literal">null</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> applyFunc = <span class="function"><span class="keyword">function</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line"><span class="meta">  "use strict"</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span> === <span class="literal">null</span>);</span><br><span class="line">&#125;;</span><br><span class="line">applyFunc.apply(<span class="literal">null</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h4 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h4><ol><li>改变 this 指向</li></ol><p>假如在一个点击事件函数中有一个内部函数 func，当点击事件被触发时，就会出现如下情况：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"divBox"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.id); <span class="comment">// divBox</span></span><br><span class="line">  <span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.id); <span class="comment">// undefined，这里的 this 指向了 window</span></span><br><span class="line">  &#125;;</span><br><span class="line">  func();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>这时，我们用 call() 来改变一下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"divBox"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.id); <span class="comment">// divBox</span></span><br><span class="line">  <span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.id); <span class="comment">// divBox</span></span><br><span class="line">  &#125;;</span><br><span class="line">  func.call(<span class="keyword">this</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="2"><li>模拟 bind 方法</li></ol><blockquote><p>function.bind(thisArg[, arg1[, arg2[, …]]])</p></blockquote><p>bind()方法创建一个新的函数，在调用时设置 this 关键字为提供的值。并在调用新函数时，将给定参数列表作为原函数的参数序列的前若干项。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>; <span class="comment">// 保存原函数</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 返回新函数</span></span><br><span class="line">    <span class="keyword">return</span> self.apply(context, <span class="built_in">arguments</span>); <span class="comment">// 将传入的 context 当做新函数体内的 this</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bindObj = &#123;</span><br><span class="line">  name: <span class="string">"tyang"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bindFunc = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name); <span class="comment">// tyang</span></span><br><span class="line">&#125;.bind(bindObj);</span><br><span class="line"></span><br><span class="line">bindFunc();</span><br></pre></td></tr></table></figure><p>这是一个简化版的 <code>Function.prototype.bind</code>实现，<code>self.apply(context, arguments)</code>才是执行原来的 bindFunc 函数，并且指定 context 对象为 bindFunc 函数体内的 this。</p><p>我们再继续修改下，使之可以预先添加一些参数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>,</span><br><span class="line">    context = [].shift.call(<span class="built_in">arguments</span>), <span class="comment">// 获取参数中第一个为绑定的this上下文</span></span><br><span class="line">    args = [].slice.call(<span class="built_in">arguments</span>); <span class="comment">// 将剩余的参数转化为数组</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回新函数</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> self.apply(context, [].concat.call(args, [].slice.call(<span class="built_in">arguments</span>))); <span class="comment">//arguments 为新函数的参数，即传入的 3，4</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bindObj = &#123;</span><br><span class="line">  name: <span class="string">"lisisi"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bindFunc = <span class="function"><span class="keyword">function</span>(<span class="params">a, b, c, d</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name); <span class="comment">// lisisi</span></span><br><span class="line">  <span class="built_in">console</span>.log([a, b, c, d]); <span class="comment">// [1, 2, 3, 4]</span></span><br><span class="line">&#125;.bind(bindObj, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">bindFunc(<span class="number">3</span>, <span class="number">4</span>);</span><br></pre></td></tr></table></figure><p><code>self.apply(context, [].concat.call(args, [].slice.call(arguments)));</code>，执行新函数的时候，会把之前传入的 context 作为 this，<code>[].slice.call(arguments)</code>将新函数传入的参数转化为数组，并作为<code>[].concat.call(args)</code>的给定参数，组合两次，作为新函数最终的参数。</p><ol start="3"><li>借用其他对象的方法</li></ol><p>第一种，”借用构造函数“实现一些类似继承的效果：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> A = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> B = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  A.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">&#125;;</span><br><span class="line">B.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> bbb = <span class="keyword">new</span> B(<span class="string">"Yangtao"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(bbb.getName()); <span class="comment">//Yangtao</span></span><br></pre></td></tr></table></figure><p>第二种，给类数组对象使用数组方法，比如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">Array</span>.prototype.push.call(<span class="built_in">arguments</span>, <span class="number">3</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>); <span class="comment">// [1, 2, 3]</span></span><br><span class="line">&#125;)(<span class="number">1</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure><p>再比如之前用到的，把 arguments 转成真正的数组的时候可以借用 <code>Array.prototype.slice.call(arguments)</code>，想截去头一个元素时，借用<code>Array.prototype.shift.call(arguments)</code></p><p>虽然我们可以把”任意“对象传入 <code>Array.prototype.push</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> aObj = &#123;&#125;;</span><br><span class="line"><span class="built_in">Array</span>.prototype.push.call(aObj, <span class="string">"first"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(aObj.length); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(aObj[<span class="number">0</span>]); <span class="comment">// first</span></span><br></pre></td></tr></table></figure><p>但是，这个对象也得满足以下两个条件：</p><ul><li>对象本身要可以存取属性</li><li>对象的 length 属性可读写</li></ul><p>如果是其他类型，比如 number，无法存取；比如函数，length 属性不可写，使用 call 或 apply 就会报错：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">Array</span>.prototype.push.call(num, <span class="string">"2"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(num.length); <span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(num[<span class="number">0</span>]); <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> funcObj = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="built_in">Array</span>.prototype.push.call(funcObj, <span class="string">"3"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(funcObj.length); <span class="comment">// Uncaught TypeError: Cannot assign to read only property 'length' of function 'function () &#123;&#125;'</span></span><br></pre></td></tr></table></figure><p>学习资料：</p><ul><li>《JavaScript 高程 3》第七章</li><li>《JavaScript 设计模式与开发实践 · 曾探》第 2 章</li></ul><p>发布：</p><ul><li>掘金<a href="https://juejin.im/post/5cb915546fb9a0688539b53b" target="_blank" rel="noopener">《初探 this、call 和 apply》</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初探 JavaScript 的变量</title>
      <link href="/2019/02/25/js-var/"/>
      <url>/2019/02/25/js-var/</url>
      
        <content type="html"><![CDATA[<h3 id="基本类型和引用类型的值"><a href="#基本类型和引用类型的值" class="headerlink" title="基本类型和引用类型的值"></a>基本类型和引用类型的值</h3><a id="more"></a><p><code>ECMAScript</code>变量一般有两种数据类型的值：<strong>基本类型和引用类型</strong>。</p><ul><li>基本类型： 简单的数据段：<code>Undefined, Null, Boolean, Number, String</code></li><li>引用类型：多个值构成的对象；</li></ul><h4 id="1-动态的属性"><a href="#1-动态的属性" class="headerlink" title="1. 动态的属性"></a>1. 动态的属性</h4><p>定义两者的值：创建一个变量并为其变量赋值；</p><p>执行两者的值：</p><ul><li>引用类型：可以添加、删除属性和方法；</li><li>基本类型：不能添加、删除属性和方法；</li></ul><p>比如：引用类型 a，可以添加属性 name age<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">a.name = <span class="string">"杨子龙"</span>;</span><br><span class="line">a.age = <span class="number">24</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a.name);                      <span class="comment">//杨子龙</span></span><br></pre></td></tr></table></figure></p><p>基本类型 name 无法添加属性 age<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">"杨子龙"</span>;</span><br><span class="line">name.age  = <span class="number">24</span>;</span><br><span class="line"><span class="built_in">console</span>.log(name.age);                 <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure></p><p>代码中可知：只能给引用类型值动态地添加属性，以便将来使用。</p><h4 id="2-赋值变量值"><a href="#2-赋值变量值" class="headerlink" title="2. 赋值变量值"></a>2. 赋值变量值</h4><p>从一个变量向另一个变量复制基本类型值和引用类型值时：</p><ul><li>基本类型：在变量对象上创建一个新值，并将其值复制给新变量分配的位置上；（完全独立的两个变量）<br>例如：</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">111</span>;</span><br><span class="line"><span class="keyword">var</span> b = a;</span><br><span class="line"><span class="built_in">console</span>.log(b);                 <span class="comment">//111</span></span><br></pre></td></tr></table></figure><p>代码中可知：变量b的值只是变量a的值的一个副本，两者的值111是完全独立的。</p><ul><li>引用类型：将存储在变量对象中的值复制一份放到为新变量分配的空间中；（引用同一个对象的两个变量）</li></ul><p>引用类型的值的副本实际是一个指针，指向存储在堆中的一个对象。<br>例如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = <span class="keyword">new</span> <span class="built_in">Object</span>;</span><br><span class="line"><span class="keyword">var</span> obj2 = obj1;</span><br><span class="line">obj1.name = <span class="string">"杨子龙"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(obj2,name);                 <span class="comment">// Object &#123; name="杨子龙"&#125; 杨子龙</span></span><br></pre></td></tr></table></figure></p><p>代码中可知：obj1和obj2都指向同一个对象Object；所以，为obj1添加的name属性，通过obj2也可以访问的到。</p><h4 id="3-传递参数"><a href="#3-传递参数" class="headerlink" title="3. 传递参数"></a>3. 传递参数</h4><p>我们都知道基本类型是<strong>按值访问</strong>的，因为可以访问保存在变量中的实际的值。<br>所有函数的参数都是<strong>按值传递</strong>的。</p><ul><li>基本类型：基本类型值的传递如同基本类型变量的复制一样；<br>在向参数传递值，被传递的值会被复制给一个局部变量（命名参数），因此这个局部变量的变化不会反映在函数的外部。</li></ul><p>例如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  num += <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">var</span> result = fn(a);</span><br><span class="line"><span class="built_in">console</span>.log(result);        <span class="comment">//20</span></span><br><span class="line"><span class="built_in">console</span>.log(a);             <span class="comment">//10</span></span><br></pre></td></tr></table></figure><p>代码中可知：参数num和变量a互不相识，只是有着相同的值而已，用完之后，你还是你，我还是我，互不干政。</p><ul><li>引用类型：引用类型的传递如同引用类型变量的复制一样；<br>在向参数传递值时，会把这个值在内存中的地址复制给一个局部变量，因此这个局部变量的变化会反映在函数的外部。</li></ul><p>例如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  obj.name = <span class="string">'杨子龙'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">fn(person);</span><br><span class="line"><span class="built_in">console</span>.log(person.name);           <span class="comment">//杨子龙</span></span><br></pre></td></tr></table></figure></p><p>代码中可知：在这个函数内部，参数obj和变量person引用的是同一个对象Object，所以，你不动我也不动，你动我也动，你中有我，我中有你，情义绵绵，经久不息……</p><p>也就是说：即使变量person是按值传递的，但是参数obj（想象成局部变量）还是会按引用来访问同一个对象。</p><blockquote><p> 访问变量有按值和按引用两种方式，参数只能按值传递。</p></blockquote><h4 id="4-检测类型"><a href="#4-检测类型" class="headerlink" title="4. 检测类型"></a>4. 检测类型</h4><ul><li>基本类型：<code>typeof</code></li><li>引用类型：<code>instanceof</code>（对象或null）</li></ul><p>例如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">'Yang Zilong'</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">24</span>;</span><br><span class="line"><span class="keyword">var</span> c = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">var</span> d = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">var</span> e;</span><br><span class="line"><span class="keyword">var</span> g = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">var</span> f = <span class="literal">null</span>;  <span class="comment">// 比较特殊</span></span><br><span class="line"><span class="keyword">var</span> h = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> a); <span class="comment">//string</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> b); <span class="comment">//number </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> c); <span class="comment">//string</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> d); <span class="comment">//boolean</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> e); <span class="comment">//undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> g); <span class="comment">//undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> f); <span class="comment">//object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> h); <span class="comment">//object</span></span><br></pre></td></tr></table></figure><blockquote><p>所用引用类型的值都是Object的实例。</p></blockquote><p>如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line"><span class="keyword">var</span> num = [<span class="number">1</span>,<span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">var</span> pattern = <span class="regexp">/.at/i</span>;</span><br><span class="line"><span class="built_in">console</span>.log(person <span class="keyword">instanceof</span> <span class="built_in">Object</span>);     <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(num <span class="keyword">instanceof</span> <span class="built_in">Object</span>);        <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(num <span class="keyword">instanceof</span> <span class="built_in">Array</span>);         <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(pattern <span class="keyword">instanceof</span> <span class="built_in">Object</span>);    <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(pattern <span class="keyword">instanceof</span> <span class="built_in">RegExp</span>);    <span class="comment">//true</span></span><br></pre></td></tr></table></figure></p><blockquote><p>使用<code>instanceof</code>检测基本类型，会返回<code>false</code>，基本类型不是对象。</p></blockquote><ul><li>参考资料：《JavaScript高级程序设计》（第三版）第四章</li><li>同步于： <a href="https://juejin.im/post/5c73a28cf265da2de52d9390" target="_blank" rel="noopener">掘金</a>、<a href="https://www.imooc.com/article/280082" target="_blank" rel="noopener">慕课网</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初探JavaScript之Prototype</title>
      <link href="/2019/02/25/js-prototype/"/>
      <url>/2019/02/25/js-prototype/</url>
      
        <content type="html"><![CDATA[<h2 id="Array-prototype"><a href="#Array-prototype" class="headerlink" title="Array.prototype"></a><code>Array.prototype</code></h2><p><strong>每一个函数，都有一个 prototype 属性</strong>，不管是你自定义的，还是函数内置的。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(fn.prototype)  <span class="comment">// &#123;constructor: ƒ&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(fn.prototype.constructor === fn)  <span class="comment">// true</span></span><br></pre></td></tr></table></figure><a id="more"></a><p><img src="https://user-gold-cdn.xitu.io/2019/2/25/169237e0c93f8c42?w=410&amp;h=206&amp;f=png&amp;s=18863" alt="image"></p><p>这里的 <code>fn.prototype</code> 打印出一个对象，对象里的 <code>constructor</code> 属性又指回了该函数本身 fn。</p><p>即<strong>每个原型都有一个 consctructor 属性指向关联的构造函数</strong>，比如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span> === <span class="built_in">Array</span>.prototype.constructor <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p><img src="https://user-gold-cdn.xitu.io/2019/2/25/169237e0c9502534?w=417&amp;h=258&amp;f=png&amp;s=25521" alt="image"></p><p>我们接着看：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.prototype) <span class="comment">// [constructor: ƒ, concat: ƒ, copyWithin: ƒ, fill: ƒ, find: ƒ, …]</span></span><br></pre></td></tr></table></figure><p>这里，除了 constructor 属性，还有其他内置的属性，即我们经常使用的操作数组的方法。</p><h2 id="proto-隐式原型"><a href="#proto-隐式原型" class="headerlink" title="__proto__(隐式原型)"></a><code>__proto__</code>(隐式原型)</h2><p><strong>所有通过函数 <code>new</code> （构造函数）出来的东西，都有一个 <code>__proto__</code> 指向该函数的 <code>prototype</code></strong>，比如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>()</span><br><span class="line">arr.__proto__ === <span class="built_in">Array</span>.prototype <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Array</span> === <span class="built_in">Array</span>.prototype.constructor <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p><img src="https://user-gold-cdn.xitu.io/2019/2/25/169237e0c9690ff1?w=427&amp;h=333&amp;f=png&amp;s=32313" alt="image"></p><p>说白了，通过构造函数 new 出来的函数，该函数的<code>__proto__</code>属性指向构造函数的原型对象（即<code>Array.prototype</code>），所以，该函数与构造函数之间没有什么关联，是通过 原型对象 产生了联系，这也就是原型链继承的雏形吧。</p><p>举个关于继承 extends 的例子：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.eat = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Animal eat'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.bark = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Dog bark'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 绑定原型，实现继承</span></span><br><span class="line">Dog.prototype = <span class="keyword">new</span> Animal()</span><br><span class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> Dog()</span><br><span class="line"></span><br><span class="line">dog.eat()  <span class="comment">// Animal eat</span></span><br><span class="line">dog.bark()  <span class="comment">// Dog bark</span></span><br></pre></td></tr></table></figure><p>上面看明白了，那么ES6的继承我们也就可以明白原理了，即 <code>class Dog extends Animal</code> 相当于 <code>Dog.prototype = new Animal()</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line">  eat() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Animal eat!'</span> + <span class="keyword">this</span>.name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">super</span>(name) </span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line">  bark() &#123;  </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Dog bark!'</span> + <span class="keyword">this</span>.name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dog = <span class="keyword">new</span> Dog(<span class="string">'哈士奇'</span>)</span><br><span class="line">dog.eat()</span><br><span class="line">dog.bark()</span><br></pre></td></tr></table></figure><p>接下来，我们就清楚为什么能这样：</p><p><strong>当我们要使用一个对象（数组）的某个功能时，如果该对象本身具有这个功能，直接调用，没有的话，那就去自身的<code>__proto__</code>属性中去找</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  myfn: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'myfn'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.myfn() <span class="comment">// 'myfn'</span></span><br><span class="line">obj.hasOwnProperty(<span class="string">'myfn'</span>)  <span class="comment">//true</span></span><br><span class="line">obj.toString()  <span class="comment">// "[object Object]"</span></span><br><span class="line">obj.hasOwnProperty(<span class="string">'toString'</span>)  <span class="comment">// false</span></span><br><span class="line">obj.__proto__.hasOwnProperty(<span class="string">'toString'</span>)  <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p><code>hasOwnProperty()</code>就可以得出这个属性是否是属于该对象本身的属性:</p><ul><li>myfn 是我们自定义的，<code>obj.hasOwnProperty(&#39;myfn&#39;)</code>为 true</li><li>toString() 我们不是自定义的，却可以使用，查一下是否属于自定义属性，<code>obj.hasOwnProperty(&#39;toString&#39;)</code>，答案为false</li><li>既然不属于自定义属性，那就去自身的<code>__proto__</code>去找，然后去原型对象上查一下，<code>obj.__proto__.hasOwnProperty(&#39;toString&#39;)</code>，哦，原来在这儿</li></ul><p>在源码中，我们经常看到<code>Array.prototype.concat</code>，其实就是我们使用的<code>[].concat</code>，<code>[]</code>，因为<code>[].__proto__ === Array.prototype</code></p><h2 id="proto-是可修改的"><a href="#proto-是可修改的" class="headerlink" title="__proto__是可修改的"></a><code>__proto__</code>是可修改的</h2><p>比如，我们新增一个<code>addClass()</code>方法：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">arr.__proto__.addClass = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">123</span>);</span><br><span class="line">&#125;</span><br><span class="line">arr.push(<span class="number">4</span>);</span><br><span class="line">arr.addClass();   <span class="comment">// 123</span></span><br></pre></td></tr></table></figure></p><p><img src="https://user-gold-cdn.xitu.io/2019/2/25/169237e0c9bd1a05?w=542&amp;h=407&amp;f=png&amp;s=46941" alt="image"></p><p>但是，这里要注意，如下重写之后，就没有了诸如 push、concat等方法：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">arr.__proto__ = &#123;</span><br><span class="line">    addClass: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">123</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">arr.push(<span class="number">3</span>)  <span class="comment">//Uncaught TypeError: arr.push is not a function</span></span><br></pre></td></tr></table></figure><h3 id="Object-prototype的原型"><a href="#Object-prototype的原型" class="headerlink" title="Object.prototype的原型"></a><code>Object.prototype</code>的原型</h3><p>万物皆对象，到最后依旧是对象，最后这个东东是个啥，我们来看一下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构造函数 Person</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例对象 myfn，它的 隐式原型 指向了其构造函数的 原型对象</span></span><br><span class="line"><span class="keyword">var</span> myfn = <span class="keyword">new</span> Person()</span><br><span class="line">myfn.__proto__ === Person.prototype  <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 那构造函数 Person 的 隐式原型又指向了谁呢</span></span><br><span class="line">Person.prototype.__proto__ === <span class="built_in">Object</span>.prototype  <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Function呐</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.__proto__ === <span class="built_in">Object</span>.prototype  <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个呢</span></span><br><span class="line"><span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">fn.prototype.__proto__ === <span class="built_in">Object</span>.prototype  <span class="comment">//true</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.__proto__ === <span class="literal">null</span>  <span class="comment">//true</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">null</span>  <span class="comment">//"object"</span></span><br></pre></td></tr></table></figure></p><h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><ul><li><p>所有的函数都有一个 <code>prototype</code>属性，该属性指向了一个对象，该对象就是调用该构造函数而创建出来的实例（如myfn）的原型（如<code>myfn.__proto__</code>）,即：<code>myfn.__proto__ === Person.prototype</code></p></li><li><p>所有的对象（除null）都具有一个<code>__proto__</code>属性，该属性指向该对象的原型，比如：<code>myfn.__proto__ === Person.prototype</code></p></li><li><p>原型也是一个对象，根据上条，那原型的原型，就是<code>Object.prototype</code></p></li><li><p>最后的null对象，可以当做是 什么都没有</p></li></ul><p>盗一张图，我们就更加清楚了（蓝色这条表示的是原型链）<br><img src="https://user-gold-cdn.xitu.io/2019/2/25/169237e0c9a3b9c5?w=590&amp;h=525&amp;f=png&amp;s=40652" alt="image"></p><p>PS: 关于原型对象这一块本来就很绕，自己看懂了不一定就真的懂了，自己梳理的时候还是漏洞百出，而且还乱，就算现在我梳理了一遍，过些日子，我要是不再继续翻阅，应该又讲不通了，下面的资料很详细，在我学习的过程中提供了很大的帮助，在此感谢作者们！</p><p>参考资料：</p><ul><li><a href="https://www.kancloud.cn/wangfupeng/zepto-design-srouce/173684" target="_blank" rel="noopener">js原型链基础</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/2" target="_blank" rel="noopener">JavaScript深入之从原型到原型链 </a></li><li><a href="https://www.cnblogs.com/wangfupeng1988/p/3978131.html" target="_blank" rel="noopener">深入理解javascript原型和闭包（3）——prototype原型</a></li></ul><p>同步于 <a href="https://juejin.im/post/5c73950651882562276c4bb2" target="_blank" rel="noopener">掘金</a> 、<a href="https://www.qdfuns.com/article.php?mod=view&amp;id=27061d05c8bcf1e650ddddc75ad9c127&amp;uid=32286" target="_blank" rel="noopener">QDfuns</a></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Debounce 和 Throttle</title>
      <link href="/2019/02/24/debounce-throttle/"/>
      <url>/2019/02/24/debounce-throttle/</url>
      
        <content type="html"><![CDATA[<p>原文地址：<a href="https://www.tuicool.com/articles/YvyQRrv" target="_blank" rel="noopener">Debounce 和 Throttle 的原理及实现</a><br><a id="more"></a></p><h3 id="防抖和节流"><a href="#防抖和节流" class="headerlink" title="防抖和节流"></a>防抖和节流</h3><h4 id="防抖"><a href="#防抖" class="headerlink" title="防抖"></a>防抖</h4><p>如输入框时，只在最后提交的时候校验，即：将多次高频率操作优化为只在最后一次执行</p><p>思路：每次触发事件时，清除之前的定时器方法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">fn, wait, immediate</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'in'</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> context = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">let</span> args = <span class="built_in">arguments</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(immediate &amp;&amp; !timer) &#123;</span><br><span class="line">      fn.apply(context, args)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(timer) clearTimeout(timer)</span><br><span class="line">    timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'timer'</span>)</span><br><span class="line">      fn.apply(context, args)</span><br><span class="line">    &#125;, wait);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'被触发了'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>).onfocus = debounce(test, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure><h4 id="节流"><a href="#节流" class="headerlink" title="节流"></a>节流</h4><p>降低频率，每隔一段时间后执行一次，将高频率操作优化为低频率操作，如滚动条事件，resize事件</p><p>思路：每次触发事件时都判断当前是否有等待执行的延时函数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throtte</span>(<span class="params">fn, wait, immediate</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">let</span> callNow = immediate</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> args = <span class="built_in">arguments</span></span><br><span class="line">    <span class="keyword">let</span> context = <span class="keyword">this</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(callNow) &#123;</span><br><span class="line">      fn.apply(context, args)</span><br><span class="line">      callNow = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!timer) &#123;</span><br><span class="line">      timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        fn.apply(context, args)</span><br><span class="line">        timer = <span class="literal">null</span></span><br><span class="line">      &#125;, wait);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'resize'</span>, throtte(test, <span class="number">1000</span>))</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初探Class、继承、Promise 及 ES6 常用功能</title>
      <link href="/2019/02/24/es6-class/"/>
      <url>/2019/02/24/es6-class/</url>
      
        <content type="html"><![CDATA[<h3 id="Class-语法糖"><a href="#Class-语法糖" class="headerlink" title="Class - 语法糖"></a>Class - 语法糖</h3><ul><li>Class 在语法上更贴合面向对象的写法</li><li>Class 实现继承更加易读、易理解</li><li>更易于写 java 等后端语言的使用</li><li>本质还是语法糖，使用 prototype</li></ul><a id="more"></a><h4 id="ES5中的写法"><a href="#ES5中的写法" class="headerlink" title="ES5中的写法"></a>ES5中的写法</h4><p>获取实例对象的原型对象<code>Object.getPrototypeOf(m2)</code></p><p>判断实例与构造函数的原型对象是否有关系<code>MathHandle2.prototype.isPrototypeOf(m2)</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MathHandle2</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.x = x</span><br><span class="line">  <span class="keyword">this</span>.y = y</span><br><span class="line">&#125;</span><br><span class="line">MathHandle2.prototype.add = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.x + <span class="keyword">this</span>.y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m2 = <span class="keyword">new</span> MathHandle2(<span class="number">1</span>,<span class="number">3</span>)</span><br><span class="line"><span class="built_in">console</span>.log(m2.add())</span><br><span class="line"><span class="built_in">console</span>.log(m2.__proto__ === MathHandle2.prototype)  <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取实例对象的原型对象Object.getPrototypeOf()</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getPrototypeOf(m2) === MathHandle2.prototype)  <span class="comment">//true</span></span><br><span class="line"><span class="comment">// 判断实例与构造函数的原型对象是否有关系isPrototypeOf()</span></span><br><span class="line"><span class="built_in">console</span>.log(MathHandle2.prototype.isPrototypeOf(m2))  <span class="comment">//true</span></span><br></pre></td></tr></table></figure></p><h4 id="ES6中的写法"><a href="#ES6中的写法" class="headerlink" title="ES6中的写法"></a>ES6中的写法</h4><p>对象实例的隐式原型（属性）指向构造函数的原型对象<code>m.__proto__ === MathHandle.prototype</code></p><p>构造函数的原型对象的constructor属性指回了构造函数本身<code>MathHandle.prototype.constructor === MathHandle</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MathHandle</span> </span>&#123;   <span class="comment">// 构造函数</span></span><br><span class="line">  <span class="keyword">constructor</span>(x, y) &#123;</span><br><span class="line">    <span class="keyword">this</span>.x = x</span><br><span class="line">    <span class="keyword">this</span>.y = y</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  add() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.x + <span class="keyword">this</span>.y</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> m = <span class="keyword">new</span> MathHandle(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">console</span>.log(m.add())  <span class="comment">//4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象实例的隐式原型（属性）指向构造函数的原型对象</span></span><br><span class="line"><span class="built_in">console</span>.log(m.__proto__ === MathHandle.prototype)  <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造函数的原型对象的constructor属性指回了构造函数本身</span></span><br><span class="line"><span class="built_in">console</span>.log(MathHandle.prototype.constructor === MathHandle)  <span class="comment">//true</span></span><br></pre></td></tr></table></figure></p><h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><h4 id="prototype"><a href="#prototype" class="headerlink" title="prototype"></a>prototype</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.eat = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Animal eat'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.bark = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Dog bark'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 绑定原型，实现继承</span></span><br><span class="line">Dog.prototype = <span class="keyword">new</span> Animal()</span><br><span class="line"><span class="keyword">var</span> hashiqi = <span class="keyword">new</span> Dog()</span><br><span class="line">hashiqi.eat()  <span class="comment">// Animal eat</span></span><br><span class="line">hashiqi.bark()  <span class="comment">// Dog bark</span></span><br></pre></td></tr></table></figure><h4 id="extends"><a href="#extends" class="headerlink" title="extends"></a>extends</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line">  eat() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Animal eat!'</span> + <span class="keyword">this</span>.name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">super</span>(name) </span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line">  bark() &#123;  </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Dog bark!'</span> + <span class="keyword">this</span>.name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hashiqi = <span class="keyword">new</span> Dog(<span class="string">'哈士奇'</span>)</span><br><span class="line">hashiqi.eat()</span><br><span class="line">hashiqi.bark()</span><br></pre></td></tr></table></figure><h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><ul><li>new Promise 实例，而且要 return</li><li>new Promise 时要传入函数，函数有 resolve、reject 两个函数</li><li>成功时执行 resolve()，失败时执行 reject()</li><li>then 监听结果</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadImg</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>)</span><br><span class="line">    img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      resolve(img)</span><br><span class="line">    &#125;</span><br><span class="line">    img.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      reject()</span><br><span class="line">    &#125;</span><br><span class="line">    img.src = src</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> promise</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> src1 = <span class="string">'https://img3.mukewang.com/5c611772085966af06000338-240-135.jpg'</span></span><br><span class="line">  <span class="keyword">var</span> src2 = <span class="string">'https://img2.mukewang.com/5c6b7cff08d6895906000338-240-135.jpg'</span></span><br><span class="line">  <span class="keyword">var</span> result1 = loadImg(src1)</span><br><span class="line">  <span class="keyword">var</span> result2 = loadImg(src2)</span><br><span class="line"></span><br><span class="line">  result1.then(<span class="function"><span class="keyword">function</span>(<span class="params">img</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'第一张图片'</span>, img.src)</span><br><span class="line">    <span class="keyword">return</span> result2  <span class="comment">//串联操作</span></span><br><span class="line">  &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">img</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'第二张图片'</span>, img.src)</span><br><span class="line">  &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">ex</span>) </span>&#123;  <span class="comment">// 统一捕获错误信息</span></span><br><span class="line">    <span class="built_in">console</span>.log(ex)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Promise.all 接受一个 promise 对象的数组，待全部完成之后，统一执行 success</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> result3 = loadImg(src1)</span><br><span class="line">  <span class="keyword">var</span> result4 = loadImg(src2)</span><br><span class="line">  <span class="built_in">Promise</span>.all([result3, result4]).then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Promise.race 接受一个包含多个 promise 对象的数组，只要有一个完成，就执行 success</span></span><br><span class="line">  <span class="built_in">Promise</span>.race([result3,result4]).then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'race:'</span>, data)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h3 id="ES6常用功能"><a href="#ES6常用功能" class="headerlink" title="ES6常用功能"></a>ES6常用功能</h3><ul><li>let const</li><li>多行字符串、模板变量</li><li>解构赋值</li><li>块级作用域</li><li>函数默认参数</li><li>箭头函数</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// let const</span></span><br><span class="line"><span class="keyword">let</span> i = <span class="number">10</span>;</span><br><span class="line">i = <span class="number">20</span>;  <span class="comment">// Uncaught SyntaxError: Identifier 'i' has already been declared</span></span><br><span class="line"><span class="keyword">const</span> j = <span class="number">100</span></span><br><span class="line">j = <span class="number">20</span>  <span class="comment">// Uncaught TypeError: Assignment to constant variable.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 多行字符串、模板变量</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">'yangtao'</span>, age = <span class="number">27</span>;</span><br><span class="line"><span class="keyword">const</span> html = <span class="string">`</span></span><br><span class="line"><span class="string">  &lt;div&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;<span class="subst">$&#123;name&#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;<span class="subst">$&#123;age&#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构赋值</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;<span class="attr">a</span>: <span class="number">100</span>, <span class="attr">b</span>: <span class="number">200</span>&#125;</span><br><span class="line"><span class="keyword">const</span> &#123;a, b&#125; = obj</span><br><span class="line"><span class="comment">// 等同于（对象按照属性）</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">a</span>: <span class="number">100</span>, <span class="attr">b</span>: <span class="number">200</span>&#125;</span><br><span class="line"><span class="keyword">var</span> a = obj.a,</span><br><span class="line">    b = obj.b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="string">'xxx'</span>, <span class="string">'yyy'</span>, <span class="string">'zzz'</span>]</span><br><span class="line"><span class="keyword">const</span> [x, z] = arr</span><br><span class="line"><span class="comment">// 等同于(数组按照索引)</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="string">'xxx'</span>, <span class="string">'yyy'</span>, <span class="string">'zzz'</span>]</span><br><span class="line"><span class="keyword">var</span> x = arr[<span class="number">0</span>],</span><br><span class="line">    z = arr[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 块级作用域</span></span><br><span class="line"><span class="keyword">const</span> myObj = &#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> item <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(item)</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">var</span> myObj = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> _item <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(_item);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(item);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数参数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">num</span>(<span class="params">a,b=<span class="number">0</span></span>) </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">num2</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> b = <span class="built_in">arguments</span>.length &gt; <span class="number">1</span> &amp;&amp; <span class="built_in">arguments</span>[<span class="number">1</span>] !== <span class="literal">undefined</span> ? <span class="built_in">arguments</span>[<span class="number">1</span>] : <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 箭头函数</span></span><br><span class="line"><span class="keyword">const</span> myarr = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">myarr.map(<span class="function"><span class="params">item</span> =&gt;</span> item + <span class="number">1</span>)</span><br><span class="line">myarr.map(<span class="function">(<span class="params">item, index</span>) =&gt;</span> <span class="built_in">console</span>.log(item, index))</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">var</span> myarr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">myarr.map(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> item + <span class="number">1</span>;</span><br><span class="line">&#125;);</span><br><span class="line">myarr.map(<span class="function"><span class="keyword">function</span> (<span class="params">item, index</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">console</span>.log(item, index);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// this指向很诡异</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'real'</span>, <span class="keyword">this</span>)  <span class="comment">// real &#123;a: 10&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">  arr.map(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)  <span class="comment">// window</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">fn.call(&#123;<span class="attr">a</span>: <span class="number">10</span>&#125;)</span><br><span class="line"><span class="comment">// 使用箭头函数修改</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'real'</span>, <span class="keyword">this</span>)  <span class="comment">// real &#123;a: 10&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">  arr.map(<span class="function"><span class="params">item</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="keyword">this</span>))  <span class="comment">// &#123;a: 10&#125;</span></span><br><span class="line">&#125;</span><br><span class="line">fn.call(&#123;<span class="attr">a</span>: <span class="number">10</span>&#125;)</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _this = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'real'</span>, <span class="keyword">this</span>); <span class="comment">// real &#123;a: 10&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">  arr.map(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(_this);</span><br><span class="line">  &#125;); <span class="comment">// &#123;a: 10&#125;</span></span><br><span class="line">&#125;</span><br><span class="line">fn.call(&#123; <span class="attr">a</span>: <span class="number">10</span> &#125;);</span><br></pre></td></tr></table></figure><h3 id="关于-JS-众多模块化标准"><a href="#关于-JS-众多模块化标准" class="headerlink" title="关于 JS 众多模块化标准"></a>关于 JS 众多模块化标准</h3><ul><li>没有模块化</li><li>AMD成为标准，require.js(也有CMD)</li><li>前端打包工具，是node.js模块化可以被使用</li><li>ES6出现，想统一现在所有模块化标准</li><li>nodejs积极支持，浏览器尚未统一</li></ul><h4 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h4><ul><li>语法：import export(注意有无default)</li><li>环境：babel编译 ES6 语法，模块化可用 webpack 和 rollup</li><li>扩展：对模块化标准统一的期待</li></ul><h3 id="Rollup"><a href="#Rollup" class="headerlink" title="Rollup"></a>Rollup</h3><ul><li>rollup 功能单一，webpack 功能强大</li><li>参考设计原则和《Linux/Unix设计思想》</li><li>工具要尽量功能单一，可集成，可扩展</li><li>gulp + rollup</li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>说一说常见的请求头和相应头都有什么呢</title>
      <link href="/2019/02/20/header-response/"/>
      <url>/2019/02/20/header-response/</url>
      
        <content type="html"><![CDATA[<h3 id="1-请求-客户端-gt-服务端-request"><a href="#1-请求-客户端-gt-服务端-request" class="headerlink" title="1.请求(客户端-&gt;服务端[request])"></a>1.请求(客户端-&gt;服务端[request])</h3><a id="more"></a><ul><li><code>GET(请求的方式) /newcoder/hello.html</code>(请求的目标资源) <code>HTTP/1.1</code>(请求采用的协议和版本号) </li><li><code>Accept: */*</code>(客户端能接收的资源类型) </li><li><code>Accept-Language: en-us</code>(客户端接收的语言类型) </li><li><code>Connection: Keep-Alive</code>(维护客户端和服务端的连接关系) </li><li><code>Host: localhost:8080</code>(连接的目标主机和端口号) </li><li><code>Referer: http://localhost/links.asp</code>(告诉服务器我来自于哪里) </li><li><code>User-Agent: Mozilla/4.0</code>(客户端版本号的名字) </li><li><code>Accept-Encoding: gzip, deflate</code>(客户端能接收的压缩数据的类型) </li><li><code>If-Modified-Since: Tue, 11 Jul 2000 18:23:51 GMT</code>(缓存时间)  </li><li><code>Cookie</code>(客户端暂存服务端的信息) </li><li><code>Date: Tue, 11 Jul 2000 18:23:51 GMT</code>(客户端请求服务端的时间)</li></ul><h3 id="2-响应-服务端-gt-客户端-response"><a href="#2-响应-服务端-gt-客户端-response" class="headerlink" title="2.响应(服务端-&gt;客户端[response])"></a>2.响应(服务端-&gt;客户端[response])</h3><ul><li><code>HTTP/1.1</code>(响应采用的协议和版本号) <code>200</code>(状态码) <code>OK</code>(描述信息)</li><li><code>Location: http://www.baidu.com</code>(服务端需要客户端访问的页面路径) </li><li><code>Server:apache tomcat</code>(服务端的Web服务端名)</li><li><code>Content-Encoding: gzip</code>(服务端能够发送压缩编码类型) </li><li><code>Content-Length: 80</code>(服务端发送的压缩数据的长度) </li><li><code>Content-Language: zh-cn</code>(服务端发送的语言类型) </li><li><code>Content-Type: text/html; charset=GB2312</code>(服务端发送的类型及采用的编码方式)</li><li><code>Last-Modified: Tue, 11 Jul 2000 18:23:51 GMT</code>(服务端对该资源最后修改的时间)</li><li><code>Refresh: 1;url=http://www.it315.org</code>(服务端要求客户端1秒钟后，刷新，然后访问指定的页面路径)</li><li><code>Content-Disposition: attachment; filename=aaa.zip</code>(服务端要求客户端以下载文件的方式打开该文件)</li><li><code>Transfer-Encoding: chunked</code>(分块传递数据到客户端）  </li><li><code>Set-Cookie:SS=Q0=5Lb_nQ; path=/search</code>(服务端发送到客户端的暂存数据)</li><li><code>Expires: -1</code>//3种(服务端禁止客户端缓存页面数据)</li><li><code>Cache-Control: no-cache</code>(服务端禁止客户端缓存页面数据)  </li><li><code>Pragma: no-cache</code>(服务端禁止客户端缓存页面数据)   </li><li><code>Connection: close(1.0)/(1.1)Keep-Alive</code>(维护客户端和服务端的连接关系)  </li><li><code>Date: Tue, 11 Jul 2000 18:23:51 GMT</code>(服务端响应客户端的时间)</li></ul><blockquote><p>在服务器响应客户端的时候，带上<code>Access-Control-Allow-Origin</code>头信息，解决跨域的一种方法。</p></blockquote><p>原文地址：<a href="https://www.nowcoder.com/test/question/done?tid=21233299&amp;qid=55682#summary" target="_blank" rel="noopener">传送门</a></p>]]></content>
      
      
      <categories>
          
          <category> 网络知识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> http </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于闭包的一道面试题</title>
      <link href="/2019/02/19/js-closure/"/>
      <url>/2019/02/19/js-closure/</url>
      
        <content type="html"><![CDATA[<p>原文地址：<a href="https://www.nowcoder.com/questionTerminal/da4115e308c948169a9a73e50d09a3e7?toCommentId=2555046" target="_blank" rel="noopener">依次点击 4 个 li 标签，哪一个选项是正确的运行结果</a></p><a id="more"></a><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>现有如下 html 结构：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>click me<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>click me<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>click me<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>click me<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><p>依次点击 4 个 li 标签，运行结果是什么</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> elements = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"li"</span>);</span><br><span class="line"><span class="keyword">var</span> length = elements.length;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">  elements[i].onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(i);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="回答（依次弹出-4，4，4，4）"><a href="#回答（依次弹出-4，4，4，4）" class="headerlink" title="回答（依次弹出 4，4，4，4）"></a>回答（依次弹出 4，4，4，4）</h3><p>以下是我当时在牛客网回答时从《JavaScript 高级程序设计》书中抄的：</p><blockquote><p>这是由于作用域链的这种配置机制引出的一个副作用，即闭包只能取得包含函数中任何变量的最后一个值。闭包所保存的是整个变量对象，而不是某个特殊的变量。</p></blockquote><p>这里的闭包函数<code>elements[i].onclick=function(){alert(i);}</code>的作用域链中保存着闭包的活动对象（这里为空）和全局变量对象（主要是 i）,所以，它们引用的是同一个变量 i；当点击完成后，变量 i=4,也就是每个内部函数 i 的值都是 4；</p><p>可以通过创建另一个匿名函数强制让闭包的行为符合预期：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> elements = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"li"</span>);</span><br><span class="line">  <span class="keyword">var</span> length = elements.length;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    elements[i].onclick = (<span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        alert(num);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;)(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>在调用匿名函数时，我们传入变量 i，由于参数是按值传递的，所以就会将变量 i 的当前值复制给参数 num。而这个匿名函数内部，又创建并 alert 了一个访问 num 的闭包。这样，每一次点击都有 num 变量的一个副本，因此可以返回各自不同的数值。</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Express、Koa 初始化</title>
      <link href="/2019/02/17/node-express/"/>
      <url>/2019/02/17/node-express/</url>
      
        <content type="html"><![CDATA[<blockquote><p>对比一下 express 和 koa 的入口文件</p></blockquote><a id="more"></a><h2 id="express-初始化"><a href="#express-初始化" class="headerlink" title="express 初始化"></a>express 初始化</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> createError = <span class="built_in">require</span>(<span class="string">"http-errors"</span>);</span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">var</span> cookieParser = <span class="built_in">require</span>(<span class="string">"cookie-parser"</span>);</span><br><span class="line"><span class="keyword">var</span> logger = <span class="built_in">require</span>(<span class="string">"morgan"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载路由控制</span></span><br><span class="line"><span class="keyword">var</span> indexRouter = <span class="built_in">require</span>(<span class="string">"./routes/index"</span>);</span><br><span class="line"><span class="keyword">var</span> usersRouter = <span class="built_in">require</span>(<span class="string">"./routes/users"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 ejs 模板引擎即模板文件位置</span></span><br><span class="line">app.set(<span class="string">"views"</span>, path.join(__dirname, <span class="string">"views"</span>));</span><br><span class="line">app.set(<span class="string">"view engine"</span>, <span class="string">"ejs"</span>);</span><br><span class="line"><span class="comment">// 定义日志和输出级别</span></span><br><span class="line">app.use(logger(<span class="string">"dev"</span>));</span><br><span class="line"><span class="comment">// JSON 解析中间件</span></span><br><span class="line">app.use(express.json());</span><br><span class="line"><span class="comment">// application/x-www-form-urlencode请求解析中间件</span></span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line"><span class="comment">// 定义cookie解析器</span></span><br><span class="line">app.use(cookieParser());</span><br><span class="line"><span class="comment">// HTTP 伪造中间件</span></span><br><span class="line">app.use(express.methodOverride());</span><br><span class="line"><span class="comment">// 定义静态文件目录</span></span><br><span class="line">app.use(express.static(path.join(__dirname, <span class="string">"public"</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配路径和路由</span></span><br><span class="line">app.use(<span class="string">"/"</span>, indexRouter);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 404 错误处理</span></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  next(createError(<span class="number">404</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 500 错误处理及错误堆栈跟踪</span></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">err, req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// set locals, only providing error in development</span></span><br><span class="line">  res.locals.message = err.message;</span><br><span class="line">  res.locals.error = req.app.get(<span class="string">"env"</span>) === <span class="string">"development"</span> ? err : &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// render the error page</span></span><br><span class="line">  res.status(err.status || <span class="number">500</span>);</span><br><span class="line">  res.render(<span class="string">"error"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = app;</span><br></pre></td></tr></table></figure><h2 id="Koa-初始化"><a href="#Koa-初始化" class="headerlink" title="Koa 初始化"></a>Koa 初始化</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> views = <span class="built_in">require</span>(<span class="string">"koa-views"</span>);</span><br><span class="line"><span class="keyword">const</span> json = <span class="built_in">require</span>(<span class="string">"koa-json"</span>);</span><br><span class="line"><span class="keyword">const</span> onerror = <span class="built_in">require</span>(<span class="string">"koa-onerror"</span>);</span><br><span class="line"><span class="keyword">const</span> bodyparser = <span class="built_in">require</span>(<span class="string">"koa-bodyparser"</span>);</span><br><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">"koa-logger"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> index = <span class="built_in">require</span>(<span class="string">"./routes/index"</span>);</span><br><span class="line"><span class="keyword">const</span> users = <span class="built_in">require</span>(<span class="string">"./routes/users"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ENV = app.env;</span><br><span class="line"></span><br><span class="line"><span class="comment">// error handler</span></span><br><span class="line">onerror(app);</span><br><span class="line"></span><br><span class="line"><span class="comment">// middlewares</span></span><br><span class="line">app.use(</span><br><span class="line">  bodyparser(&#123;</span><br><span class="line">    enableTypes: [<span class="string">"json"</span>, <span class="string">"form"</span>, <span class="string">"text"</span>]</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line">app.use(json());</span><br><span class="line"></span><br><span class="line">app.use(logger(<span class="string">"dev"</span>));</span><br><span class="line"></span><br><span class="line">app.use(<span class="built_in">require</span>(<span class="string">"koa-static"</span>)(__dirname + <span class="string">"/public"</span>));</span><br><span class="line"></span><br><span class="line">app.use(</span><br><span class="line">  views(__dirname + <span class="string">"/views"</span>, &#123;</span><br><span class="line">    extension: <span class="string">"pug"</span></span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// logger</span></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> start = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="keyword">const</span> ms = <span class="keyword">new</span> <span class="built_in">Date</span>() - start;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;ctx.method&#125;</span> <span class="subst">$&#123;ctx.url&#125;</span> - <span class="subst">$&#123;ms&#125;</span>ms`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// routes</span></span><br><span class="line">app.use(index.routes(), index.allowedMethods());</span><br><span class="line"><span class="comment">// app.use(users.routes(), users.allowedMethods())</span></span><br><span class="line">app.use(user.routes(), index.allowedMethods());</span><br><span class="line">app.use(blog.routes(), index.allowedMethods());</span><br><span class="line"></span><br><span class="line"><span class="comment">// error-handling</span></span><br><span class="line">app.on(<span class="string">"error"</span>, (err, ctx) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">"server error"</span>, err, ctx);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = app;</span><br></pre></td></tr></table></figure><h2 id="实例目录"><a href="#实例目录" class="headerlink" title="实例目录"></a>实例目录</h2><ul><li><a href="https://github.com/yangtao2o/node-express-mongodb/blob/master/doc/doc-01-init.md" target="_blank" rel="noopener">网站初始化，实现 GET 和 POST 的 Ajax 请求</a></li><li><a href="https://github.com/yangtao2o/node-express-mongodb/blob/master/doc/doc-02-login.md" target="_blank" rel="noopener">登录模块</a></li><li><a href="https://github.com/yangtao2o/node-express-mongodb/blob/master/doc/doc-02-login.md" target="_blank" rel="noopener">上传图片模块</a></li></ul><blockquote><p>原文地址：<a href="https://github.com/jiaoyanlin/myNodeProject" target="_blank" rel="noopener">Node.js+Express+MongoDB 建站实例</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue经典实例 ToDoList</title>
      <link href="/2019/02/17/vue-todolist/"/>
      <url>/2019/02/17/vue-todolist/</url>
      
        <content type="html"><![CDATA[<blockquote><p>使用webpack构建一个vue的简易开发环境并添加一个Todo demo</p></blockquote><h3 id="ToDoList"><a href="#ToDoList" class="headerlink" title="ToDoList"></a>ToDoList</h3><h4 id="传送门：Demo-amp-amp-Github"><a href="#传送门：Demo-amp-amp-Github" class="headerlink" title="传送门：Demo &amp;&amp; Github"></a>传送门：<a href="https://istaotao.com/todo/dist/" target="_blank" rel="noopener">Demo</a> &amp;&amp; <a href="https://github.com/yangtao2o/todo" target="_blank" rel="noopener">Github</a></h4><a id="more"></a><p>下载：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/yangtao2o/todo.git</span><br></pre></td></tr></table></figure></p><p>下载依赖：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure></p><p>本地运行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure></p><p>访问地址：<code>http://localhost:8000</code></p><p>生产运行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 前端框架 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《Vue.js实战》之前端路由与vue-router</title>
      <link href="/2019/02/04/vue-router/"/>
      <url>/2019/02/04/vue-router/</url>
      
        <content type="html"><![CDATA[<h3 id="前端路由与-vue-router"><a href="#前端路由与-vue-router" class="headerlink" title="前端路由与 vue-router"></a>前端路由与 vue-router</h3><a id="more"></a><h4 id="什么是前端路由"><a href="#什么是前端路由" class="headerlink" title="什么是前端路由"></a>什么是前端路由</h4><blockquote><p>每次 GET 或者 POST 请求在服务端有一个专门的正则配置列表，然后匹配到具体的一条路径后，分发到不同的 Controller，进行各种操作，最终将 html 或数据返回给前端，这就完成了一次 IO。</p></blockquote><p>前端路由的实现有两种：</p><ul><li>URL的hash，即锚点（#），js 通过 hashChange 事件监听 url 的变化</li><li>HTML5 的 History 模式</li></ul><p>优点：</p><ul><li>页面持久性，如音乐网站</li><li>前后端彻底分离，如 Angular 的 ngRouter，React 的 ReactRouter，还有 Vue 的 vue-router</li></ul><p>需要考虑的问题：</p><ul><li>页面的拔插性</li><li>页面的生命周期</li><li>内存管理等</li></ul><h4 id="vue-router-基本用法"><a href="#vue-router-基本用法" class="headerlink" title="vue-router 基本用法"></a>vue-router 基本用法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建目录 router</span></span><br><span class="line"><span class="comment"># 安装 vue-router</span></span><br><span class="line">npm i -S vue-router</span><br><span class="line"></span><br><span class="line"><span class="comment"># index.js添加</span></span><br><span class="line">import VueRouter from <span class="string">'vue-router'</span>;</span><br><span class="line">Vue.use(VueRouter);</span><br></pre></td></tr></table></figure><p>在目录 router 新建 views 目录，接着新建 about.vue、 index.vue、 user.vue等</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> Routers = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/index'</span>,</span><br><span class="line">    component: <span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">require</span>([<span class="string">'../router/views/index.vue'</span>], resolve)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/about'</span>,</span><br><span class="line">    component: <span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">require</span>([<span class="string">'../router/views/about.vue'</span>], resolve)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'*'</span>,</span><br><span class="line">    redirect: <span class="string">'../index'</span>  <span class="comment">// 404指向首页</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> RouterConfig = &#123;</span><br><span class="line">  <span class="comment">// 使用HTML5的history路由模式</span></span><br><span class="line">  mode: <span class="string">'history'</span>,</span><br><span class="line">  routes: Routers</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(RouterConfig);</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(root);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  router: router,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;).$mount(root);</span><br></pre></td></tr></table></figure><p>路由模式通过HTML5的History路由模式，通过 ‘/’设置路径。修改package.json:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "dev": "webpack-dev-server --config webpack.config.js --mode=development --history-api-fallback"</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p><p>增加了 <code>--history-api-fallback</code>，所有的路由都指向<code>index.html</code>。</p><p>然后在根实例<code>App.vue</code>中添加<code>&lt;router-view&gt;&lt;/router-view&gt;</code></p><h4 id="跳转"><a href="#跳转" class="headerlink" title="跳转"></a>跳转</h4><p>vue-router 有两种跳转页面的方式：</p><ul><li><code>&lt;router-link&gt;</code>组件，会渲染成 <code>&lt;a&gt;</code> 标签，如：<code>&lt;router-link to=&quot;/about&quot;&gt;跳转到 about&lt;/router-link&gt;</code><ul><li>tag : <code>tag=&quot;li&quot;</code> 标签会被渲染成指定的 <code>&lt;li&gt;</code></li><li>replace : 无历史记录</li><li>active-class</li></ul></li><li>使用router实例： <code>$router</code> 方法，如：<code>this.$router.push(&#39;/index&#39;);</code><ul><li>replace : <code>this.$router.replace(&#39;/index&#39;)</code>;</li><li>go : <code>this.$router.go(-1)</code>;<h4 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h4><blockquote><p>问题：如何在SPA项目中，修改网页的标题？</p></blockquote></li></ul></li></ul><p>一般我们是通过<code>window.document.title = &#39;标题&#39;</code>来修改，但是在什么时候修改，这是个问题。</p><p>vue-router 提供了导航钩子 <code>beforeEach()</code> 和 <code>afterEach()</code>，它们会在路由即将改变前和改变后触发。</p><p>这样就解决了页面众多，维护麻烦的问题。（mounted钩子）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 从路由对象 to 里获取 meta 信息</span></span><br><span class="line">  <span class="built_in">window</span>.document.title = to.meta.title;</span><br><span class="line">  <span class="comment">// 判断页面是否登录</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">window</span>.localStorage.getItem(<span class="string">'token'</span>)) &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next(<span class="string">'/login'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.afterEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 页面跳转回来滚动条默认在顶端</span></span><br><span class="line">  <span class="built_in">window</span>.scroll(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="状态管理与-Vuex"><a href="#状态管理与-Vuex" class="headerlink" title="状态管理与 Vuex"></a>状态管理与 Vuex</h3><h4 id="状态管理与使用场景"><a href="#状态管理与使用场景" class="headerlink" title="状态管理与使用场景"></a>状态管理与使用场景</h4><p>组件的基本运行模式：一个组件分为数据和视图，数据更新时，视图也跟着更新…视图中又可以绑定一些事件，它们触发methods里指定的方法，从而可以改变数据、更新视图。</p><p>如果需要跨组件共享数据的需求，那就需要借助 Vuex 来管理组件状态。</p><h4 id="Vuex-基本用法"><a href="#Vuex-基本用法" class="headerlink" title="Vuex 基本用法"></a>Vuex 基本用法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -S vuex</span><br></pre></td></tr></table></figure><h4 id="高级用法-1"><a href="#高级用法-1" class="headerlink" title="高级用法"></a>高级用法</h4><h3 id="实战：中央事件总线插件-vue-bus-loading…"><a href="#实战：中央事件总线插件-vue-bus-loading…" class="headerlink" title="实战：中央事件总线插件 vue-bus(loading…)"></a>实战：中央事件总线插件 vue-bus(loading…)</h3><blockquote><p><a href="https://github.com/yangtao2o/vue-webpack-iview" target="_blank" rel="noopener">练习地址</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 前端框架 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue-router </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《Vue.js实战》之使用webpack</title>
      <link href="/2019/02/04/vue-webpack/"/>
      <url>/2019/02/04/vue-webpack/</url>
      
        <content type="html"><![CDATA[<h3 id="使用-webpack"><a href="#使用-webpack" class="headerlink" title="使用 webpack"></a>使用 webpack</h3><a id="more"></a><h4 id="前端工程化与webpack"><a href="#前端工程化与webpack" class="headerlink" title="前端工程化与webpack"></a>前端工程化与webpack</h4><p>前端工程化主要解决的问题：</p><ul><li>JavaScript、css 代码的合并与压缩</li><li>CSS 预处理：Less、Sass、Stylus 的编译</li><li>生成雪碧图</li><li>ES6 -&gt; ES5</li><li>模块化等</li></ul><p>webpack 的主要使用场景是<code>单页面富应用（SPA）</code>，将一些诸如：typescript、less、jpg、vue等格式的文件通过特定的<code>加载器（Loader）</code>编译后，最终统一生成 .js、.css、.png等静态资源文件。</p><p>如何文件都可称为是一个模块。webpack就是处理模块间的依赖关系，并把他们进行打包。</p><h3 id="webpack-基础配置"><a href="#webpack-基础配置" class="headerlink" title="webpack 基础配置"></a>webpack 基础配置</h3><h4 id="安装-webpack-与-webpack-dev-server"><a href="#安装-webpack-与-webpack-dev-server" class="headerlink" title="安装 webpack 与 webpack-dev-server"></a>安装 webpack 与 webpack-dev-server</h4><p>初始化<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm init  </span><br><span class="line"><span class="comment"># 按照提示一步步往下走</span></span><br></pre></td></tr></table></figure></p><p>本地局部安装 webpack:（书中是v2，我的需要下载脚手架 -cli）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack --save-dev</span><br><span class="line">npm i -D webpack-cli</span><br><span class="line"></span><br><span class="line"><span class="comment"># 会多出下面一项“</span></span><br><span class="line"><span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">  <span class="string">"webpack"</span>: <span class="string">"^4.28.4"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>安装 <code>webpack-dev-server</code>，可以启动一个服务器、热更新、接口代理等<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-dev-server --save-dev</span><br></pre></td></tr></table></figure></p><p>最终的 package.json 文件内容如下：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"vue-webpack-iview"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"学习《Vue.js实战》之进阶篇"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"repository"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"git"</span>,</span><br><span class="line">    <span class="attr">"url"</span>: <span class="string">"git+https://github.com/yangtao2o/vue-webpack-iview.git"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"keywords"</span>: [</span><br><span class="line">    <span class="string">"vue"</span>,</span><br><span class="line">    <span class="string">"webpack"</span>,</span><br><span class="line">    <span class="string">"iview"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">"yangtao"</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="attr">"bugs"</span>: &#123;</span><br><span class="line">    <span class="attr">"url"</span>: <span class="string">"https://github.com/yangtao2o/vue-webpack-iview/issues"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"homepage"</span>: <span class="string">"https://github.com/yangtao2o/vue-webpack-iview#readme"</span>,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"webpack"</span>: <span class="string">"^4.28.4"</span>,</span><br><span class="line">    <span class="attr">"webpack-cli"</span>: <span class="string">"^3.2.1"</span>,</span><br><span class="line">    <span class="attr">"webpack-dev-server"</span>: <span class="string">"^3.1.14"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="就是一个-js-文件而已"><a href="#就是一个-js-文件而已" class="headerlink" title="就是一个 js 文件而已"></a>就是一个 js 文件而已</h4><p>创建 <code>webpack.config.js</code>，并初始化：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> config = &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = config;</span><br></pre></td></tr></table></figure><p>接着，在 package.json 里配置启动项：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",</span><br><span class="line">  "dev": "webpack-dev-server --open --config webpack.config.js --mode=development"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// --open：会在启动服务时自动打开浏览器</span><br><span class="line">// --config：指向 webpack-dev-server 读取的配置文件路径</span><br><span class="line">// --host --port：可配置 IP 和端口，如：--host 172.172.172.1 --port 8888</span><br><span class="line">// --mode=development：需要说明是什么环境，不然会显示警告</span><br></pre></td></tr></table></figure><p>webpack 的入口（Entry）和出口（Output），重中之重，新建 <code>main.js</code>，并在 <code>webpack.config.js</code> 中进行入口和输出的配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var config = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    main: &apos;./main&apos;  // 入口文件为 main.js</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.join(__dirname, &apos;./dist&apos;),  // 输出目录</span><br><span class="line">    publicPath: &apos;./dist&apos;,  //指定资源文件引用的目录</span><br><span class="line">    filename: &apos;main.js&apos;  // 指定输出文件的名称</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = config;</span><br></pre></td></tr></table></figure></p><p>然后：<code>npm run dev</code>，浏览器会自动打开页面了。</p><h4 id="逐步完善配置文件"><a href="#逐步完善配置文件" class="headerlink" title="逐步完善配置文件"></a>逐步完善配置文件</h4><p>webpack 对于不同的模块需要不同的加载器来处理，通过安装不同的加载器，就可以对各种后缀名的文件进行处理。</p><p>如处理 .css 文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># css</span></span><br><span class="line">npm install css-loader --save-dev</span><br><span class="line">npm install style-loader --save-dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># rules 属性中可以指定一系列的 loaders</span></span><br><span class="line"><span class="comment"># 每一个 loader 都必须包含 test 和 use </span></span><br><span class="line"><span class="comment"># 处理名为 .css 的文件时，先通过 css-loader 转换，再通过 style-loader 转换，然后继续打包</span></span><br><span class="line">module: &#123;</span><br><span class="line">  rules: [  </span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">test</span>: <span class="string">'/\.css$/'</span>,</span><br><span class="line">      use: [</span><br><span class="line">        <span class="string">'style-loader'</span>,</span><br><span class="line">        <span class="string">'css-loader'</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>在实际的业务中，需要使用插件 <code>extract-text-webpack-plugin</code> 把各处的css文件提取出来。，并生成一个 main.css 文件，最终在 index.html 里加载它。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install extract-text-webpack-plugin@next --save-dev</span><br></pre></td></tr></table></figure><p>config<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="string">'/\.css$/'</span>,</span><br><span class="line">      use: ExtractTextPlugin.extract(&#123;</span><br><span class="line">        use: <span class="string">'css-loader'</span>,</span><br><span class="line">        fallback: <span class="string">'style-loader'</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> ExtractTextPlugin(<span class="string">'main.css'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p><h3 id="单文件组件与-vue-loader"><a href="#单文件组件与-vue-loader" class="headerlink" title="单文件组件与 vue-loader"></a>单文件组件与 vue-loader</h3><p>安装加载器：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev vue vue-loader vue-style-loader</span><br><span class="line">npm install --save-dev vue-template-compiler</span><br><span class="line">npm install --save-dev vue-hot-reload-api</span><br><span class="line">npm i -D babel babel-loader</span><br><span class="line">npm i -D @babel/core</span><br><span class="line">npm i -D @babel/preset-env</span><br></pre></td></tr></table></figure></p><p>配置：<br><a href="https://www.babeljs.cn/docs/setup/#installation" target="_blank" rel="noopener">Babel-loader</a>、<a href="https://vue-loader.vuejs.org/zh/guide/" target="_blank" rel="noopener">Vue-loader</a></p><h4 id="结合自己配置的过程中关于版本冲突的解决办法"><a href="#结合自己配置的过程中关于版本冲突的解决办法" class="headerlink" title="结合自己配置的过程中关于版本冲突的解决办法"></a>结合自己配置的过程中关于版本冲突的解决办法</h4><p>参考：<a href="https://blog.csdn.net/weixin_40814356/article/details/80625747" target="_blank" rel="noopener">webpack4配置vue环境和一些小坑</a></p><p>主要修改：</p><ul><li><p>index.js(之前的 <code>main.js</code>，目录也放在了<code>/src/</code>下)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span>;</span><br><span class="line"><span class="keyword">const</span> root = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(root);</span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;).$mount(root);</span><br></pre></td></tr></table></figure></li><li><p>App.vue</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    Hello &#123;&#123; name &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">    data() &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        name: <span class="string">'Vue.js'</span></span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>package.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,</span><br><span class="line">  <span class="string">"dev"</span>: <span class="string">"webpack-dev-server --config webpack.config.js --mode=development"</span>,</span><br><span class="line">  <span class="string">"build"</span>: <span class="string">"webpack --progress --hide-modules --mode=production"</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">  <span class="string">"@babel/core"</span>: <span class="string">"^7.2.2"</span>,</span><br><span class="line">  <span class="string">"@babel/preset-env"</span>: <span class="string">"^7.2.3"</span>,</span><br><span class="line">  <span class="string">"babel"</span>: <span class="string">"^6.23.0"</span>,</span><br><span class="line">  <span class="string">"babel-loader"</span>: <span class="string">"^8.0.5"</span>,</span><br><span class="line">  <span class="string">"css-loader"</span>: <span class="string">"^2.1.0"</span>,</span><br><span class="line">  <span class="string">"extract-text-webpack-plugin"</span>: <span class="string">"^4.0.0-beta.0"</span>,</span><br><span class="line">  <span class="string">"style-loader"</span>: <span class="string">"^0.23.1"</span>,</span><br><span class="line">  <span class="string">"vue"</span>: <span class="string">"^2.5.22"</span>,</span><br><span class="line">  <span class="string">"vue-hot-reload-api"</span>: <span class="string">"^2.3.1"</span>,</span><br><span class="line">  <span class="string">"vue-loader"</span>: <span class="string">"^15.5.1"</span>,</span><br><span class="line">  <span class="string">"vue-style-loader"</span>: <span class="string">"^4.1.2"</span>,</span><br><span class="line">  <span class="string">"vue-template-compiler"</span>: <span class="string">"^2.5.22"</span>,</span><br><span class="line">  <span class="string">"webpack"</span>: <span class="string">"^4.28.4"</span>,</span><br><span class="line">  <span class="string">"webpack-cli"</span>: <span class="string">"^3.2.1"</span>,</span><br><span class="line">  <span class="string">"webpack-dev-server"</span>: <span class="string">"^3.1.14"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><ul><li><p>webpack.config.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> VueLoaderPlugin = <span class="built_in">require</span>(<span class="string">'vue-loader/lib/plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: path.join(__dirname, <span class="string">'./src/index.js'</span>),</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.join(__dirname, <span class="string">'./dist'</span>),  <span class="comment">// 输出目录</span></span><br><span class="line">    publicPath: <span class="string">'/dist'</span>,  <span class="comment">//指定资源文件引用的目录</span></span><br><span class="line">    filename: <span class="string">'main.js'</span>  <span class="comment">// 指定输出文件的名称</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">        loader: <span class="string">'vue-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          loaders: &#123;</span><br><span class="line">            css: ExtractTextPlugin.extract(&#123;</span><br><span class="line">              use: <span class="string">'css-loader'</span>,</span><br><span class="line">              fallback: <span class="string">'vue-style-loader'</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: ExtractTextPlugin.extract(&#123;</span><br><span class="line">          use: <span class="string">'css-loader'</span>,</span><br><span class="line">          fallback: <span class="string">'style-loader'</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> VueLoaderPlugin(),</span><br><span class="line">    <span class="keyword">new</span> ExtractTextPlugin(<span class="string">'main.css'</span>),</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>.babelrc</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [<span class="string">"@babel/preset-env"</span>],</span><br><span class="line">  <span class="attr">"plugins"</span>: [<span class="string">"@babel/plugin-transform-runtime"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>index.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./dist/main.css"</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/main.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="用于生产环境-loading…"><a href="#用于生产环境-loading…" class="headerlink" title="用于生产环境(loading…)"></a>用于生产环境(loading…)</h3><blockquote><p><a href="https://github.com/yangtao2o/vue-webpack-iview" target="_blank" rel="noopener">练习地址</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 前端框架 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>页面滑动时的动画插件 WOW.js</title>
      <link href="/2019/02/04/plugin-wow/"/>
      <url>/2019/02/04/plugin-wow/</url>
      
        <content type="html"><![CDATA[<blockquote><p>当初次加载页面的时候，需要一些动画渐入，并且当滑动到当前内容时也会出现动画，之后就恢复正常，所以就用到了 <code>WOW.js</code>。</p></blockquote><a id="more"></a><p>比如：<a href="https://www.rt-thread.org/" target="_blank" rel="noopener">RT-Thread</a></p><p>再比如设计师必备：<a href="https://www.sketchapp.com/" target="_blank" rel="noopener">sketchapp</a></p><h2 id="WOW-js"><a href="#WOW-js" class="headerlink" title="WOW.js"></a>WOW.js</h2><p>文档：<a href="https://www.delac.io/wow/index.html" target="_blank" rel="noopener">WOW</a></p><h2 id="Animate-css"><a href="#Animate-css" class="headerlink" title="Animate.css"></a>Animate.css</h2><p>模拟：<a href="https://daneden.github.io/animate.css/" target="_blank" rel="noopener">Animate</a></p><p><code>animate.css</code> 包含了一组炫酷、有趣、跨浏览器的动画，可以在你的项目中直接使用。</p><h2 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">  <span class="attr">href</span>=<span class="string">"https://cdn.bootcss.com/animate.css/3.7.0/animate.min.css"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">rel</span>=<span class="string">"stylesheet"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/wow/1.1.2/wow.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><p>文档：<a href="https://www.delac.io/wow/docs.html" target="_blank" rel="noopener">Setup WOW.js</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">```html</span><br><span class="line">&lt;div class=&quot;wow bounceInUp&quot;  data-wow-duration=&quot;2s&quot; data-wow-delay=&quot;5s&quot;&gt;</span><br><span class="line">    Content to Reveal Here</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    new WOW().init();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>ps：初始加载页面的时候，很有可能会出现内容再动画渲染，所以直接设置：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.wow</span> &#123;</span><br><span class="line">  <span class="attribute">visibility</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>npm run 报错：getaddrinfo ENOTFOUND localhost</title>
      <link href="/2019/01/13/localhost/"/>
      <url>/2019/01/13/localhost/</url>
      
        <content type="html"><![CDATA[<p>安装 Angular 的时候，启动 <code>ng serve --open</code>，报错如下：<br><a id="more"></a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  my-app git:(master) ng serve</span><br><span class="line">getaddrinfo ENOTFOUND localhost</span><br><span class="line">Error: getaddrinfo ENOTFOUND localhost</span><br><span class="line">    at errnoException (dns.js:50:10)</span><br><span class="line">    at GetAddrInfoReqWrap.onlookup [as oncomplete] (dns.js:92:26)</span><br></pre></td></tr></table></figure></p><p>查了一下自己的hosts，原来我把默认的host给关掉了，重新启动即可：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1localhost</span><br><span class="line">255.255.255.255broadcasthost</span><br><span class="line">::1             localhost</span><br></pre></td></tr></table></figure><p>重新 <code>ng serve --open</code>，然后：<code>ℹ ｢wdm｣: Compiled successfully.</code></p>]]></content>
      
      
      <categories>
          
          <category> 前端框架 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 报错 </tag>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows下Node.js 多版本管理器-Gnvm</title>
      <link href="/2018/12/21/tool-gnvm/"/>
      <url>/2018/12/21/tool-gnvm/</url>
      
        <content type="html"><![CDATA[<p>我们在平时的项目开发中，经常需要指定 Node 的版本，所有版本控制管理，就很有必要，需要哪个切哪个。<br><a id="more"></a></p><h4 id="MacOS"><a href="#MacOS" class="headerlink" title="MacOS"></a>MacOS</h4><p>主要有 <code>n</code> 和 <code>nvm</code>,具体可以自行百度，查之，用之</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install -g n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接输入 n ,然后回车，可上下选择版本</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装最新版/稳定版</span></span><br><span class="line">n latest/stable</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除</span></span><br><span class="line">n rm 8.11.3</span><br></pre></td></tr></table></figure><h4 id="主要安利-Windows下的-gnvm"><a href="#主要安利-Windows下的-gnvm" class="headerlink" title="主要安利 Windows下的 gnvm"></a>主要安利 Windows下的 gnvm</h4><p>官方地址：<a href="https://github.com/kenshin/gnvm" target="_blank" rel="noopener">GNVM - Node.js 多版本管理器</a></p><h5 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 git bash，其它下载方式如 go、curl等可查看官方文档</span></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:Kenshin/gnvm-bin.git</span><br></pre></td></tr></table></figure><h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><p>将解压后的 <code>gnvm.exe</code> 保存到 <code>node.js</code> 所在的文件夹下，如：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\nodejs</span><br></pre></td></tr></table></figure></p><h5 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h5><p>管理员身份进入 <code>cmd</code>，输入 <code>gnvm version</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\WINDOWS\system32&gt;gnvm version</span><br><span class="line">Current version 0.2.0 64 bit.</span><br><span class="line">Copyright (C) 2014-2016 Kenshin Wang &lt;kenshin@ksria.com&gt;</span><br><span class="line">See https://github.com/kenshin/gnvm <span class="keyword">for</span> more information.</span><br></pre></td></tr></table></figure></p><h5 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">C:\WINDOWS\system32&gt;gnvm config</span><br><span class="line">Waring: config file C:\Program Files\nodejs\\.gnvmrc is not exist.</span><br><span class="line">Notice: Config file C:\Program Files\nodejs\\.gnvmrc create success.</span><br><span class="line">Notice: config file path C:\Program Files\nodejs\\.gnvmrc</span><br><span class="line">gnvm config registry is http://nodejs.org/dist/</span><br><span class="line">gnvm config noderoot is C:\Program Files\nodejs\</span><br><span class="line">gnvm config globalversion is 10.14.2-x86</span><br><span class="line">gnvm config latestversion is unknown</span><br></pre></td></tr></table></figure><h5 id="查询需要下载的-node-版本"><a href="#查询需要下载的-node-版本" class="headerlink" title="查询需要下载的 node 版本"></a>查询需要下载的 node 版本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">C:\WINDOWS\system32&gt;gnvm search 8.*.*</span><br><span class="line">Search Node.js version rules [8.*.*] from http://nodejs.org/dist/index.json, please <span class="built_in">wait</span>.</span><br><span class="line">+--------------------------------------------------+</span><br><span class="line">| No.   date         node ver    <span class="built_in">exec</span>      npm ver |</span><br><span class="line">+--------------------------------------------------+</span><br><span class="line">  1     2018-12-18   8.14.1      x86 x64   6.4.1</span><br><span class="line">  2     2018-11-27   8.14.0      x86 x64   6.4.1</span><br><span class="line">  3     2018-11-20   8.13.0      x86 x64   6.4.1</span><br><span class="line">  4     2018-09-10   8.12.0      x86 x64   6.4.1</span><br><span class="line">  5     2018-08-15   8.11.4      x86 x64   5.6.0</span><br><span class="line">  6     2018-06-12   8.11.3      x86 x64   5.6.0</span><br><span class="line">  7     2018-05-15   8.11.2      x86 x64   5.6.0</span><br><span class="line">  8     2018-03-29   8.11.1      x86 x64   5.6.0</span><br><span class="line">  9     2018-03-28   8.11.0      x86 x64   5.6.0</span><br><span class="line">  10    2018-03-06   8.10.0      x86 x64   5.6.0</span><br><span class="line">  11    2018-01-02   8.9.4       x86 x64   5.6.0</span><br><span class="line">  12    2017-12-07   8.9.3       x86 x64   5.5.1</span><br><span class="line">  13    2017-12-05   8.9.2       x86 x64   5.5.1</span><br><span class="line">  14    2017-11-07   8.9.1       x86 x64   5.5.1</span><br><span class="line">  15    2017-10-31   8.9.0       x86 x64   5.5.1</span><br><span class="line">  16    2017-10-25   8.8.1       x86 x64   5.4.2</span><br><span class="line">  17    2017-10-24   8.8.0       x86 x64   5.4.2</span><br><span class="line">  18    2017-10-11   8.7.0       x86 x64   5.4.2</span><br><span class="line">  19    2017-09-26   8.6.0       x86 x64   5.3.0</span><br><span class="line">  20    2017-09-12   8.5.0       x86 x64   5.3.0</span><br><span class="line">  21    2017-08-15   8.4.0       x86 x64   5.3.0</span><br><span class="line">  22    2017-08-08   8.3.0       x86 x64   5.3.0</span><br><span class="line">  23    2017-07-20   8.2.1       x86 x64   5.3.0</span><br><span class="line">  24    2017-07-19   8.2.0       x86 x64   5.3.0</span><br><span class="line">  25    2017-07-11   8.1.4       x86 x64   5.0.3</span><br><span class="line">  26    2017-06-29   8.1.3       x86 x64   5.0.3</span><br><span class="line">  27    2017-06-15   8.1.2       x86 x64   5.0.3</span><br><span class="line">  28    2017-06-13   8.1.1       x86 x64   5.0.3</span><br><span class="line">  29    2017-06-08   8.1.0       x86 x64   5.0.3</span><br><span class="line">  30    2017-05-30   8.0.0       x86 x64   5.0.0</span><br><span class="line">+--------------------------------------------------+</span><br></pre></td></tr></table></figure><h5 id="下载帮助文档"><a href="#下载帮助文档" class="headerlink" title="下载帮助文档"></a>下载帮助文档</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:\WINDOWS\system32&gt;gnvm <span class="built_in">help</span> node-version</span><br><span class="line">Show and fix [global] [latest] Node.js version e.g. :</span><br><span class="line">gnvm node-version            :Show Node.js global and latest version, and fix it.</span><br><span class="line">gnvm node-version latest     :Show Node.js latest version, and fix it.</span><br><span class="line">gnvm node-version global     :Show Node.js global version, and fix it.</span><br></pre></td></tr></table></figure><h5 id="下载node"><a href="#下载node" class="headerlink" title="下载node"></a>下载node</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\WINDOWS\system32&gt;gnvm install 8.11.3 --global</span><br></pre></td></tr></table></figure><h5 id="查看已下载的版本列表"><a href="#查看已下载的版本列表" class="headerlink" title="查看已下载的版本列表"></a>查看已下载的版本列表</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:\WINDOWS\system32&gt;gnvm ls</span><br><span class="line">Notice: gnvm.exe root is C:\Program Files\nodejs\\</span><br><span class="line">v10.14.2 -- x86</span><br><span class="line">v8.11.2</span><br><span class="line">v8.11.3 -- global</span><br></pre></td></tr></table></figure><h5 id="使用指定版本"><a href="#使用指定版本" class="headerlink" title="使用指定版本"></a>使用指定版本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\WINDOWS\system32&gt;gnvm use 8.11.3</span><br><span class="line">Set success, global Node.js version is 8.11.3.</span><br></pre></td></tr></table></figure><h5 id="查看当前Node版本"><a href="#查看当前Node版本" class="headerlink" title="查看当前Node版本"></a>查看当前Node版本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\WINDOWS\system32&gt;node -v</span><br><span class="line">v8.11.3</span><br></pre></td></tr></table></figure><p>基本上可以解决版本切换问题，详情可查询<a href="http://ksria.com/gnvm/" target="_blank" rel="noopener">官方文档</a></p>]]></content>
      
      
      <categories>
          
          <category> Nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nodejs </tag>
            
            <tag> gnvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通俗点理解Nodejs的非阻塞及事件驱动</title>
      <link href="/2018/12/18/node-event-io/"/>
      <url>/2018/12/18/node-event-io/</url>
      
        <content type="html"><![CDATA[<h3 id="node-js是什么"><a href="#node-js是什么" class="headerlink" title="node.js是什么"></a>node.js是什么</h3><blockquote><p>node.js是什么？</p></blockquote><ul><li>这是一种通过JavaScript语言开发web服务端的东西</li></ul><blockquote><p>为什么我们要用node.js？</p></blockquote><ul><li>node.js有非阻塞，事件驱动I/O等特性，从而让高并发（high concurrency）在的轮询（Polling）和comet构建的应用中成为可能。<a id="more"></a><h3 id="HTTP请求"><a href="#HTTP请求" class="headerlink" title="HTTP请求"></a>HTTP请求</h3></li></ul><p>浏览器给网站发请求的过程一直没怎么变过。</p><p>当浏览器给网站发了请求。服务器收到了请求，然后开始搜寻被请求的资源。如果有需要，服务器还会查询一下数据库，最后把响应结果传回浏览器。</p><p>不过，在传统的web服务器中（比如<code>Apache</code>），每一个请求都会让服务器创建一个新的进程来处理这个请求。</p><p>后来有了Ajax。有了Ajax，我们就不用每次都请求一个完整的新页面了，取而代之的是，每次只请求需要的部分页面信息就可以了。</p><p>这显然是一个进步。</p><h3 id="长轮询"><a href="#长轮询" class="headerlink" title="长轮询"></a>长轮询</h3><p>但是比如你要建一个<code>FriendFeed</code>这样的社交网站（类似人人网那样的刷朋友新鲜事的网站），你的好友会随时的推送新的状态，然后你的新鲜事会实时自动刷新。</p><p>要达成这个需求，我们需要让用户一直与服务器保持一个有效连接。目前最简单的实现方法，就是让用户和服务器之间保持<code>长轮询（long polling）</code>。</p><p>HTTP请求不是持续的连接，你请求一次，服务器响应一次，然后就完了。</p><p><code>长轮询是一种利用HTTP模拟持续连接的技巧</code>。具体来说，只要页面载入了，不管你需不需要服务器给你响应信息，你都会给服务器发一个Ajax请求。这个请求不同于一般的Ajax请求，服务器不会直接给你返回信息，而是它要等着，直到服务器觉得该给你发信息了，它才会响应。</p><p>比如，你的好友发了一条新鲜事，服务器就会把这个新鲜事当做响应发给你的浏览器，然后你的浏览器就刷新页面了。浏览器收到响应刷新完之后，再发送一条新的请求给服务器，这个请求依然不会立即被响应。</p><p>于是就开始重复以上步骤。</p><p>利用这个方法，可以让浏览器始终保持等待响应的状态。虽然以上过程依然只有非持续的Http参与，但是我们模拟出了一个看似持续的连接状态。</p><h3 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h3><p>我们再看传统的服务器（比如Apache）。</p><p>每次一个新用户连到你的网站上，你的服务器就得开一个连接。每个连接都需要占一个进程，这些进程大部分时间都是闲着的（比如等着你好友发新鲜事，等好友发完才给用户响应信息。或者等着数据库返回查询结果什么的）。</p><p>虽然这些进程闲着，但是照样占用内存。这意味着，如果用户连接数的增长到一定规模，你服务器没准就要耗光内存直接瘫了。</p><h3 id="非阻塞和事件驱动"><a href="#非阻塞和事件驱动" class="headerlink" title="非阻塞和事件驱动"></a>非阻塞和事件驱动</h3><p>这种情况怎么解决？</p><p>解决方法就是刚才上边说的：<em>非阻塞和事件驱动</em>。</p><p>这些概念在我们谈的这个情景里面其实没那么难理解。</p><p>你把非阻塞的服务器想象成一个loop循环，这个loop会一直跑下去。</p><p>一个新请求来了，这个loop就接了这个请求，把这个请求传给其他的进程（比如传给一个搞数据库查询的进程），然后响应一个回调（callback）。</p><p>完事了这loop就接着跑，接其他的请求。</p><p>这样下来。服务器就不会像之前那样傻等着数据库返回结果了。</p><p>如果数据库把结果返回来了，loop就把结果传回用户的浏览器，接着继续跑。</p><p>在这种方式下，你的服务器的进程就不会闲着等着。</p><p>从而在理论上说，同一时刻的数据库查询数量，以及用户的请求数量就没有限制了。服务器只在用户那边有事件发生的时候才响应，这就是事件驱动。</p><p>FriendFeed是用基于Python的非阻塞框架Tornado (知乎也用了这个框架) 来实现上面说的新鲜事功能的。不过，Node.js就比前者更妙了。</p><h3 id="再看Node-js"><a href="#再看Node-js" class="headerlink" title="再看Node.js"></a>再看Node.js</h3><p>Node.js的应用是通过javascript开发的，然后直接在Google的变态V8引擎上跑。</p><p>用了Node.js，你就不用担心用户端的请求会在服务器里跑了一段能够造成阻塞的代码了。</p><p>因为javascript本身就是事件驱动的脚本语言。</p><p>你回想一下，在给前端写javascript的时候，更多时候你都是在搞事件处理和回调函数。</p><p>javascript本身就是给事件处理量身定制的语言。</p><p>Node.js还是处于初期阶段。如果你想开发一个基于Node.js的应用，你应该会需要写一些很底层代码。</p><p>但是下一代浏览器很快就要采用<code>WebSocket</code>技术了，从而长轮询也会消失。</p><p>在Web开发里，Node.js这种类型的技术只会变得越来越重要。</p><p>英文原文：<a href="https://www.sitepoint.com/node-js-is-the-new-black/" target="_blank" rel="noopener">Node.js is the New Black</a></p><p>中文原文：<a href="https://www.zhihu.com/question/33578075/answer/56951771" target="_blank" rel="noopener">Node.js是用来做什么的？</a></p>]]></content>
      
      
      <categories>
          
          <category> Nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git push 报错之 Permission to userA.git denied to userB</title>
      <link href="/2018/12/17/git-push-error/"/>
      <url>/2018/12/17/git-push-error/</url>
      
        <content type="html"><![CDATA[<p>报错信息：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  git-command git:(master) git push</span><br><span class="line">remote: Permission to xxx.git denied to zguii.</span><br><span class="line">fatal: unable to access <span class="string">'https://github.com/xxx.git/'</span>: The requested URL returned error: 403</span><br></pre></td></tr></table></figure></p><a id="more"></a><h3 id="解决过程"><a href="#解决过程" class="headerlink" title="解决过程"></a>解决过程</h3><h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4><p>之前我有登录过其他账号，如zguii，并进行了一系列操作，后来我要使用自己的账号的时候，就会出现如上的报错信息。</p><p>刚开始嫌麻烦，我使用客户端发布操作，正常，后来，多次使用 <code>git bash</code>，就很痛苦了，索性就改一下。 </p><h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>既然是用户权限被占用了，而且我也不需要那个用户了，那就删除吧。</p><h4 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重新创建文件，暂时设置密码为空，并且会产生 `id_rsa`、`id_rsa.pub`，（有可能会产生 config ，但有可能是空文件）</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">"yangtaobanner@foxmail.com"</span></span><br><span class="line"></span><br><span class="line">➜  git-command git:(master) ssh-keygen -t rsa -C <span class="string">"yangtaobanner@foxmail.com"</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/Users/yangtao/.ssh/id_rsa): </span><br><span class="line">/Users/yangtao/.ssh/id_rsa already exists.</span><br><span class="line">Overwrite (y/n)? y</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /Users/yangtao/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /Users/yangtao/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制 `id_rsa.pub` 里的所有内容，将此粘贴到你要新建的 `SSH key`里</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看配置</span></span><br><span class="line">git config --list</span><br><span class="line"></span><br><span class="line">git config --list --global</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试是否可以连接</span></span><br><span class="line">ssh -T git@github.com</span><br><span class="line">Hi yangtao2o! You<span class="string">'ve successfully authenticated, but GitHub does not provide shell access.</span></span><br></pre></td></tr></table></figure><p>设置完毕，再次 <code>git push</code>，额…依旧报错…<br>想到可能是缓存，好吧，清！呃呃…依然如此…</p><p>好多分钟之后，忽然想起还能访问默认账户，说明账户依然存在，笨！</p><p>然后，我就去钥匙串查看了一下 <code>github.com</code>，我去，还真是岿然不动地躺在那儿…</p><p>恶狠狠地删之！！！</p><p>然后，<code>git push</code>，输入用户、密码，熬过几秒，刷刷刷，看到了久违的 <code>Done</code></p><p>其实，归根结底，如果Git设置里的账户是你自己的，只要删除钥匙串账户就行，我竟然走了这么久的弯路，脚很疼，哦不，脑瓜子疼！</p><p>PS：MacOS 隐藏文件开启快捷键：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">command</span> + ^ + .</span><br></pre></td></tr></table></figure></p><h3 id="windows解决方法"><a href="#windows解决方法" class="headerlink" title="windows解决方法"></a>windows解决方法</h3><p><a href="https://blog.csdn.net/klxh2009/article/details/76019742" target="_blank" rel="noopener">解决 github push failed （remote: Permission to userA/repo.git denied to userB.）</a></p><p>➜ 主要是删除之前的用户，如我的之前的账户是 <code>zguii</code></p><h3 id="MacOS解决方法"><a href="#MacOS解决方法" class="headerlink" title="MacOS解决方法"></a>MacOS解决方法</h3><p><a href="https://www.jianshu.com/p/6621c42ef112" target="_blank" rel="noopener">mac下配置多个git账号并进行账号切换</a></p><p><a href="https://www.jianshu.com/p/b29a3c275f68" target="_blank" rel="noopener">解决git本地多ssh key的问题</a></p><p><a href="https://www.zybuluo.com/yangfch3/note/172120" target="_blank" rel="noopener">多个 SSH KEY 的管理</a></p>]]></content>
      
      
      <categories>
          
          <category> 开发工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> 开发工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git 常用命令练习</title>
      <link href="/2018/12/14/git-command/"/>
      <url>/2018/12/14/git-command/</url>
      
        <content type="html"><![CDATA[<blockquote><p>使用 <code>git bash</code> 的过程中，除了常用的那几条，其它的总需要查找手册，索性跟着大牛总结的文章走一遍吧</p></blockquote><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul><li>Workspace: 工作区</li><li>Index / Stage: 暂存区</li><li>Repository: 仓库区（或本地仓库）</li><li>Remote: 远程仓库<a id="more"></a><img src="https://user-images.githubusercontent.com/19526072/49999253-4c690980-ffd1-11e8-892a-bff60b374d12.png" alt="image"></li></ul><h3 id="新建"><a href="#新建" class="headerlink" title="新建"></a>新建</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在当前目录 git-command 下新建 Git 代码库，（会生成 .git 文件）</span></span><br><span class="line">git init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建目录 git-command 并将其初始化为 Git 代码库</span></span><br><span class="line">git init git-command</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从线上获取一个完整的项目代码</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/yangtao2o/git-command.git</span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>Git的设置文件为 <code>.gitconfig</code> ，它可以在用户主目录下（全局配置），也可以在项目目录下（项目配置）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示配置信息</span></span><br><span class="line">git config --list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改</span></span><br><span class="line">git config --global</span><br><span class="line"></span><br><span class="line">git config --global user.name <span class="string">"yangtao"</span></span><br><span class="line">git config --global user.email <span class="string">"xxx@.qq.com"</span></span><br></pre></td></tr></table></figure><h3 id="增加、删除文件"><a href="#增加、删除文件" class="headerlink" title="增加、删除文件"></a>增加、删除文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加指定文件到暂存区</span></span><br><span class="line">git add index.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加指定目录到暂存区，包括子目录</span></span><br><span class="line">git add assets</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加当前目录的所有文件到暂存区</span></span><br><span class="line">git add .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加每个变化前，都会要求确认</span></span><br><span class="line"><span class="comment"># 对于同一个文件的多处变化，可以实现分次提交</span></span><br><span class="line">git add -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除工作区文件，并将这次删除加入暂存区</span></span><br><span class="line">git rm [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止追踪指定文件，但该文件会保留在工作区</span></span><br><span class="line">git rm --cached [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改文件名，并放入暂存区</span></span><br><span class="line">git mv index.html index-new.html</span><br></pre></td></tr></table></figure><h3 id="代码提交"><a href="#代码提交" class="headerlink" title="代码提交"></a>代码提交</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 暂存区提交到仓库区 ( -m (msg) )</span></span><br><span class="line">git commit -m <span class="string">"My first commit"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定文件提交</span></span><br><span class="line">git commit [file1] [file2] ... -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交工作区自上次 commit 之后的变化，直接到仓库区</span></span><br><span class="line">git commit -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交时显示所有的 diff 信息</span></span><br><span class="line">git commit -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用一次新的 commit ，提交上一次提交</span></span><br><span class="line"><span class="comment"># 如果代码没有任何变化，则用来改写上一次 commit 的提交信息</span></span><br><span class="line">git commit --amend -m <span class="string">"new commit"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重做上一次 commit ，并包括指定文件的新变化</span></span><br><span class="line">git commit --amend [file1] [file2] ...</span><br></pre></td></tr></table></figure><h3 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出所有的本地分支</span></span><br><span class="line">git branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有的远程分支 ( -r (remotes))</span></span><br><span class="line">git branch -r</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有的本地分支和远程分支</span></span><br><span class="line">git branch -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，但依然停留在当前分支</span></span><br><span class="line">git branch primary</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建，并切换至 该分支</span></span><br><span class="line">git checkout -b primary-yt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建，指向指定 commit</span></span><br><span class="line">git branch [branch] [commitID]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建，与指定的远程分支建立追踪关系</span></span><br><span class="line">git branch --track [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到指定分支，并更新工作区</span></span><br><span class="line">git checkout [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到上一个分支</span></span><br><span class="line">git checkout -</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立追踪关系，在现有分支与指定的远程分支之间</span></span><br><span class="line">git branch --<span class="built_in">set</span>-upstream [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并指定分支 master-yt 到当前分支 master</span></span><br><span class="line">git merge master-yt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择一个 commit，合并进当前分支</span></span><br><span class="line">git cherry-pick [commitid]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除分支</span></span><br><span class="line">git branch -d master-ytt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程分支</span></span><br><span class="line">git push origin --delete [branch-name]</span><br><span class="line">git branch -dr [remote/branch]</span><br></pre></td></tr></table></figure><h3 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出标签</span></span><br><span class="line">git tag</span><br></pre></td></tr></table></figure><h3 id="查看信息"><a href="#查看信息" class="headerlink" title="查看信息"></a>查看信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示有变更的文件</span></span><br><span class="line">git status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前分支的版本历史</span></span><br><span class="line">git <span class="built_in">log</span></span><br></pre></td></tr></table></figure><h2 id="参考目录"><a href="#参考目录" class="headerlink" title="参考目录"></a>参考目录</h2><ul><li><a href="http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html" target="_blank" rel="noopener">Git 常用命令</a></li><li><a href="https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000" target="_blank" rel="noopener">Git教程 - 廖雪峰的官方网站</a></li></ul><p><a href="https://github.com/yangtao2o/git-command" target="_blank" rel="noopener">练习 Demo</a></p>]]></content>
      
      
      <categories>
          
          <category> 开发工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> 开发工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小片段代码简汇之CSS篇</title>
      <link href="/2018/12/09/code-css/"/>
      <url>/2018/12/09/code-css/</url>
      
        <content type="html"><![CDATA[<blockquote><p>总结在平时开发中遇到的一些小问题，大概很长一段时间就会来这么一次，小片段剧场.</p></blockquote><a id="more"></a><h2 id="页面布局"><a href="#页面布局" class="headerlink" title="页面布局"></a>页面布局</h2><ul><li><a href="https://juejin.im/post/5aa252ac518825558001d5de#heading-55" target="_blank" rel="noopener">干货!各种常见布局实现+知名网站实例分析</a></li><li><a href="https://chokcoco.github.io/CSS-Inspiration/#/" target="_blank" rel="noopener">CSS 灵感</a> - 这里可以让你寻找到使用或者是学习 CSS 的灵感，以分类的形式，展示不同 CSS 属性或者不同的课题使用 CSS 来解决的各种方法。</li></ul><h2 id="white-space-word-break-word-wrap"><a href="#white-space-word-break-word-wrap" class="headerlink" title="white-space | word-break | word-wrap"></a>white-space | word-break | word-wrap</h2><ul><li><a href="https://juejin.im/post/5b8905456fb9a01a105966b4" target="_blank" rel="noopener">彻底搞懂 word-break、word-wrap、white-space</a></li></ul><h3 id="white-space"><a href="#white-space" class="headerlink" title="white-space"></a><code>white-space</code></h3><p>控制空白字符的显示，同时还能控制是否自动换行。它有五个值：<code>normal | nowrap | pre | pre-wrap | pre-line</code></p><h3 id="word-break"><a href="#word-break" class="headerlink" title="word-break"></a><code>word-break</code></h3><p>控制单词如何被拆分换行。它有三个值：<code>normal | break-all | keep-all</code></p><h3 id="word-wrap（overflow-wrap）"><a href="#word-wrap（overflow-wrap）" class="headerlink" title="word-wrap（overflow-wrap）"></a><code>word-wrap（overflow-wrap）</code></h3><p>控制长度超过一行的单词是否被拆分换行，是 word-break 的补充，它有两个值：<code>normal | break-word</code></p><h2 id="兼容-Windows、Mac-的-font-family"><a href="#兼容-Windows、Mac-的-font-family" class="headerlink" title="兼容 Windows、Mac 的 font-family"></a>兼容 Windows、Mac 的 font-family</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">font-family</span>: <span class="selector-tag">Helvetica</span> <span class="selector-tag">Neue</span> <span class="selector-tag">For</span> <span class="selector-tag">Number</span>, <span class="selector-tag">-apple-system</span>, <span class="selector-tag">BlinkMacSystemFont</span>,</span><br><span class="line">  <span class="selector-tag">Segoe</span> <span class="selector-tag">UI</span>, <span class="selector-tag">Roboto</span>, <span class="selector-tag">PingFang</span> <span class="selector-tag">SC</span>, "<span class="selector-tag">PingFangSC-Light</span>", "<span class="selector-tag">Microsoft</span> <span class="selector-tag">yahei</span>", <span class="selector-tag">Arial</span>,</span><br><span class="line">  <span class="selector-tag">Helvetica</span>, <span class="selector-tag">sans-serif</span>;</span><br></pre></td></tr></table></figure><h2 id="关于-ios-下的-input-输入框光标上移的问题"><a href="#关于-ios-下的-input-输入框光标上移的问题" class="headerlink" title="关于 ios 下的 input 输入框光标上移的问题"></a>关于 ios 下的 input 输入框光标上移的问题</h2><blockquote><p>一般外框设置高度为<code>auto</code>,取消掉<code>line-height</code>,input 本身设置字号大小，使用 padding 撑开，取消’height、line-height’</p></blockquote><h2 id="下拉框箭头重写"><a href="#下拉框箭头重写" class="headerlink" title="下拉框箭头重写"></a>下拉框箭头重写</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* --ie清除--*/</span></span><br><span class="line"><span class="selector-tag">select</span><span class="selector-pseudo">::-ms-expand</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* --火狐、谷歌清除--*/</span></span><br><span class="line"><span class="selector-tag">select</span> &#123;</span><br><span class="line">  <span class="attribute">appearance</span>: none;</span><br><span class="line">  <span class="attribute">-moz-appearance</span>: none;</span><br><span class="line">  <span class="attribute">-webkit-appearance</span>: none;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">30px</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#fafafb</span> <span class="built_in">url</span>(<span class="string">"/select-logo.png"</span>) <span class="number">98%</span> <span class="number">50%</span> no-repeat <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="用-CSS-写三角形箭头"><a href="#用-CSS-写三角形箭头" class="headerlink" title="用 CSS 写三角形箭头"></a>用 CSS 写三角形箭头</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.wx-wper-con</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">158px</span>;</span><br><span class="line">  <span class="attribute">height</span>: auto;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#e9e9e9</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0px</span> <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">100</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">6px</span> -<span class="number">2px</span> <span class="number">#aaa</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wx-wper-con</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-class">.wx-wper-con</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: -<span class="number">9.5px</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">border-right</span>: <span class="number">8px</span> solid transparent;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">8px</span> solid <span class="number">#dadada</span>;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">8px</span> solid transparent;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wx-wper-con</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">top</span>: -<span class="number">8.5px</span>;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">8px</span> solid <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="border-边框渐变-圆角"><a href="#border-边框渐变-圆角" class="headerlink" title="border 边框渐变+圆角"></a>border 边框渐变+圆角</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.border-test</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">4px</span> solid transparent;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">border-top-right-radius</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">background-clip</span>: padding-box;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.border-test</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: -<span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">right</span>: -<span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: -<span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">left</span>: -<span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">border-top-right-radius</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(155deg, red, blue);</span><br><span class="line">  <span class="attribute">z-index</span>: -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="文字两端对齐"><a href="#文字两端对齐" class="headerlink" title="文字两端对齐"></a>文字两端对齐</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">text-align</span>: <span class="selector-tag">justify</span>;</span><br><span class="line"><span class="selector-tag">text-align-last</span>: <span class="selector-tag">justify</span>;</span><br></pre></td></tr></table></figure><h2 id="每个单词的首字母大写"><a href="#每个单词的首字母大写" class="headerlink" title="每个单词的首字母大写"></a>每个单词的首字母大写</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">text-transform</span>: <span class="selector-tag">uppercase</span>;</span><br></pre></td></tr></table></figure><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/text-transform" target="_blank" rel="noopener">text-transform</a></li></ul><blockquote><p>这是 CSS2 中的属性，参数有 capitalize | uppercase | lowercase | none</p></blockquote><p>参数介绍：</p><ul><li>none： 默认。定义带有小写字母和大写字母的标准的文本。</li><li>capitalize： 文本中的每个单词以大写字母开头。</li><li>uppercase： 定义仅有大写字母。</li><li>lowercase： 定义无大写字母，仅有小写字母。</li></ul><h2 id="单选高亮"><a href="#单选高亮" class="headerlink" title="单选高亮"></a>单选高亮</h2><p><a href="https://juejin.im/post/5d6ffb676fb9a06b1c744bd5#heading-12" target="_blank" rel="noopener">原文</a></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.input</span><span class="selector-pseudo">:checked</span> + <span class="selector-class">.colors</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#e63838</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#e63838</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;div class="single-check"&gt;</span><br><span class="line">    &lt;input class="input" type="radio" name="colors" value="1"&gt;</span><br><span class="line">    &lt;div class="colors"&gt;天空之境&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><ul><li><code>~ 选择器</code>：查找某个元素后面的所有兄弟元素</li><li><code>+ 选择器</code>：查找某个元素后面紧邻的兄弟元素</li></ul><h2 id="多列等高问题"><a href="#多列等高问题" class="headerlink" title="多列等高问题"></a>多列等高问题</h2><ol><li><code>padding + margin</code>：每列设置一个比较大的<code>padding-bottom</code>，然后通过取负值的 <code>margin-bottom</code>，缺点很明显：如下方无法看到圆角，无法看到 <code>border-bottom</code> 等</li><li><code>display: table</code></li><li><code>display: flex</code></li></ol><h2 id="1px-方案"><a href="#1px-方案" class="headerlink" title="1px 方案"></a>1px 方案</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.min-device-pixel-ratio</span>(@<span class="keyword">scale2</span>, @scale3) &#123;</span><br><span class="line">  @<span class="keyword">media</span> screen and (min-device-pixel-ratio: <span class="number">2</span>),</span><br><span class="line">    (-webkit-min-device-pixel-ratio: <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="selector-tag">transform</span>: @<span class="keyword">scale2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  @<span class="keyword">media</span> screen and (min-device-pixel-ratio: <span class="number">3</span>),</span><br><span class="line">    (-webkit-min-device-pixel-ratio: <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="selector-tag">transform</span>: @<span class="keyword">scale3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.border-1px(@color: #DDD, @radius: 2px, @style: solid) &#123;</span><br><span class="line">  &amp;<span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">    <span class="attribute">pointer-events</span>: none;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transform-origin</span>: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> @style @color;</span><br><span class="line">    <span class="attribute">border-radius</span>: @radius;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    @media screen and (min-device-pixel-ratio: 2),</span><br><span class="line">      (<span class="selector-tag">-webkit-min-device-pixel-ratio</span>: 2) &#123;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">200%</span>;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">200%</span>;</span><br><span class="line">      <span class="attribute">border-radius</span>: @radius * <span class="number">2</span>;</span><br><span class="line">      <span class="attribute">transform</span>: <span class="built_in">scale</span>(0.5);</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">media</span> screen and (min-device-pixel-ratio: <span class="number">3</span>),</span><br><span class="line">      (-webkit-min-device-pixel-ratio: <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="selector-tag">width</span>: 300%;</span><br><span class="line">      <span class="selector-tag">height</span>: 300%;</span><br><span class="line">      <span class="selector-tag">border-radius</span>: @<span class="keyword">radius</span> * <span class="number">3</span>;</span><br><span class="line">      <span class="selector-tag">transform</span>: <span class="selector-tag">scale</span>(0<span class="selector-class">.33</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.border-top-1px(@color: #DDD, @style: solid) &#123;</span><br><span class="line">  &amp;<span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">1px</span> @style @color;</span><br><span class="line">    <span class="attribute">transform-origin</span>: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    .min-device-pixel-ratio(scaleY(0.5), scaleY(0.33));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><a href="https://juejin.im/post/5d6ffb676fb9a06b1c744bd5#heading-5" target="_blank" rel="noopener">原文</a></li></ul><h2 id="css-之-flex-和-grid"><a href="#css-之-flex-和-grid" class="headerlink" title="css 之 flex 和 grid"></a>css 之 flex 和 grid</h2><h3 id="flex"><a href="#flex" class="headerlink" title="flex"></a>flex</h3><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/flex" target="_blank" rel="noopener">flex - CSS（层叠样式表）| MDN</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Flexible_Box_Layout/Aligning_Items_in_a_Flex_Container" target="_blank" rel="noopener">Aligning Items in a Flex Container</a></li><li><a href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html" target="_blank" rel="noopener">Flex 布局教程：语法篇</a> - 阮一峰</li><li><a href="http://www.ruanyifeng.com/blog/2015/07/flex-examples.html" target="_blank" rel="noopener">Flex 布局教程：实例篇</a> - 阮一峰</li><li><a href="https://cloud.tencent.com/developer/article/1354252" target="_blank" rel="noopener">30 分钟彻底弄懂 flex 布局</a> — 可以直接读这篇总结文章，讲的很详细</li><li><a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/" target="_blank" rel="noopener">A Complete Guide to Flexbox</a> — 比较生动形象，自身网站就很好看</li></ul><h3 id="grid"><a href="#grid" class="headerlink" title="grid"></a>grid</h3><ul><li><a href="https://v4.bootcss.com/docs/4.0/layout/grid/" target="_blank" rel="noopener">Bootstrap 4</a> 的布局在使用 grid</li><li><a href="http://www.ruanyifeng.com/blog/2019/03/grid-layout-tutorial.html" target="_blank" rel="noopener">CSS Grid 网格布局教程</a> - 阮一峰</li></ul><h3 id="使用-flex-还是-grid"><a href="#使用-flex-还是-grid" class="headerlink" title="使用 flex 还是 grid"></a>使用 flex 还是 grid</h3><ul><li><a href="https://zhuanlan.zhihu.com/p/46757975" target="_blank" rel="noopener">最全～ Grid vs Flex</a></li></ul><h2 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h2><ul><li><a href="https://juejin.im/post/5d6ffb676fb9a06b1c744bd5#heading-12" target="_blank" rel="noopener">【前端词典】11 个 CSS 知识搭配 11 个 JS 特性 （实用合集）</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzI4NDYxNTM0OQ==&amp;mid=2247484312&amp;idx=1&amp;sn=f4c51d7c3b7dc49f234d119ca0983bb4&amp;chksm=ebf9f442dc8e7d54e2c29761fe9b8c9909a475aca434543759ddd5c1a6e2e8ac10e406bb99ef&amp;mpshare=1&amp;scene=23&amp;srcid=1121SGoxE9Vgb66UMridQbbF&amp;sharer_sharetime=1574331417826&amp;sharer_shareid=73865875704bcba3caa8b09c62f6bd7a%23rd" target="_blank" rel="noopener">web 前端面试中 10 个关于 css 高频面试题,你都会吗?</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小片段代码简汇之JS篇</title>
      <link href="/2018/12/07/code-js/"/>
      <url>/2018/12/07/code-js/</url>
      
        <content type="html"><![CDATA[<blockquote><p>总结在平时开发中遇到的一些小问题，大概很长一段时间就会来这么一次，小片段剧场。</p></blockquote><p>Show Time:<br><a id="more"></a></p><h4 id="多行文本截取clamp-js"><a href="#多行文本截取clamp-js" class="headerlink" title="多行文本截取clamp.js"></a>多行文本截取clamp.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src = <span class="string">"https://cdn.bootcss.com/Clamp.js/0.5.1/clamp.min.js"</span> &gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">clampFunc(<span class="string">"obj-content-header"</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clampFunc</span>(<span class="params">className, clampNum</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> $<span class="built_in">module</span> = $(<span class="string">"."</span> + className);</span><br><span class="line">  clampNum = clampNum ? clampNum : <span class="number">1</span>;</span><br><span class="line">  $.each($<span class="built_in">module</span>, <span class="function"><span class="keyword">function</span> (<span class="params">i, index</span>) </span>&#123;</span><br><span class="line">    $clamp($(<span class="keyword">this</span>).get(<span class="number">0</span>), &#123;</span><br><span class="line">      clamp: clampNum</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="判断本地是否存在jquery写法"><a href="#判断本地是否存在jquery写法" class="headerlink" title="判断本地是否存在jquery写法"></a>判断本地是否存在jquery写法</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> jQuery == <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="built_in">document</span>.write(<span class="built_in">unescape</span>(<span class="string">"%3Cscript src='https://cdn.bootcss.com/jquery/1.9.0/jquery.min.js' type='text/javascript'%3E%3C/script%3E"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><h4 id="截流函数-AND-节流函数"><a href="#截流函数-AND-节流函数" class="headerlink" title="截流函数 AND 节流函数"></a>截流函数 AND 节流函数</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 截流函数 **/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * fn 执行函数</span></span><br><span class="line"><span class="comment">  * context 绑定上下文</span></span><br><span class="line"><span class="comment">  * timeout 延时数值</span></span><br><span class="line"><span class="comment">  **/</span></span><br><span class="line"><span class="keyword">let</span> debounce = <span class="function"><span class="keyword">function</span>(<span class="params">fn, context, timeout</span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> timer;</span><br><span class="line"><span class="comment">// 使用闭包将内容传递出去</span></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(timer) &#123;</span><br><span class="line">clearTimeout(timer);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">fn.apply(context, <span class="built_in">arguments</span>);</span><br><span class="line">&#125;, timeout);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/** 节流函数 **/</span></span><br><span class="line"><span class="keyword">var</span> throttle = <span class="function"><span class="keyword">function</span>(<span class="params">fn, delay, mustRunDelay</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> timer = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> t_start;</span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> context = <span class="keyword">this</span>;</span><br><span class="line"><span class="keyword">var</span> args = <span class="built_in">arguments</span>;</span><br><span class="line"><span class="keyword">var</span> t_curr = +<span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">clearTimeout(timer);</span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line"><span class="keyword">if</span>(!t_start) &#123;</span><br><span class="line">t_start = t_curr;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// 超时判断</span></span><br><span class="line"><span class="keyword">if</span>(t_curr - t_start &gt;= mustRunDelay) &#123;</span><br><span class="line">fn.apply(context, args);</span><br><span class="line">t_start = t_curr;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="for循环添加点击事件"><a href="#for循环添加点击事件" class="headerlink" title="for循环添加点击事件"></a>for循环添加点击事件</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> elems = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'a'</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = elems.length; i &lt; l; i++) &#123;</span><br><span class="line">  (<span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">    elems[index].addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">      e.preventDefault();</span><br><span class="line">      <span class="built_in">console</span>.log(index);</span><br><span class="line">    &#125;, <span class="string">'false'</span>);</span><br><span class="line">  &#125;)(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="判断浏览器是否开启本地cookie"><a href="#判断浏览器是否开启本地cookie" class="headerlink" title="判断浏览器是否开启本地cookie"></a>判断浏览器是否开启本地cookie</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nd = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">nd.setSeconds(nd.getSeconds() + <span class="number">60</span>);</span><br><span class="line"><span class="built_in">document</span>.cookie = <span class="string">"cookietest=1; expires="</span> + nd.toGMTString();</span><br><span class="line"><span class="keyword">var</span> cookiesEnabled = <span class="built_in">document</span>.cookie.indexOf(<span class="string">"cookietest="</span>) != <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">if</span> (!cookiesEnabled) &#123;</span><br><span class="line">  <span class="comment">//没有启用cookie   </span></span><br><span class="line">  alert(<span class="string">"没有启用cookie "</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">//已经启用cookie   </span></span><br><span class="line">  alert(<span class="string">"已经启用cookie "</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="解决同级元素鼠标移入移出效果"><a href="#解决同级元素鼠标移入移出效果" class="headerlink" title="解决同级元素鼠标移入移出效果"></a>解决同级元素鼠标移入移出效果</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"member-card-item"</span> <span class="attr">id</span>=<span class="string">"memberCard"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"member-card-wper"</span> <span class="attr">id</span>=<span class="string">"memberProfile"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"drop-icon"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"card-item"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"card-item"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cardTimer = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> $mCard = $(<span class="string">'#rightNav .wx-wper'</span>);</span><br><span class="line"><span class="keyword">var</span> $mProfile = $(<span class="string">'#rightNav .wx-outer'</span>);</span><br><span class="line">$mCard.get(<span class="number">0</span>).onmouseover = $mProfile.get(<span class="number">0</span>).onmouseover = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  clearCardTime();</span><br><span class="line">&#125;</span><br><span class="line">$mCard.get(<span class="number">0</span>).onmouseout = $mProfile.get(<span class="number">0</span>).onmouseout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  cardTime();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cardTime</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  cardTimer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $mProfile.hide();</span><br><span class="line">  &#125;, <span class="number">400</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clearCardTime</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  clearTimeout(cardTimer);</span><br><span class="line">  $mProfile.show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="placeholder样式兼容-amp-amp-属性IE兼容"><a href="#placeholder样式兼容-amp-amp-属性IE兼容" class="headerlink" title="placeholder样式兼容&amp;&amp;属性IE兼容"></a>placeholder样式兼容&amp;&amp;属性IE兼容</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.common-form-control</span><span class="selector-pseudo">::-webkit-input-placeholder</span>,</span><br><span class="line"><span class="selector-class">.common-form-control</span><span class="selector-pseudo">::-moz-placeholder</span>,</span><br><span class="line"><span class="selector-class">.common-form-control</span><span class="selector-pseudo">:-ms-input-placeholder</span>,</span><br><span class="line"><span class="selector-class">.common-form-control</span><span class="selector-pseudo">::placeholder</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#9b9b9b</span>;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line">  $.fn.placeholder = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> opts = $.extend(&#123;&#125;, $.fn.placeholder.defaults, options);</span><br><span class="line">    <span class="keyword">var</span> isIE = <span class="built_in">document</span>.all ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> _this = <span class="keyword">this</span>,</span><br><span class="line">        placeholderValue = _this.getAttribute(<span class="string">"placeholder"</span>); <span class="comment">//缓存默认的placeholder值</span></span><br><span class="line">      <span class="keyword">if</span> (isIE) &#123;</span><br><span class="line">        _this.setAttribute(<span class="string">"value"</span>, placeholderValue);</span><br><span class="line">        _this.onfocus = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          $.trim(_this.value) == placeholderValue ? _this.value = <span class="string">""</span> : <span class="string">''</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        _this.onblur = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          $.trim(_this.value) == <span class="string">""</span> ? _this.value = placeholderValue : <span class="string">''</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)(jQuery);</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">$(<span class="string">"input"</span>).placeholder();</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><h4 id="返回顶部函数"><a href="#返回顶部函数" class="headerlink" title="返回顶部函数"></a>返回顶部函数</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回顶部</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gotoTop</span>(<span class="params">acceleration,stime</span>) </span>&#123;</span><br><span class="line">  acceleration = acceleration || <span class="number">0.1</span>;</span><br><span class="line">  stime = stime || <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">var</span> x1 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> y1 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> x2 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> y2 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> x3 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> y3 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">document</span>.documentElement) &#123;</span><br><span class="line">    x1 = <span class="built_in">document</span>.documentElement.scrollLeft || <span class="number">0</span>;</span><br><span class="line">    y1 = <span class="built_in">document</span>.documentElement.scrollTop || <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">document</span>.body) &#123;</span><br><span class="line">    x2 = <span class="built_in">document</span>.body.scrollLeft || <span class="number">0</span>;</span><br><span class="line">    y2 = <span class="built_in">document</span>.body.scrollTop || <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> x3 = <span class="built_in">window</span>.scrollX || <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> y3 = <span class="built_in">window</span>.scrollY || <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> x = <span class="built_in">Math</span>.max(x1, <span class="built_in">Math</span>.max(x2, x3));</span><br><span class="line">  <span class="keyword">var</span> y = <span class="built_in">Math</span>.max(y1, <span class="built_in">Math</span>.max(y2, y3));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> speeding = <span class="number">1</span> + acceleration;</span><br><span class="line">  <span class="built_in">window</span>.scrollTo(<span class="built_in">Math</span>.floor(x / speeding), <span class="built_in">Math</span>.floor(y / speeding));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(x &gt; <span class="number">0</span> || y &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> run = <span class="string">"gotoTop("</span> + acceleration + <span class="string">", "</span> + stime + <span class="string">")"</span>;</span><br><span class="line">    <span class="built_in">window</span>.setTimeout(run, stime);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="滚动监听垂直联动"><a href="#滚动监听垂直联动" class="headerlink" title="滚动监听垂直联动"></a>滚动监听垂直联动</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">window</span>).scroll(<span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span>,</span><br><span class="line">    sTop = $(<span class="keyword">this</span>).scrollTop(),</span><br><span class="line">    windowH = $(<span class="built_in">window</span>).height() / <span class="number">2</span>,</span><br><span class="line">    pos = <span class="built_in">parseFloat</span>($(<span class="string">'#area3'</span>).offset().top) / <span class="number">2</span>,</span><br><span class="line">    pos1 = $(<span class="string">'#area3'</span>).offset().top - windowH,</span><br><span class="line">    pos2 = $(<span class="string">'#area4'</span>).offset().top - windowH,</span><br><span class="line">    pos3 = $(<span class="string">'#area5'</span>).offset().top - windowH,</span><br><span class="line">    pos4 = $(<span class="string">'#area6'</span>).offset().top - windowH</span><br><span class="line">  $target = $(<span class="string">'#navList'</span>).parent().parent();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (sTop &gt;= pos) &#123;</span><br><span class="line">    $target.show();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $target.hide();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (sTop &gt;= pos4) &#123;</span><br><span class="line">    i = <span class="number">3</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sTop &gt;= pos3) &#123;</span><br><span class="line">    i = <span class="number">2</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sTop &gt;= pos2) &#123;</span><br><span class="line">    i = <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  $(<span class="string">'#navList li'</span>).eq(i).addClass(<span class="string">'active'</span>).siblings().removeClass(<span class="string">'active'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="右侧浮动导航平滑切换"><a href="#右侧浮动导航平滑切换" class="headerlink" title="右侧浮动导航平滑切换"></a>右侧浮动导航平滑切换</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">"#navList a"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> href = $(<span class="keyword">this</span>).attr(<span class="string">"href"</span>);</span><br><span class="line">  <span class="keyword">var</span> pos = $(href).offset().top - <span class="number">48</span>;</span><br><span class="line">  $(<span class="keyword">this</span>).parent().addClass(<span class="string">'active'</span>).siblings().removeClass(<span class="string">'active'</span>);</span><br><span class="line">  <span class="keyword">if</span> (!$(<span class="string">"body"</span>).is(<span class="string">":animated"</span>)) &#123;</span><br><span class="line">    $(<span class="string">"html,body"</span>).animate(&#123;</span><br><span class="line">      scrollTop: pos</span><br><span class="line">    &#125;, <span class="number">600</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="判断浏览器是否为IE（包括IE11）"><a href="#判断浏览器是否为IE（包括IE11）" class="headerlink" title="判断浏览器是否为IE（包括IE11）"></a>判断浏览器是否为IE（包括IE11）</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isIE</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!!<span class="built_in">window</span>.ActiveXObject || <span class="string">"ActiveXObject"</span> <span class="keyword">in</span> <span class="built_in">window</span>) &#123;</span><br><span class="line">    alert(<span class="string">"is IE"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    alert(<span class="string">"is not IE"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="判断浏览器是否为移动端"><a href="#判断浏览器是否为移动端" class="headerlink" title="判断浏览器是否为移动端"></a>判断浏览器是否为移动端</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isMobile = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span>(navigator.userAgent.match(<span class="regexp">/(iPhone|iPod|Android|ios)/i</span>)) &#123;</span><br><span class="line">  isMobile = <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  isMobile = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="将时间戳转换为时间"><a href="#将时间戳转换为时间" class="headerlink" title="将时间戳转换为时间"></a>将时间戳转换为时间</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMyDate</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> oDate = <span class="keyword">new</span> <span class="built_in">Date</span>(str),</span><br><span class="line">    oYear = oDate.getFullYear(),</span><br><span class="line">    oMonth = oDate.getMonth() + <span class="number">1</span>,</span><br><span class="line">    oDay = oDate.getDate(),</span><br><span class="line">    oHour = oDate.getHours(),</span><br><span class="line">    oMin = oDate.getMinutes(),</span><br><span class="line">    oSen = oDate.getSeconds(),</span><br><span class="line">    oTime = oYear + <span class="string">'-'</span> + getzf(oMonth) + <span class="string">'-'</span> + getzf(oDay) + <span class="string">' '</span> + getzf(oHour) + <span class="string">':'</span> + getzf(oMin) + <span class="string">':'</span> + getzf(oSen); <span class="comment">//最后拼接时间  </span></span><br><span class="line">  <span class="keyword">return</span> oTime;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getzf</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">parseInt</span>(num) &lt; <span class="number">10</span>) &#123;</span><br><span class="line">    num = <span class="string">'0'</span> + num;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Node实现JavaScript模块的原理简单介绍"><a href="#Node实现JavaScript模块的原理简单介绍" class="headerlink" title="Node实现JavaScript模块的原理简单介绍"></a>Node实现JavaScript模块的原理简单介绍</h4><p><a href="https://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000/001434502419592fd80bbb0613a42118ccab9435af408fd000" target="_blank" rel="noopener">原文</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/** Node实现JavaScript模块的一个简单的原理介绍</span><br><span class="line"> * Node利用JavaScript的函数式编程的特性，轻而易举地实现了模块的隔离</span><br><span class="line"> * 变量module是Node在加载js文件前准备的一个变量，并将其传入加载函数</span><br><span class="line"> **/</span><br><span class="line">(function() &#123;</span><br><span class="line">  var s = &apos;Hello&apos;; //读取Hello.js代码</span><br><span class="line">  var name = &apos;Taotao&apos;;</span><br><span class="line"></span><br><span class="line">  console.log(&apos;Hell0 &apos; + name + &apos;!&apos;);</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">// 准备module对象</span><br><span class="line">var module = &#123;</span><br><span class="line">  id: &apos;hello&apos;,</span><br><span class="line">  exports: &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var load = function(module) &#123;</span><br><span class="line">  //读取Hello.js代码</span><br><span class="line">  function greet(module) &#123;</span><br><span class="line">    console.log(&apos;Hell0 &apos; + name + &apos;!&apos;);</span><br><span class="line">  &#125;</span><br><span class="line">  module.exports = greet;</span><br><span class="line">  return module.exports;</span><br><span class="line">&#125;</span><br><span class="line">var exported = load(module);</span><br><span class="line">//保存</span><br><span class="line">save(module, exported);</span><br></pre></td></tr></table></figure></p><h4 id="Nodejs基本模块fs"><a href="#Nodejs基本模块fs" class="headerlink" title="Nodejs基本模块fs"></a>Nodejs基本模块fs</h4><p><a href="https://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000/001434501497361a4e77c055f5c4a8da2d5a1868df36ad1000" target="_blank" rel="noopener">Node.js内置的fs模块就是文件系统模块，负责读写文件。</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步读文件</span></span><br><span class="line">fs.readFile(<span class="string">'test1.txt'</span>, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步写文件</span></span><br><span class="line"><span class="keyword">var</span> writeData = <span class="string">'Hello,Node.js'</span>;</span><br><span class="line">fs.writeFile(<span class="string">'test1.txt'</span>, writeData, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'OK!'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步读文件</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> data = fs.readFileSync(<span class="string">'test1.txt'</span>, <span class="string">'utf-8'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步读文件</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  fs.writeFileSync(<span class="string">'test1.txt'</span>, writeData);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"OK!"</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步读取文件相关信息</span></span><br><span class="line">fs.stat(<span class="string">'test1.txt'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, stat</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'isFile: '</span> + stat.isFile()); <span class="comment">// 是否是文件</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'isDirectory: '</span> + stat.isDirectory()); <span class="comment">// 是否是目录</span></span><br><span class="line">    <span class="keyword">if</span> (stat.isFile()) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'size: '</span> + stat.size);  <span class="comment">// 文件大小</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'birth time: '</span> + stat.birthtime);  <span class="comment">// 创建时间，Date对象</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'modifier time: '</span> + stat.mtime);  <span class="comment">// 修改时间，Date对象</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步读取文件 statSync()</span></span><br></pre></td></tr></table></figure><h4 id="Nodejs基本模块http"><a href="#Nodejs基本模块http" class="headerlink" title="Nodejs基本模块http"></a>Nodejs基本模块http</h4><p><a href="https://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000/0014345015296018cac40c198b543fead5c549865b9bd4a000" target="_blank" rel="noopener">廖雪峰的官方网站之Node中的Http</a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"><span class="comment">// 导入http模块</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>),</span><br><span class="line">    url = <span class="built_in">require</span>(<span class="string">'url'</span>),</span><br><span class="line">    path = <span class="built_in">require</span>(<span class="string">'path'</span>),</span><br><span class="line">    http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从命令行参数获取root目录，默认是当前目录：</span></span><br><span class="line"><span class="keyword">var</span> root = path.resolve(process.argv[<span class="number">2</span>] || <span class="string">'.'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Static root dir: '</span> + root);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建http server</span></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获得URL的path</span></span><br><span class="line">  <span class="keyword">var</span> pathname = url.parse(request.url).pathname;</span><br><span class="line">  <span class="comment">// 获得对应的本地文件路径</span></span><br><span class="line">  <span class="keyword">var</span> filepath = path.join(root, pathname);</span><br><span class="line">  <span class="comment">// 获取文件状态</span></span><br><span class="line">  fs.stat(filepath, <span class="function"><span class="keyword">function</span>(<span class="params">err, stats</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!err &amp;&amp; stats.isFile()) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'200 '</span> + request.url);</span><br><span class="line">      response.writeHead(<span class="number">200</span>);</span><br><span class="line">      <span class="comment">// 将文件流导向response</span></span><br><span class="line">      fs.createReadStream(filepath).pipe(response);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'404 '</span> + request.url);</span><br><span class="line">      response.writeHead(<span class="number">404</span>);</span><br><span class="line">      response.end(<span class="string">'404 Not Found'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 让服务器监听8080端口</span></span><br><span class="line">server.listen(<span class="number">8080</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server is running at http:127.0.0.1:8080/'</span>);</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自定义单选框、复选框样式</title>
      <link href="/2018/12/07/style-checkout-radio/"/>
      <url>/2018/12/07/style-checkout-radio/</url>
      
        <content type="html"><![CDATA[<p>开发过程中，为了兼容IE低版本浏览器，我们重写单选框、复选框等的样式，就需要借助 js 来实现。<br><a id="more"></a><br>Javascript</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重写多选框,单选框样式</span></span><br><span class="line">;(<span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</span><br><span class="line">  $.fn.hcheckbox = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    $(<span class="string">':checkbox+label'</span>, <span class="keyword">this</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      $(<span class="keyword">this</span>).addClass(<span class="string">'disabled'</span>);</span><br><span class="line">      <span class="keyword">if</span> ($(<span class="keyword">this</span>).prev().is(<span class="string">':disabled'</span>) == <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($(<span class="keyword">this</span>).prev().is(<span class="string">':checked'</span>))</span><br><span class="line">          $(<span class="keyword">this</span>).addClass(<span class="string">"checked"</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $(<span class="keyword">this</span>).addClass(<span class="string">'disabled'</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;).click(<span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> ischeckbox = $(<span class="keyword">this</span>).prev().is(<span class="string">':checked'</span>);</span><br><span class="line">      <span class="keyword">if</span> (!ischeckbox) &#123;</span><br><span class="line">        $(<span class="keyword">this</span>).addClass(<span class="string">"checked"</span>);</span><br><span class="line">        $(<span class="keyword">this</span>).prev().checked = <span class="literal">true</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $(<span class="keyword">this</span>).removeClass(<span class="string">'checked'</span>);</span><br><span class="line">        $(<span class="keyword">this</span>).prev().checked = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      event.stopPropagation();</span><br><span class="line">    &#125;).prev().hide();</span><br><span class="line">  &#125;</span><br><span class="line">  $.fn.hradio = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> $(<span class="string">':radio+label'</span>, <span class="keyword">this</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      $(<span class="keyword">this</span>).addClass(<span class="string">'hRadio'</span>);</span><br><span class="line">      <span class="keyword">if</span> ($(<span class="keyword">this</span>).prev().is(<span class="string">"checked"</span>))</span><br><span class="line">        $(<span class="keyword">this</span>).addClass(<span class="string">'hRadio-Checked'</span>);</span><br><span class="line"></span><br><span class="line">    &#125;).click(<span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">      $(<span class="keyword">this</span>).parent().siblings().find(<span class="string">':radio+label'</span>).removeClass(<span class="string">"hRadio-Checked"</span>);</span><br><span class="line">      <span class="keyword">if</span> (!$(<span class="keyword">this</span>).prev().is(<span class="string">':checked'</span>)) &#123;</span><br><span class="line">        $(<span class="keyword">this</span>).addClass(<span class="string">"hRadio-Checked"</span>);</span><br><span class="line">        $(<span class="keyword">this</span>).prev()[<span class="number">0</span>].checked = <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      event.stopPropagation();</span><br><span class="line">    &#125;).prev().hide();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(jQuery)</span><br><span class="line"></span><br><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $(<span class="string">'.checkbox'</span>).hcheckbox();</span><br><span class="line">  $(<span class="string">'.radio-wper'</span>).hradio();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Style<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-tag">input</span>,</span><br><span class="line"><span class="selector-class">.radio-wper</span> <span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-tag">label</span>,</span><br><span class="line"><span class="selector-class">.radio-wper</span> <span class="selector-tag">label</span> &#123;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">22px</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-class">.disabled</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-class">.checked</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-class">.radio-wper</span> <span class="selector-class">.hRadio</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-class">.radio-wper</span> <span class="selector-class">.hRadio-Checked</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background-position</span>:  <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">  <span class="attribute">background-size</span>: <span class="number">100%</span> <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-class">.disabled</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">'../../images/activities/adi2018/check-01.png'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-class">.checked</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">'../../images/activities/adi2018/check-02.png'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.radio-wper</span> <span class="selector-class">.hRadio</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">'../../images/activities/adi2018/radio-01.png'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.radio-wper</span> <span class="selector-class">.hRadio-Checked</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">'../../images/activities/adi2018/radio-02.png'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 工具库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>实现文字的无缝滚动、间歇性向上翻滚</title>
      <link href="/2018/11/29/plugin-scroll/"/>
      <url>/2018/11/29/plugin-scroll/</url>
      
        <content type="html"><![CDATA[<p>文字向上滚动分为：无缝滚动、间歇性滚动<br><a id="more"></a></p><h3 id="间歇性滚动"><a href="#间歇性滚动" class="headerlink" title="间歇性滚动"></a>间歇性滚动</h3><h4 id="使用jQuery的-animate"><a href="#使用jQuery的-animate" class="headerlink" title="使用jQuery的 animate"></a>使用jQuery的 <code>animate</code></h4><p>一般情况下，向上翻滚一行内容，即一个<code>&lt;li&gt;&lt;/li&gt;</code>，但是如果是一行有多个<code>li</code>标签，要使用常见的插件就会出现问题了…</p><p>所以自己改吧改吧：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</span><br><span class="line">  $.fn.myScroll = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> init = &#123;</span><br><span class="line">      items: <span class="number">1</span>,  <span class="comment">//一行有几项内容</span></span><br><span class="line">      speed: <span class="number">3000</span>,  <span class="comment">//滚动速度</span></span><br><span class="line">      moveHeight: <span class="number">22</span>  <span class="comment">// 行高</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> intId = [];</span><br><span class="line">    <span class="keyword">var</span> opts = $.extend(&#123;&#125;, init, options);</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">moveUp</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">      obj.animate(&#123;</span><br><span class="line">        marginTop: <span class="string">'-'</span> + opts.moveHeight + <span class="string">'px'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="number">1000</span>,</span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>);</span><br><span class="line">        $<span class="keyword">this</span>.find(<span class="string">'li'</span>).slice(<span class="number">0</span>, opts.items).appendTo($<span class="keyword">this</span>);</span><br><span class="line">        $<span class="keyword">this</span>.css(<span class="string">'margin-top'</span>, <span class="number">0</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> sh = opts.moveHeight,</span><br><span class="line">        speed = opts.speed,</span><br><span class="line">        items = opts.items,</span><br><span class="line">        $<span class="keyword">this</span> = $(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">      intId[i] = setInterval(timerEvent, speed);</span><br><span class="line"></span><br><span class="line">      $<span class="keyword">this</span>.hover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        clearInterval(intId[i]);</span><br><span class="line">      &#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        intId[i] = setInterval(timerEvent, speed);</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">var</span> len = $<span class="keyword">this</span>.find(<span class="string">'li'</span>).length;</span><br><span class="line">      <span class="keyword">if</span>(len &gt; items &amp;&amp; len &lt;= items * <span class="number">2</span>) &#123;</span><br><span class="line">        $<span class="keyword">this</span>.html($<span class="keyword">this</span>.html() + $<span class="keyword">this</span>.html());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">timerEvent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> len = $<span class="keyword">this</span>.find(<span class="string">'li'</span>).length;</span><br><span class="line">        <span class="keyword">if</span>(len &gt; items &amp;&amp; len &lt;= items * <span class="number">2</span>) &#123;</span><br><span class="line">          len /= <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(len &lt;= items) &#123;</span><br><span class="line">          clearInterval(intId[i]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          moveUp($<span class="keyword">this</span>, sh);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(jQuery);</span><br><span class="line">$(<span class="string">'#scrollLists'</span>).myScroll(&#123;</span><br><span class="line">  items: <span class="number">3</span>,</span><br><span class="line">  speed: <span class="number">3000</span>,</span><br><span class="line">  moveHeight: <span class="number">22</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>以下的都是单行内容翻滚，搬过来记录下：</p><h4 id="使用JavaScript"><a href="#使用JavaScript" class="headerlink" title="使用JavaScript"></a>使用JavaScript</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Scroll</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">Scroll.prototype.upScroll = <span class="function"><span class="keyword">function</span> (<span class="params">dom, _h, interval</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> dom = <span class="built_in">document</span>.getElementById(dom);</span><br><span class="line">  <span class="keyword">var</span> timer = setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _field = dom.children[<span class="number">0</span>];</span><br><span class="line">    _field.style.marginTop = _h;</span><br><span class="line">    clearTimeout(timer);</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">  setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _field = dom.children[<span class="number">0</span>];</span><br><span class="line">    _field.style.marginTop = <span class="string">"0px"</span>;</span><br><span class="line">    dom.appendChild(_field);</span><br><span class="line">    <span class="keyword">var</span> _field = dom.children[<span class="number">0</span>]</span><br><span class="line">    _field.style.marginTop = _h;</span><br><span class="line">  &#125;, interval)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> myScroll = <span class="keyword">new</span> Scroll();</span><br></pre></td></tr></table></figure><p>用法：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * demo 父容器(ul)的id</span></span><br><span class="line"><span class="comment"> * -36px 子元素li的高度</span></span><br><span class="line"><span class="comment"> * 3000  滚动间隔时间</span></span><br><span class="line"><span class="comment"> * 每次滚动持续时间可到css文件中修改</span></span><br><span class="line"><span class="comment"> * （找不到原文了-.-）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">myScroll.upScroll(<span class="string">"demo"</span>,<span class="string">"-36px"</span>,<span class="number">3000</span>);</span><br></pre></td></tr></table></figure></p><h3 id="无缝滚动"><a href="#无缝滚动" class="headerlink" title="无缝滚动"></a>无缝滚动</h3><p>下载地址：<a href="http://www.jq22.com/jquery-info6631" target="_blank" rel="noopener">简单的jQuery无缝向上滚动效果</a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</span><br><span class="line">  $.fn.myScroll = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//默认配置</span></span><br><span class="line">    <span class="keyword">var</span> defaults = &#123;</span><br><span class="line">      speed: <span class="number">40</span>, <span class="comment">//滚动速度,值越大速度越慢</span></span><br><span class="line">      rowHeight: <span class="number">24</span> <span class="comment">//每行的高度</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> opts = $.extend(&#123;&#125;, defaults, options),</span><br><span class="line">      intId = [];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">marquee</span>(<span class="params">obj, step</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      obj.find(<span class="string">"ul"</span>).animate(&#123;</span><br><span class="line">        marginTop: <span class="string">'-=1'</span></span><br><span class="line">      &#125;, <span class="number">0</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> s = <span class="built_in">Math</span>.abs(<span class="built_in">parseInt</span>($(<span class="keyword">this</span>).css(<span class="string">"margin-top"</span>)));</span><br><span class="line">        <span class="keyword">if</span> (s &gt;= step) &#123;</span><br><span class="line">          $(<span class="keyword">this</span>).find(<span class="string">"li"</span>).slice(<span class="number">0</span>, <span class="number">1</span>).appendTo($(<span class="keyword">this</span>));</span><br><span class="line">          $(<span class="keyword">this</span>).css(<span class="string">"margin-top"</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span> (<span class="params">i</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> sh = opts[<span class="string">"rowHeight"</span>],</span><br><span class="line">        speed = opts[<span class="string">"speed"</span>],</span><br><span class="line">        _this = $(<span class="keyword">this</span>);</span><br><span class="line">      intId[i] = setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (_this.find(<span class="string">"ul"</span>).height() &lt;= _this.height()) &#123;</span><br><span class="line">          clearInterval(intId[i]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          marquee(_this, sh);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, speed);</span><br><span class="line"></span><br><span class="line">      _this.hover(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        clearInterval(intId[i]);</span><br><span class="line">      &#125;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        intId[i] = setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (_this.find(<span class="string">"ul"</span>).height() &lt;= _this.height()) &#123;</span><br><span class="line">            clearInterval(intId[i]);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            marquee(_this, sh);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, speed);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)(jQuery);</span><br><span class="line"></span><br><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">'.myscroll'</span>).myScroll(&#123;</span><br><span class="line">    speed: <span class="number">40</span>, <span class="comment">//数值越大，速度越慢</span></span><br><span class="line">    rowHeight: <span class="number">26</span> <span class="comment">//li的高度</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 工具库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js插件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>九宫格抽奖</title>
      <link href="/2018/11/27/plugin-lottery/"/>
      <url>/2018/11/27/plugin-lottery/</url>
      
        <content type="html"><![CDATA[<p>九宫格抽奖记录：</p><a id="more"></a><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 九宫格抽奖</span></span><br><span class="line"><span class="keyword">var</span> click=<span class="literal">false</span>;</span><br><span class="line"><span class="keyword">var</span> luck=&#123;</span><br><span class="line"></span><br><span class="line">  index: <span class="number">0</span>,<span class="comment">//当前转动到哪个位置，起点位置</span></span><br><span class="line">  count: <span class="number">0</span>,<span class="comment">//总共有多少个位置</span></span><br><span class="line">  timer: <span class="number">0</span>,<span class="comment">//setTimeout的ID，用clearTimeout清除</span></span><br><span class="line">  speed: <span class="number">30</span>,<span class="comment">//初始转动速度</span></span><br><span class="line">  times: <span class="number">0</span>,<span class="comment">//转动次数</span></span><br><span class="line">  cycle: <span class="number">70</span>,<span class="comment">//转动基本次数：即至少需要转动多少次再进入抽奖环节</span></span><br><span class="line">  prize: <span class="number">-1</span>,<span class="comment">//中奖位置</span></span><br><span class="line"></span><br><span class="line">  init:<span class="function"><span class="keyword">function</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($(<span class="string">"#"</span>+id).find(<span class="string">".luck-unit"</span>).length&gt;<span class="number">0</span>) &#123;</span><br><span class="line">      $luck = $(<span class="string">"#"</span>+id);</span><br><span class="line">      $units = $luck.find(<span class="string">".luck-unit"</span>);</span><br><span class="line">      <span class="keyword">this</span>.obj = $luck;</span><br><span class="line">      <span class="keyword">this</span>.count = $units.length;</span><br><span class="line">      <span class="comment">// $luck.find(".luck-unit-"+this.index).addClass("active");</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  roll:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> index = <span class="keyword">this</span>.index;</span><br><span class="line">    <span class="keyword">var</span> count = <span class="keyword">this</span>.count;</span><br><span class="line">    <span class="keyword">var</span> luck = <span class="keyword">this</span>.obj;</span><br><span class="line">    $(luck).find(<span class="string">".luck-unit-"</span>+index).removeClass(<span class="string">"active"</span>);</span><br><span class="line">    index += <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (index&gt;count<span class="number">-1</span>) &#123;</span><br><span class="line">      index = <span class="number">0</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    $(luck).find(<span class="string">".luck-unit-"</span>+index).addClass(<span class="string">"active"</span>);</span><br><span class="line">    <span class="keyword">this</span>.index=index;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  stop:<span class="function"><span class="keyword">function</span>(<span class="params">index</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.prize=index;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">roll</span>(<span class="params">which</span>)</span>&#123;</span><br><span class="line">  luck.times += <span class="number">1</span>;</span><br><span class="line">  luck.roll();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (luck.times &gt; luck.cycle+<span class="number">10</span> &amp;&amp; luck.prize==luck.index) &#123;</span><br><span class="line">    <span class="keyword">var</span> title = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> content = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> desc = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> prize = <span class="string">''</span>;</span><br><span class="line">    <span class="comment">// 最终停下来的位置</span></span><br><span class="line">    <span class="comment">// 初始化</span></span><br><span class="line">    clearTimeout(luck.timer);</span><br><span class="line">    luck.prize=<span class="number">-1</span>;</span><br><span class="line">    luck.times=<span class="number">0</span>;</span><br><span class="line">    click=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span>(which) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        prize = <span class="string">'小米鼠标'</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        prize = <span class="string">'固态硬盘'</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        prize = <span class="string">'乐扣保温杯'</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        prize = <span class="string">'京东券'</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        prize = <span class="string">'谢谢参与'</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        prize = <span class="string">'万用表'</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        prize = <span class="string">'摩尔吧课程折扣券'</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">        prize = <span class="string">'小米耳机'</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(which == <span class="number">4</span>) &#123;</span><br><span class="line">      title = <span class="string">'谢谢参与'</span>;</span><br><span class="line">      content = <span class="string">'再接再厉'</span></span><br><span class="line">      desc = <span class="string">'请查看活动详情，获取更多抽奖资格'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      title = <span class="string">'恭喜您'</span>;</span><br><span class="line">      content = <span class="string">'获得 &lt;span class="blue"&gt;'</span>+ prize +<span class="string">'&lt;/span&gt;'</span>;</span><br><span class="line">      <span class="keyword">if</span>(which == <span class="number">6</span>) &#123;</span><br><span class="line">        desc = <span class="string">'请至您的”个人中心“查收'</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        desc = <span class="string">'奖品将于活动结束后统一发送'</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 展示中奖状态</span></span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      modalShow(title,content,desc);</span><br><span class="line">    &#125;, <span class="number">800</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (luck.times&lt;luck.cycle) &#123;</span><br><span class="line">      luck.speed -= <span class="number">10</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (luck.times==luck.cycle) &#123;</span><br><span class="line">      <span class="comment">// 最终中奖位置的索引</span></span><br><span class="line">      luck.prize = which;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (luck.times &gt; luck.cycle+<span class="number">10</span> &amp;&amp; ((luck.prize==<span class="number">0</span> &amp;&amp; luck.index==<span class="number">7</span>) || luck.prize==luck.index+<span class="number">1</span>)) &#123;</span><br><span class="line">        luck.speed += <span class="number">110</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        luck.speed += <span class="number">20</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (luck.speed&lt;<span class="number">40</span>) &#123;</span><br><span class="line">      luck.speed=<span class="number">40</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    luck.timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      roll(which);</span><br><span class="line">    &#125;,luck.speed);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Lottery init</span></span><br><span class="line">  luck.init(<span class="string">'luckArea'</span>);</span><br><span class="line"></span><br><span class="line">  $(<span class="string">"#startBtn"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(click) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      click=<span class="literal">true</span>;</span><br><span class="line">      luck.speed=<span class="number">100</span>;</span><br><span class="line">      $.get(<span class="string">"http://www.moore8.com/campaign/lotteryAct"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> data = $.parseJSON(data);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'data:'</span>, data);</span><br><span class="line">        <span class="keyword">if</span>(data.code == <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="keyword">var</span> which = data.type;</span><br><span class="line">          <span class="comment">// 调取抽奖并传值</span></span><br><span class="line">          roll(which);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span>(data.msg == <span class="string">'请先登录！'</span>) &#123;</span><br><span class="line">            loginFunc(<span class="string">'course_gift'</span>);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> desc = <span class="string">'请查看活动详情，获取更多抽奖资格'</span>;</span><br><span class="line">            modalShow(<span class="string">'对不起'</span>, data.msg, desc);</span><br><span class="line">          &#125;</span><br><span class="line">          click = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">modalShow</span>(<span class="params">title, body, desc</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> title = title || <span class="string">'温馨提示'</span>;</span><br><span class="line">  <span class="keyword">var</span> body = body || <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">var</span> desc = desc || <span class="string">''</span>;</span><br><span class="line">  $(<span class="string">'#mTitle'</span>).html(title);</span><br><span class="line">  $(<span class="string">'#mBody'</span>).html(body);</span><br><span class="line">  $(<span class="string">'#mDesc'</span>).html(desc);</span><br><span class="line">  $(<span class="string">'#myModal'</span>).modal(<span class="string">'show'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loginFunc</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> href = <span class="built_in">window</span>.location.href;</span><br><span class="line">  <span class="keyword">var</span> id = id ? <span class="string">"%23"</span> + id : <span class="string">''</span>;</span><br><span class="line">  <span class="built_in">window</span>.location.href = <span class="string">"/login/?referer="</span> + href + id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 工具库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jQuery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>活动之整点秒杀功能优化</title>
      <link href="/2018/11/27/feat-sale/"/>
      <url>/2018/11/27/feat-sale/</url>
      
        <content type="html"><![CDATA[<p>整点秒杀功能总结：<br><a id="more"></a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> starttime1 = <span class="string">"2018/11/14 14:00"</span>,</span><br><span class="line">  endtime1 = <span class="string">"2018/11/15 14:00"</span>,</span><br><span class="line"></span><br><span class="line">  starttime7 = <span class="string">"2018/11/19 14:00"</span>,</span><br><span class="line">  endtime7 = <span class="string">"2018/11/20 14:00"</span>,</span><br><span class="line">  <span class="comment">// 中 5~8 组（省略）</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 下 9~12 组（省略）</span></span><br><span class="line"></span><br><span class="line">  starttime22 = <span class="string">"2018/11/29 14:00"</span>,</span><br><span class="line">  endtime22 = <span class="string">"2018/11/30 14:00"</span>,</span><br><span class="line"></span><br><span class="line">  starttime23 = <span class="string">"2018/12/14 14:00"</span>,</span><br><span class="line">  endtime23 = <span class="string">"2018/12/15 14:00"</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取 整点秒杀状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> getShopStatus = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> statuShop = [];</span><br><span class="line">  $.ajax(&#123;</span><br><span class="line">    url: <span class="string">'//www.eeboard.com/wp-content/themes/eeboard/api/eeboardsix.php?act=shop_detail'</span>,</span><br><span class="line">    dataType: <span class="string">'json'</span>,</span><br><span class="line">    cache: <span class="literal">false</span>,</span><br><span class="line">    <span class="keyword">async</span>: <span class="literal">false</span>,</span><br><span class="line">    type: <span class="string">"GET"</span>,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> arr8 = data.data.eight;</span><br><span class="line">      <span class="comment">// 整点秒杀状态</span></span><br><span class="line">      <span class="keyword">if</span> (!arr8) &#123;</span><br><span class="line">        arr8 = [<span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>]</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">var</span> d1over = arr8[<span class="number">0</span>],</span><br><span class="line">        d2over = arr8[<span class="number">1</span>],</span><br><span class="line">        d3over = arr8[<span class="number">2</span>],</span><br><span class="line">        d4over = arr8[<span class="number">3</span>],</span><br><span class="line">        d5over = arr8[<span class="number">4</span>],</span><br><span class="line">        d6over = arr8[<span class="number">5</span>],</span><br><span class="line">        d7over = arr8[<span class="number">6</span>],</span><br><span class="line">        d8over = arr8[<span class="number">7</span>],</span><br><span class="line">        d9over = arr8[<span class="number">8</span>],</span><br><span class="line">        d10over = arr8[<span class="number">9</span>],</span><br><span class="line">        d11over = arr8[<span class="number">10</span>],</span><br><span class="line">        d12over = arr8[<span class="number">11</span>];</span><br><span class="line"></span><br><span class="line">      statuShop = [</span><br><span class="line">        d1over, d1over, d2over, d2over, d3over, d3over, d4over,</span><br><span class="line">        d5over, d5over, d6over, d6over, d7over, d7over, d8over, d8over,</span><br><span class="line">        d9over, d9over, d10over, d10over, d11over, d11over, d12over, d12over</span><br><span class="line">      ];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> statuShop;</span><br><span class="line">    &#125;,</span><br><span class="line">    error: <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// console.log('商城接口报错---');</span></span><br><span class="line">      <span class="comment">// console.log(error);</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> statuShop;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> shopStatusArr = getShopStatus();</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 时间状态函数  </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timeStatus</span>(<span class="params">start, end</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> status = <span class="string">'load'</span>,</span><br><span class="line">    nowTime = <span class="built_in">parseFloat</span>(<span class="keyword">new</span> <span class="built_in">Date</span>().getTime()),</span><br><span class="line">    startTime = <span class="built_in">parseFloat</span>((<span class="keyword">new</span> <span class="built_in">Date</span>(start)).getTime()),</span><br><span class="line">    endTime = <span class="built_in">parseFloat</span>((<span class="keyword">new</span> <span class="built_in">Date</span>(end)).getTime()),</span><br><span class="line">    lastStartTime = <span class="built_in">parseFloat</span>(startTime - nowTime),</span><br><span class="line">    lastEndTime = <span class="built_in">parseFloat</span>(endTime - nowTime);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 未开始</span></span><br><span class="line">  <span class="keyword">if</span> (lastStartTime &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> status = <span class="string">'load'</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (lastStartTime &lt;= <span class="number">0</span> &amp;&amp; lastEndTime &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// 进行中</span></span><br><span class="line">    <span class="keyword">return</span> status = <span class="string">'start'</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (lastEndTime &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// 已结束</span></span><br><span class="line">    <span class="keyword">return</span> status = <span class="string">'end'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 各个时间段状态切换函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isTimeStartEvent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> timer;</span><br><span class="line">  <span class="keyword">var</span> timersArr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>];</span><br><span class="line">  <span class="comment">// 判断时间状态</span></span><br><span class="line">  $.each(timersArr, <span class="function"><span class="keyword">function</span> (<span class="params">i, item</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> start = <span class="built_in">eval</span>(<span class="string">'starttime'</span> + item);</span><br><span class="line">    <span class="keyword">var</span> end = <span class="built_in">eval</span>(<span class="string">'endtime'</span> + item);</span><br><span class="line">    <span class="keyword">var</span> status = timeStatus(start, end);</span><br><span class="line">   </span><br><span class="line">    switchCaseEvent(item, status);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> *秒杀时间监控：判断时间段函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">intervalStartEvent</span>(<span class="params">start, end</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> bigTimer;</span><br><span class="line">  <span class="keyword">var</span> isClear = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">var</span> status = timeStatus(start, end);</span><br><span class="line">  <span class="comment">// 时间截止，清除定时器</span></span><br><span class="line">  <span class="keyword">if</span> (status === <span class="string">'end'</span>) &#123;</span><br><span class="line">    isClear = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (isClear) &#123;</span><br><span class="line">    clearTimeout(bigTimer);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    bigTimer = setTimeout(<span class="string">'intervalStartEvent(starttime1, endtime23);'</span>, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 监控时间段函数</span></span><br><span class="line">  isTimeStartEvent();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 提示及button状态切换函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">switchCaseEvent</span>(<span class="params">item, type</span>) </span>&#123;</span><br><span class="line">  item = item || <span class="number">1</span>;</span><br><span class="line">  type = type || <span class="string">'end'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (item) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      startAndEndEvent($(<span class="string">'#qiangbtn1'</span>), item, type);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">      startAndEndEvent($(<span class="string">'#qiangbtn2'</span>), item, type);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">      startAndEndEvent($(<span class="string">'#qiangbtn3'</span>), item, type);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">      startAndEndEvent($(<span class="string">'#qiangbtn4'</span>), item, type);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">9</span>:</span><br><span class="line">      startAndEndEvent($(<span class="string">'#qiangbtn5'</span>), item, type);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">      startAndEndEvent($(<span class="string">'#qiangbtn6'</span>), item, type);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">13</span>:</span><br><span class="line">      startAndEndEvent($(<span class="string">'#qiangbtn7'</span>), item, type);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">14</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">15</span>:</span><br><span class="line">      startAndEndEvent($(<span class="string">'#qiangbtn8'</span>), item, type);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">17</span>:</span><br><span class="line">      startAndEndEvent($(<span class="string">'#qiangbtn9'</span>), item, type);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">18</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">19</span>:</span><br><span class="line">      startAndEndEvent($(<span class="string">'#qiangbtn10'</span>), item, type);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">20</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">21</span>:</span><br><span class="line">      startAndEndEvent($(<span class="string">'#qiangbtn11'</span>), item, type);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">22</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">23</span>:</span><br><span class="line">      startAndEndEvent($(<span class="string">'#qiangbtn12'</span>), item, type);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文字状态切换函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">startAndEndEvent</span>(<span class="params">obj, item, type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!obj) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span> (type === <span class="string">'start'</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> status = shopStatusArr[item - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (status) &#123;</span><br><span class="line">      $(<span class="string">'#qiang-time0'</span> + item).text(<span class="string">'开始秒杀'</span>);</span><br><span class="line">      obj.removeClass(<span class="string">'unclick'</span>).text(<span class="string">'开始秒杀'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      $(<span class="string">'#qiang-time0'</span> + item).text(<span class="string">'已抢光'</span>).css(<span class="string">'color'</span>, <span class="string">'#9b9b9b'</span>);</span><br><span class="line">      obj.addClass(<span class="string">'unclick unclick-over'</span>).text(<span class="string">'已抢光'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'end'</span>) &#123;</span><br><span class="line">    $(<span class="string">'#qiang-time0'</span> + item).text(<span class="string">'已抢光'</span>).css(<span class="string">'color'</span>, <span class="string">'#9b9b9b'</span>);</span><br><span class="line">    obj.addClass(<span class="string">'unclick unclick-time'</span>).text(<span class="string">'已抢光'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $(<span class="string">'#qiang-time0'</span> + item).text(<span class="string">'即将开始'</span>);</span><br><span class="line">    <span class="comment">// 两对时间段对应同一个按钮，判断本段时间是否截止，再开启另一段时间的状态</span></span><br><span class="line">    <span class="keyword">if</span> (obj.hasClass(<span class="string">'unclick-time'</span>)) &#123;</span><br><span class="line">      obj.removeClass(<span class="string">'unclick'</span>).text(<span class="string">'即将开始'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 工具库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js功能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设置Cookie</title>
      <link href="/2018/11/03/web-cookie/"/>
      <url>/2018/11/03/web-cookie/</url>
      
        <content type="html"><![CDATA[<h3 id="设置Cookie总结"><a href="#设置Cookie总结" class="headerlink" title="设置Cookie总结"></a>设置Cookie总结</h3><a id="more"></a><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 收藏功能</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">addFavorite</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">var</span> title = <span class="string">'意法半导体STM32/STM8技术社区 - 提供最新的ST资讯和技术交流'</span>;</span><br><span class="line">   <span class="keyword">var</span> URL = <span class="string">'http://www.stmcu.org.cn/'</span>; </span><br><span class="line">   <span class="comment">// IE10</span></span><br><span class="line">   <span class="keyword">if</span>(<span class="built_in">document</span>.all) &#123;</span><br><span class="line">     <span class="built_in">window</span>.external.addFavorite(URL, title);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     alert(<span class="string">'手动 Ctrl+D 可以收藏我们的网站哦'</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 设置cookie，同一域名都可获取</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">setCookie</span>(<span class="params">name, value, exdays</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">var</span> exdays = exdays || <span class="number">1024</span>;</span><br><span class="line">   <span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">   d.setTime(d.getTime() + (exdays * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>));</span><br><span class="line">   <span class="built_in">document</span>.cookie = name + <span class="string">"="</span> + <span class="built_in">escape</span>(value) + <span class="string">";path=/;expires="</span> + d.toGMTString();</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">// 读取cookies，判断是否存在设置的name</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">var</span> name = name + <span class="string">"="</span>;</span><br><span class="line">   <span class="keyword">var</span> ca = <span class="built_in">document</span>.cookie.split(<span class="string">';'</span>);</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; ca.length; i++) &#123;</span><br><span class="line">     <span class="keyword">var</span> c = ca[i].trim();</span><br><span class="line">     <span class="keyword">if</span> (c.indexOf(name) == <span class="number">0</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> c.substring(name.length, c.length);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">checkCookie</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">var</span> user = getCookie(<span class="string">"msgCookie"</span>);</span><br><span class="line">   <span class="keyword">var</span> width = <span class="built_in">window</span>.innerWidth||<span class="built_in">document</span>.documentElement.clientWidth||<span class="built_in">document</span>.body.clientWidth;</span><br><span class="line">   <span class="keyword">if</span>(width &gt;= <span class="number">1080</span>) &#123;</span><br><span class="line">     <span class="keyword">if</span> (user != <span class="string">""</span>) &#123;</span><br><span class="line">       msgHide();</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       msgShow();</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 关闭时设置cookie</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">closeModal</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   msgHide();</span><br><span class="line">   setCookie(<span class="string">"msgCookie"</span>, <span class="string">'msgCookie'</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">msgHide</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">document</span>.getElementById(<span class="string">'newsTipsModal'</span>).style.display = <span class="string">'none'</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">msgShow</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">document</span>.getElementById(<span class="string">'newsTipsModal'</span>).style.display = <span class="string">'block'</span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// init</span></span><br><span class="line"> checkCookie();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js功能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习JavaScript深入系列简要总结</title>
      <link href="/2018/10/31/js-learn-prototype/"/>
      <url>/2018/10/31/js-learn-prototype/</url>
      
        <content type="html"><![CDATA[<p>学习JavaScript深入系列简要总结<br><a id="more"></a></p><h3 id="从原型到原型链"><a href="#从原型到原型链" class="headerlink" title="从原型到原型链"></a>从原型到原型链</h3><p>原文地址：<a href="https://github.com/mqyqingfeng/Blog/issues/2" target="_blank" rel="noopener">JavaScript深入之从原型到原型链</a></p><blockquote><p>每一个函数都有一个<code>prototype</code>属性，该属性指向了一个对象，此对象为调用该函数而创建的实例的原型</p></blockquote><p><img src="https://github.com/mqyqingfeng/Blog/raw/master/Images/prototype1.png" alt="构造函数和实例原型的关系图"></p><blockquote><p>每一个对象（除null）都具有一个属性：<code>__proto__</code>，这个属性指向该对象的原型</p></blockquote><p><img src="https://github.com/mqyqingfeng/Blog/raw/master/Images/prototype2.png" alt="实例与实例原型的关系图"></p><blockquote><p>每个原型都有一个constructor属性指向关联的构造函数</p></blockquote><p><img src="https://raw.githubusercontent.com/mqyqingfeng/Blog/master/Images/prototype3.png" alt=""></p><blockquote><p>原型对象是通过 <code>Object</code> 构造函数生成的，最后<code>Object.prototype.__proto__ = null</code></p></blockquote><p><img src="https://github.com/mqyqingfeng/Blog/raw/master/Images/prototype5.png" alt="原型链示意图"></p><h3 id="词法作用域和动态作用域"><a href="#词法作用域和动态作用域" class="headerlink" title="词法作用域和动态作用域"></a>词法作用域和动态作用域</h3><p>原文链接：<a href="https://github.com/mqyqingfeng/Blog/issues/3" target="_blank" rel="noopener">JavaScript深入之词法作用域和动态作用域</a></p><blockquote><p>javascript采用的是<code>词法作用域(lexical scoping)</code>，函数的作用域是在函数定义的时候就决定了，而不是调用的时候才决定</p></blockquote><ul><li>词法作用域，即静态作用域，函数的作用域在函数定义的时候就决定了</li><li>动态作用域，函数的作用域是在函数调用的时候才决定</li></ul><h3 id="执行上下文栈"><a href="#执行上下文栈" class="headerlink" title="执行上下文栈"></a>执行上下文栈</h3><p>当执行一个函数的时候，就会创建一个<code>执行上下文(execution context)</code>，并且压入<code>执行上下文栈(Execution context stack, ESC)</code></p><p>当函数执行完毕的时候，会将函数的<code>执行上下文栈</code>中弹出</p><h3 id="变量对象"><a href="#变量对象" class="headerlink" title="变量对象"></a>变量对象</h3><p>1、全局上下文的变量对象初始化：全局对象</p><p>2、函数上下文的变量对象初始化：只包括<code>Arguments</code>对象</p><p>3、进入执行上下文时：给变量对象添加形参、函数声明、变量声明等初始的属性值</p><p>4、代码执行阶段：再次修改变量对象的属性值</p><p>总结：未进入执行阶段之前，<code>变量对象(VO)</code>中的属性都不能访问！但是进入执行阶段之后，<code>变量对象(VO)</code>转变为了<code>活动对象(AO)</code>，里面的属性都能被访问了，然后开始进行执行阶段的操作。它们其实都是同一个对象，只是处于执行上下文的不同生命周期。</p><p>最后，函数是“第一等公民”，记住这个，变量名称和函数名称相同的声明，优先执行函数声明</p><h3 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h3><h3 id="从ECMAScript规范解读this"><a href="#从ECMAScript规范解读this" class="headerlink" title="从ECMAScript规范解读this"></a>从ECMAScript规范解读this</h3><h3 id="执行上下文"><a href="#执行上下文" class="headerlink" title="执行上下文"></a>执行上下文</h3><h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><p>闭包是指那些能够访问自由变量的函数。</p><p>自由变量是指在函数中使用的，但既不是参数也不是函数的局部变量的变量。</p><p>那么，闭包 = 函数 + 函数能够访问的自由变量。</p><h3 id="参数按值传递"><a href="#参数按值传递" class="headerlink" title="参数按值传递"></a>参数按值传递</h3><p>ECMAScript中所有函数的参数都是按值传递的。</p><p>即，把函数外部的值复制给函数内部的参数，就和把值从一个变量复制给另一个变量一样。</p><p>参数如果是基本类型是按值传递，如果是引用类型按共享传递。</p><p>共享传递是指，在传递对象的时候，传递对象的引用的副本。</p><h3 id="call和apply的模拟实现"><a href="#call和apply的模拟实现" class="headerlink" title="call和apply的模拟实现"></a>call和apply的模拟实现</h3><p><code>call()</code>在使用一个指定的this值和若干个指定的参数值的前提下，调用某个函数或方法。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.mycall = <span class="function"><span class="keyword">function</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> context = context || <span class="built_in">window</span>;</span><br><span class="line">  <span class="comment">//获取调用call的函数，用this可以获取</span></span><br><span class="line">  context.fn = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">var</span> args = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>, l = <span class="built_in">arguments</span>.length; i &lt; l; i++) &#123;</span><br><span class="line">    args.push(<span class="string">'arguments['</span> + i + <span class="string">']'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 把传给call的参数传递给了context.fn函数</span></span><br><span class="line">  <span class="keyword">var</span> result = <span class="built_in">eval</span>(<span class="string">'context.fn('</span> + args + <span class="string">')'</span>);</span><br><span class="line">  <span class="keyword">delete</span> context.fn;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>apply()</code>同<code>call()</code>，只不过将多个参数值，以数组的形式传入而已。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.myapply = <span class="function"><span class="keyword">function</span>(<span class="params">context, arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> context = <span class="built_in">Object</span>(context) || <span class="built_in">window</span>;</span><br><span class="line">  context.fn = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">var</span> result;</span><br><span class="line">  <span class="keyword">if</span> (!arr) &#123;</span><br><span class="line">    result = context.fn();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> args = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> index = <span class="number">0</span>; index &lt; arr.length; index++) &#123;</span><br><span class="line">      args.push(<span class="string">'arr['</span> + index + <span class="string">']'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    result = <span class="built_in">eval</span>(<span class="string">'context.fn('</span> + args + <span class="string">')'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">delete</span> context.fn;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="bind的模拟实现"><a href="#bind的模拟实现" class="headerlink" title="bind的模拟实现"></a>bind的模拟实现</h3><p><code>bind()</code>方法会创建一个新函数。当这个新函数被调用，bind()第一个参数将作为它运行时的this，之后的一系列参数将会在传递的实参前传入，作为它的参数。</p><h3 id="new的模拟实现"><a href="#new的模拟实现" class="headerlink" title="new的模拟实现"></a>new的模拟实现</h3><p>new运算符创建一个用户定义的对象类型的实例或具有构造函数的内置对象类型之一。</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>冴羽的博客之JavaScript、ES6系列集锦</title>
      <link href="/2018/10/26/blog-01/"/>
      <url>/2018/10/26/blog-01/</url>
      
        <content type="html"><![CDATA[<blockquote><p>JavaScript深入系列 15 篇已完结<br>JavaScript专题系列 20 篇已完结<br>underscore 系列 8 篇已完结<br><a id="more"></a></p></blockquote><h2 id="冴羽的博客"><a href="#冴羽的博客" class="headerlink" title="冴羽的博客"></a>冴羽的博客</h2><h3 id="专栏"><a href="#专栏" class="headerlink" title="专栏"></a>专栏</h3><ul><li><a href="https://juejin.im/user/58e4b9b261ff4b006b3227f4" target="_blank" rel="noopener">掘金主页</a></li><li><p><a href="https://segmentfault.com/u/yayu/articles" target="_blank" rel="noopener">segmentfault主页</a></p></li><li><p><a href="https://www.zhihu.com/people/qing-feng-yi-yang/activities" target="_blank" rel="noopener">知乎</a></p></li></ul><h3 id="深入系列目录"><a href="#深入系列目录" class="headerlink" title="深入系列目录"></a>深入系列目录</h3><ol><li><a href="https://github.com/mqyqingfeng/Blog/issues/2" target="_blank" rel="noopener">JavaScirpt深入之从原型到原型链</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/3" target="_blank" rel="noopener">JavaScript深入之词法作用域和动态作用域</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/4" target="_blank" rel="noopener">JavaScript深入之执行上下文栈</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/5" target="_blank" rel="noopener">JavaScript深入之变量对象</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/6" target="_blank" rel="noopener">JavaScript深入之作用域链</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/7" target="_blank" rel="noopener">JavaScript深入之从ECMAScript规范解读this</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/8" target="_blank" rel="noopener">JavaScript深入之执行上下文</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/9" target="_blank" rel="noopener">JavaScript深入之闭包</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/10" target="_blank" rel="noopener">JavaScript深入之参数按值传递</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/11" target="_blank" rel="noopener">JavaScript深入之call和apply的模拟实现</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/12" target="_blank" rel="noopener">JavaScript深入之bind的模拟实现</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/13" target="_blank" rel="noopener">JavaScript深入之new的模拟实现</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/14" target="_blank" rel="noopener">JavaScript深入之类数组对象与arguments</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/15" target="_blank" rel="noopener">JavaScript深入之创建对象的多种方式以及优缺点</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/16" target="_blank" rel="noopener">JavaScript深入之继承的多种方式以及优缺点</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/17" target="_blank" rel="noopener">JavaScript深入系列15篇正式完结！</a></li></ol><h3 id="专题系列目录"><a href="#专题系列目录" class="headerlink" title="专题系列目录"></a>专题系列目录</h3><ol><li><a href="https://github.com/mqyqingfeng/Blog/issues/22" target="_blank" rel="noopener">JavaScript专题之跟着underscore学防抖</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/26" target="_blank" rel="noopener">JavaScript专题之跟着underscore学节流</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/27" target="_blank" rel="noopener">JavaScript专题之数组去重</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/28" target="_blank" rel="noopener">JavaScript专题之类型判断(上)</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/30" target="_blank" rel="noopener">JavaScript专题之类型判断(下)</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/32" target="_blank" rel="noopener">JavaScript专题之深浅拷贝</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/33" target="_blank" rel="noopener">JavaScript专题之从零实现jQuery的extend</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/35" target="_blank" rel="noopener">JavaScript专题之如何求数组的最大值和最小值</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/36" target="_blank" rel="noopener">JavaScript专题之数组扁平化</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/37" target="_blank" rel="noopener">JavaScript专题之学underscore在数组中查找指定元素</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/40" target="_blank" rel="noopener">JavaScript专题之jQuery通用遍历方法each的实现</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/41" target="_blank" rel="noopener">JavaScript专题之如何判断两个对象相等</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/42" target="_blank" rel="noopener">JavaScript专题之函数柯里化</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/43" target="_blank" rel="noopener">JavaScript专题之偏函数</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/44" target="_blank" rel="noopener">JavaScript专题之惰性函数</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/45" target="_blank" rel="noopener">JavaScript专题之函数组合</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/46" target="_blank" rel="noopener">JavaScript专题之函数记忆</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/49" target="_blank" rel="noopener">JavaScript专题之递归</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/51" target="_blank" rel="noopener">JavaScript专题之乱序</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/52" target="_blank" rel="noopener">JavaScript专题之解读 v8 排序源码</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/53" target="_blank" rel="noopener">JavaScript专题系列20篇正式完结！</a></li></ol><h3 id="underscore-系列目录"><a href="#underscore-系列目录" class="headerlink" title="underscore 系列目录"></a>underscore 系列目录</h3><ol><li><a href="https://github.com/mqyqingfeng/Blog/issues/56" target="_blank" rel="noopener">underscore 系列之如何写自己的 underscore</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/57" target="_blank" rel="noopener">underscore 系列之链式调用</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/58" target="_blank" rel="noopener">underscore 系列之内部函数 cb 和 optimizeCb</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/60" target="_blank" rel="noopener">underscore 系列之内部函数 restArgs</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/62" target="_blank" rel="noopener">underscore 系列之防冲突与 Utility Functions</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/63" target="_blank" rel="noopener">underscore 系列之实现一个模板引擎(上)</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/70" target="_blank" rel="noopener">underscore 系列之实现一个模板引擎(下)</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/77" target="_blank" rel="noopener">underscore 系列之字符实体与 _.escape</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/79" target="_blank" rel="noopener">underscore 的源码该如何阅读？</a></li></ol><h3 id="ES6-系列目录"><a href="#ES6-系列目录" class="headerlink" title="ES6 系列目录"></a>ES6 系列目录</h3><ol><li><a href="https://github.com/mqyqingfeng/Blog/issues/82" target="_blank" rel="noopener">ES6 系列之 let 和 const</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/84" target="_blank" rel="noopener">ES6 系列之模板字符串</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/85" target="_blank" rel="noopener">ES6 系列之箭头函数</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/87" target="_blank" rel="noopener">ES6 系列之模拟实现 Symbol 类型</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/90" target="_blank" rel="noopener">ES6 系列之迭代器与 for of</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/91" target="_blank" rel="noopener">ES6 系列之模拟实现一个 Set 数据结构</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/92" target="_blank" rel="noopener">ES6 系列之 WeakMap</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/98" target="_blank" rel="noopener">ES6 系列之我们来聊聊 Promise</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/99" target="_blank" rel="noopener">ES6 系列之 Generator 的自动执行</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/100" target="_blank" rel="noopener">ES6 系列之我们来聊聊 Async</a></li></ol><h3 id="友情链接"><a href="#友情链接" class="headerlink" title="友情链接"></a>友情链接</h3><ol><li><a href="https://juejin.im/post/5bbc54a2e51d450e5a7445b4" target="_blank" rel="noopener">如何轻松拿到淘宝前端 offer</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Purl.js-JS获取地址栏信息用例测试</title>
      <link href="/2018/09/23/js-purl/"/>
      <url>/2018/09/23/js-purl/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Purl.js可以帮助我们来获取地址栏的一些信息， 可以使用原生js，也可以使用jQuery</p></blockquote><ul><li><a href="https://www.bootcdn.cn/purl/readme/" target="_blank" rel="noopener">Purl.js官方文档</a></li></ul><a id="more"></a><table><thead><tr><th style="text-align:left">Attributes</th><th>Info</th></tr></thead><tbody><tr><td style="text-align:left">source</td><td>The whole url being parsed</td></tr><tr><td style="text-align:left">protocol</td><td>eg. http, https, file, etc</td></tr><tr><td style="text-align:left">host</td><td>eg. <a href="http://www.mydomain.com" target="_blank" rel="noopener">www.mydomain.com</a>, localhost etc</td></tr><tr><td style="text-align:left">port</td><td>eg. 80</td></tr><tr><td style="text-align:left">relative</td><td>The relative path to the file including the querystring (eg. /folder/dir/index.html?item=value)</td></tr><tr><td style="text-align:left">path</td><td>The path to the file (eg. /folder/dir/index.html)</td></tr><tr><td style="text-align:left">directory</td><td>The directory part of the path (eg. /folder/dir/)</td></tr><tr><td style="text-align:left">file</td><td>The basename of the file eg. index.html</td></tr><tr><td style="text-align:left">query</td><td>The entire query string if it exists, eg. item=value&amp;item2=value2</td></tr><tr><td style="text-align:left">fragment or anchor</td><td>The entire string after the # symbol</td></tr></tbody></table><h4 id="初始化："><a href="#初始化：" class="headerlink" title="初始化："></a>初始化：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url;</span><br><span class="line"><span class="keyword">var</span> myurl;</span><br><span class="line"></span><br><span class="line">$(<span class="string">"#clickBtn"</span>).find(<span class="string">'button'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> res, resInfo;</span><br><span class="line"></span><br><span class="line">  myurl = $(<span class="string">"#urlArea"</span>).val();</span><br><span class="line">  <span class="comment">// 如果myurl为空，则会获取当前页面的url</span></span><br><span class="line">  url = purl(myurl);</span><br><span class="line"></span><br><span class="line">  $(<span class="string">"#urlArea"</span>).val(myurl);</span><br><span class="line"></span><br><span class="line">  res = $(<span class="keyword">this</span>).text();</span><br><span class="line">  resInfo = getUrlInfo(url, res);</span><br><span class="line"></span><br><span class="line">  $(<span class="string">"#inputRes"</span>).val(resInfo);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUrlInfo</span>(<span class="params">url, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (res === <span class="string">'param'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> url.param();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (res === <span class="string">'segment'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> url.segment();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> url.attr(res);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="运行试试看："><a href="#运行试试看：" class="headerlink" title="运行试试看："></a>运行试试看：</h4><ul><li><a href="https://codepen.io/istaotao/pen/EeJoKP" target="_blank" rel="noopener">codepen完整代码</a> </li></ul><h4 id="截图如下所示："><a href="#截图如下所示：" class="headerlink" title="截图如下所示："></a>截图如下所示：</h4><p><img src="https://cdn.files.qdfuns.com/article/content/picture/201807/20/221014v16gkkkdks3eegac.png" alt="截图"></p><h4 id="记录在QDfuns"><a href="#记录在QDfuns" class="headerlink" title="记录在QDfuns:"></a>记录在QDfuns:</h4><ul><li><a href="https://www.qdfuns.com/article/32286/0a69e234cca1cab2f2005425338623a8.html" target="_blank" rel="noopener">Purl.js-使用JS获取URL信息</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js插件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTML5 Canvas 图形绘制</title>
      <link href="/2018/09/23/canvas-01/"/>
      <url>/2018/09/23/canvas-01/</url>
      
        <content type="html"><![CDATA[<blockquote><p>canvas 元素并非 Canvas 中最强大的部分，真正的关键部分是 2D 渲染上下文，这是你真正绘制图形的地方。canvas 元素的用途只是作为 2D 渲染上下文的包装器，它包含绘图和图形操作所需要的全部方法和丰富功能。理解这一点是很重要的，强调一下：绘图是在 2D 渲染上下文中进行的，而不是在 canvas 元素中进行。可以通过 canvas 元素访问和显示 2D 渲染上下文。<a href="http://techbrood.com/h5b2a?p=html-canvas-2dcontext" target="_blank" rel="noopener">【引入原文】</a></p></blockquote><a id="more"></a><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p><a href="https://codepen.io/istaotao/pen/LJvzEm" target="_blank" rel="noopener">HTML5 Canvas 粉尘态粒子引力效应</a></p><h2 id="文章"><a href="#文章" class="headerlink" title="文章"></a>文章</h2><p><a href="https://www.qdfuns.com/article/32286/453691c72f71e7534b062c8baa8e3506.html" target="_blank" rel="noopener">HTML5 Canvas 图形绘制 初级</a></p><p><a href="https://www.qdfuns.com/article/32286/4c494e2cdc21135c41be95fbb685e379.html" target="_blank" rel="noopener">HTML5 Canvas 图形绘制 中级</a></p><p><a href="https://www.qdfuns.com/article/32286/237e32dfb71a2626c02cfc74c65f7271.html" target="_blank" rel="noopener">HTML5 跟随鼠标移动的雪花动画</a></p><p><a href="https://www.qdfuns.com/article/32286/e833cda2cb9eacc01f09ffae5734405e.html" target="_blank" rel="noopener">HTML5 Canvas 很酷炫的粉尘态粒子引力效应实践</a></p><p><a href="https://www.qdfuns.com/article/32286/c05adac0d8a4f65121707a336bd1190b.html" target="_blank" rel="noopener">HTML5 很酷炫的点线粒子特效，你不试一下？</a></p>]]></content>
      
      
      <categories>
          
          <category> Html </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Canvas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【转】高效学习JavaScript的六个思维技巧</title>
      <link href="/2018/09/22/js-learn/"/>
      <url>/2018/09/22/js-learn/</url>
      
        <content type="html"><![CDATA[<p>初始整理于慕课网手记<a href="http://www.imooc.com/article/12113" target="_blank" rel="noopener">高效学习JavaScript的六个思维技巧</a><br><a id="more"></a></p><h2 id="更快学习JavaScript的六个思维技巧"><a href="#更快学习JavaScript的六个思维技巧" class="headerlink" title="更快学习JavaScript的六个思维技巧"></a>更快学习JavaScript的六个思维技巧</h2><blockquote><p><strong>当人们试图学习JavaScript或其他编程语言的时候，他们通常会遇到如下挑战。</strong></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1. 一些概念让他们感到困惑，特别是如果之前学过其他类型的语言。</span><br><span class="line"></span><br><span class="line">2. 很难找到学习的时间（或者动力）去学习。</span><br><span class="line"></span><br><span class="line">3. 你很容易忘掉之前学到的东西。</span><br><span class="line"></span><br><span class="line">4. JavaScript工具太多并且经常更新，以至于很难找到学习的切入点。</span><br><span class="line"></span><br><span class="line">5. ...</span><br></pre></td></tr></table></figure><p><strong>幸运的是，这些难题最终能够被克服。在这篇文章，我将展示六个能够帮助你更快、更开心、更高效地学习JavaScript的六个思维技巧。</strong></p><h3 id="1、不要让对未来的忧虑干扰你现在的学习"><a href="#1、不要让对未来的忧虑干扰你现在的学习" class="headerlink" title="1、不要让对未来的忧虑干扰你现在的学习"></a>1、不要让对未来的忧虑干扰你现在的学习</h3><blockquote><p>有些JavaScript初学者会问刚开始要学习哪种框架，但是如果你还没能熟练使用原生JavaScript，你就不应该问这种问题。因为你会花很多时间研究各种框架而得不到进步。</p></blockquote><blockquote><p>走出这个陷阱的一个方法是制定一个学习路径图。例如，要成为前端开发，你的路径图可能是下图。在将来你能够使用HTML和CSS制作动态页面。</p></blockquote><p><img src="http://img.mukewang.com/57ad9d660001149f07470214.png" alt="前端开发学习路径图"></p><h3 id="2、不要让自信骗你进入持续遗忘的陷阱"><a href="#2、不要让自信骗你进入持续遗忘的陷阱" class="headerlink" title="2、不要让自信骗你进入持续遗忘的陷阱"></a>2、不要让自信骗你进入持续遗忘的陷阱</h3><p><strong>快速理解一个概念会是JavaScript进步的最大阻碍，下面我将解释。</strong></p><blockquote><p>当你遇到一个知识点，而你好像理解了，你很可能抑制不住内心跳到下一个知识点的冲动。</p></blockquote><blockquote><p>现实可能是你会理解下一个知识点然后继续跳到下一个知识点。</p></blockquote><blockquote><p>但是，很快你会到达一个节点，在这个节点你发现自己已经忘了前面所学，于是你需要回过头复习，你快速瞟了一下之前所学然后又继续学习新的知识。</p></blockquote><blockquote><p>   但是现在，你忘记了其他东西。</p></blockquote><blockquote><p>   你一直重复这种继续-回顾-继续-回顾模式直到你发现自己完全迷失。</p><p>   你开始沮丧，想要休息，然后当你开始重振旗鼓，却发现自己已经忘掉所有。</p></blockquote><p><strong>幸运的是，我们有两个应对上述问题的方法：</strong></p><ul><li><p>一次只学一样东西；</p></li><li><p>做练习——实际就是敲代码；</p></li></ul><blockquote><p>   当你学习一个新的概念，你要将它实践出来，练习它，与它和善相处，甚至能够将它与其他概念联系到一起。</p></blockquote><blockquote><p>   当你学习一个示例，最重要的是你要自己将代码敲出来，这样能帮助你吸收它。另外，一次只学一个东西能够帮助你巩固所学，因为记忆更少的东西更容易。</p></blockquote><p><strong>这个过程看起来貌似比阅读然后快速跳到下一个知识点要花费更长的时间，但是实际上它所花的时间更少，因为这样你就不需要频繁复习之前所学。我在好几个场合后才艰难的领悟到这个道理。</strong></p><h3 id="3、使用正确的思维方式练习"><a href="#3、使用正确的思维方式练习" class="headerlink" title="3、使用正确的思维方式练习"></a>3、使用正确的思维方式练习</h3><p><strong>很多人认为敲代码是烦人的重复性工作，所以他们通常会跳过这个步骤试着寻找捷径。如果你试图为JavaScript练习寻找捷径，你将会为此花费更多的时间。</strong></p><p><strong>但是我们如何才能使得敲代码更加的有趣，使得我们愿意去敲代码呢？</strong></p><p><em>试着改变为下面的思维模式：</em></p><blockquote><p> 如果你刚学了一个JavaScript概念，然而你被告知不能使用它，对此你感觉如何？个人来说我会感到有点恼火，特别是为了弄懂它我花费了宝贵的时间。这就像是一个小孩得到了一个新的玩具，但却被限制不能玩它。</p></blockquote><blockquote><p>当你学习JavaScript的新知识，试着将这个知识点视作一个新玩具，例如新车、一双新鞋、或任何你觉得值得有趣的东西。然后，不要把敲代码当成工作，将敲代码视作你正在玩游戏。你正在使用刚学的技能做一些很酷的事情。给自己惊喜，把成果展示给你的朋友。</p></blockquote><blockquote><p>   带着游戏的思维模式你将学得更快，将记忆的更牢，同时你将体会到更多乐趣。</p></blockquote><h3 id="4、使用Facebook技巧为编程腾时间"><a href="#4、使用Facebook技巧为编程腾时间" class="headerlink" title="4、使用Facebook技巧为编程腾时间"></a>4、使用Facebook技巧为编程腾时间</h3><blockquote><p>人们遇到的一个普遍问题是，他们通常找不到时间去敲代码。通常，这些人会花好几个小时浏览例如Facebook、YouTube、Wikipedia或者Reddit这样的网站。无论你是否符合上述描述，我们都能从中学到一些东西。</p></blockquote><blockquote><p> 我当然有时间只浏览Facebook一会儿，但通常我会在上面待好几个小时浏览往返。这是如何发生的？我认为原因在于，刚开始我并没打算花在这上面花费那么多时间。开始行动是做一件事情最困难的部分，所以将目标设定的足够小能够帮助我们进入状态。如果有人问我是不是打算花几个小时浏览Facebook，我会回答不，因为我没有时间。然而，对于仅仅尝试一下我是能够接受的，这也是我能够沉浸其中的方法。</p></blockquote><blockquote><p>  <strong>好消息是，你能够对敲代码运用同样的心理技巧。</strong></p><p>   <strong>不要计划花几个小时敲代码，因为你会发现自己没有时间。</strong></p><p>   <strong>相反的，告诉自己只敲三分钟代码。这样你就不需要为寻找敲代码的时间烦心。</strong></p></blockquote><h3 id="5、思考的更慢你将学得更快"><a href="#5、思考的更慢你将学得更快" class="headerlink" title="5、思考的更慢你将学得更快"></a>5、思考的更慢你将学得更快</h3><blockquote><p>这一条听起来违反直觉，所以下面我将用一个故事来解释。</p></blockquote><blockquote><p>我的一个朋友又一次对JavaScript的一个特性感到困惑。我让他将他知道的解释给我听，然后告诉我哪儿让他困惑。当它向我解释代码，我发现他在跳步。</p></blockquote><blockquote><p>“等会儿！”我说道。“慢慢来，然后将这些一步步解释给我听。”</p></blockquote><blockquote><p>我的朋友直接将整个代码的功能总结给我听。</p></blockquote><blockquote><p>我再次让他暂停。“你还是在跳步。再解释一次，这次我需要你一步步将每一行代码发生了什么解释给我听。”</p></blockquote><blockquote><p>这一次，我的朋友能够更好的解释代码是如何运行的。关键在于他花时间去理解每一行代码而不是试图一下理解所有。</p></blockquote><blockquote><p>在上述这种案例中，<strong>思考的更慢实际上让你学得更快。</strong></p></blockquote><h3 id="6、在写复杂代码前先用简单语言写下"><a href="#6、在写复杂代码前先用简单语言写下" class="headerlink" title="6、在写复杂代码前先用简单语言写下"></a>6、在写复杂代码前先用简单语言写下</h3><blockquote><p>如果你要写的代码是复杂并且不常见的，先用简单语言将代码写下。这样，你能够你能够在真正写之前知道自己要做什么。下面是使用这个方法的两个好处：</p></blockquote><ul><li><p>你将更容易更快速的写代码，因为你不需要时刻停下来思考自己将要怎么做。</p></li><li><p>由于你知道代码要干什么，能够更好的排除错误。</p></li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><blockquote><p>我们已经讲了好几个更快速学习JavaScript的方法，但是你也能将上述方法运用于学习其他东西。下面是上述方法的概括：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">（1）、不要再想将要学什么，沉浸于现在；</span><br><span class="line"></span><br><span class="line">（2）、通过把新技能当做玩具使得练习更有趣；</span><br><span class="line"></span><br><span class="line">（3）、就像浏览Facebook、YouTube之类的网站一样，在敲代码前告诉自己只敲几分钟，这样你就拥有了敲代码的时间；</span><br><span class="line"></span><br><span class="line">（4）、慢下来，小步向前，你将学得更快。</span><br></pre></td></tr></table></figure><blockquote><p>本文转载自：<a href="http://www.zcfy.cc" target="_blank" rel="noopener">众成翻译</a></p><p>译者：<a href="http://www.zcfy.cc/@Ryan" target="_blank" rel="noopener">Ryan</a></p><p>链接：<a href="http://www.zcfy.cc/article/436" target="_blank" rel="noopener">http://www.zcfy.cc/article/436</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>从零制作edm邮件，需要了解的一些规则</title>
      <link href="/2018/09/19/edm-01/"/>
      <url>/2018/09/19/edm-01/</url>
      
        <content type="html"><![CDATA[<p>因为电子邮件客户端预览窗口通常只是一小部分屏幕宽度，你最好上你的电子邮件的宽度设计在大约600px。没有人喜欢水平滚动条<br><a id="more"></a></p><h3 id="一、初见"><a href="#一、初见" class="headerlink" title="一、初见"></a>一、初见</h3><h4 id="table"><a href="#table" class="headerlink" title="table"></a>table</h4><ul><li><code>&lt;table&gt;</code> 标签定义 HTML 表格</li><li>简单的 HTML 表格由 <code>table</code> 元素以及一个或多个 <code>tr</code>、<code>th</code> 或 <code>td</code> 元素组成</li><li><code>tr(table row)</code> 元素定义表格行，<code>th(table head)</code> 元素定义表头，<code>td(table data)</code> 元素定义表格单元</li><li>更复杂的 HTML 表格也可能包括 <code>caption</code>、<code>col</code>、<code>colgroup</code>、<code>thead</code>、<code>tfoot</code> 以及 <code>tbody</code> 元素</li><li><a href="http://www.w3school.com.cn/tags/tag_table.asp" target="_blank" rel="noopener">HTML table 标签</a></li></ul><h4 id="table属性"><a href="#table属性" class="headerlink" title="table属性"></a>table属性</h4><ul><li><code>border</code> — 规定表格边框的宽度</li><li><code>align</code> — 规定表格相对周围元素的对齐方式 <code>(left,center,right)</code></li><li><code>valign</code> — 垂直，默认是<code>valign=&quot;middle&quot;</code>，但是会修改为<code>valign=&quot;top&quot;</code></li><li><code>cellspacing</code> — 规定单元格之间的空间</li><li><code>cellpadding</code> — 规定单元边沿与其内容之间的空白</li><li><code>width</code> — 规定表格的宽度</li><li><code>height</code> — 规定表格的高度</li><li><code>background</code> — 背景图像</li><li><code>bgcolor</code> — 背景颜色</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span> <span class="attr">width</span>=<span class="string">"600"</span> <span class="attr">align</span>=<span class="string">"center"</span> <span class="attr">bgcolor</span>=<span class="string">"#cccccc"</span> <span class="attr">cellspacing</span>=<span class="string">"10"</span> <span class="attr">cellpadding</span>=<span class="string">"20"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span>语文<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span>数学<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span>英语<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="style"><a href="#style" class="headerlink" title="style"></a>style</h4><ul><li><code>width、height</code></li><li><code>font-family</code></li><li><code>font-size</code></li><li><code>font-weight</code></li><li><code>color</code></li><li><code>line-height</code></li><li><code>border</code></li><li><code>background-color</code></li><li><code>background-image</code></li><li><code>vertical-align</code></li></ul><h4 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h4><h5 id="行内元素"><a href="#行内元素" class="headerlink" title="行内元素"></a>行内元素</h5><ul><li><code>&lt;a href=&quot;http://www.eefocus.com&quot; target=&quot;_blank&quot;&gt;</code></li><li><code>&lt;img src=&quot;http://baidu.com/hao123.png&quot; alt=&quot;hao123图片&quot;&gt;</code></li><li><code>&lt;span&gt;我也可以是一段话，只是没法自主设置宽度而已&lt;/span&gt;</code></li></ul><h5 id="块级元素"><a href="#块级元素" class="headerlink" title="块级元素"></a>块级元素</h5><ul><li><code>&lt;p&gt;我是一段话...&lt;/p&gt;</code></li></ul><h3 id="二、了解"><a href="#二、了解" class="headerlink" title="二、了解"></a>二、了解</h3><h4 id="基本格式"><a href="#基本格式" class="headerlink" title="基本格式"></a>基本格式</h4><h5 id="Area-1"><a href="#Area-1" class="headerlink" title="Area-1"></a>Area-1</h5><ul><li>HTML 编码格式：<code>utf-8</code></li><li>页面尽量保持宽（600px~800px）、高（1024px），整体邮件不要太大，比如15k（各个邮箱不同）左右，不然很容易走垃圾邮箱</li><li>样式使用行间样式，如：<code>&lt;td style=&quot;font-family:Arial, Helvetica, sans-serif;font-size:12px;color:#000000;&quot; &gt;文字&lt;/td&gt;</code>其他的方式会被无视</li></ul><h5 id="Area-2"><a href="#Area-2" class="headerlink" title="Area-2"></a>Area-2</h5><ul><li><code>font-family</code> 属性不能为空</li><li>使用<code>&lt;table&gt;</code>布局，居中显示使用<code>align=&quot;center</code></li><li>不使用 table 以外的 <code>body</code>、<code>meta</code>和<code>html</code>之类的标签，部分邮箱系统会把这些过滤掉</li><li>不使用 <code>flash、java、javascript、frames、iframe、activeX</code> 以及 <code>dhtml</code></li><li>不要出现<code>onmouseover</code>、<code>onmouseout</code>，即使设定了，也会被过滤掉</li></ul><h5 id="Area-3"><a href="#Area-3" class="headerlink" title="Area-3"></a>Area-3</h5><ul><li>区域与区域之间的上下、左右之间的空白间隙，使用标准的<code>&lt;td width=15&gt;&amp;nbsp;&lt;/td&gt;</code>或<code>&lt;td height=&quot;15&quot;&gt;&amp;nbsp;&lt;/td&gt;</code>，不要使用<code>padding=&quot;15px&quot;</code> — 防止各个邮箱的解析不同</li></ul><h4 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h4><ul><li>图片的每个属性都要定义完整，如：<code>&lt;img src=&quot;http://www.eefocus.com/logo.png&quot; style=&quot;vertical-align:top;display:block;&quot; width=&quot;210&quot; height=&quot;100&quot;  alt=&quot;logo&quot;/&gt;</code></li><li>定义<code>style=&quot;vertical-align:top;&quot;</code> — 防止图片之间会有缝隙、变形等显示异常的情况</li><li>定义<code>display:block</code> — 解决Outlook电子邮件客户中图片底部增加空白间距的问题</li><li>限制每张图片的大小<code>width=&quot;200 height=&quot;200&quot;</code>或者<code>style=&quot;width:200px;height:200px;&quot;</code></li><li>添加每张图片alt属性，如：<code>alt=&quot;我是干啥的&quot;</code> — 防止图片无法加载，也可以知晓这是做什么的</li><li>图片格式使用<code>jpg、png</code>，尽量不要使用<code>gif</code></li><li>地址使用绝对路径（以<code>http/https</code>开头的）</li><li>尽量不使用背景图片<code>background-image</code>（Outlook不显示，但是可以显示背景色：<code>bgColor=&quot;f3f3f3&quot;</code>），直接使用图片<code>&lt;img src=&quot;&quot;&gt;</code></li><li>为了保持各个邮箱的一致性，尽量使用图片，大图可拆分成几张小图拼接，每张图片不要太大（15K以内）</li></ul><h4 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h4><ul><li>地址绝对路径：<code>&lt;a href=&quot;http://www.eefocus.com&quot;&gt;Logo Plus&lt;/a&gt;</code></li><li>地址不可过长（超过255个字符），尽量简短</li><li>数量尽量不超过10个</li><li>地址不要使用特殊符号，避免解析错误</li><li>文字中出现链接地址，被屏蔽的风险比较高，一般是文字+链接、图片+链接</li><li>不要使用地图功能链接，很容易被划分为垃圾邮箱</li><li>为避免用户收到的邮件图片无法浏览，请制作一份和邮件内容一样的web 页面，然后在邮件顶部写一句话：“如果您无法查看邮件内容，请点击这里”， 链接到放有同样内容的web页面</li></ul><h4 id="Outlook邮箱规则"><a href="#Outlook邮箱规则" class="headerlink" title="Outlook邮箱规则"></a>Outlook邮箱规则</h4><ul><li>内敛元素的<code>padding</code>无效、<code>vertical-align</code>不能被识别，可定义在<code>td</code></li><li>别想着继承的事儿，某一块的样式都单独设置，比如链接样式，文字样式等</li><li><code>p</code>标签的<code>width</code>不起作用，可定义在<code>td</code></li><li><code>p</code>标签的字体颜色会被覆盖，可单独使用诸如<code>span</code>等重新设置字体颜色，或者使用<code>style</code>定义在td</li><li>当设置 <code>&lt;img align=&quot;left&quot; /&gt;</code> 或 <code>&lt;img align=&quot;right&quot; /&gt;</code>时，图片会脱离文档流，在其父元素设置了 <code>margin</code> 或 <code>padding</code> 的话，都无法使其下移，左移或右移</li><li><code>line-height</code>默认为<code>1.6</code></li><li><code>#FFFFFF</code>关于颜色值，使用六位并且大写，使用简写在outlook下被忽略（很神奇）</li><li>关于链接，可以单独设置：<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">style</span>&gt;</span><br><span class="line">    <span class="selector-tag">a</span><span class="selector-pseudo">:link</span>,</span><br><span class="line">    <span class="selector-tag">a</span><span class="selector-pseudo">:visited</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: white;</span><br><span class="line">      <span class="attribute">text-decoration</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>,</span><br><span class="line">    <span class="selector-tag">a</span><span class="selector-pseudo">:active</span> &#123;</span><br><span class="line">      <span class="attribute">text-decoration</span>: none;</span><br><span class="line">      <span class="attribute">color</span>: white;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">a</span><span class="selector-pseudo">:focus</span> &#123;</span><br><span class="line">      <span class="attribute">text-decoration</span>: none;</span><br><span class="line">      <span class="attribute">color</span>: white;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/style&gt;</span><br></pre></td></tr></table></figure></li></ul><h5 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h5><ul><li>避免使用<code>margin padding</code>等属性，定义宽高的属性放在<code>td</code>，定义样式放在<code>p</code>或者<code>span</code>等标签内</li><li>一般而言，指定表格单元格宽度要比指定表格自身宽度要好 </li><li>使用bgcolor来替找style=”background:”,在电子邮件客户端中HTML属性要比CSS样式更好，但是优先等级依旧是：css样式&gt;html属性</li><li>新浪邮箱会忽略掉<code>cellpadding</code>，一般设置为<code>0</code><h3 id="三、悟道"><a href="#三、悟道" class="headerlink" title="三、悟道"></a>三、悟道</h3><h4 id="邮件设计"><a href="#邮件设计" class="headerlink" title="邮件设计"></a>邮件设计</h4></li><li>电子邮件的设计过程是非常纠结的，为了美还得考虑制作过程的煎熬<h5 id="保持简单"><a href="#保持简单" class="headerlink" title="保持简单"></a>保持简单</h5></li><li>当设计一个HTML电子邮件时，请记住保持简单，编码的时候考虑坚持两列布局，这样能为您省去很多麻烦的事情<h5 id="减少图像的使用甚至避免使用"><a href="#减少图像的使用甚至避免使用" class="headerlink" title="减少图像的使用甚至避免使用"></a>减少图像的使用甚至避免使用</h5></li><li>记住你的设计不能太花哨，因为Outlook不支持背景图像<h5 id="窄屏最好"><a href="#窄屏最好" class="headerlink" title="窄屏最好"></a>窄屏最好</h5></li><li>因为电子邮件客户端预览窗口通常只是一小部分屏幕宽度，你最好上你的电子邮件的宽度设计在大约600px。没有人喜欢水平滚动条<h5 id="保持一致"><a href="#保持一致" class="headerlink" title="保持一致"></a>保持一致</h5></li><li>记住，我们使用固定的元素属性cellpadding和cellspacing设置单元格的边距和单元格的间距。这样保持元素之间的间距一致性是正确的与谨慎的<blockquote><p>节选自：<a href="http://www.w3cplus.com/css/getting-started-with-html-emails.html" target="_blank" rel="noopener">开始制作HTML Email </a>之邮件设计</p></blockquote><h4 id="邮件制作"><a href="#邮件制作" class="headerlink" title="邮件制作"></a>邮件制作</h4></li><li>电子邮件的制作过程是非常煎熬的，一不小心就乱了、乱了。<h4 id="邮件测试"><a href="#邮件测试" class="headerlink" title="邮件测试"></a>邮件测试</h4></li><li>电子邮件的测试过程是非常痛苦的，也是最让人奔溃的，因为你很有可能拆了西墙补东墙</li></ul><h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><h5 id="我们看一下测试邮件：效果图"><a href="#我们看一下测试邮件：效果图" class="headerlink" title="我们看一下测试邮件：效果图"></a>我们看一下测试邮件：<a href="https://www.qdfuns.com/article.php?mod=view&amp;id=333432fb9305a8331f6cc39998a2626e&amp;uid=32286" target="_blank" rel="noopener">效果图</a></h5>]]></content>
      
      
      <categories>
          
          <category> Html </category>
          
      </categories>
      
      
        <tags>
            
            <tag> EDM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac 终端简易学习总结</title>
      <link href="/2018/08/13/macos-bash/"/>
      <url>/2018/08/13/macos-bash/</url>
      
        <content type="html"><![CDATA[<h3 id="一、目录基本操作"><a href="#一、目录基本操作" class="headerlink" title="一、目录基本操作"></a>一、目录基本操作</h3><h5 id="1-pwd-—-获取当前所在路径"><a href="#1-pwd-—-获取当前所在路径" class="headerlink" title="1. pwd — 获取当前所在路径"></a>1. <code>pwd</code> — 获取当前所在路径</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">yangtaodeMacBook-Pro:<span class="built_in">test</span> yangtao$ <span class="built_in">pwd</span></span><br><span class="line">/Users/yangtao/Desktop/文件创建/<span class="built_in">test</span></span><br></pre></td></tr></table></figure><a id="more"></a><h5 id="2-ls-—-列出当前目录下的所有文件"><a href="#2-ls-—-列出当前目录下的所有文件" class="headerlink" title="2. ls — 列出当前目录下的所有文件"></a>2. <code>ls</code> — 列出当前目录下的所有文件</h5><ul><li><code>ls -l</code> — 用长格式列出来</li><li><code>ls -a</code> — 列出文件（包括隐藏的文件）</li><li><code>ls -al</code> — 以长格式列出文件（包括隐藏的文件）</li></ul><h5 id="3-cd-—-目录间的切换"><a href="#3-cd-—-目录间的切换" class="headerlink" title="3. cd — 目录间的切换"></a>3. <code>cd</code> — 目录间的切换</h5><p>可以使用<code>tab</code>键补全目录名称，将文件拖入终端，可以显示该文件的目录</p><ul><li><code>cd</code> — (无参数)返回 home 目录</li><li><code>cd ~</code> — 返回 home 目录，可以使用<code>cd ~/Music</code>快速到达该目录，使用<code>cd ~Guest/</code>进入 Guest 用户的 home 目录</li><li><code>cd -</code> — 返回上一次操作的目录，可与当前目录进行切换</li><li><code>cd ..</code> — 返回上一层目录，<code>..</code>表示上一层目录，而<code>.</code>表示当前目录，如<code>./Music</code>，表示当前目录下的 Music 文件</li></ul><h5 id="4-mkdir-文件名-—-（make-dir）新建文件夹"><a href="#4-mkdir-文件名-—-（make-dir）新建文件夹" class="headerlink" title="4. mkdir 文件名 — （make dir）新建文件夹"></a>4. <code>mkdir 文件名</code> — （make dir）新建文件夹</h5><h5 id="5-rmdir-文件名-—-（remove-dir）删除文件夹"><a href="#5-rmdir-文件名-—-（remove-dir）删除文件夹" class="headerlink" title="5. rmdir 文件名 — （remove dir）删除文件夹"></a>5. <code>rmdir 文件名</code> — （remove dir）删除文件夹</h5><p>如果文件夹内不为空，则无法用 rmdir 删除文件夹</p><h5 id="6-rm-文件名-—-（remove-dir）删除文件"><a href="#6-rm-文件名-—-（remove-dir）删除文件" class="headerlink" title="6. rm 文件名 — （remove dir）删除文件"></a>6. <code>rm 文件名</code> — （remove dir）删除文件</h5><p>注意：用<code>rm</code>删除掉的文件是无法从回收站中找回的！而且不能使用 rm 来删除文件夹</p><h5 id="7-mv-原文件-目标目录-新文件名-—-移动"><a href="#7-mv-原文件-目标目录-新文件名-—-移动" class="headerlink" title="7. mv 原文件 目标目录/新文件名 — 移动"></a>7. <code>mv 原文件 目标目录/新文件名</code> — 移动</h5><p>把文件从一个地方移到另一个地方，但是当没有给出另外一个目录时，移动的现象就是为其更改了名字</p><h5 id="8-cp-带目录文件-目标目录-—-复制粘贴"><a href="#8-cp-带目录文件-目标目录-—-复制粘贴" class="headerlink" title="8. cp 带目录文件 目标目录 — 复制粘贴"></a>8. <code>cp 带目录文件 目标目录</code> — 复制粘贴</h5><h5 id="9-man-命令-—-查看使用手册"><a href="#9-man-命令-—-查看使用手册" class="headerlink" title="9. man 命令 — 查看使用手册"></a>9. <code>man 命令</code> — 查看使用手册</h5><h5 id="10-touch-—-创建文件"><a href="#10-touch-—-创建文件" class="headerlink" title="10. touch — 创建文件"></a>10. <code>touch</code> — 创建文件</h5><h5 id="11-cat-—-查看文件内容"><a href="#11-cat-—-查看文件内容" class="headerlink" title="11. cat — 查看文件内容"></a>11. <code>cat</code> — 查看文件内容</h5><h4 id="二、历史操作"><a href="#二、历史操作" class="headerlink" title="二、历史操作"></a>二、历史操作</h4><h5 id="1-向上（向下）箭头"><a href="#1-向上（向下）箭头" class="headerlink" title="1. 向上（向下）箭头"></a>1. <code>向上（向下）箭头</code></h5><p>查看上一个（下一个）命令，可以一直向前查看之前执行过的命令</p><h5 id="2-l-—-找出与你最近一次的-l-开头的命令，并执行"><a href="#2-l-—-找出与你最近一次的-l-开头的命令，并执行" class="headerlink" title="2. !l — 找出与你最近一次的 l 开头的命令，并执行"></a>2. <code>!l</code> — 找出与你最近一次的 l 开头的命令，并执行</h5><h5 id="3-history-—-查看之前执行过命令的历史记录"><a href="#3-history-—-查看之前执行过命令的历史记录" class="headerlink" title="3. history — 查看之前执行过命令的历史记录"></a>3. <code>history</code> — 查看之前执行过命令的历史记录</h5><h4 id="三、进程管理操作"><a href="#三、进程管理操作" class="headerlink" title="三、进程管理操作"></a>三、进程管理操作</h4><h5 id="1-ps-—-查看当前终端运行的程序"><a href="#1-ps-—-查看当前终端运行的程序" class="headerlink" title="1. ps — 查看当前终端运行的程序"></a>1. <code>ps</code> — 查看当前终端运行的程序</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">yangtaodeMacBook-Pro:<span class="built_in">test</span> yangtao$ ps</span><br><span class="line">  PID TTY           TIME CMD</span><br><span class="line">19083 ttys000    0:00.40 -bash</span><br></pre></td></tr></table></figure><h5 id="2-ps-ax-—列出这台电脑正在运行的所有程序"><a href="#2-ps-ax-—列出这台电脑正在运行的所有程序" class="headerlink" title="2. ps ax —列出这台电脑正在运行的所有程序"></a>2. <code>ps ax</code> —列出这台电脑正在运行的所有程序</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">20008   ??  S      0:00.12 /System/Library/Frameworks/QuickLook.framework/Resources/quicklookd.app/Contents/MacOS/quicklookd</span><br><span class="line">19082 s000  Ss     0:00.02 login -pf yangtao</span><br><span class="line">19083 s000  S      0:00.40 -bash</span><br><span class="line">20079 s000  R+     0:00.00 ps ax</span><br><span class="line">yangtaodeMacBook-Pro:<span class="built_in">test</span> yangtao$</span><br></pre></td></tr></table></figure><h5 id="3-top-—-显示这台计算机上有哪些进程，显示内存、CPU、负载等"><a href="#3-top-—-显示这台计算机上有哪些进程，显示内存、CPU、负载等" class="headerlink" title="3. top — 显示这台计算机上有哪些进程，显示内存、CPU、负载等"></a>3. <code>top</code> — 显示这台计算机上有哪些进程，显示内存、CPU、负载等</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">PID    COMMAND      %CPU TIME     <span class="comment">#TH   #WQ  #PORT MEM    PURG   CMPRS  PGRP  PPID  STATE    BOOSTS           %CPU_ME %CPU_OTHRS UID  FAULTS    COW</span></span><br><span class="line">20088  top          4.1  00:00.99 1/1   0    23    6724K  0B     0B     20088 19083 running  *0[1]            0.00000 0.00000    0    7185+     105</span><br><span class="line">20087  AGSService   0.0  00:00.03 2     1    36    1716K  0B     0B     20087 1     sleeping *0[1]            0.00000 0.00000    0    3076</span><br></pre></td></tr></table></figure><h5 id="4-kill-PID-—-结束指定进程-ID-的进程"><a href="#4-kill-PID-—-结束指定进程-ID-的进程" class="headerlink" title="4. kill [PID] — 结束指定进程 ID 的进程"></a>4. <code>kill [PID]</code> — 结束指定进程 ID 的进程</h5><p><strong>具体做法：</strong> 先使用 top 命令查看想要结束进程的 PID，然后使用命令<code>kill [PID]</code></p><p><strong>Tips：</strong> 如果遇到无法杀掉的进程，输入命令<code>sudo kill -9 [PID]</code> (伪装超级管理员，强迫杀掉该进程)，接着输入自己用户的密码（前提是自己这个用户具有 sudo 的资格）</p><h4 id="四、万能的-grep-操作"><a href="#四、万能的-grep-操作" class="headerlink" title="四、万能的 grep 操作"></a>四、万能的 grep 操作</h4><h5 id="1-grep-800-log-txt-—-从-log-txt-中找出-800-位置的数据"><a href="#1-grep-800-log-txt-—-从-log-txt-中找出-800-位置的数据" class="headerlink" title="1. grep 800 log.txt — 从 log.txt 中找出 800 位置的数据"></a>1. <code>grep 800 log.txt</code> — 从 log.txt 中找出 800 位置的数据</h5><h5 id="2-grep-n-800-log-txt-—-从-log-txt-中找出-800-位置的数据-并在前面加上行号"><a href="#2-grep-n-800-log-txt-—-从-log-txt-中找出-800-位置的数据-并在前面加上行号" class="headerlink" title="2. grep -n 800 log.txt — 从 log.txt 中找出 800 位置的数据,并在前面加上行号"></a>2. <code>grep -n 800 log.txt</code> — 从 log.txt 中找出 800 位置的数据,并在前面加上行号</h5><h5 id="3-grep-n-Hello-是否加上行号-—-从当前目录下的所有文件中找出出现过-Hello-的文件"><a href="#3-grep-n-Hello-是否加上行号-—-从当前目录下的所有文件中找出出现过-Hello-的文件" class="headerlink" title="3. grep (-n) Hello * (是否加上行号) — 从当前目录下的所有文件中找出出现过 Hello 的文件"></a>3. <code>grep (-n) Hello * (是否加上行号)</code> — 从当前目录下的所有文件中找出出现过 Hello 的文件</h5><h5 id="4-ls-usr-bin-grep-ls-—-查看-usr-bin-目录下面带-ls-的目录"><a href="#4-ls-usr-bin-grep-ls-—-查看-usr-bin-目录下面带-ls-的目录" class="headerlink" title="4. ls /usr/bin | grep ls — 查看/usr/bin 目录下面带 ls 的目录"></a>4. <code>ls /usr/bin | grep ls</code> — 查看/usr/bin 目录下面带 ls 的目录</h5><h5 id="5-ls-usr-bin-grep-ls-wc-—-计算出单词的数量"><a href="#5-ls-usr-bin-grep-ls-wc-—-计算出单词的数量" class="headerlink" title="5. ls /usr/bin | grep ls | wc — 计算出单词的数量"></a>5. <code>ls /usr/bin | grep ls | wc</code> — 计算出单词的数量</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">yangtaodeMacBook-Pro:<span class="built_in">test</span> yangtao$ ls /usr/bin | grep ls | wc</span><br><span class="line">      16      16     124</span><br><span class="line"><span class="comment"># 16行 16个单词 124个字符</span></span><br></pre></td></tr></table></figure><h4 id="五、环境变量操作"><a href="#五、环境变量操作" class="headerlink" title="五、环境变量操作"></a>五、环境变量操作</h4><h5 id="1-set-grep-PATH-—-查看环境变量"><a href="#1-set-grep-PATH-—-查看环境变量" class="headerlink" title="1. set | grep PATH — 查看环境变量"></a>1. <code>set | grep PATH</code> — 查看环境变量</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">yangtaodeMacBook-Pro:~ yangtao$ <span class="built_in">set</span> | grep PATH</span><br><span class="line">PATH=/usr/<span class="built_in">local</span>/bin:/usr/bin:/bin:/usr/sbin:/sbin</span><br></pre></td></tr></table></figure><h5 id="2-set-grep-PATH-—-将其他文件夹路径（本机用户下面的-bin-目录）添加到-PATH"><a href="#2-set-grep-PATH-—-将其他文件夹路径（本机用户下面的-bin-目录）添加到-PATH" class="headerlink" title="2. set | grep PATH — 将其他文件夹路径（本机用户下面的 bin 目录）添加到 PATH"></a>2. <code>set | grep PATH</code> — 将其他文件夹路径（本机用户下面的 bin 目录）添加到 PATH</h5><p>这样做只是一次性的，也就是说在当前终端，是可以直接生效的，但是当你关闭后，重新打开终端，这个操作是不被保存的。</p><p>在<code>/etc/profile</code>这个文件是任何人打开终端都会执行的，是系统级的 profile。</p><p>如果我们想自定义自己的 profile，可以在自己的家目录下新建文件命名为：<code>.profile</code>，这个文件会在你打开终端时自动执行。</p><p>我们将刚刚的命令 2 输入其中，然后保存退出（vim 下使用<code>:wq</code>）<br>这样的话，在我们刚刚已经登录的终端里面它还是不起作用的，假如你希望它可以立刻生效，你可以使用<code>source</code>命令。</p><h5 id="3-source-—-例如：source-profile"><a href="#3-source-—-例如：source-profile" class="headerlink" title="3. source — 例如：source .profile"></a>3. <code>source</code> — 例如：<code>source .profile</code></h5><p>使 Shell 读入指定的 Shell 程序文件并依次执行文件中的所有语句，通常用于重新执行刚修改的初始化文件，使之立即生效，而不必注销并重新登录</p><h4 id="六、网络配置操作"><a href="#六、网络配置操作" class="headerlink" title="六、网络配置操作"></a>六、网络配置操作</h4><h5 id="1-ifconfig-—-列出本机所有的网络设备以及其上面的配置，主要指的是-ip-地址和-mac-地址"><a href="#1-ifconfig-—-列出本机所有的网络设备以及其上面的配置，主要指的是-ip-地址和-mac-地址" class="headerlink" title="1. ifconfig — 列出本机所有的网络设备以及其上面的配置，主要指的是 ip 地址和 mac 地址"></a>1. <code>ifconfig</code> — 列出本机所有的网络设备以及其上面的配置，主要指的是 ip 地址和 mac 地址</h5><p>我的连的是 en5，它的状态时 active（最后一行），原文是 en4</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">en5: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500</span><br><span class="line">ether ac:de:48:00:11:22</span><br><span class="line">inet6 fe80::aede:48ff:fe00:1122%en5 prefixlen 64 scopeid 0x7</span><br><span class="line">nd6 options=201&lt;PERFORMNUD,DAD&gt;</span><br><span class="line">media: autoselect</span><br><span class="line">status: active</span><br></pre></td></tr></table></figure><p><em>其他用法：</em></p><ul><li><p><code>ifconfig en4 down/up</code> — 关闭（或打开）某个网络接口，比如 en4,一般需要管理员权限，所以需要在前面加 sudo 命令</p></li><li><p><code>sudo ifconfig en4 add 10.10.10.12 netmask 255.255.255.0</code> — 给 en4 加入别的网段</p></li><li><code>sudo ifconfig en4 delete 10.10.10.12</code> — 给 en4 删除指定网段</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 临时修改MAC地址</span></span><br><span class="line">ifconfig en0 down // 关闭网卡设备（这里假设是en0）</span><br><span class="line">ifconfig en0 hw ether [MAC地址] // 修改MAC地址</span><br><span class="line">ifconfig en0 up // 重启网卡</span><br><span class="line"></span><br><span class="line"><span class="comment"># 临时修改内网ip地址</span></span><br><span class="line">ifconfig en0 down</span><br><span class="line">ifconfig en0 192.168.169.245 netmask 255.255.255.0</span><br></pre></td></tr></table></figure><h5 id="2-ping-—-检测网络是否是连通状态"><a href="#2-ping-—-检测网络是否是连通状态" class="headerlink" title="2. ping — 检测网络是否是连通状态"></a>2. <code>ping</code> — 检测网络是否是连通状态</h5><h5 id="3-netstat-—-显示各种网络相关信息"><a href="#3-netstat-—-显示各种网络相关信息" class="headerlink" title="3. netstat — 显示各种网络相关信息"></a>3. <code>netstat</code> — 显示各种网络相关信息</h5><p><em>其他用法：</em></p><ul><li><p><code>netstat -l</code> — 列出本机进行监听的端口</p></li><li><p><code>netstat -lt</code> — 只列出 tcp 的连接，同理在 l 后面跟上 u 的话，将会列出各种 udp 的监听端口</p></li><li><p><code>netstat -s</code> — 查看统计数据</p></li><li><p><code>netstat -p</code> — 列出进程信息，你可以了解是哪一个程序在哪一个端口上做些什么事情</p></li><li><p><code>netstat -pc</code> — 会显示出实时更新的进程信息</p></li><li><p><code>netstat -r</code> — 查看路由表</p></li><li><code>netstat -i</code> — 查看接口信息</li></ul><blockquote><p>详情参考<br><a href="https://www.jianshu.com/p/0e43268f01db" target="_blank" rel="noopener">Mac 终端学习系列</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MacOS </tag>
            
            <tag> 终端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git之本地拉取Github代码、修改远程URL</title>
      <link href="/2018/08/09/git-revert/"/>
      <url>/2018/08/09/git-revert/</url>
      
        <content type="html"><![CDATA[<p><img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1533488265900&amp;di=91f78407d4ffda11e55202ceafda93c4&amp;imgtype=jpg&amp;src=http%3A%2F%2Fimg3.imgtn.bdimg.com%2Fit%2Fu%3D2417199588%2C1851489715%26fm%3D214%26gp%3D0.jpg" alt=""></p><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Workspace：工作区</span><br><span class="line">Index / Stage：暂存区</span><br><span class="line">Repository：仓库区（或本地仓库）</span><br><span class="line">Remote：远程仓库</span><br></pre></td></tr></table></figure><h4 id="详细介绍如何使用git"><a href="#详细介绍如何使用git" class="headerlink" title="详细介绍如何使用git"></a>详细介绍如何使用git</h4><ul><li>博客推荐：<ul><li><a href="https://juejin.im/entry/5b66e89951882563522b78ae/" target="_blank" rel="noopener">如何使用Git上传项目代码到github</a> </li><li><a href="https://juejin.im/entry/5b66ec5c51882536e875be76/" target="_blank" rel="noopener">Git远程操作详解—阮一峰</a></li><li><a href="https://juejin.im/entry/5667d39d00b0ee7fa8c9f99f" target="_blank" rel="noopener">常用 Git 命令清单—阮一峰</a></li></ul></li></ul><h4 id="本地拉取仓库代码-—-clone"><a href="#本地拉取仓库代码-—-clone" class="headerlink" title="本地拉取仓库代码 — clone"></a>本地拉取仓库代码 — clone</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/yangtao2o/yangtao2o.github.io.git</span><br></pre></td></tr></table></figure><h4 id="修改远程URL-—-remote"><a href="#修改远程URL-—-remote" class="headerlink" title="修改远程URL — remote"></a>修改远程URL — remote</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git remote -v    <span class="comment"># 查看远程服务器地址和仓库名称</span></span><br><span class="line">git remote show origin   <span class="comment"># 查看远程服务器仓库状态</span></span><br><span class="line">git remote add origin https://github.com/yangtao2o/yangtao2o.github.io.git  <span class="comment"># 添加远程仓库地址</span></span><br><span class="line">git remote <span class="built_in">set</span>-url origin https://github.com/..io.git   <span class="comment"># 设置远程仓库地址(用于修改远程仓库地址)</span></span><br><span class="line">git remote rename &lt;old name&gt; &lt;new name&gt;  <span class="comment"># 修改远程主机的名称</span></span><br><span class="line">git remote rm &lt;repository&gt;   <span class="comment"># 删除远程仓库</span></span><br></pre></td></tr></table></figure><h4 id="代码回滚"><a href="#代码回滚" class="headerlink" title="代码回滚"></a>代码回滚</h4><ul><li><p>如果是在workspace，未git push，使用以下命令会清空工作目录中所有未提交的内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard HEAD  <span class="comment"># 全部撤销</span></span><br><span class="line">git checkout -- hello.html  <span class="comment"># 只恢复hello.html文件</span></span><br></pre></td></tr></table></figure></li><li><p>如果已提交，使用<code>git revert</code>，使用一次新的commit，来回滚要你要回滚的位置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git revert HEAD</span><br></pre></td></tr></table></figure></li><li><p>参考：<a href="https://juejin.im/entry/5b6707f25188251ac22b6f0f/" target="_blank" rel="noopener">Git的撤消操作 - 重置, 签出 和 撤消</a></p><h4 id="使用过程中，遇到的一些问题"><a href="#使用过程中，遇到的一些问题" class="headerlink" title="使用过程中，遇到的一些问题"></a>使用过程中，遇到的一些问题</h4></li><li><p><code>git pull</code>时<code>fatal:refusing to merge unrelated histories</code></p><ul><li><code>git pull --allow-unrelated-histories</code></li></ul></li><li><p><code>origin</code>一般是我们自己创建的代码库，所以可以做任何的<code>git pull or git push</code>，但是如果我们引入了他人的代码库，就成了<code>upstream</code>，只能<code>git fetch</code>，通过<code>fork</code>到自己的仓库里，如同<code>origin</code></p><ul><li>关于<code>fork、origin、upstream、clone</code>之间的关系博文推荐： <a href="https://juejin.im/entry/5b66f8d5f265da0f574e0884/" target="_blank" rel="noopener">GitHub关于fork、origin、upstream、clone的藕断丝连</a></li></ul></li><li><p><a href="https://juejin.im/entry/5b66ea75e51d45195312a173/" target="_blank" rel="noopener">git submodule使用以及注意事项</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 开发工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>macOS安装homebrew报错 LibreSSL SSL_read SSL_ERROR_SYSCALL errno 54</title>
      <link href="/2018/08/05/macos-brew/"/>
      <url>/2018/08/05/macos-brew/</url>
      
        <content type="html"><![CDATA[<blockquote><p>LibreSSL SSL_read: SSL_ERROR_SYSCALL, errno 54</p></blockquote><a id="more"></a><h4 id="安装"><a href="#安装" class="headerlink" title="# 安装"></a># 安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">curl <span class="string">"https://nodejs.org/dist/latest/node-<span class="variable">$&#123;VERSION:-$(wget -qO- https://nodejs.org/dist/latest/ | sed -nE 's|.*&gt;node-(.*)\.pkg&lt;/a&gt;.*|\1|p')&#125;</span>.pkg"</span> &gt; <span class="string">"<span class="variable">$HOME</span>/Downloads/node-latest.pkg"</span> &amp;&amp; sudo installer -store -pkg <span class="string">"<span class="variable">$HOME</span>/Downloads/node-latest.pkg"</span> -target <span class="string">"/"</span></span><br></pre></td></tr></table></figure><h4 id="报错"><a href="#报错" class="headerlink" title="# 报错"></a># 报错</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">==&gt; Tapping homebrew/core</span><br><span class="line">Cloning into <span class="string">'/usr/local/Homebrew/Library/Taps/homebrew/homebrew-core'</span>...</span><br><span class="line">fatal: unable to access <span class="string">'https://github.com/Homebrew/homebrew-core/'</span>: LibreSSL SSL_read: SSL_ERROR_SYSCALL, errno 54</span><br><span class="line">Error: Failure <span class="keyword">while</span> executing; `git <span class="built_in">clone</span> https://github.com/Homebrew/homebrew-core /usr/<span class="built_in">local</span>/Homebrew/Library/Taps/homebrew/homebrew-core --depth=1` exited with 128.</span><br><span class="line">Error: Failure <span class="keyword">while</span> executing; `/usr/<span class="built_in">local</span>/bin/brew tap homebrew/core` exited with 1.</span><br></pre></td></tr></table></figure><h4 id="解决："><a href="#解决：" class="headerlink" title="# 解决："></a># 解决：</h4><ul><li>执行下面这句命令，更换为中科院的镜像：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> git://mirrors.ustc.edu.cn/homebrew-core.git/ /usr/<span class="built_in">local</span>/Homebrew/Library/Taps/homebrew/homebrew-core --depth=1</span><br></pre></td></tr></table></figure><ul><li>把homebrew-core的镜像地址也设为中科院的国内镜像</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>"</span> </span><br><span class="line"></span><br><span class="line">git remote <span class="built_in">set</span>-url origin https://mirrors.ustc.edu.cn/brew.git</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>/Library/Taps/homebrew/homebrew-core"</span> </span><br><span class="line"></span><br><span class="line">git remote <span class="built_in">set</span>-url origin https://mirrors.ustc.edu.cn/homebrew-core.git</span><br></pre></td></tr></table></figure><ul><li>更新</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew update</span><br></pre></td></tr></table></figure><ul><li>使用</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install node</span><br></pre></td></tr></table></figure><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul><li>报错解决：<a href="https://blog.csdn.net/qq_35624642/article/details/79682979" target="_blank" rel="noopener">macOS High Sierra10.13.3安装homebrew报错LibreSSL SSL_read: SSL_ERROR_SYSCALL, errno 54解决方法</a></li><li><a href="https://blog.csdn.net/qq_41234116/article/details/79366454" target="_blank" rel="noopener">Mac安装，简单实用，卸载homebrew详细教程</a> </li></ul>]]></content>
      
      
      <categories>
          
          <category> 系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MacOS </tag>
            
            <tag> Homebrew </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>macOS下node版本管理下载新版本时中断返回Segmentation fault 11</title>
      <link href="/2018/08/05/macos-node/"/>
      <url>/2018/08/05/macos-node/</url>
      
        <content type="html"><![CDATA[<blockquote><p>前记：安装 node 的时候安装了最新版本，但是我需要指定某一个版本，所以安装了 n 模块，来进行版本切换，但是途中发生了报错：Segmentation fault：11，导致 npm 命令无法使用，由于使用的 macOS，大家都推荐 HomeBrew，于是连滚带爬地从一个坑跳到另一个坑，好疼啊…</p></blockquote><a id="more"></a><h4 id="n-模块"><a href="#n-模块" class="headerlink" title="n 模块"></a>n 模块</h4><ul><li>首先 <strong>n 模块不支持 Windows！！！</strong></li><li>安装：<code>sudo npm install -g n</code></li><li>参考：<a href="https://blog.csdn.net/kiddd_fu/article/details/78655672" target="_blank" rel="noopener">node 版本更新的简便方法——神奇的 n 模块</a></li><li>版本切换：<code>n</code>，然后上下切换，圆点在哪儿就是哪个，但是问题两个或者多个都是灰色，即没有圆点，怎么办？<ul><li>这时，切回去使用<code>node -v</code>就会报错：<code>Segmentation fault: 11</code> ，当然，npm 直接<code>npm: command not found</code></li></ul></li><li>解决：<code>sudo n 8.1.3</code></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/8/4/165046762420dadb?w=1268&amp;h=478&amp;f=jpeg&amp;s=170090" alt=""></p><ul><li>参考：<a href="https://blog.csdn.net/Dcatfly/article/details/75201172" target="_blank" rel="noopener">n 模块管理 node 版本遇到的问题</a></li><li>但是切换到 8.11.3，问题依旧存在，所以删除：<code>sudo n rm 8.11.3</code></li><li>卸载 npm：<code>sudo npm uninstall npm -g</code>，然后去 node 官网重新下载<code>8.11.3LTS</code>，安装成功，但是使用<code>n list</code>，并未查看到此版本</li><li>于是，重新再走一遍：<code>sudo n 8.11.3</code>，成功。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MacOS </tag>
            
            <tag> Nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript算法初级练习</title>
      <link href="/2018/08/01/js-algo-1/"/>
      <url>/2018/08/01/js-algo-1/</url>
      
        <content type="html"><![CDATA[<h3 id="需要定义一个最小值和一个最大值之间的随机数"><a href="#需要定义一个最小值和一个最大值之间的随机数" class="headerlink" title="# 需要定义一个最小值和一个最大值之间的随机数"></a># 需要定义一个最小值和一个最大值之间的随机数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ourFunction</span>(<span class="params">ourMin, ourMax</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (ourMax - ourMin + <span class="number">1</span>)) + ourMin;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ourFunction(<span class="number">1</span>, <span class="number">9</span>);</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="计算一个整数的阶乘"><a href="#计算一个整数的阶乘" class="headerlink" title="# 计算一个整数的阶乘"></a># 计算一个整数的阶乘</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorialize</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 请把你的代码写在这里</span></span><br><span class="line">  <span class="keyword">if</span>(num &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> num *= factorialize(num - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">factorialize(<span class="number">5</span>);</span><br></pre></td></tr></table></figure><h3 id="来一段回文"><a href="#来一段回文" class="headerlink" title="# 来一段回文"></a># 来一段回文</h3><ul><li><a href="http://www.w3cplus.com/javascript/palindrome-check-in-javascript.html" target="_blank" rel="noopener">JavaScript算法练习： JavaScript中回文(Palindromes)处理</a></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方法一</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">palindrome</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 请把你的代码写在这里</span></span><br><span class="line">  <span class="keyword">var</span> re = <span class="regexp">/[\W_]/g</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> lowRegStr = str.toLowerCase().replace(re, <span class="string">''</span>);</span><br><span class="line">  <span class="keyword">var</span> reveRegStr = lowRegStr.split(<span class="string">''</span>).reverse().join(<span class="string">''</span>);</span><br><span class="line">  <span class="keyword">return</span> lowRegStr == reveRegStr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">palindrome(<span class="string">"eye"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//方法二</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">palindrome</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 请把你的代码写在这里</span></span><br><span class="line">  <span class="keyword">var</span> re = <span class="regexp">/[\W_]/g</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> lowRegStr = str.toLowerCase().replace(re, <span class="string">''</span>);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>, l=lowRegStr.length; i&lt;l/<span class="number">2</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span>(lowRegStr[i] != lowRegStr[l - <span class="number">1</span> -i]) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">palindrome(<span class="string">"eye"</span>);</span><br></pre></td></tr></table></figure><h3 id="在句子中找出最长的单词，并返回它的长度。"><a href="#在句子中找出最长的单词，并返回它的长度。" class="headerlink" title="# 在句子中找出最长的单词，并返回它的长度。"></a># 在句子中找出最长的单词，并返回它的长度。</h3><ul><li><a href="http://www.cnblogs.com/chenjinxinlove/p/5579043.html" target="_blank" rel="noopener">js 数组排序和算法排序</a></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">findLongestWord</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> strArr = str = str.split(<span class="string">' '</span>);</span><br><span class="line">  <span class="keyword">var</span> newArr = [];</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;strArr.length; i++) &#123;</span><br><span class="line">    newArr.push(strArr[i].length);</span><br><span class="line">  &#125;</span><br><span class="line">  newArr.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> b - a;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> newArr[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">findLongestWord(<span class="string">"What if we try a super-long word such as otorhinolaryngology"</span>);</span><br></pre></td></tr></table></figure><h3 id="确保字符串的每个单词首字母都大写，其余部分小写。"><a href="#确保字符串的每个单词首字母都大写，其余部分小写。" class="headerlink" title="# 确保字符串的每个单词首字母都大写，其余部分小写。"></a># 确保字符串的每个单词首字母都大写，其余部分小写。</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">titleCase</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> strArr = str.split(<span class="string">' '</span>);</span><br><span class="line">  <span class="keyword">var</span> newStrArr = [];</span><br><span class="line">  <span class="keyword">var</span> newStr = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;strArr.length; i++) &#123;</span><br><span class="line">    newStr = strArr[i][<span class="number">0</span>].toUpperCase();</span><br><span class="line">    newStr += strArr[i].substr(<span class="number">1</span>).toLowerCase();</span><br><span class="line">    newStrArr.push(newStr);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  newStrArr = newStrArr.join(<span class="string">' '</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> newStrArr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">titleCase(<span class="string">"I'm a little tea pot"</span>);</span><br></pre></td></tr></table></figure><h3 id="找出多个数组中的最大数"><a href="#找出多个数组中的最大数" class="headerlink" title="# 找出多个数组中的最大数"></a># 找出多个数组中的最大数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">largestOfFour</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> newArr = [];</span><br><span class="line">  <span class="keyword">var</span> num = [];</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;arr.length; i++) &#123;</span><br><span class="line">    num = arr[i].sort(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> b - a;</span><br><span class="line">    &#125;);</span><br><span class="line">    newArr.push(num[<span class="number">0</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newArr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">largestOfFour([[<span class="number">4</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">3</span>], [<span class="number">13</span>, <span class="number">27</span>, <span class="number">18</span>, <span class="number">26</span>], [<span class="number">32</span>, <span class="number">35</span>, <span class="number">37</span>, <span class="number">39</span>], [<span class="number">1000</span>, <span class="number">1001</span>, <span class="number">857</span>, <span class="number">1</span>]]);</span><br></pre></td></tr></table></figure><h3 id="判断一个字符串-str-是否以指定的字符串-target-结尾。"><a href="#判断一个字符串-str-是否以指定的字符串-target-结尾。" class="headerlink" title="# 判断一个字符串(str)是否以指定的字符串(target)结尾。"></a># 判断一个字符串(str)是否以指定的字符串(target)结尾。</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">confirmEnding</span>(<span class="params">str, target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> len = target.length;</span><br><span class="line">  <span class="keyword">if</span>(str.substr(-len) == target) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">confirmEnding(<span class="string">"He has to give me a new name"</span>, <span class="string">"name"</span>);</span><br><span class="line">confirmEnding(<span class="string">"Bastian"</span>, <span class="string">"n"</span>);</span><br></pre></td></tr></table></figure><h3 id="重复一个指定的字符串-num次，如果num是一个负数则返回一个空字符串。"><a href="#重复一个指定的字符串-num次，如果num是一个负数则返回一个空字符串。" class="headerlink" title="# 重复一个指定的字符串 num次，如果num是一个负数则返回一个空字符串。"></a># 重复一个指定的字符串 num次，如果num是一个负数则返回一个空字符串。</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">repeat</span>(<span class="params">str, num</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 请把你的代码写在这里</span></span><br><span class="line">  <span class="keyword">var</span> newArr = [];</span><br><span class="line">  <span class="keyword">var</span> newStr = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">if</span>(num &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    newStr = <span class="string">''</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;num; i++) &#123;</span><br><span class="line">      newArr.push(str);</span><br><span class="line">    &#125;</span><br><span class="line">    newStr = newArr.join(<span class="string">''</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newStr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">repeat(<span class="string">"abc"</span>, <span class="number">4</span>);</span><br></pre></td></tr></table></figure><h3 id="如果字符串的长度比指定的参数num长…"><a href="#如果字符串的长度比指定的参数num长…" class="headerlink" title="# 如果字符串的长度比指定的参数num长…"></a># 如果字符串的长度比指定的参数num长…</h3><ul><li>如果字符串的长度比指定的参数num长，则把多余的部分用…来表示。切记，插入到字符串尾部的三个点号也会计入字符串的长度。但是，如果指定的参数num小于或等于3，则添加的三个点号不会计入字符串的长度。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">truncate</span>(<span class="params">str, num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> newStr=<span class="string">''</span>;</span><br><span class="line">  <span class="keyword">if</span>(num &gt;= str.length) &#123;</span><br><span class="line">    newStr = str.slice(<span class="number">0</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(num &gt; <span class="number">3</span>) &#123;</span><br><span class="line">    newStr = str.slice(<span class="number">0</span>, num<span class="number">-3</span>) + <span class="string">'...'</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    newStr = str.slice(<span class="number">0</span>, num) + <span class="string">'...'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newStr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">truncate(<span class="string">"A-tisket a-tasket A green and yellow basket"</span>, <span class="number">11</span>);</span><br></pre></td></tr></table></figure><h3 id="把一个数组arr按照指定的数组大小size分割成若干个数组块。"><a href="#把一个数组arr按照指定的数组大小size分割成若干个数组块。" class="headerlink" title="# 把一个数组arr按照指定的数组大小size分割成若干个数组块。"></a># 把一个数组arr按照指定的数组大小size分割成若干个数组块。</h3><ul><li><a href="https://segmentfault.com/q/1010000004921251" target="_blank" rel="noopener">js将一位数组分割成每三个一组</a></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">chunk</span>(<span class="params">arr, size</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> newArr = [];</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;arr.length; i+=size) &#123;</span><br><span class="line">    newArr.push(arr.slice(i, i+size));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newArr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chunk([<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>], <span class="number">2</span>);</span><br></pre></td></tr></table></figure><h3 id="返回一个数组被截断n个元素后还剩余的元素，截断从索引0开始。"><a href="#返回一个数组被截断n个元素后还剩余的元素，截断从索引0开始。" class="headerlink" title="# 返回一个数组被截断n个元素后还剩余的元素，截断从索引0开始。"></a># 返回一个数组被截断n个元素后还剩余的元素，截断从索引0开始。</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">slasher</span>(<span class="params">arr, howMany</span>) </span>&#123;</span><br><span class="line">  arr.splice(<span class="number">0</span>, howMany);</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">slasher([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="number">2</span>);</span><br></pre></td></tr></table></figure><h3 id="如果数组第一个字符串元素包含了第二个字符串元素的所有字符，函数返回true。"><a href="#如果数组第一个字符串元素包含了第二个字符串元素的所有字符，函数返回true。" class="headerlink" title="# 如果数组第一个字符串元素包含了第二个字符串元素的所有字符，函数返回true。"></a># 如果数组第一个字符串元素包含了第二个字符串元素的所有字符，函数返回true。</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mutation</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> str1 = arr[<span class="number">0</span>].toLowerCase();  </span><br><span class="line">  <span class="keyword">var</span> str2 = arr[<span class="number">1</span>].toLowerCase();</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;str2.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span>(str1.indexOf(str2[i]) == <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mutation([<span class="string">"hello"</span>, <span class="string">"hey"</span>]);</span><br></pre></td></tr></table></figure><h3 id="删除数组中的所有假值。"><a href="#删除数组中的所有假值。" class="headerlink" title="# 删除数组中的所有假值。"></a># 删除数组中的所有假值。</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bouncer</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> newArr = [];</span><br><span class="line">  newArr = arr.filter(<span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(val !== (<span class="literal">undefined</span> &amp;&amp; <span class="literal">null</span> &amp;&amp; <span class="string">""</span> &amp;&amp; <span class="literal">NaN</span> &amp;&amp; <span class="literal">false</span> &amp;&amp; <span class="number">0</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> val;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> newArr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bouncer([<span class="number">7</span>, <span class="string">"ate"</span>, <span class="string">""</span>, <span class="literal">false</span>, <span class="number">9</span>]);</span><br></pre></td></tr></table></figure><h3 id="数组排序并找出元素索引，先给数组排序，然后找到指定的值在数组的位置，最后返回位置对应的索引。"><a href="#数组排序并找出元素索引，先给数组排序，然后找到指定的值在数组的位置，最后返回位置对应的索引。" class="headerlink" title="# 数组排序并找出元素索引，先给数组排序，然后找到指定的值在数组的位置，最后返回位置对应的索引。"></a># 数组排序并找出元素索引，先给数组排序，然后找到指定的值在数组的位置，最后返回位置对应的索引。</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">where</span>(<span class="params">arr, num</span>) </span>&#123;</span><br><span class="line">  arr.push(num);</span><br><span class="line">  arr.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a-b;</span><br><span class="line">  &#125;);  </span><br><span class="line">  <span class="keyword">return</span> arr.indexOf(num);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">where([<span class="number">40</span>, <span class="number">60</span>], <span class="number">50</span>);</span><br></pre></td></tr></table></figure><h3 id="实现一个摧毁-destroyer-函数，第一个参数是待摧毁的数组，其余的参数是待摧毁的值。"><a href="#实现一个摧毁-destroyer-函数，第一个参数是待摧毁的数组，其余的参数是待摧毁的值。" class="headerlink" title="# 实现一个摧毁(destroyer)函数，第一个参数是待摧毁的数组，其余的参数是待摧毁的值。"></a># 实现一个摧毁(destroyer)函数，第一个参数是待摧毁的数组，其余的参数是待摧毁的值。</h3><ul><li><a href="http://blog.csdn.net/wangmc0827/article/details/72529116" target="_blank" rel="noopener">FCC–Seek and Destroy（摧毁数组）</a></li><li><a href="http://www.cnblogs.com/codepen2010/p/6824934.html" target="_blank" rel="noopener">Seek and Destroy(算法)</a></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">destroyer</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> newArr = [];</span><br><span class="line">  <span class="keyword">var</span> arg = <span class="built_in">arguments</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">1</span>; i&lt;arg.length; i++) &#123;</span><br><span class="line">    newArr.push(arg[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  arr = arr.filter(<span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> newArr.indexOf(val) &lt; <span class="number">0</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">destroyer([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure><blockquote><p>发表于<a href="http://www.imooc.com/article/20814" target="_blank" rel="noopener">慕课网手记</a></p></blockquote><blockquote><p>题目来自： <strong>FreeCodeCamp</strong> <a href="https://freecodecamp.cn/map-aside#nested-collapseBasicAlgorithmScripting" target="_blank" rel="noopener">BasicAlgorithmScripting</a><br>参考资料： <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects" target="_blank" rel="noopener">JavaScript标准库</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> JavaScript算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Github报错fatal unable to access No such file or directory</title>
      <link href="/2018/07/30/github-01/"/>
      <url>/2018/07/30/github-01/</url>
      
        <content type="html"><![CDATA[<p>之前有安装过github旧版，一直正常，后来更新了新版，但是<code>git pull</code>的时候如有如下报错：<br><a id="more"></a></p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fatal: unable to access 'https://github.com/eefocus/deploy.git/': schannel: failed to open CA file 'C:/Users/Administrator/AppData/Local/GitHubDesktop/app-1.2.3/resources/app/git/mingw64/bin/curl-ca-bundle.crt': No such file or directory</span><br></pre></td></tr></table></figure><ul><li>找到<code>C:\ProgramData\Git\config</code>，打开，修改<code>sslCAinfo</code>（路径得看自己文件相对应的位置）如下：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[core]</span><br><span class="line">symlinks = true</span><br><span class="line">autocrlf = true</span><br><span class="line">fscache = true</span><br><span class="line">[color]</span><br><span class="line">diff = auto</span><br><span class="line">status = auto</span><br><span class="line">branch = auto</span><br><span class="line">interactive = true</span><br><span class="line">[pack]</span><br><span class="line">[help]</span><br><span class="line">format = html</span><br><span class="line">[https]</span><br><span class="line">sslCAinfo = C:/Users/Administrator/AppData/Local/GitHubDesktop/app-1.2.6/resources/app/git/mingw64/ssl/certs/curl-ca-bundle.crt</span><br><span class="line">[sendemail]</span><br><span class="line">smtpserver = /bin/msmtp.exe</span><br><span class="line"></span><br><span class="line">[diff &quot;astextplain&quot;]</span><br><span class="line">textconv = astextplain</span><br><span class="line">[rebase]</span><br><span class="line">autosquash = true</span><br></pre></td></tr></table></figure><ul><li><strong>重点提示</strong>：默认的是<code>[http]</code>，如果有必要你需要改成<code>[https]</code></li><li>如果找不到<code>C:\ProgramData</code>文件（我的是win10），在查看下将隐藏的项目打个勾<br><img src="https://user-images.githubusercontent.com/19526072/43298424-81590c1a-9188-11e8-8968-666bdd839ced.png" alt="打开隐藏文件"></li></ul><blockquote><p>参考：<a href="http://www.mamicode.com/info-detail-2368065.html" target="_blank" rel="noopener">GitHub Desktop报错fatal: unable to access ‘https://github.com……: schannel: failed to open CA file ‘C:/Users……bundle.crt’: No such file or directory的解决办法</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 开发工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 开发工具 </tag>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端学习资料峡谷</title>
      <link href="/2018/07/06/dev-data/"/>
      <url>/2018/07/06/dev-data/</url>
      
        <content type="html"><![CDATA[<blockquote><p>整理 2017-2018 的前端学习资料</p></blockquote><a id="more"></a><h3 id="学习资料站"><a href="#学习资料站" class="headerlink" title="学习资料站"></a>学习资料站</h3><h4 id="网站"><a href="#网站" class="headerlink" title="网站"></a>网站</h4><ul><li><strong><a href="https://juejin.im/post/5a0c1956f265da430a501f51" target="_blank" rel="noopener">(2017)个人分享–web 前端学习资源分享</a></strong></li><li><strong><a href="https://developer.mozilla.org/zh-CN/docs/Learn" target="_blank" rel="noopener">学习 Web 开发</a></strong></li><li><strong><a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide" target="_blank" rel="noopener">Web 开发者指南</a></strong></li><li><strong><a href="https://developer.mozilla.org/zh-CN/docs/Web/Tutorials" target="_blank" rel="noopener">教程</a></strong></li><li><strong><a href="http://www.w3school.com.cn/" target="_blank" rel="noopener">W3school</a></strong></li><li><strong><a href="https://www.w3.org/" target="_blank" rel="noopener">W3C</a></strong></li><li><strong><a href="http://www.hewebgl.com/" target="_blank" rel="noopener">WebGL 中文网</a></strong></li></ul><h4 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h4><ul><li><strong><a href="http://es6.ruanyifeng.com/#docs/intro" target="_blank" rel="noopener">ECMAScript 6 入门</a></strong></li><li><strong><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript" target="_blank" rel="noopener">JavaScript</a></strong></li><li><strong><a href="http://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==&amp;mid=2651552568&amp;idx=1&amp;sn=2c85a858b0a28d1c256354312f535f13&amp;chksm=8025acf9b75225efea70a70b3d753bd53ec596f2d90371d960d5643e8c5946cea79f355c7513&amp;mpshare=1&amp;scene=23&amp;srcid=0906yyeOcwhCqvE1DrkomSbR#rd" target="_blank" rel="noopener">怎么学 JavaScript？</a></strong></li><li><strong><a href="http://www.jianshu.com/p/72e318848de8" target="_blank" rel="noopener">10 个最佳的 JavaScript 风格指南</a></strong></li></ul><h4 id="框架、库"><a href="#框架、库" class="headerlink" title="框架、库"></a>框架、库</h4><ul><li><strong><a href="http://www.bootcss.com/" target="_blank" rel="noopener">前端框架、资料汇集</a></strong></li><li><strong><a href="https://www.lodashjs.com/" target="_blank" rel="noopener">Lodash</a></strong>— 是一个一致性、模块化、高性能的 JavaScript 实用工具库。</li><li><strong><a href="http://www.bootcss.com/p/headroom.js/" target="_blank" rel="noopener">Headroom.js</a></strong>— 为页面顶部多留些空间。在不需要页头时将其隐藏。</li><li><strong><a href="http://www.bootcss.com/p/icheck/" target="_blank" rel="noopener">iCheck</a></strong>—增强复选框和单选按钮</li><li><strong><a href="http://www.hewebgl.com/article/articledir/1" target="_blank" rel="noopener">Three.js</a></strong>— 是 JavaScript 编写的 WebGL 第三方库。提供了非常多的 3D 显示功能。</li></ul><h4 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h4><ul><li><strong><a href="https://github.com/geeeeeeeeek/git-recipes" target="_blank" rel="noopener">高质量的 Git 中文教程</a></strong>—该 Wiki 的编者非常认真细致地总结和翻译了许多 Github 知识和技巧</li><li><strong><a href="http://www.yangzhiping.com/tech/github.html" target="_blank" rel="noopener">如何高效利用 GitHub</a></strong></li><li><strong><a href="http://www.bootcss.com/p/git-guide/" target="_blank" rel="noopener">Git - 简易指南</a></strong></li><li><strong><a href="https://zhuanlan.zhihu.com/p/24081900" target="_blank" rel="noopener">全面理解 Git</a></strong></li><li><strong><a href="https://gruntjs.com/" target="_blank" rel="noopener">Grunt</a></strong>—项目构建工具</li><li><strong><a href="http://www.gulpjs.com.cn/" target="_blank" rel="noopener">Gulp</a></strong>—用自动化构建工具增强你的工作流程！</li><li><strong><a href="https://webpack.bootcss.com/" target="_blank" rel="noopener">Webpack</a></strong>—前端资源模块化管理和打包工具</li><li><strong><a href="http://www.jianshu.com/p/42e11515c10f" target="_blank" rel="noopener">入门 Webpack，看这篇就够了</a></strong></li></ul><h4 id="博客"><a href="#博客" class="headerlink" title="博客"></a>博客</h4><ul><li><strong><a href="http://www.zhangxinxu.com/" target="_blank" rel="noopener">张鑫旭</a></strong></li><li><strong><a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener">廖雪峰的官方网站</a></strong></li><li><strong><a href="http://www.ruanyifeng.com/blog/javascript/" target="_blank" rel="noopener">阮一峰的网络日志之 JavaScript</a></strong></li></ul><h4 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h4><ul><li><strong><a href="http://blog.jobbole.com/105633/" target="_blank" rel="noopener">HTTPS 工作原理和 TCP 握手机制</a></strong></li></ul><h3 id="快速查找区"><a href="#快速查找区" class="headerlink" title="快速查找区"></a>快速查找区</h3><ul><li><strong><a href="https://github.com/yangtao2o/learninglog/wiki/JavaScript经典实例#regexp" target="_blank" rel="noopener">正则表达式特殊字符</a></strong></li></ul><h3 id="学习书籍"><a href="#学习书籍" class="headerlink" title="学习书籍"></a>学习书籍</h3><ul><li><strong><a href="https://github.com/yangtao2o/learninglog/wiki/JavaScript经典实例" target="_blank" rel="noopener">JavaScript 经典实例</a></strong><ul><li>慕课网手记<a href="http://www.imooc.com/article/20555" target="_blank" rel="noopener">归纳《JavaScript 经典实例》之 JS 不只是简单的构件块</a></li></ul></li><li><strong><a href="https://freecodecamp.cn/map-aside#nested-collapseBasicAlgorithmScripting" target="_blank" rel="noopener">FreeCodeCamp</a></strong><ul><li>慕课网发布手记 <a href="http://www.imooc.com/article/20814" target="_blank" rel="noopener">JavaScript 算法初级练习</a></li></ul></li></ul><h3 id="个人手记集锦"><a href="#个人手记集锦" class="headerlink" title="个人手记集锦"></a>个人手记集锦</h3><ul><li><strong><a href="http://www.imooc.com/u/3120512/articles" target="_blank" rel="noopener">慕课网手记</a></strong></li><li><strong><a href="https://www.qdfuns.com/u/32286.html" target="_blank" rel="noopener">前端网笔记</a></strong></li></ul>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端 </tag>
            
            <tag> 前端学习资料 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo常用命令集合</title>
      <link href="/2018/07/06/hexo-order/"/>
      <url>/2018/07/06/hexo-order/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th style="text-align:left">简写</th><th></th><th></th></tr></thead><tbody><tr><td style="text-align:left">hexo n “我的博客”</td><td>hexo new “我的博客”</td><td>#新建文章</td></tr><tr><td style="text-align:left">hexo p</td><td>hexo publish</td></tr><tr><td style="text-align:left">hexo g</td><td>hexo generate</td><td>#生成</td></tr><tr><td style="text-align:left">hexo s</td><td>hexo server</td><td>#启动服务预览</td></tr><tr><td style="text-align:left">hexo d</td><td>hexo deploy</td><td>#部署</td></tr></tbody></table><a id="more"></a><table><thead><tr><th style="text-align:left">服务器</th><th></th></tr></thead><tbody><tr><td style="text-align:left">hexo server #Hexo</td><td>会监视文件变动并自动更新，您无须重启服务器。</td></tr><tr><td style="text-align:left">hexo server -s</td><td>#静态模式</td></tr><tr><td style="text-align:left">hexo server -p 5000</td><td>#更改端口</td></tr><tr><td style="text-align:left">hexo server -i 192.168.1.1</td><td>#自定义 IP</td></tr><tr><td style="text-align:left">hexo clean</td><td>#清除缓存 网页正常情况下可以忽略此条命令</td></tr><tr><td style="text-align:left">hexo g</td><td>#生成静态网页</td></tr><tr><td style="text-align:left">hexo d</td><td>#开始部署</td></tr></tbody></table><table><thead><tr><th style="text-align:left">监视文件变动</th><th></th></tr></thead><tbody><tr><td style="text-align:left">hexo generate</td><td>#使用 Hexo 生成静态文件快速而且简单</td></tr><tr><td style="text-align:left">hexo generate –watch</td><td>#监视文件变动</td></tr></tbody></table><table><thead><tr><th style="text-align:left">完成后部署（两个命令的作用是相同的）</th><th style="text-align:left">草稿</th></tr></thead><tbody><tr><td style="text-align:left">hexo generate –deploy</td><td style="text-align:left">hexo publish [layout] <title></title></td></tr><tr><td style="text-align:left">hexo deploy –generate</td><td style="text-align:left">…</td></tr><tr><td style="text-align:left">hexo deploy -g</td><td style="text-align:left">…</td></tr><tr><td style="text-align:left">hexo server -g</td><td style="text-align:left">…</td></tr></tbody></table><table><thead><tr><th style="text-align:left">模版</th><th style="text-align:left"></th></tr></thead><tbody><tr><td style="text-align:left">hexo new “postName”</td><td style="text-align:left">#新建文章</td></tr><tr><td style="text-align:left">hexo new page “pageName”</td><td style="text-align:left">#新建页面</td></tr><tr><td style="text-align:left">hexo generate</td><td style="text-align:left">#生成静态页面至public目录</td></tr><tr><td style="text-align:left">hexo server</td><td style="text-align:left">#开启预览访问端口（默认端口4000，’ctrl + c’关闭server）</td></tr><tr><td style="text-align:left">hexo deploy</td><td style="text-align:left">#将.deploy目录部署到GitHub</td></tr><tr><td style="text-align:left">hexo new [layout] <title></title></td><td style="text-align:left">..</td></tr><tr><td style="text-align:left">hexo new photo “My Gallery”</td><td style="text-align:left">..</td></tr><tr><td style="text-align:left">hexo new “Hello World” –lang tw</td><td style="text-align:left">..</td></tr></tbody></table><blockquote><p>参考 :<a href="https://blog.csdn.net/qq_26975307/article/details/62447489" target="_blank" rel="noopener">Hexo常用命令笔记</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于使用Hexo主题Yilia中碰到的问题一二</title>
      <link href="/2018/04/08/hexo-yilia/"/>
      <url>/2018/04/08/hexo-yilia/</url>
      
        <content type="html"><![CDATA[<ul><li>关于使用主题 <a href="https://github.com/litten/hexo-theme-yilia" target="_blank" rel="noopener">Yilia</a>的一些问题的集合地：<a href="https://github.com/litten/hexo-theme-yilia/issues" target="_blank" rel="noopener">Issues</a></li></ul><blockquote><p>首推：<a href="http://www.ahonn.me/2016/12/15/create-a-hexo-theme-from-scratch/" target="_blank" rel="noopener">从零开始制作 Hexo 主题 </a></p></blockquote><a id="more"></a><blockquote><p>Q1：主页如何截取文本长度？</p></blockquote><ul><li>在需要截断的位置使用 <code>&lt;!-- More --&gt;</code> 即可</li></ul><blockquote><p>Q2：如何设置多个标签？</p></blockquote><ul><li><code>tags: [Hexo,Theme]</code>，参考<a href="https://www.zhihu.com/question/48934747/answer/113403121" target="_blank" rel="noopener">此处</a></li></ul><blockquote><p>Q3：更换主题的时候报错</p></blockquote><ul><li>一般是由于主题配置文件中的 <code>key: value</code>前后出现了空格，或者之间没有空格导致的</li></ul><blockquote><p>Q4：如何创建 about 等页面？如何创建自定义页面？</p></blockquote><ul><li><code>hexo new page &quot;about&quot;</code></li><li>参考<br>_ <a href="https://blog.csdn.net/lcyaiym/article/details/76762105?locationNum=5&amp;fps=1" target="_blank" rel="noopener">hexo 的 Next 创建 tags </a><br>_ <a href="https://refined-x.com/2017/07/10/Hexo%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%B5%E9%9D%A2%E7%9A%84%E6%96%B9%E6%B3%95/" target="_blank" rel="noopener">Hexo 自定义页面的方法 </a></li></ul><blockquote><p>其他</p></blockquote><ul><li>选择 favicon：<a href="http://www.easyicon.net/language.zh-cn/" target="_blank" rel="noopener">easyicon</a></li></ul><p><img src="/img/about-bg.jpg" alt="banner"></p>]]></content>
      
      
      <categories>
          
          <category> 博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用Hexo+Github搭建自己的个人网站</title>
      <link href="/2018/04/08/hexo/"/>
      <url>/2018/04/08/hexo/</url>
      
        <content type="html"><![CDATA[<h3 id="Hexo-官方文档"><a href="#Hexo-官方文档" class="headerlink" title="Hexo 官方文档"></a><a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="noopener">Hexo 官方文档</a></h3><a id="more"></a><blockquote><p><a href="https://www.jekyll.com.cn/" target="_blank" rel="noopener">将纯文本转化为静态网站和博客框架：jekyll</a></p></blockquote><h3 id="参考网站"><a href="#参考网站" class="headerlink" title="参考网站"></a>参考网站</h3><ul><li><a href="https://zoumiaojiang.com/article/how-to-build-a-blog/" target="_blank" rel="noopener">快速低成本的搭建一个马马虎虎的博客</a></li><li><a href="https://huangxuan.me/" target="_blank" rel="noopener">Hux Blog一生想做浪漫极客</a></li><li><a href="https://www.jianshu.com/p/b96fd206571a" target="_blank" rel="noopener">教你定制Hexo的landscape打造自己的主题</a></li><li><a href="http://www.codertian.com/2015/11/26/github-hexo-blog/" target="_blank" rel="noopener">【实用技能】使用github+Hexo人人都能拥有一个博客</a></li><li><a href="https://zhuanlan.zhihu.com/p/26625249" target="_blank" rel="noopener">GitHub+Hexo 搭建个人网站详细教程</a></li><li><a href="https://blog.csdn.net/guin_guo/article/details/51090481" target="_blank" rel="noopener">使用github page + hexo3.0 搭建个人博客，加绑定域名。</a></li><li>【很详细】<a href="https://www.cnblogs.com/visugar/p/6821777.html" target="_blank" rel="noopener">hexo从零开始到搭建完整</a></li></ul><h3 id="主题推荐"><a href="#主题推荐" class="headerlink" title="主题推荐"></a>主题推荐</h3><ul><li>合集：<a href="https://hexo.io/themes/" target="_blank" rel="noopener">Themes|Hexo</a> </li><li><a href="https://www.jianshu.com/p/bcdbe7347c8d" target="_blank" rel="noopener">Hexo博客主题推荐</a></li><li><a href="https://github.com/litten/hexo-theme-yilia" target="_blank" rel="noopener">hexo-theme-yilia</a></li><li><a href="https://blog.csdn.net/u011026329/article/details/52939341" target="_blank" rel="noopener">Yelee —— 简而不减 Hexo 双栏博客主题</a></li><li><a href="https://material.viosey.com/docs/#/start" target="_blank" rel="noopener">Material Theme</a></li><li><a href="http://haojen.github.io/" target="_blank" rel="noopener">Haojen ‘s Blog</a> <ul><li><a href="https://haojen.github.io/2017/05/09/Anisina-%E4%B8%AD%E6%96%87%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/" target="_blank" rel="noopener">Anisina 中文使用教程</a></li></ul></li><li><a href="https://blog.daraw.cn/" target="_blank" rel="noopener">DaraW</a><ul><li><a href="https://github.com/CodeDaraW/Hacker" target="_blank" rel="noopener">Hacker</a></li></ul></li><li><a href="https://github.com/BoizZ/hexo-theme-laughing" target="_blank" rel="noopener">laughing</a></li><li><a href="http://www.ccblog.win/" target="_blank" rel="noopener">http://www.ccblog.win/</a></li><li><a href="https://github.com/CodeDaraW/Hacker" target="_blank" rel="noopener">Hacker</a></li><li>加载速度快列表页：<a href="http://blog.minfive.com/" target="_blank" rel="noopener">A simple &amp; beautiful &amp; fast theme for Hexo</a></li><li>偏向Vue：<a href="https://github.com/yanm1ng/hexo-theme-vexo" target="_blank" rel="noopener">Vexo</a></li><li>设计类：<a href="https://github.com/miccall/hexo-theme-Mic_Theme" target="_blank" rel="noopener">Mic_Theme</a></li><li>酷炫类：<ul><li><a href="https://github.com/ochukai/hexo-theme-ochuunn" target="_blank" rel="noopener">hexo-theme-ochuunn</a></li><li><a href="http://firework.studio/archer-demo/" target="_blank" rel="noopener">Archer</a></li></ul></li><li>扁平化类：<a href="http://blog.minfive.com/" target="_blank" rel="noopener">A simple &amp; beautiful &amp; fast theme for Hexo</a><ul><li><a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank" rel="noopener">hexo-theme-skapp</a></li></ul></li><li>简洁、明了<ul><li><a href="https://github.com/Huxpro/huxpro.github.io" target="_blank" rel="noopener">hexo-theme-huxblog</a> </li><li><a href="http://gaoryrt.com/" target="_blank" rel="noopener">A plain theme for Hexo</a> — 比较个性化</li><li><a href="https://blog.daraw.cn/" target="_blank" rel="noopener">DARAW</a></li><li><a href="https://mikecoder.github.io/oj-code/" target="_blank" rel="noopener">hexo-theme-gandalfr</a></li><li><a href="http://www.ahonn.me/" target="_blank" rel="noopener">Even</a></li></ul></li><li>卡片式：<a href="https://xaoxuu.com/wiki/material-x/" target="_blank" rel="noopener">Material X</a><h3 id="博客"><a href="#博客" class="headerlink" title="博客"></a>博客</h3></li><li><a href="http://moxfive.xyz/" target="_blank" rel="noopener">MOxFIVE</a> </li></ul><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ul><li><a href="https://www.zhihu.com/question/52272170" target="_blank" rel="noopener">hexo+Github Page搭建的博客无法加载样式表？</a></li><li><a href="https://segmentfault.com/a/1190000007385345" target="_blank" rel="noopener">hexo githubpage 初始化 并解决同步静态页面问题</a></li><li><a href="https://help.github.com/articles/changing-a-remote-s-url/" target="_blank" rel="noopener">Changing a remote’s URL</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习《JavaScript经典实例》之第3章</title>
      <link href="/2018/04/08/js-chapter-3/"/>
      <url>/2018/04/08/js-chapter-3/</url>
      
        <content type="html"><![CDATA[<h3 id="第3章-JavaScript的构建块"><a href="#第3章-JavaScript的构建块" class="headerlink" title="第3章 JavaScript的构建块"></a>第3章 JavaScript的构建块</h3><a id="more"></a><h4 id="3种基本的创建函数方式："><a href="#3种基本的创建函数方式：" class="headerlink" title="3种基本的创建函数方式："></a>3种基本的创建函数方式：</h4><ul><li>声明式函数</li><li>匿名函数或函数构造函数</li><li>函数字面值或函数表达式</li></ul><h4 id="3-1-放置函数并提升"><a href="#3-1-放置函数并提升" class="headerlink" title="3.1 放置函数并提升"></a>3.1 放置函数并提升</h4><ul><li>声明式函数，可以放置在代码中的任何位置；函数表达式，必须将其放置在使用函数的位置之前</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在声明一个变量之前打印a</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'a'</span>, a);  <span class="comment">//undefined</span></span><br><span class="line"><span class="keyword">var</span> a;</span><br><span class="line"><span class="comment">// 在声明一个变量并赋值</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'aa'</span>, aa);  <span class="comment">//undefined</span></span><br><span class="line"><span class="keyword">var</span> aa = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明变量发生了提升，但是赋值并没有，赋值是在相应的位置发生的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明式函数，在访问该函数之前，提升将确保把函数声明移动到当前作用域的顶部</span></span><br><span class="line"><span class="built_in">console</span>.log(mytest());  <span class="comment">//success</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mytest</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">'success'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用函数表达式就会报错，变量可能声明了，但没有实例化，但是你的代码试图将这个变量当做一个函数对待</span></span><br><span class="line"><span class="built_in">console</span>.log(mytest2());  <span class="comment">//TypeError: mytest2 is not a function</span></span><br><span class="line"><span class="keyword">var</span> mytest2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">'success2'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-2-把一个函数当做参数传递给另一个函数"><a href="#3-2-把一个函数当做参数传递给另一个函数" class="headerlink" title="3.2 把一个函数当做参数传递给另一个函数"></a>3.2 把一个函数当做参数传递给另一个函数</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">otherFunction</span>(<span class="params">x, y, z</span>) </span>&#123;</span><br><span class="line">x(y, z);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 可以像传递一个命名的变量一样，将一个函数作为参数传递给另一个函数</span></span><br><span class="line"><span class="keyword">var</span> param = <span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params">a1, a2</span>) </span>&#123; alert(a1 + <span class="string">" "</span> + a2); &#125;;</span><br><span class="line">otherFunction(param, <span class="string">"Hello"</span>, <span class="string">"World"</span>);</span><br></pre></td></tr></table></figure><ul><li>函数式编程和JavaScript<ul><li><strong>高阶函数：</strong> 一个函数接受另一个函数作为参数，或者返回一个函数，或者两者都具备</li><li><strong>函数式编程：</strong> 对应用程序复杂性进行抽象的一种方式，使用整齐、干净的函数调用替代了复杂的循环和条件语句（代码可读性高）</li><li>比如：将数组中的所有数字相加</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for循环相加</span></span><br><span class="line"><span class="keyword">var</span> nums = [<span class="number">1</span>, <span class="number">34</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">18</span>];</span><br><span class="line"><span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">sum += nums[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'sum'</span>, sum);  <span class="comment">//75</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nums2 = [<span class="number">1</span>, <span class="number">34</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">18</span>];</span><br><span class="line"><span class="keyword">var</span> sum2 = nums2.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">n1, n2</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> n1 + n2;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'sum2'</span>, sum2);  <span class="comment">//75</span></span><br></pre></td></tr></table></figure><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce_clone" target="_blank" rel="noopener">arr.reduce([callback, initialValue])</a> 方法接收一个函数作为累加器（accumulator），数组中的每个值（从左到右）开始缩减，最终为一个值。</li></ul><h4 id="3-3-实现递归算法"><a href="#3-3-实现递归算法" class="headerlink" title="3.3 实现递归算法"></a>3.3 实现递归算法</h4><ul><li>想要实现一个函数，它递归地遍历一个数组并返回一个反向的数组字符串</li><li>缺点：递归很消耗内存</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 阶乘</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> n == <span class="number">1</span> ? n : n * factorial(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'阶乘'</span>, factorial(<span class="number">4</span>));  <span class="comment">// 24</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 斐波那契</span></span><br><span class="line"><span class="keyword">var</span> fibonacci = <span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> n &lt; <span class="number">2</span> ? n : fibonacci(n - <span class="number">1</span>) + fibonacci(n - <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'斐波那契'</span>, fibonacci(<span class="number">10</span>));  <span class="comment">//55</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用一个递归函数字面值来反转数组元素，从最大长度开始，每次迭代都将这个值自减</span></span><br><span class="line"><span class="comment">// 当为 0 时，返回字符串</span></span><br><span class="line"><span class="keyword">var</span> reverseArrary = <span class="function"><span class="keyword">function</span>(<span class="params">x, index, str</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> index == <span class="number">0</span> ? str : reverseArrary(x, --index, (str += <span class="string">" "</span> + x[index]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> arr = [<span class="string">'apple'</span>, <span class="string">'orange'</span>, <span class="string">'peach'</span>, <span class="string">'lime'</span>];</span><br><span class="line"><span class="keyword">var</span> str = reverseArrary(arr, arr.length, <span class="string">""</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'str'</span>, str);  <span class="comment">//lime peach orange apple</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果要反过来，按照顺序把数组连接为一个字符串</span></span><br><span class="line"><span class="keyword">var</span> orderArray = <span class="function"><span class="keyword">function</span>(<span class="params">x, i, str</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> i == x.length - <span class="number">1</span> ? str : orderArray(x, ++i, (str += x[i] + <span class="string">" "</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> numArr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="keyword">var</span> numStr = orderArray(numArr, <span class="number">-1</span>, <span class="string">""</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'numStr'</span>, numStr);  <span class="comment">//1 2 3 4</span></span><br></pre></td></tr></table></figure><h4 id="3-4-使用一个定时器和回调防止代码阻塞"><a href="#3-4-使用一个定时器和回调防止代码阻塞" class="headerlink" title="3.4 使用一个定时器和回调防止代码阻塞"></a>3.4 使用一个定时器和回调防止代码阻塞</h4><ul><li>在程序的输出中，3个外围的 <code>console.log()</code> 立即被处理了</li><li>队列中下一个事件是第一个 <code>noBlock()</code> 函数调用，其中又调用了 <code>factorial()</code> ，记录了其运行时候的活动，最后跟着回调函数的调用</li><li>第二次同样地调用了 <code>callBack()</code></li><li>第三次调用 <code>callBack()</code> 的时候，回调函数中的调用针对第一次 <code>callBack()</code> ，并使用了第一次函数调用的最终结果：6</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'n'</span>, n);</span><br><span class="line"><span class="keyword">return</span> n == <span class="number">1</span> ? <span class="number">1</span> : n * factorial(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">noBlock</span>(<span class="params">n, callback</span>) </span>&#123;</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> val = factorial(n);</span><br><span class="line"><span class="keyword">if</span>(callback &amp;&amp; <span class="keyword">typeof</span> callback == <span class="string">'function'</span>) &#123;</span><br><span class="line">callback(val);</span><br><span class="line">&#125;</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Top of the morning to you'</span>);</span><br><span class="line">noBlock(<span class="number">3</span>, <span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'first call ends width '</span> + n);</span><br><span class="line">noBlock(n, <span class="function"><span class="keyword">function</span>(<span class="params">m</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'final result is '</span> + m);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tst = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">tst += i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'value of tst is '</span> + tst);</span><br><span class="line">noBlock(<span class="number">4</span>, <span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'end result is '</span> + n);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'not doing too much'</span>);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>待续~</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> JavaScript经典实例 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习《JavaScript经典实例》之第2章</title>
      <link href="/2018/04/08/js-chapter-2/"/>
      <url>/2018/04/08/js-chapter-2/</url>
      
        <content type="html"><![CDATA[<h3 id="第2章-JavaScript数组"><a href="#第2章-JavaScript数组" class="headerlink" title="第2章 JavaScript数组"></a>第2章 JavaScript数组</h3><a id="more"></a><h4 id="2-1-在数组中搜索"><a href="#2-1-在数组中搜索" class="headerlink" title="2.1 在数组中搜索"></a>2.1 在数组中搜索</h4><ul><li><code>indexOf()、lastIndexOf()</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> animals = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="string">'dog'</span>, <span class="string">'cat'</span>, <span class="string">'seal'</span>, <span class="string">'elephant'</span>, <span class="string">'walrus'</span>, <span class="string">'lion'</span>);</span><br><span class="line"><span class="keyword">var</span> index = animals.indexOf(<span class="string">'cat'</span>);</span><br><span class="line"><span class="keyword">var</span> index2 = animals.lastIndexOf(<span class="string">'lion'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'i'</span>,index);  <span class="comment">//1</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'i2'</span>,index2);  <span class="comment">//5</span></span><br></pre></td></tr></table></figure><ul><li><a href="http://www.runoob.com/jsref/jsref-findindex.html" target="_blank" rel="noopener">findIndex()</a> 方法返回传入一个测试条件（函数）符合条件的数组第一个元素位置。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nums = [<span class="number">2</span>, <span class="number">4</span>, <span class="number">199</span>, <span class="number">80</span>, <span class="number">400</span>, <span class="number">30</span>, <span class="number">90</span>];</span><br><span class="line"><span class="keyword">var</span> over = nums.findIndex(<span class="function"><span class="keyword">function</span>(<span class="params">ele</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> (ele &gt;= <span class="number">100</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'nums'</span>,nums[over]);  <span class="comment">//199</span></span><br></pre></td></tr></table></figure><h4 id="2-2-用concat-和apply-将一个二维数组扁平化"><a href="#2-2-用concat-和apply-将一个二维数组扁平化" class="headerlink" title="2.2 用concat()和apply()将一个二维数组扁平化"></a>2.2 用concat()和apply()将一个二维数组扁平化</h4><ul><li>concat() 方法用于连接两个或多个数组。该方法不会改变现有的数组，而仅仅会返回被连接数组的一个副本。<ul><li><code>arrayObject.concat(arrayX,arrayX,......,arrayX)</code></li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fruitarray = [];</span><br><span class="line">fruitarray[<span class="number">0</span>] = [<span class="string">'stranwberry'</span>, <span class="string">'orange'</span>];</span><br><span class="line">fruitarray[<span class="number">1</span>] = [<span class="string">'lime'</span>, <span class="string">'peach'</span>, <span class="string">'banana'</span>];</span><br><span class="line">fruitarray[<span class="number">2</span>] = [<span class="string">'tangerine'</span>, <span class="string">'apricot'</span>];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'array'</span>,fruitarray.concat());</span><br><span class="line"><span class="keyword">var</span> newArray = fruitarray.concat.apply([], fruitarray);</span><br><span class="line"><span class="built_in">console</span>.log(newArray);</span><br></pre></td></tr></table></figure><ul><li><a href="http://www.cnblogs.com/lengyuehuahun/p/5643625.html" target="_blank" rel="noopener">apply()与call()的区别</a></li><li><a href="https://www.zhihu.com/question/20289071" target="_blank" rel="noopener">如何理解和熟练运用js中的call及apply？</a><ul><li><code>obj.call(thisObj, arg1, arg2, ...);</code></li><li><code>obj.apply(thisObj, [arg1, arg2, ...]);</code></li></ul></li><li>call() &amp; apply()，动态改变this</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'add'</span>, <span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'sum'</span>, <span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line">add(<span class="number">1</span>, <span class="number">2</span>);  <span class="comment">//Window</span></span><br><span class="line">sum(<span class="number">1</span>, <span class="number">2</span>);  <span class="comment">//Window</span></span><br><span class="line"></span><br><span class="line">add.call(sum, <span class="number">1</span>, <span class="number">2</span>);  <span class="comment">//sum(a, b)</span></span><br><span class="line">sum.call(add, <span class="number">1</span>, <span class="number">2</span>);  <span class="comment">//add(a ,b)</span></span><br></pre></td></tr></table></figure><ul><li>arguments装换为数组, 返回的是数组，但是arguments本身保持不变</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arg = [].slice.call(<span class="built_in">arguments</span>);</span><br><span class="line"><span class="comment">// [].slice.call(document.getElementsByTagName('li'));</span></span><br></pre></td></tr></table></figure><ul><li>借用别人的方法</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line">name: <span class="string">'jack'</span>,</span><br><span class="line">showName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'this name:'</span>,<span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line">name: <span class="string">'rose'</span></span><br><span class="line">&#125;</span><br><span class="line">foo.showName();  <span class="comment">//jack</span></span><br><span class="line">foo.showName.call(bar);  <span class="comment">//rose</span></span><br></pre></td></tr></table></figure><ul><li>实现继承</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Student = <span class="function"><span class="keyword">function</span>(<span class="params">name, age, high</span>) </span>&#123;</span><br><span class="line">Person.call(<span class="keyword">this</span>, name, age);</span><br><span class="line"><span class="keyword">this</span>.high = high;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>封装对象保证this的指向</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _this = <span class="keyword">this</span>;</span><br><span class="line">_this.$box.on(<span class="string">'mousedown'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> _this.fndown.apply(_this);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-3-删除或替换数组元素"><a href="#2-3-删除或替换数组元素" class="headerlink" title="2.3 删除或替换数组元素"></a>2.3 删除或替换数组元素</h4><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/splice" target="_blank" rel="noopener">splice()</a> 方法与 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/slice" target="_blank" rel="noopener">slice()</a> 方法的作用是不同的，splice() 方法会直接对数组进行修改。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> animals = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="string">'dog'</span>, <span class="string">'cat'</span>, <span class="string">'rabbit'</span>, <span class="string">'pig'</span>, <span class="string">'apple'</span>);</span><br><span class="line"><span class="comment">// 从数组删除元素</span></span><br><span class="line">animals.splice(animals.indexOf(<span class="string">'apple'</span>), <span class="number">1</span>);</span><br><span class="line"><span class="built_in">console</span>.log(animals);  <span class="comment">// ["dog", "cat", "rabbit", "pig"]</span></span><br><span class="line"><span class="comment">// 替换</span></span><br><span class="line">animals.splice(animals.indexOf(<span class="string">'pig'</span>), <span class="number">1</span>, <span class="string">'monkey'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(animals);  <span class="comment">//["dog", "cat", "rabbit", "monkey"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用循环和分割来替换和删除元素</span></span><br><span class="line"><span class="keyword">var</span> charSets = [<span class="string">"ab"</span>, <span class="string">"bb"</span>, <span class="string">"cd"</span>, <span class="string">"ab"</span>, <span class="string">"cc"</span>, <span class="string">"ab"</span>, <span class="string">"dd"</span>, <span class="string">"ab"</span>];</span><br><span class="line"><span class="keyword">while</span>(charSets.indexOf(<span class="string">'ab'</span>) != <span class="number">-1</span>) &#123;</span><br><span class="line">charSets.splice(charSets.indexOf(<span class="string">'ab'</span>), <span class="number">1</span>, <span class="string">'**'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(charSets);  <span class="comment">//["**", "bb", "cd", "**", "cc", "**", "dd", "**"]</span></span><br><span class="line"><span class="keyword">while</span>(charSets.indexOf(<span class="string">'**'</span>) != <span class="number">-1</span>) &#123;</span><br><span class="line">charSets.splice(charSets.indexOf(<span class="string">'**'</span>), <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(charSets); <span class="comment">//["bb", "cd", "cc", "dd"]</span></span><br></pre></td></tr></table></figure><h4 id="2-4-提取一个数组中的一部分"><a href="#2-4-提取一个数组中的一部分" class="headerlink" title="2.4 提取一个数组中的一部分"></a>2.4 提取一个数组中的一部分</h4><ul><li>不更改原数组，使用<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/slice" target="_blank" rel="noopener">slice()</a></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> animals = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="string">'dog'</span>, <span class="string">'cat'</span>, <span class="string">'rabbit'</span>, <span class="string">'pig'</span>, <span class="string">'apple'</span>);</span><br><span class="line"><span class="keyword">var</span> newAnimals = animals.slice(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(animals);  <span class="comment">//["dog", "cat", "rabbit", "pig", "apple"]</span></span><br><span class="line"><span class="built_in">console</span>.log(newAnimals);  <span class="comment">//["cat"]</span></span><br></pre></td></tr></table></figure><h4 id="2-5-对每一个数组元素应用一个函数"><a href="#2-5-对每一个数组元素应用一个函数" class="headerlink" title="2.5 对每一个数组元素应用一个函数"></a>2.5 对每一个数组元素应用一个函数</h4><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypedArray/forEach" target="_blank" rel="noopener">Array.prototype.forEach()</a></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> charSets = [<span class="string">"ab"</span>, <span class="string">"bb"</span>, <span class="string">"cd"</span>, <span class="string">"ab"</span>, <span class="string">"cc"</span>, <span class="string">"ab"</span>, <span class="string">"dd"</span>, <span class="string">"ab"</span>];</span><br><span class="line">charSets.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">element, index, array</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(element == <span class="string">'ab'</span>) array[index] = <span class="string">'**'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(charSets);  <span class="comment">//["**", "bb", "cd", "**", "cc", "**", "dd", "**"]</span></span><br></pre></td></tr></table></figure><h4 id="2-6-使用forEach-和call-遍历querySelectorAll-的结果"><a href="#2-6-使用forEach-和call-遍历querySelectorAll-的结果" class="headerlink" title="2.6 使用forEach()和call()遍历querySelectorAll()的结果"></a>2.6 使用forEach()和call()遍历querySelectorAll()的结果</h4><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/querySelectorAll" target="_blank" rel="noopener">querySelectorAll()</a></li><li>可以将forEach()强制和一个NodeList一起使用</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cells = <span class="built_in">document</span>.querySelectorAll(<span class="string">'td + td'</span>);</span><br><span class="line">[].forEach.call(cells, <span class="function"><span class="keyword">function</span>(<span class="params">cell</span>) </span>&#123;</span><br><span class="line">sum += <span class="built_in">parseFloat</span>(cell.firstChild.data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="2-7-对数组中的每个元素执行一个函数并返回一个新数组"><a href="#2-7-对数组中的每个元素执行一个函数并返回一个新数组" class="headerlink" title="2.7 对数组中的每个元素执行一个函数并返回一个新数组"></a>2.7 对数组中的每个元素执行一个函数并返回一个新数组</h4><ul><li>将一个十进制的数组转化为新的等价的十六进制数组</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/map" target="_blank" rel="noopener">map()</a>方法创建一个新数组，其结果是该数组中的每个元素都调用一个提供的函数后返回的结果。</li><li>与forEach()不同，不会修改原数组，但是必须返回一个值</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> decArray = [<span class="number">23</span>, <span class="number">3</span>, <span class="number">24</span>, <span class="number">45</span>, <span class="number">500</span>, <span class="number">9</span>, <span class="number">70</span>];</span><br><span class="line"><span class="keyword">var</span> hexArray = decArray.map(<span class="function"><span class="keyword">function</span>(<span class="params">ele</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> ele.toString(<span class="number">16</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(decArray);  <span class="comment">//[23, 3, 24, 45, 500, 9, 70]</span></span><br><span class="line"><span class="built_in">console</span>.log(hexArray);  <span class="comment">//["17", "3", "18", "2d", "1f4", "9", "46"]</span></span><br></pre></td></tr></table></figure><h4 id="2-8-创建一个过滤后的数组"><a href="#2-8-创建一个过滤后的数组" class="headerlink" title="2.8 创建一个过滤后的数组"></a>2.8 创建一个过滤后的数组</h4><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/filter" target="_blank" rel="noopener">filter()</a> 方法创建一个新数组, 其包含通过所提供函数实现的测试的所有元素。 </li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> charSet = [<span class="string">'**'</span>, <span class="string">'bb'</span>, <span class="string">'cc'</span>, <span class="string">'**'</span>, <span class="string">'cd'</span>];</span><br><span class="line"><span class="keyword">var</span> newArray = charSet.filter(<span class="function"><span class="keyword">function</span>(<span class="params">element, index, array</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> element != <span class="string">"**"</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(newArray);  <span class="comment">//["bb", "cc", "cd"]</span></span><br></pre></td></tr></table></figure><h4 id="2-9-验证数组内容"><a href="#2-9-验证数组内容" class="headerlink" title="2.9 验证数组内容"></a>2.9 验证数组内容</h4><ul><li>使用Array <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/every" target="_blank" rel="noopener">every()</a>方法来检查每个元素是否符合给定的条件</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/some" target="_blank" rel="noopener">some()</a> 方法确保至少某些元素符合该条件</li><li>区别：every()方法只要函数返回一个false值，处理就会结束，而some()方法会继续测试每个元素，直至返回true，此时，不再验证其他元素，即可返回ture</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testValue</span>(<span class="params">element, index, array</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> testExp = <span class="regexp">/^[a-zA-Z]+$/</span>;</span><br><span class="line"><span class="keyword">return</span> testExp.test(element);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> elemSet = [<span class="string">'**'</span>, <span class="number">123</span>, <span class="string">'adv'</span>, <span class="string">'-'</span>, <span class="number">45</span>, <span class="string">'AAA'</span>];</span><br><span class="line"><span class="keyword">var</span> result = elemSet.every(testValue);</span><br><span class="line"><span class="keyword">var</span> result2 = elemSet.some(testValue);</span><br><span class="line"><span class="built_in">console</span>.log(result);  <span class="comment">//false</span></span><br><span class="line"><span class="built_in">console</span>.log(result2);  <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> elemSet2 = [<span class="string">'aaa'</span>, <span class="string">'animals'</span>, <span class="string">'vvv'</span>];</span><br><span class="line">result = elemSet2.every(testValue);</span><br><span class="line">result2 = elemSet2.some(testValue);</span><br><span class="line"><span class="built_in">console</span>.log(result);  <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(result2);  <span class="comment">//true</span></span><br></pre></td></tr></table></figure><h4 id="2-10-使用一个关联数组来存储表单元素名和值"><a href="#2-10-使用一个关联数组来存储表单元素名和值" class="headerlink" title="2.10 使用一个关联数组来存储表单元素名和值"></a>2.10 使用一个关联数组来存储表单元素名和值</h4><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/keys" target="_blank" rel="noopener">keys()</a> 方法返回一个新的Array迭代器，它包含数组中每个索引的键。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> elemArray = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> elem = <span class="built_in">document</span>.forms[<span class="number">0</span>].elements[<span class="number">0</span>];</span><br><span class="line">elemArray[elem.id] = elem.value;</span><br><span class="line"><span class="keyword">var</span> elemArray = &#123;<span class="attr">name</span>: <span class="string">'yt'</span>, <span class="attr">age</span>:<span class="number">25</span>&#125;;</span><br><span class="line"><span class="built_in">Object</span>.keys(elemArray).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">key</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> value = elemArray[key];</span><br><span class="line"><span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>待续~</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> JavaScript经典实例 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习《JavaScript经典实例》之第1章</title>
      <link href="/2018/04/08/js-chapter-1/"/>
      <url>/2018/04/08/js-chapter-1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>《JavaScript经典实例》各节中的完整代码解决了常见的编程问题，并且给出了在任何浏览器中构建Web应用程序的技术。只需要将这些代码示例复制并粘贴到你自己的项目中就行了，可以快速完成工作，并且在此过程中学习JavaScript的很多知识。</p></blockquote><h3 id="第1章-JavaScript不只是简单的构件块"><a href="#第1章-JavaScript不只是简单的构件块" class="headerlink" title="第1章 JavaScript不只是简单的构件块"></a>第1章 JavaScript不只是简单的构件块</h3><h4 id="1-1-JavaScript对象、基本类型和字面值之间的区别"><a href="#1-1-JavaScript对象、基本类型和字面值之间的区别" class="headerlink" title="1.1 JavaScript对象、基本类型和字面值之间的区别"></a>1.1 JavaScript对象、基本类型和字面值之间的区别</h4><ul><li><p>5种基本类型：字符串、数值、布尔值、null、undefined，有3个有对应的构造方法对象:string、Number、Boolean </p></li><li><p>基本类型变量严格等于字面值，而对象实例则不会，因为基本类型是按值来比较的，而值是字面值</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num1 = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">var</span> num2 = <span class="keyword">new</span> <span class="built_in">Number</span>(<span class="number">123</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> num1);  <span class="comment">//number </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> num2);  <span class="comment">//object</span></span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="1-2-从字符串提取一个列表"><a href="#1-2-从字符串提取一个列表" class="headerlink" title="1.2 从字符串提取一个列表"></a>1.2 从字符串提取一个列表</h4><ul><li>提取之前：<code>This is a list of items: cherries, limes, oranges, apples.</code></li><li>提取之后：<code>[&#39;cherries&#39;,&#39;limes&#39;,&#39;oranges&#39;,&#39;apples&#39;]</code></li><li><strong><a href="http://www.w3school.com.cn/jsref/jsref_indexOf.asp" target="_blank" rel="noopener">indexOf()</a></strong> 方法可返回某个指定的字符串值在字符串中首次出现的位置。</li><li><strong><a href="http://www.w3school.com.cn/jsref/jsref_substring.asp" target="_blank" rel="noopener">substring()</a></strong> 方法用于提取字符串中介于两个指定下标之间的字符。</li><li><strong><a href="http://www.w3school.com.cn/jsref/jsref_split.asp" target="_blank" rel="noopener">split()</a></strong> 方法用于把一个字符串分割成字符串数组。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sentence = <span class="string">'This is one sentence. This is a sentence with a list of items: cherries, oranges, apples, bananas. That was the list of items.'</span>;</span><br><span class="line"><span class="keyword">var</span> start = sentence.indexOf(<span class="string">':'</span>);</span><br><span class="line"><span class="keyword">var</span> end = sentence.indexOf(<span class="string">'.'</span>, start+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">var</span> listStr = sentence.substring(start+<span class="number">1</span>, end);</span><br><span class="line"><span class="keyword">var</span> fruits = listStr.split(<span class="string">','</span>);</span><br><span class="line"><span class="built_in">console</span>.log(fruits);  <span class="comment">//[" cherries", " oranges", " apples", " bananas"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//取出空格等</span></span><br><span class="line">fruits.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">elmnt,indx,arry</span>) </span>&#123;</span><br><span class="line">    arry[indx] = elmnt.trim();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(fruits);  <span class="comment">//["cherries", "oranges", "apples", "bananas"]</span></span><br></pre></td></tr></table></figure><h4 id="1-3-检查一个存在的、非空的字符串"><a href="#1-3-检查一个存在的、非空的字符串" class="headerlink" title="1.3 检查一个存在的、非空的字符串"></a>1.3 检查一个存在的、非空的字符串</h4><ul><li>想要验证一个变量已经定义了，是一个字符串，并且它不为空</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">typeof</span> unknowVariable === <span class="string">'string'</span> &amp;&amp; unknowVariable.length &gt; <span class="number">0</span>) &#123;...&#125;</span><br></pre></td></tr></table></figure><h4 id="1-4-插入特殊字符"><a href="#1-4-插入特殊字符" class="headerlink" title="1.4 插入特殊字符"></a>1.4 插入特殊字符</h4><ul><li>想要向字符串中插入一个特殊字符，例如一个换行</li><li>转义序列都以一个<em>反斜杠</em> 开始（\）</li></ul><h4 id="1-5-使用新字符串替换模式"><a href="#1-5-使用新字符串替换模式" class="headerlink" title="1.5 使用新字符串替换模式"></a>1.5 使用新字符串替换模式</h4><ul><li>使用String对象的replace方法和一个 <strong><a href="http://www.runoob.com/js/js-regexp.html" target="_blank" rel="noopener">正则表达式</a></strong></li><li><strong><a href="http://www.w3school.com.cn/jsref/jsref_replace.asp" target="_blank" rel="noopener">replace()</a></strong> 方法用于在字符串中用一些字符替换另一些字符，或替换一个与正则表达式匹配的子串。</li></ul><h4 id="正则表达式特殊字符"><a href="#正则表达式特殊字符" class="headerlink" title="正则表达式特殊字符"></a>正则表达式特殊字符</h4><table><thead><tr><th>字符</th><th>匹配</th><th>例子</th></tr></thead><tbody><tr><td>^</td><td>匹配输入的开头</td><td>/^This/ 匹配This is…</td></tr><tr><td>$</td><td>匹配输入的结束</td><td>/end$/ 匹配This is the end</td></tr><tr><td>*</td><td>匹配0次或多次</td><td>/se*/ 匹配s seeee或se</td></tr><tr><td>?</td><td>匹配0次或1次</td><td>/ap?/ 匹配apple and and</td></tr><tr><td>+</td><td>匹配1次或多次</td><td>/ap+/ 匹配apple 但是不匹配and</td></tr><tr><td>{n}</td><td>严格匹配n次</td><td>/ap{2}/ 严格匹配apple 但是不匹配apie</td></tr><tr><td>{n,}</td><td>匹配n次或多次</td><td>/ap{2,}/ 匹配apple中的p，但是不匹配apie中的p</td></tr><tr><td>{n,m}</td><td>至少匹配n次，之多匹配m<br>除换行以外的任何字符</td><td>/ap{2,4}/ 匹配apppppple中的4个p<br>/a.e/ 匹配ape和axe</td></tr><tr><td>[…]</td><td>方括号中的任何字符</td><td>/a[px]e/ 匹配ape axe 但是不匹配apxe</td></tr><tr><td>[^…]</td><td>除了方括号以外的任何字符</td><td>/a[^px]/ 匹配ale 但是不匹配ape axe</td></tr><tr><td>\b</td><td>匹配单词边界</td><td>/\bno/ 匹配nono中的第一个no</td></tr><tr><td>\B</td><td>匹配非单词边界</td><td>/\Bno/ 匹配nono中的第二个no</td></tr><tr><td>\d</td><td>数字0到9</td><td>/\d{3}/ 匹配Now in 123 中的123</td></tr><tr><td>\D</td><td>匹配任何非数字字符</td><td>/\D{2,4}/ 匹配Now in 123 中的Now in</td></tr><tr><td>\w</td><td>匹配任何单词字符（字母、数组和下划线</td><td>/\w/ 匹配javaScript中的j</td></tr><tr><td>\W</td><td>匹配任何非单词字符（非字母、数组和下划线）</td><td>/\W/ 匹配100%中的%</td></tr><tr><td>\n</td><td>匹配一个换行</td><td></td></tr><tr><td>\s</td><td>一个单个的空白字符</td><td></td></tr><tr><td>\S</td><td>一个单个的非空白字符</td><td></td></tr><tr><td>\t</td><td>一个制表符</td><td></td></tr><tr><td>(x)</td><td>捕获括号</td><td>记住匹配的字符</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> searchString = <span class="string">"Now is the time, this is the tame"</span>;</span><br><span class="line"><span class="keyword">var</span> re = <span class="regexp">/t\w&#123;2&#125;e/g</span>;</span><br><span class="line"><span class="keyword">var</span> replacement = searchString.replace(re, <span class="string">'place'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(replacement);  <span class="comment">//Now is the place, this is the place</span></span><br></pre></td></tr></table></figure><h4 id="1-6-找到并突出显示一个模式的所有实例"><a href="#1-6-找到并突出显示一个模式的所有实例" class="headerlink" title="1.6 找到并突出显示一个模式的所有实例"></a>1.6 找到并突出显示一个模式的所有实例</h4><ul><li>RegExp <strong><a href="http://www.w3school.com.cn/jsref/jsref_exec_regexp.asp" target="_blank" rel="noopener">exec()</a></strong> 方法用于检索字符串中的正则表达式的匹配</li><li>RegExpObject.exec(string)</li><li>返回一个数组，其中存放匹配的结果。如果未找到匹配，则返回值为 null</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> searchString2 = <span class="string">"Now is the time and this is the time and that is the time"</span>;</span><br><span class="line"><span class="keyword">var</span> parttern = <span class="regexp">/t\w*e/g</span>;  <span class="comment">//\w 匹配任何单词字符</span></span><br><span class="line"><span class="keyword">var</span> matchArray;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//用regexp exec检查模式，如果不为空，处理它</span></span><br><span class="line"><span class="keyword">while</span>((matchArray = parttern.exec(searchString2)) != <span class="literal">null</span>) &#123;</span><br><span class="line">str += <span class="string">"at "</span> + matchArray.index + <span class="string">" we found "</span> + matchArray[<span class="number">0</span>] + <span class="string">"\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(str);</span><br><span class="line"><span class="comment">// at 7 we found the</span></span><br><span class="line"><span class="comment">// at 11 we found time</span></span><br><span class="line"><span class="comment">// at 28 we found the</span></span><br><span class="line"><span class="comment">// at 32 we found time</span></span><br><span class="line"><span class="comment">// at 49 we found the</span></span><br><span class="line"><span class="comment">// at 53 we found time</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实例1-1</span></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"searchSubmit"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取模式</span></span><br><span class="line">    <span class="keyword">var</span> pattern = <span class="built_in">document</span>.getElementById(<span class="string">"pattern"</span>).value;</span><br><span class="line">    <span class="keyword">var</span> re = <span class="keyword">new</span> <span class="built_in">RegExp</span>(pattern, <span class="string">"g"</span>);</span><br><span class="line">    <span class="comment">//获取字符串</span></span><br><span class="line">    <span class="keyword">var</span> searchString = <span class="built_in">document</span>.getElementById(<span class="string">"inComing"</span>).value;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> matchArray;</span><br><span class="line">    <span class="keyword">var</span> resultString = <span class="string">"&lt;pre&gt;"</span>;</span><br><span class="line">    <span class="keyword">var</span> first = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> last = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//找到每一个匹配</span></span><br><span class="line">    <span class="keyword">while</span>((matchArray = re.exec(searchString)) != <span class="literal">null</span>) &#123;</span><br><span class="line">    last = matchArray.index;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取所有匹配的字符串，将其连接起来</span></span><br><span class="line">    resultString += searchString.substring(first, last);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//使用class，添加匹配的字符串</span></span><br><span class="line">    resultString += <span class="string">'&lt;span class="found"&gt;'</span> + matchArray[<span class="number">0</span>] + <span class="string">'&lt;/span&gt;'</span>;</span><br><span class="line">    first = re.lastIndex;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//完成字符串</span></span><br><span class="line">    resultString += searchString.substring(first, searchString.length);</span><br><span class="line">    resultString += <span class="string">"&lt;/pre&gt;"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//插入页面</span></span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"searchResult"</span>).innerHTML = resultString;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-7-使用捕获圆括号交换一个字符串中的单词"><a href="#1-7-使用捕获圆括号交换一个字符串中的单词" class="headerlink" title="1.7 使用捕获圆括号交换一个字符串中的单词"></a>1.7 使用捕获圆括号交换一个字符串中的单词</h4><ul><li>交换名称，让姓氏先出现</li><li>解决：使用捕获圆括号和一个正则表达式在字符串中找到并记住他们的名字，然后互换他们</li><li><strong><a href="http://www.w3school.com.cn/jsref/jsref_replace.asp" target="_blank" rel="noopener">replace()</a></strong> 方法用于在字符串中用一些字符替换另一些字符，或替换一个与正则表达式匹配的子串。</li></ul><table><thead><tr><th>字符</th><th>替换文本</th></tr></thead><tbody><tr><td>$1、$2、…、$99</td><td>与 regexp 中的第 1 到第 99 个子表达式相匹配的文本。</td></tr><tr><td>$&amp;</td><td>与 regexp 相匹配的子串。</td></tr><tr><td>$`</td><td>位于匹配子串左侧的文本。</td></tr><tr><td>$’</td><td>位于匹配子串右侧的文本。</td></tr><tr><td>$$</td><td>允许替换中有一个字面值美元符号($)</td></tr><tr><td>$n</td><td>插入使用RegExp的第n次捕获圆括号的值</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myName = <span class="string">"Tao Yang"</span>;</span><br><span class="line"><span class="keyword">var</span> nameRe = <span class="regexp">/^(\w+)\s(\w+)$/</span>;</span><br><span class="line"><span class="keyword">var</span> myNewName = myName.replace(nameRe, <span class="string">"$2 $1"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(myNewName);  <span class="comment">//Yang Tao</span></span><br></pre></td></tr></table></figure><h4 id="1-8-使用命名实体来替代HTML标签"><a href="#1-8-使用命名实体来替代HTML标签" class="headerlink" title="1.8 使用命名实体来替代HTML标签"></a>1.8 使用命名实体来替代HTML标签</h4><ul><li>使用正则表达式把尖括号(&lt;&gt;)转换为命名的实体：&lt;和&gt;</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pieceOfHtml = <span class="string">"&lt;p&gt;This is a &lt;span&gt;paragraph&lt;/span&gt;&lt;/p&gt;"</span>;</span><br><span class="line">pieceOfHtml = pieceOfHtml.replace(<span class="regexp">/&lt;/g</span>, <span class="string">"&amp;lt;"</span>);</span><br><span class="line">pieceOfHtml = pieceOfHtml.replace(<span class="regexp">/&gt;/g</span>, <span class="string">"&amp;gt;"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(pieceOfHtml); <span class="comment">//&amp;lt;p&amp;gt;This is a &amp;lt;span&amp;gt;paragraph&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;</span></span><br></pre></td></tr></table></figure><h4 id="1-9-ISO-8610格式的日期转换为Date对象可接受的一种形式"><a href="#1-9-ISO-8610格式的日期转换为Date对象可接受的一种形式" class="headerlink" title="1.9 ISO 8610格式的日期转换为Date对象可接受的一种形式"></a>1.9 ISO 8610格式的日期转换为Date对象可接受的一种形式</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dtstr = <span class="string">"2014-3-04T19:35:32Z"</span>;</span><br><span class="line">dtstr = dtstr.replace(<span class="regexp">/\D/g</span>, <span class="string">" "</span>);</span><br><span class="line"><span class="built_in">console</span>.log(dtstr);  <span class="comment">//2014 3 04 19 35 32</span></span><br><span class="line"><span class="keyword">var</span> dtcomps = dtstr.split(<span class="string">" "</span>);</span><br><span class="line"><span class="comment">//在基于1的ISO 8610月份和基于0的日期格式之间转换</span></span><br><span class="line">dtcomps[<span class="number">1</span>]--;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> convdt = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">Date</span>.UTC.apply(<span class="literal">null</span>, dtcomps));</span><br><span class="line"><span class="built_in">console</span>.log(convdt.toString());  <span class="comment">//Wed Mar 05 2014 03:35:32 GMT+0800 (中国标准时间)</span></span><br></pre></td></tr></table></figure><h4 id="1-10-使用带有定时器的函数闭包"><a href="#1-10-使用带有定时器的函数闭包" class="headerlink" title="1.10 使用带有定时器的函数闭包"></a>1.10 使用带有定时器的函数闭包</h4><ul><li>使用一个匿名函数作为setInterval()或setTimeout()方法调用的第一个参数</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> intervalId = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"redbox"</span>).addEventListener(<span class="string">'click'</span>, startBox, <span class="literal">false</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">startBox</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(intervalId == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> x = <span class="number">100</span>;</span><br><span class="line">        intervalId = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            x += <span class="number">5</span>;</span><br><span class="line">            <span class="keyword">var</span> left = x + <span class="string">"px"</span>;</span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">"redbox"</span>).style.left = left;</span><br><span class="line">        &#125;, <span class="number">500</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        clearInterval(intervalId);</span><br><span class="line">        intervalId = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-11-记录两个事件之间消耗的时间"><a href="#1-11-记录两个事件之间消耗的时间" class="headerlink" title="1.11 记录两个事件之间消耗的时间"></a>1.11 记录两个事件之间消耗的时间</h4><ul><li>在第一个事件发生的时候，创建一个Date对象，当第二个时间发生的时候，创建一个新的Date对象，并且从第二个对象中减去第一个对象。两者之间的差以毫秒表示的，要转换为秒，就除以1000</li><li>两个日期可以相减，但是相加就成了拼接字符串</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> firstDate = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    doEvent(firstDate);</span><br><span class="line">&#125;, <span class="number">25000</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doEvent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> secondDate = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">var</span> diff = secondDate - firstDate;</span><br><span class="line">    <span class="built_in">console</span>.log(diff);   <span class="comment">//25001</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-12-十进制数转化为十六进制值"><a href="#1-12-十进制数转化为十六进制值" class="headerlink" title="1.12 十进制数转化为十六进制值"></a>1.12 十进制数转化为十六进制值</h4><ul><li>使用Number对象的 <strong><a href="http://www.w3school.com.cn/jsref/jsref_toString_boolean.asp" target="_blank" rel="noopener">toString()</a></strong> 方法</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">255</span>;</span><br><span class="line"><span class="built_in">console</span>.log(num.toString(<span class="number">16</span>));  <span class="comment">//ff</span></span><br></pre></td></tr></table></figure><h4 id="1-13-想要将表中一列的所有数字加和"><a href="#1-13-想要将表中一列的所有数字加和" class="headerlink" title="1.13 想要将表中一列的所有数字加和"></a>1.13 想要将表中一列的所有数字加和</h4><ul><li>遍历表中包含了数字值的列，将其转换为数字，并加和</li><li><strong><a href="http://www.runoob.com/jsref/met-document-queryselector.html" target="_blank" rel="noopener">querySelector()</a></strong>  方法返回文档中匹配指定 CSS 选择器的一个元素</li><li>如果你需要返回所有的元素，请使用 querySelectorAll() 方法替代</li><li>全局函数 <strong><a href="http://www.runoob.com/jsref/jsref-parseint.html" target="_blank" rel="noopener">parseInt()</a></strong> 和 <strong><a href="http://www.runoob.com/jsref/jsref-parsefloat.html" target="_blank" rel="noopener">parseFloat()</a></strong> 都把字符串转化为数字</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//使用querySelectorAll找到第二列的所有单元格</span></span><br><span class="line"><span class="keyword">var</span> cells = <span class="built_in">document</span>.querySelectorAll(<span class="string">"td:nth-of-type(2)"</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>, l=cells.length; i&lt;l; i++) &#123;</span><br><span class="line">    sum += <span class="built_in">parseFloat</span>(cells[i].firstChild.data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-14-在角度和弧度之间转换"><a href="#1-14-在角度和弧度之间转换" class="headerlink" title="1.14 在角度和弧度之间转换"></a>1.14 在角度和弧度之间转换</h4><ul><li>将角度转换为弧度</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> radians = degrees * (<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br></pre></td></tr></table></figure><ul><li>将弧度转化为角度</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> degrees = radians * (<span class="number">180</span> / <span class="built_in">Math</span>.PI);</span><br></pre></td></tr></table></figure><h4 id="1-15-找到页面元素可容纳的一个圆的半径和圆心"><a href="#1-15-找到页面元素可容纳的一个圆的半径和圆心" class="headerlink" title="1.15 找到页面元素可容纳的一个圆的半径和圆心"></a>1.15 找到页面元素可容纳的一个圆的半径和圆心</h4><ul><li><a href="http://www.w3school.com.cn/jsref/jsref_min.asp" target="_blank" rel="noopener">Math.min(x,y)</a>方法可返回指定的数字中带有最低值的数字。</li><li>求出宽度和高度中较小的一个，用其除以2得到半径</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> circleRadius = <span class="built_in">Math</span>.min(elemengWidth, elemengHeight) / <span class="number">2</span>;</span><br></pre></td></tr></table></figure><ul><li>给指定页面元素的宽度、高度，通过将二者都除以2来找到其中心点</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = elemengWidth / <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> y = elemengHeight / <span class="number">2</span>;</span><br></pre></td></tr></table></figure><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/getComputedStyle" target="_blank" rel="noopener">Window.getComputedStyle()</a>方法给出应用活动样式表后的元素的所有CSS属性的值，并解析这些值可能包含的任何基本计算。</li><li><a href="http://www.zhangxinxu.com/wordpress/2012/05/getcomputedstyle-js-getpropertyvalue-currentstyle/" target="_blank" rel="noopener">getComputedStyle()</a></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>将一个SVG圆放入到一个div元素中<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-id">#elem</span> &#123;</span></span><br><span class="line"><span class="undefined">width: 100%;</span></span><br><span class="line"><span class="undefined">height: 500px;</span></span><br><span class="line"><span class="css"><span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#ddd</span>;</span></span><br><span class="line"><span class="css"><span class="selector-tag">background-color</span>: <span class="selector-id">#ddd</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"elem"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">height</span>=<span class="string">"100%"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">circle</span> <span class="attr">id</span>=<span class="string">"circ"</span> <span class="attr">width</span>=<span class="string">"10"</span> <span class="attr">height</span>=<span class="string">"10"</span> <span class="attr">r</span>=<span class="string">"10"</span> <span class="attr">fill</span>=<span class="string">"#f90"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.onload = <span class="built_in">window</span>.onresize = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> box = <span class="built_in">document</span>.getElementById(<span class="string">"elem"</span>);</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> style = <span class="built_in">window</span>.getComputedStyle(box, <span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> width = <span class="built_in">parseInt</span>(style.getPropertyValue(<span class="string">"width"</span>));</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> height = <span class="built_in">parseInt</span>(style.getPropertyValue(<span class="string">"height"</span>));</span></span><br><span class="line"><span class="javascript"><span class="built_in">console</span>.log(<span class="string">'w'</span>, width, <span class="string">'h'</span>, height);</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> x = width / <span class="number">2</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> y = height / <span class="number">2</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> circleRadius = <span class="built_in">Math</span>.min(width, height) / <span class="number">2</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> circ = <span class="built_in">document</span>.getElementById(<span class="string">"circ"</span>);</span></span><br><span class="line"><span class="javascript">circ.setAttribute(<span class="string">"r"</span>, circleRadius);</span></span><br><span class="line"><span class="javascript">circ.setAttribute(<span class="string">"cx"</span>, x);</span></span><br><span class="line"><span class="javascript">circ.setAttribute(<span class="string">"cy"</span>, y);</span></span><br><span class="line"><span class="javascript"><span class="built_in">console</span>.log(<span class="string">'r'</span>, circleRadius, <span class="string">' cx'</span>, x, <span class="string">' cy'</span>, y);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="1-16-计算圆弧的长度"><a href="#1-16-计算圆弧的长度" class="headerlink" title="1.16 计算圆弧的长度"></a>1.16 计算圆弧的长度</h4><ul><li>给定了一个圆的半径及圆弧角的角度值，求该圆弧的长度</li><li>使用<code>Math.PI</code>把角度转换为弧度，并在公式中使用该结果来求得圆弧的长度</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> radians = degrees * (<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="keyword">var</span> arclength = radians * radians;</span><br></pre></td></tr></table></figure><blockquote><p>待续~</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> JavaScript经典实例 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jQuery工具函数操作DOM</title>
      <link href="/2017/05/21/practice-jquery-dom/"/>
      <url>/2017/05/21/practice-jquery-dom/</url>
      
        <content type="html"><![CDATA[<blockquote><p>jQuery 实战》（第三版）第九章学习总结</p></blockquote><a id="more"></a><h2 id="过滤数组"><a href="#过滤数组" class="headerlink" title="过滤数组"></a>过滤数组</h2><p><strong><code>$.grep(array,callback[,invert])</code></strong></p><ul><li>invert 为 true,则回调函数的值是 false，导致值被收集；</li><li>invert 为 false,则回调函数的值是 true，导致值数据收集；</li><li>初始元素不变；</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> originalArray = [<span class="number">0</span>, <span class="number">34</span>, <span class="number">32</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">23</span>, <span class="number">3214</span>, <span class="number">342</span>, <span class="number">1</span>, <span class="number">43</span>, <span class="number">56</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">75</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bigNum1 = $.grep(</span><br><span class="line">  originalArray,</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value &gt; <span class="number">10</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bigNum2 = $.grep(</span><br><span class="line">  originalArray,</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value &gt; <span class="number">10</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">true</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"bigNum1"</span>, bigNum1);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"bigNum2"</span>, bigNum2);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"originalArray"</span>, originalArray);</span><br></pre></td></tr></table></figure><p><img src="http://img1.sycdn.imooc.com/5920f0b40001e7ed06950175.png" alt="console"></p><h2 id="转换数组"><a href="#转换数组" class="headerlink" title="转换数组"></a>转换数组</h2><p><strong><code>$.map(collection, callback)</code></strong></p><ul><li><code>collection[Array | Object]</code></li><li><code>callback(Function)</code> 接受两个参数：当前值和初始数组值的索引；如果传递的是对象，则第二个参数是属性的当前值；</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> oneBased = $.map([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">4</span>], <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> value + <span class="number">1</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"oneBased"</span>, oneBased);</span><br><span class="line"></span><br><span class="line"><span class="comment">//将收集到的保存字符串的数组提取里面的数值，如若是，则提取，如若不是，则忽略；</span></span><br><span class="line"><span class="keyword">var</span> strings = [<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"4"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> values1 = $.map(strings, <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = <span class="keyword">new</span> <span class="built_in">Number</span>(value);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">isNaN</span>(result) ? <span class="literal">null</span> : result;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> values2 = $.map(strings, <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">isNaN</span>(value) ? <span class="literal">null</span> : value;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"values1"</span>, values1);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"values2"</span>, values2);</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理从转换函数里返回的数组，并存入结果数组中</span></span><br><span class="line"><span class="keyword">var</span> characters = $.map([<span class="string">"hello"</span>, <span class="string">"world"</span>], <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> value.split(<span class="string">""</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"characters"</span>, characters);</span><br></pre></td></tr></table></figure><p><img src="http://img1.sycdn.imooc.com/5920f7710001ee9706960181.png" alt="console2"></p><p><strong><code>$.inArray</code></strong></p><ul><li><code>$.inArray(value, array[, fromIndex])</code>确定一个数组是否包含某个特定的值，或者位置</li><li><code>fromIndex(Number)</code> 数组中开始查询的位置；默认 0</li><li>返回数组中第一个出现值得位置索引，没有返回-1</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> index1 = $.inArray(<span class="number">2</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"><span class="keyword">var</span> index2 = $.inArray(<span class="number">3</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"index1"</span>, index1); <span class="comment">//index 1</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"index2"</span>, index2); <span class="comment">//index -1(未找到)</span></span><br></pre></td></tr></table></figure><p><strong><code>$.makeArray(object)</code></strong> – 把类数组对象转换为 JavaScript 数组</p><p><strong><code>$.merge(array1, array2)</code></strong> – 合并两个数组，并将第一个数组被修改后作为结果返回</p><h2 id="扩展对象"><a href="#扩展对象" class="headerlink" title="扩展对象"></a>扩展对象</h2><p><strong><code>$.extend([deep,] target, [source1, source2,...,sourceN])</code></strong></p><ul><li>通过传递的对象属性来扩展 target 对象；扩展后的对象可作为返回值</li><li><code>deep(Boolean)</code> 忽略或者为 false，使用浅拷贝扩展；true，则使用深拷贝扩展</li><li><code>target(Object)</code> 使用源元素属性来扩展目标对象</li><li><code>source1...(Object)</code> 一个或者多个对象,属性会添加到 target 目标对象中</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$.extend()函数合并了多个源对象的属性不包含重复值，而且按照顺序排序</span></span><br><span class="line"><span class="keyword">var</span> target = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> source1 = &#123; <span class="attr">c</span>: <span class="number">4</span>, <span class="attr">d</span>: <span class="number">5</span>, <span class="attr">e</span>: <span class="number">6</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> source2 = &#123; <span class="attr">c</span>: <span class="number">8</span>, <span class="attr">e</span>: <span class="number">10</span>, <span class="attr">f</span>: <span class="number">9</span> &#125;;</span><br><span class="line"></span><br><span class="line">$.extend(target, source1, source2);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"target(after)"</span>, target);</span><br><span class="line"></span><br><span class="line"><span class="comment">//传递空对象作为目标</span></span><br><span class="line"><span class="keyword">var</span> newObject = $.extend(&#123;&#125;, source1, source2);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"newObject"</span>, newObject);</span><br><span class="line"></span><br><span class="line"><span class="comment">//深拷贝</span></span><br><span class="line"><span class="keyword">var</span> target1 = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> source11 = &#123; <span class="attr">b</span>: &#123; <span class="attr">foo</span>: <span class="string">"bar"</span> &#125;, <span class="attr">c</span>: <span class="number">3</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> source22 = &#123; <span class="attr">b</span>: &#123; <span class="attr">oof</span>: <span class="string">"rab"</span> &#125;, <span class="attr">d</span>: <span class="number">4</span> &#125;;</span><br><span class="line"></span><br><span class="line">$.extend(<span class="literal">true</span>, target1, source11, source22);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"target1"</span>, target1);</span><br></pre></td></tr></table></figure><p><img src="http://img1.sycdn.imooc.com/59217be70001859607000553.png" alt="console"></p><h2 id="序列化参数"><a href="#序列化参数" class="headerlink" title="序列化参数"></a>序列化参数</h2><p><strong><code>$.param(params[, traditional])</code></strong></p><ul><li>序列化为适当的字符串传递信息，便于为查询字符串提交请求</li><li><code>params(Array|jQuery|Object)</code></li><li><code>traditional(Boolean)</code> 是否执行传统的影子序列化</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">lable</span> <span class="attr">for</span>=<span class="string">"name"</span>&gt;</span>Name:<span class="tag">&lt;/<span class="name">lable</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"name"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"YangTao"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">lable</span> <span class="attr">for</span>=<span class="string">"surname"</span>&gt;</span>Surname:<span class="tag">&lt;/<span class="name">lable</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"surname"</span> <span class="attr">name</span>=<span class="string">"surname"</span> <span class="attr">value</span>=<span class="string">"Bluth"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">lable</span> <span class="attr">for</span>=<span class="string">"address"</span>&gt;</span>Address:<span class="tag">&lt;/<span class="name">lable</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"address"</span> <span class="attr">name</span>=<span class="string">"address"</span> <span class="attr">value</span>=<span class="string">"Fake street 1, Beijing, China"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> formResult = $.param($(<span class="string">"input"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"formResult"</span>, formResult);</span><br></pre></td></tr></table></figure><p><img src="http://img1.sycdn.imooc.com/592180f500018e7007010100.png" alt="console"></p><h2 id="测试对象"><a href="#测试对象" class="headerlink" title="测试对象"></a>测试对象</h2><ul><li><strong><code>$.isArray(param)</code></strong> param 是 JavaScript 数组，返回 true,否则返回 false</li><li><strong><code>$.isFunction(param)</code></strong> param 是函数，返回 true，否则返回 false</li><li><strong><code>$.isNumeric(param)</code></strong> param 是数值，返回 true，否则返回 false</li><li><strong><code>$.isWindow(param)</code></strong> param 表示 window 对象，返回 true，否则返回 false</li><li><strong><code>$.isEmptyObject(param)</code></strong> param 是 JavaScript 对象，不包含属性，返回 true，否则返回 false</li><li><strong><code>$.isPlainObject(param)</code></strong> param 表示用 <code>via{}</code> 或者 <code>new Object()</code>创建的 JavaScript 对象，返回 true，否则返回 false</li><li><strong><code>$.isXMLDoc(param)</code></strong> param 表示 XML 文档或 XML 节点，返回 true，否则返回 false</li></ul><h2 id="查看值的类型"><a href="#查看值的类型" class="headerlink" title="查看值的类型"></a>查看值的类型</h2><ul><li><strong><code>$.type(param)</code></strong></li></ul><h2 id="解析函数"><a href="#解析函数" class="headerlink" title="解析函数"></a>解析函数</h2><ul><li><strong><code>$.paramJSON(json)</code></strong></li><li><strong><code>$.paramXML(xml)</code></strong></li><li><strong><code>$.paramHTML(html[,context][,keepScripts])</code></strong></li></ul><h2 id="测试包含"><a href="#测试包含" class="headerlink" title="测试包含"></a>测试包含</h2><ul><li><strong><code>$.contains(container, contained)</code></strong> 测试元素是否包含在 DOM 层的另一个元素中</li></ul>]]></content>
      
      
      <categories>
          
          <category> 工具库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jQuery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>embed嵌入多个优酷视频并自动播放</title>
      <link href="/2017/01/22/practice-video-embed/"/>
      <url>/2017/01/22/practice-video-embed/</url>
      
        <content type="html"><![CDATA[<blockquote><p>整理入坑学习记录</p></blockquote><a id="more"></a><h2 id="关于-embed-标签"><a href="#关于-embed-标签" class="headerlink" title="关于 embed 标签"></a>关于 embed 标签</h2><p>特点：</p><ul><li>多个视频选择；</li><li>弹出模态框，不能上下滑动；</li><li>视频自带可全屏；</li><li>视频自动播放；</li><li>兼容 IE，IE 会有播放残留，所以让其刷新页面；</li><li>其他浏览器：火狐，谷歌，edge，safari 等；</li></ul><p>首先，先看一下嵌入网页中优酷视频的完整代码（直接从优酷分享得到的 HTML 代码）：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>embed<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">embed</span> <span class="attr">src</span>=<span class="string">'http://player.youku.com/player.php/sid/XMjQ4MDg2MTc2MA==/v.swf'</span> <span class="attr">allowFullScreen</span>=<span class="string">'true'</span> <span class="attr">quality</span>=<span class="string">'high'</span> <span class="attr">width</span>=<span class="string">'480'</span> <span class="attr">height</span>=<span class="string">'400'</span> <span class="attr">align</span>=<span class="string">'middle'</span> <span class="attr">allowScriptAccess</span>=<span class="string">'always'</span> <span class="attr">type</span>=<span class="string">'application/x-shockwave-flash'</span>&gt;</span><span class="tag">&lt;/<span class="name">embed</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>代码中，<code>&lt;embed&gt;</code>的相关属性：</p><ul><li><code>src</code> — 指向资源；</li><li><code>quality=&#39;high&#39;</code> — 视频的默认清晰度，一般为 high;</li><li><code>width,height</code> — 视频的宽、高度；</li><li><code>align=&#39;middle&#39;</code> — 视频的位置；</li><li><code>allowFullScreen=&#39;true&#39;</code> — 是否运行全屏观看，默认 true;</li><li><code>type=&#39;application/x-shockwave-flash&#39;</code> — 各个浏览器支持情况；</li><li><code>allowScriptAccess=&#39;always&#39;</code> — 特殊属性，用于确保 Flash 影片可能特定于某个版本的 Flash；</li></ul><p>常用的基本属性就这些了，不过，这个嵌入的视频，默认是不自动播放，下面来看看自动播放的设置代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>embed<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">embed</span> <span class="attr">src</span>=<span class="string">'http://player.youku.com/player.php/sid/XMjQ4MDg2MTc2MA==/v.swf?VideoIDS=XMjQ4MDg2MTc2MA==&amp;isAutoPlay=true&amp;isShowRelatedVideo=false&amp;showAd=0'</span> <span class="attr">allowFullScreen</span>=<span class="string">'true'</span> <span class="attr">quality</span>=<span class="string">'high'</span> <span class="attr">width</span>=<span class="string">'480'</span> <span class="attr">height</span>=<span class="string">'400'</span> <span class="attr">align</span>=<span class="string">'middle'</span> <span class="attr">allowScriptAccess</span>=<span class="string">'always'</span> <span class="attr">type</span>=<span class="string">'application/x-shockwave-flash'</span>&gt;</span><span class="tag">&lt;/<span class="name">embed</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这些属性一看就明白：</p><ul><li><code>isAutoPlay=true</code> — 是否自动播放；</li><li><code>isShowRelatedVideo=false</code> — 是否展示相关视频；</li></ul><p>好了，embed 的常用属性介绍完毕，接下来咱们一起看看如何跟换视频的链接：</p><h3 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h3><p>由于是多个视频展示，所以复制多个 data-item 值：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"videoList"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-item</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">name</span>=<span class="string">"video01"</span>&gt;</span>视频01<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>视频简介<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>视频描述视频描述视频描述<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-item</span>=<span class="string">"2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">name</span>=<span class="string">"video02"</span>&gt;</span>视频02<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>视频简介<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>视频描述视频描述视频描述<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-item</span>=<span class="string">"3"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">name</span>=<span class="string">"video03"</span>&gt;</span>视频03<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>视频简介<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>视频描述视频描述视频描述<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-item</span>=<span class="string">"4"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">name</span>=<span class="string">"video04"</span>&gt;</span>视频04<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>视频简介<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>视频描述视频描述视频描述<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h3><p>模态框设置，并且设置视频关闭按钮，（这里没有直接将 embed 的内容写入在页面上，防止有些浏览器直接跳过 js 代码）</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--遮罩层--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"mask"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--视频区--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"videoModal"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"closeBtn"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>x<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h3><p>使用 jquery 获取到点击事件，并判断是否是需要点击的对象：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> embedEle;</span><br><span class="line"><span class="keyword">var</span> videoID = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">var</span> videoSrc;</span><br><span class="line"><span class="keyword">var</span> videoModal = $(<span class="string">"#videoModal"</span>);</span><br><span class="line"><span class="keyword">var</span> $targetEle = $(<span class="string">"#videoList"</span>).find(<span class="string">"li"</span>);</span><br><span class="line"><span class="comment">//点击视频，判断是否是button，排除其他内容</span></span><br><span class="line">$targetEle.click(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> dataItem = $(<span class="keyword">this</span>).attr(<span class="string">"data-item"</span>);</span><br><span class="line">  <span class="keyword">var</span> $para1 = $(<span class="keyword">this</span>).find(<span class="string">"p"</span>)[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">var</span> $para2 = $(<span class="keyword">this</span>).find(<span class="string">"p"</span>)[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">if</span> (e.target == $para1 || e.target == $para2) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    videoID = isWhichSrc(dataItem);</span><br><span class="line">    videoFunc(videoID);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>根据<code>data-item</code>的值，获取点击的<code>data-item</code>，并执行<code>isWhichSrc(num)</code>函数,并将获取到的视频链接赋值给<code>videoID = isWhichSrc(dataItem);</code>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据得到的data-item值判断相对应的视频ID</span></span><br><span class="line"><span class="keyword">var</span> isWhichSrc = <span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (num == <span class="number">1</span>) &#123;</span><br><span class="line">    videoID = <span class="string">"XMjQ4MDg2MTc2MA"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (num == <span class="number">2</span>) &#123;</span><br><span class="line">    videoID = <span class="string">"XMTY0OTYzNTU0NA"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (num == <span class="number">3</span>) &#123;</span><br><span class="line">    videoID = <span class="string">"XMTQyMDExNjA4NA"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (num == <span class="number">4</span>) &#123;</span><br><span class="line">    videoID = <span class="string">"XMTc2MDAxOTIwOA"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> videoID;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>然后将此值传入给<code>videoFunc(videoid)</code>；该函数中，创建<code>embed</code>并添加到页面上：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据视频ID赋值视频链接</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">videoFunc</span>(<span class="params">videoid</span>) </span>&#123;</span><br><span class="line">  videoSrc =</span><br><span class="line">    <span class="string">"http://player.youku.com/player.php/sid/"</span> +</span><br><span class="line">    videoid +</span><br><span class="line">    <span class="string">"==/v.swf?VideoIDS="</span> +</span><br><span class="line">    videoid +</span><br><span class="line">    <span class="string">"==&amp;isAutoPlay=true&amp;isShowRelatedVideo=false&amp;showAd=0"</span>;</span><br><span class="line"></span><br><span class="line">  embedEle =</span><br><span class="line">    <span class="string">"&lt;embed src='"</span> +</span><br><span class="line">    videoSrc +</span><br><span class="line">    <span class="string">"' allowFullScreen='true' quality='high' width='610' height='460' align='middle' allowScriptAccess='always' type='application/x-shockwave-flash'&gt;&lt;/embed&gt;"</span>;</span><br><span class="line">  <span class="comment">//将获得的embed标签添加进去</span></span><br><span class="line">  videoModal.append(embedEle);</span><br><span class="line">  $(<span class="string">"#videoModal"</span>).slideDown(<span class="number">600</span>);</span><br><span class="line">  showMask();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后就是关于遮罩层的函数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showMask</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $(<span class="string">"body"</span>).css(<span class="string">"overflow"</span>, <span class="string">"hidden"</span>);</span><br><span class="line">  $(<span class="string">"#mask"</span>)</span><br><span class="line">    .css(&#123; <span class="attr">height</span>: $(<span class="built_in">document</span>).height(), <span class="attr">width</span>: $(<span class="built_in">document</span>).width() &#125;)</span><br><span class="line">    .slideDown(<span class="number">600</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hideMask</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $(<span class="string">"#mask"</span>).slideUp(<span class="number">600</span>);</span><br><span class="line">  bodyShow();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bodyShow</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $(<span class="string">"body"</span>).css(<span class="string">"overflow"</span>, <span class="string">"auto"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="完整栗子"><a href="#完整栗子" class="headerlink" title="完整栗子"></a>完整栗子</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>youku-video-embed<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">    <span class="attr">type</span>=<span class="string">"text/javascript"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">"http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"</span></span></span><br><span class="line"><span class="tag">  &gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    * &#123;</span></span><br><span class="line"><span class="undefined">      margin: 0;</span></span><br><span class="line"><span class="undefined">      padding: 0;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="comment">/*遮罩层*/</span></span></span><br><span class="line"><span class="css">    <span class="selector-id">#mask</span> &#123;</span></span><br><span class="line"><span class="undefined">      position: fixed;</span></span><br><span class="line"><span class="undefined">      top: 0;</span></span><br><span class="line"><span class="undefined">      left: 0;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">opacity</span>: 0<span class="selector-class">.8</span>;</span></span><br><span class="line"><span class="undefined">      filter: alpha(opacity=80);</span></span><br><span class="line"><span class="css">      <span class="selector-tag">background-color</span>: <span class="selector-id">#000</span>;</span></span><br><span class="line"><span class="undefined">      z-index: 99;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="comment">/*视频*/</span></span></span><br><span class="line"><span class="css">    <span class="selector-id">#closeBtn</span> &#123;</span></span><br><span class="line"><span class="undefined">      float: right;</span></span><br><span class="line"><span class="undefined">      padding-right: 5px;</span></span><br><span class="line"><span class="undefined">      width: 14px;</span></span><br><span class="line"><span class="undefined">      height: 20px;</span></span><br><span class="line"><span class="undefined">      line-height: 20px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-id">#closeBtn</span> <span class="selector-tag">a</span> &#123;</span></span><br><span class="line"><span class="undefined">      font-size: 18px;</span></span><br><span class="line"><span class="undefined">      font-weight: bold;</span></span><br><span class="line"><span class="undefined">      cursor: pointer;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">color</span>: <span class="selector-id">#666</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-id">#closeBtn</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line"><span class="undefined">      text-decoration: none;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-id">#videoModal</span> &#123;</span></span><br><span class="line"><span class="undefined">      display: none;</span></span><br><span class="line"><span class="undefined">      position: fixed;</span></span><br><span class="line"><span class="undefined">      top: 10%;</span></span><br><span class="line"><span class="undefined">      left: 50%;</span></span><br><span class="line"><span class="undefined">      margin-left: -305px;</span></span><br><span class="line"><span class="undefined">      width: 610px;</span></span><br><span class="line"><span class="undefined">      height: 480px;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">background-color</span>: <span class="selector-id">#000</span>;</span></span><br><span class="line"><span class="undefined">      z-index: 100;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="comment">/*按钮*/</span></span></span><br><span class="line"><span class="css">    <span class="selector-class">.wrapper</span> &#123;</span></span><br><span class="line"><span class="undefined">      margin: 0 auto;</span></span><br><span class="line"><span class="undefined">      width: 100%;</span></span><br><span class="line"><span class="undefined">      max-width: 1140px;</span></span><br><span class="line"><span class="undefined">      text-align: center;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    h3 &#123;</span></span><br><span class="line"><span class="undefined">      margin-top: 20px;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">color</span>: <span class="selector-id">#b403b7</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    ul &#123;</span></span><br><span class="line"><span class="undefined">      overflow: hidden;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    ul li &#123;</span></span><br><span class="line"><span class="undefined">      float: left;</span></span><br><span class="line"><span class="undefined">      list-style-type: none;</span></span><br><span class="line"><span class="undefined">      margin: 10px 20px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    p &#123;</span></span><br><span class="line"><span class="undefined">      font-size: 14px;</span></span><br><span class="line"><span class="undefined">      font-family: "微软雅黑";</span></span><br><span class="line"><span class="css">      <span class="selector-tag">color</span>: <span class="selector-id">#999</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.wrapper</span> <span class="selector-tag">button</span> &#123;</span></span><br><span class="line"><span class="undefined">      margin-top: 50px;</span></span><br><span class="line"><span class="undefined">      width: 200px;</span></span><br><span class="line"><span class="undefined">      height: 200px;</span></span><br><span class="line"><span class="undefined">      cursor: pointer;</span></span><br><span class="line"><span class="undefined">      border-radius: 8px;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">color</span>: <span class="selector-id">#666</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.wrapper</span> <span class="selector-tag">button</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">opacity</span>: 0<span class="selector-class">.8</span>;</span></span><br><span class="line"><span class="undefined">      filter: alpha(opacity=80);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--遮罩层--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"mask"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--视频区--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"videoModal"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"closeBtn"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>x<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--按钮--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>embed链接优酷视频自动播放<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"videoList"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-item</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">name</span>=<span class="string">"video01"</span>&gt;</span>视频01<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>视频简介<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>视频描述视频描述视频描述<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-item</span>=<span class="string">"2"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">name</span>=<span class="string">"video02"</span>&gt;</span>视频02<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>视频简介<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>视频描述视频描述视频描述<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-item</span>=<span class="string">"3"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">name</span>=<span class="string">"video03"</span>&gt;</span>视频03<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>视频简介<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>视频描述视频描述视频描述<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-item</span>=<span class="string">"4"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">name</span>=<span class="string">"video04"</span>&gt;</span>视频04<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>视频简介<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>视频描述视频描述视频描述<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--js--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> embedEle;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> videoID = <span class="string">""</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> videoSrc;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> videoModal = $(<span class="string">"#videoModal"</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> $targetEle = $(<span class="string">"#videoList"</span>).find(<span class="string">"li"</span>);</span></span><br><span class="line"><span class="javascript">      <span class="comment">//点击视频，判断是否是button，排除其他内容</span></span></span><br><span class="line"><span class="javascript">      $targetEle.click(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> dataItem = $(<span class="keyword">this</span>).attr(<span class="string">"data-item"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> $para1 = $(<span class="keyword">this</span>).find(<span class="string">"p"</span>)[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> $para2 = $(<span class="keyword">this</span>).find(<span class="string">"p"</span>)[<span class="number">1</span>];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (e.target == $para1 || e.target == $para2) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="undefined">          videoID = isWhichSrc(dataItem);</span></span><br><span class="line"><span class="undefined">          videoFunc(videoID);</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;);</span></span><br><span class="line"><span class="javascript">      <span class="comment">//关闭</span></span></span><br><span class="line"><span class="javascript">      $(<span class="string">"#closeBtn"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">        videoModal</span></span><br><span class="line"><span class="undefined">          .slideUp(600)</span></span><br><span class="line"><span class="javascript">          .find(<span class="string">"embed"</span>)</span></span><br><span class="line"><span class="undefined">          .remove();</span></span><br><span class="line"><span class="javascript">        <span class="comment">//兼容IE，让其刷新页面，对其他浏览器无效</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.execCommand(<span class="string">"Refresh"</span>);</span></span><br><span class="line"><span class="undefined">        hideMask();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="undefined">      &#125;);</span></span><br><span class="line"><span class="javascript">      <span class="comment">//根据得到的data-item值判断相对应的视频ID</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> isWhichSrc = <span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (num == <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="javascript">          videoID = <span class="string">"XMjQ4MDg2MTc2MA"</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (num == <span class="number">2</span>) &#123;</span></span><br><span class="line"><span class="javascript">          videoID = <span class="string">"XMTY0OTYzNTU0NA"</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (num == <span class="number">3</span>) &#123;</span></span><br><span class="line"><span class="javascript">          videoID = <span class="string">"XMTQyMDExNjA4NA"</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (num == <span class="number">4</span>) &#123;</span></span><br><span class="line"><span class="javascript">          videoID = <span class="string">"XMTc2MDAxOTIwOA"</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> videoID;</span></span><br><span class="line"><span class="undefined">      &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="comment">//根据视频ID赋值视频链接</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">videoFunc</span>(<span class="params">videoid</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">        videoSrc =</span></span><br><span class="line"><span class="javascript">          <span class="string">"http://player.youku.com/player.php/sid/"</span> +</span></span><br><span class="line"><span class="undefined">          videoid +</span></span><br><span class="line"><span class="javascript">          <span class="string">"==/v.swf?VideoIDS="</span> +</span></span><br><span class="line"><span class="undefined">          videoid +</span></span><br><span class="line"><span class="javascript">          <span class="string">"==&amp;isAutoPlay=true&amp;isShowRelatedVideo=false&amp;showAd=0"</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        embedEle =</span></span><br><span class="line"><span class="javascript">          <span class="string">"&lt;embed src='"</span> +</span></span><br><span class="line"><span class="undefined">          videoSrc +</span></span><br><span class="line"><span class="javascript">          <span class="string">"' allowFullScreen='true' quality='high' width='610' height='460' align='middle' allowScriptAccess='always' type='application/x-shockwave-flash'&gt;&lt;/embed&gt;"</span>;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//将获得的embed标签添加进去</span></span></span><br><span class="line"><span class="undefined">        videoModal.append(embedEle);</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#videoModal"</span>).slideDown(<span class="number">600</span>);</span></span><br><span class="line"><span class="undefined">        showMask();</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="comment">//遮罩层部分</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">showMask</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"body"</span>).css(<span class="string">"overflow"</span>, <span class="string">"hidden"</span>);</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#mask"</span>)</span></span><br><span class="line"><span class="javascript">          .css(&#123; <span class="attr">height</span>: $(<span class="built_in">document</span>).height(), <span class="attr">width</span>: $(<span class="built_in">document</span>).width() &#125;)</span></span><br><span class="line"><span class="undefined">          .slideDown(600);</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">hideMask</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#mask"</span>).slideUp(<span class="number">600</span>);</span></span><br><span class="line"><span class="undefined">        bodyShow();</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">bodyShow</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"body"</span>).css(<span class="string">"overflow"</span>, <span class="string">"auto"</span>);</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Html </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Html </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初识JavaScript的解析与执行过程</title>
      <link href="/2016/09/16/practice-compiler/"/>
      <url>/2016/09/16/practice-compiler/</url>
      
        <content type="html"><![CDATA[<blockquote><p>整理入坑学习记录</p></blockquote><a id="more"></a><h2 id="全局预处理"><a href="#全局预处理" class="headerlink" title="全局预处理"></a>全局预处理</h2><p>先扫描函数声明，再扫描变量声明：</p><ul><li>函数：用声明的方式创建的函数；</li><li>变量：用 var 定义的变量；初始化为 undefined；</li></ul><p>如果出现<em>命名冲突</em> 时：</p><ul><li>函数声明：覆盖；</li><li>变量声明：忽略；</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">f(); <span class="comment">//fff</span></span><br><span class="line">g(); <span class="comment">//TypeError: g is not a function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"fff"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> g = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"ggg"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>f()函数是声明方式创建的函数，g()是函数表达式，全局预处理时词法环境中，只能是用声明的方式创建的函数。</p><p>因此，全局预处理时 g()从语义上看，应该是函数，但是由于 g()是函数表达式，不会在词法环境中，所以调用时会报错。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">//ReferenceError: b is not defined</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">b = <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>同理，词法环境中只有用 var 定义的变量。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">alert(f); <span class="comment">//function f()&#123;alert('567');&#125;</span></span><br><span class="line"><span class="keyword">var</span> f = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  alert(<span class="string">"123"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> f = <span class="number">2</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  alert(<span class="string">"567"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  alert(<span class="string">"890"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>命名冲突时，函数具有“优先权”，变量会直接被忽略，而函数会被覆盖。</p><h2 id="全局执行过程"><a href="#全局执行过程" class="headerlink" title="全局执行过程"></a>全局执行过程</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">alert(a); <span class="comment">//undefined</span></span><br><span class="line">alert(b); <span class="comment">//ReferenceError: b is not defined</span></span><br><span class="line">alert(f); <span class="comment">//function f() &#123;console.log('f');&#125;</span></span><br><span class="line">alert(g); <span class="comment">//undefined</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">b = <span class="number">2</span>;</span><br><span class="line">alert(b); <span class="comment">//2</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"f"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> g = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"g"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">alert(g); <span class="comment">//function () &#123;console.log('g');&#125;</span></span><br></pre></td></tr></table></figure><p>为了分析方便我们可以使用词法环境：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LexicalEnvironment &#123;&#125; === <span class="built_in">window</span>；</span><br></pre></td></tr></table></figure><p>全局预处理时：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span> &#123;</span><br><span class="line">    <span class="comment">//先扫描函数声明：</span></span><br><span class="line">    f: 指向函数,</span><br><span class="line">    <span class="comment">//再扫面变量声明：</span></span><br><span class="line">    a: <span class="literal">undefined</span>,</span><br><span class="line">    g: <span class="literal">undefined</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>全局执行时：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span> &#123;</span><br><span class="line">    f: 指向函数,</span><br><span class="line">    a: <span class="number">1</span>,</span><br><span class="line">    b: <span class="number">2</span>,</span><br><span class="line">    g: 指向函数</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="函数预处理阶段"><a href="#函数预处理阶段" class="headerlink" title="函数预处理阶段"></a>函数预处理阶段</h2><ul><li>每调用一次，产生一个词法环境（或执行上下文<code>Execution Context</code>）；</li><li>先传入函数的参数，若参数值为空，初始化<code>undefined</code>；</li><li>然后是内部函数声明，若发生命名冲突，会覆盖；</li><li>接着就是内部<code>var</code>变量声明，若发生命名冲突，会忽略；</li></ul><h2 id="函数执行阶段"><a href="#函数执行阶段" class="headerlink" title="函数执行阶段"></a>函数执行阶段</h2><ul><li>给预处理阶段的成员赋值；</li><li>无 var 声明的变量，会成为全局成员；</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  alert(a); <span class="comment">//1</span></span><br><span class="line">  alert(b); <span class="comment">//funciton b()&#123;&#125;</span></span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">100</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">f(<span class="number">1</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure><p><code>VO（Variable Object）</code>——&gt; 变量对象</p><p>函数中的激活对象：<code>VO（functionContext）=== AO;</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">AO(f) &#123;</span><br><span class="line">    a: <span class="number">1</span>,                   <span class="comment">//变量命名冲突，忽略</span></span><br><span class="line">    b: 指向函数,            <span class="comment">//函数命名冲突，覆盖</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  alert(a); <span class="comment">//10</span></span><br><span class="line">  alert(b); <span class="comment">//undefined</span></span><br><span class="line">  alert(c); <span class="comment">//undefined</span></span><br><span class="line">  alert(d); <span class="comment">//function d()&#123;&#125;</span></span><br><span class="line">  alert(e); <span class="comment">//undefined</span></span><br><span class="line">  <span class="comment">//alert(x);     //ReferenceError: x is not defined</span></span><br><span class="line">  <span class="keyword">var</span> c = <span class="number">10</span>;</span><br><span class="line">  alert(c); <span class="comment">//10</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">d</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">  <span class="keyword">var</span> e = <span class="function"><span class="keyword">function</span> <span class="title">_e</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">  alert(e); <span class="comment">//function _e()&#123;&#125;</span></span><br><span class="line">  (<span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"></span>) </span>&#123;&#125;);</span><br><span class="line">  b = <span class="number">20</span>;</span><br><span class="line">  alert(b); <span class="comment">//20</span></span><br><span class="line">&#125;</span><br><span class="line">test(<span class="number">10</span>);</span><br></pre></td></tr></table></figure><p>函数预处理时：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">AO（test） &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//参数：</span></span><br><span class="line">    a: <span class="number">10</span>,</span><br><span class="line">    b: <span class="literal">undefined</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//函数声明：</span></span><br><span class="line">    d: 指向函数，</span><br><span class="line"></span><br><span class="line">    <span class="comment">//变量声明：</span></span><br><span class="line">    c: <span class="literal">undefined</span>,</span><br><span class="line">    e: <span class="literal">undefined</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>函数执行时：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">AO（test） &#123;</span><br><span class="line">    a: <span class="number">10</span>,</span><br><span class="line">    b: <span class="number">20</span>,</span><br><span class="line">    d: 指向函数，</span><br><span class="line">    c: <span class="number">10</span>,</span><br><span class="line">    e: 指向函数</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初识JavaScript的对象属性类型</title>
      <link href="/2016/09/14/practice-object-attribute/"/>
      <url>/2016/09/14/practice-object-attribute/</url>
      
        <content type="html"><![CDATA[<blockquote><p>整理入坑学习记录</p></blockquote><a id="more"></a><h2 id="何为对象"><a href="#何为对象" class="headerlink" title="何为对象"></a>何为对象</h2><p>简单点说，对象包含属性或方法，而对象的每个属性或方法都有一个名字，这个名字又都映射到一个值。</p><p>所以，对象就是一组名值对（键值对），其中值可以是数据或函数。</p><p>每个对象都是基于一个引用类型创建的，这个引用类型可以是原生类型，也可以是自定义类型。</p><h2 id="创建自定义对象"><a href="#创建自定义对象" class="headerlink" title="创建自定义对象"></a>创建自定义对象</h2><p>创建一个 Object 的实例：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">varperson = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">person.name = <span class="string">"Bob"</span>;</span><br><span class="line">person.age = <span class="number">24</span>;</span><br><span class="line">person.job = <span class="string">"Teacher"</span>;</span><br><span class="line"></span><br><span class="line">person.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  alert(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>用对象字面量重新创建对象：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">  name: <span class="string">"Bob"</span>,</span><br><span class="line">  age: <span class="number">24</span>,</span><br><span class="line">  job: <span class="string">"Teacher"</span>,</span><br><span class="line"></span><br><span class="line">  sayName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="keyword">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>用两种方式创建的 person 对象都有相同的属性和方法。</p></blockquote><h2 id="属性类型"><a href="#属性类型" class="headerlink" title="属性类型"></a>属性类型</h2><p>属性类型分为数据属性和访问器属性。</p><p>数据属性有 4 个特性：</p><ul><li><code>[[Configurable]]</code></li><li><code>[[Enumerable]]</code></li><li><code>[[Writable]]</code></li><li><code>[[Value]]</code></li></ul><p>访问器属性也有 4 个特性，不包含数据值，包含一对儿 <code>getter</code> 和 <code>setter</code> 函数：</p><ul><li><p><code>[[Configurable]]</code></p></li><li><p><code>[[Enumerable]]</code></p></li><li><p><code>[[Get]]</code></p></li><li><p><code>[[Set]]</code></p></li></ul><p>修改属性默认的特性<code>Object.defineProperty()</code>方法，接受三个参数：</p><ol><li>属性所在的对象；</li><li>属性的名字；</li><li>一个描述符对象；</li></ol><p>数据属性例子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;&#125;；</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(person, <span class="string">"name"</span>, &#123;</span><br><span class="line">    writeable: <span class="literal">false</span>,</span><br><span class="line">    configurable: <span class="literal">false</span>,</span><br><span class="line">    value: <span class="string">"Bob"</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">alert(person.name);           <span class="comment">//"Bob"</span></span><br><span class="line">person.name = <span class="string">"Mike"</span>;</span><br><span class="line">alert(person.name);            <span class="comment">//"Bob"</span></span><br></pre></td></tr></table></figure><p>例子中创建了一个名为 name 的属性，由于 writable 设置为 false,name 的值是“只读”的，不可修改；</p><p>把 configurable 设置为 false，表示不能从对象中删除（delete）属性，而且，一旦把属性定义为不可配置的，再次调用 <code>Object.defineProperty()</code>方法修改 writable 之外的特性，会导致错误。</p><p>在调用<code>Object.defineProperty()</code>方法时，如果不指定，<code>configurable、 enumerable、 writable</code>特性的默认值都是<code>false</code>;</p><p>如果不调用<code>Object.defineProperty()</code>方法时，即直接在对象上定义的属性，他们的<code>configurable enumerable writable</code>特性的默认值都是<code>true</code>，<code>value</code>特性为指定的值（默认值为<code>undefined</code>）；</p><p>getter setter 方法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">  name: <span class="string">"Bob"</span>,</span><br><span class="line">  job: <span class="string">"Teacher"</span>,</span><br><span class="line"></span><br><span class="line">  get age() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear() - <span class="number">1992</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  set age(val) &#123;</span><br><span class="line">    alert(<span class="string">"Age can't be set to "</span> + val);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">alert(person.age); <span class="comment">//24</span></span><br><span class="line">person.age = <span class="number">100</span>; <span class="comment">//Age can't be set to 100</span></span><br><span class="line">alert(person.age); <span class="comment">//still 24</span></span><br></pre></td></tr></table></figure><p>以上代码创建了一个 person 对象，并定义了两个默认的属性：name 和 job,而且包含有一个 getter 函数和一个 setter 函数。</p><ul><li>getter 函数返回 age 的值；</li><li>setter 函数返回设置 age 的值 val；</li></ul><p>定义多个属性：<code>Object.defineProperties()</code>方法，接受两个对象参数：</p><ol><li>第一个对象是要添加和修改其属性的对象；</li><li>第二个对象的属性与第一个对象中药添加或修改的属性一一对应。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> book = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperties(book, &#123;</span><br><span class="line">  _year: &#123;</span><br><span class="line">    writable: <span class="literal">true</span>,</span><br><span class="line">    value: <span class="number">2016</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  edition: &#123;</span><br><span class="line">    writable: <span class="literal">true</span>,</span><br><span class="line">    value: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  year: &#123;</span><br><span class="line">    get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>._year;</span><br><span class="line">    &#125;,</span><br><span class="line">    set: <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (val &gt; <span class="number">2016</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>._year = val;</span><br><span class="line">        <span class="keyword">this</span>.edition += val - <span class="number">2016</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(book.year); <span class="comment">//2016</span></span><br><span class="line"><span class="built_in">console</span>.log(book.edition); <span class="comment">//1</span></span><br><span class="line">book.year = <span class="number">2018</span>;</span><br><span class="line"><span class="built_in">console</span>.log(book.edition); <span class="comment">//3</span></span><br></pre></td></tr></table></figure><p>以上代码在 book 对象上定义了两个数据属性（<code>_year</code> 和 <code>edition</code>）和一个访问器属性（year）。</p><p>读取属性的特性<code>Object.getOwnPropertyDescriptor()</code>方法，接受两个参数：</p><ol><li>属性所在的对象；</li><li>要读取其描述符的属性名称。</li></ol><p>返回值是一个对象：</p><ul><li>数据属性，对象的属性有<code>configurable 、enumerable、 writable、value</code>；</li><li>访问器属性，对象的属性有<code>configurable 、enumerable、 get、set</code>。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> book = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperties(book, &#123;</span><br><span class="line">  _year: &#123;</span><br><span class="line">    value: <span class="number">2016</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  edition: &#123;</span><br><span class="line">    value: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  year: &#123;</span><br><span class="line">    get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>._year;</span><br><span class="line">    &#125;,</span><br><span class="line">    set: <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (val &gt; <span class="number">2016</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>._year = val;</span><br><span class="line">        <span class="keyword">this</span>.edition += val - <span class="number">2016</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> descriptor = <span class="built_in">Object</span>.getOwnPropertyDescriptor(book, <span class="string">"_year"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(descriptor.value); <span class="comment">//2016</span></span><br><span class="line"><span class="built_in">console</span>.log(descriptor.configurable); <span class="comment">//false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> descriptor.get); <span class="comment">//undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> descriptor = <span class="built_in">Object</span>.getOwnPropertyDescriptor(book, <span class="string">"year"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(descriptor.value); <span class="comment">//undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(descriptor.enumerable); <span class="comment">//false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> descriptor.get); <span class="comment">//function</span></span><br></pre></td></tr></table></figure><ul><li><code>数据属性_year</code>，value 等于最初的值，configurable 是 false，而 get 等于 undefined；</li><li><code>访问器属性 year</code>，value 等于 undefined，enumerable 是 false，而 get 是一个指向 getter 函数的指针。</li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初识JavaScript的面向对象</title>
      <link href="/2016/08/21/practice-object/"/>
      <url>/2016/08/21/practice-object/</url>
      
        <content type="html"><![CDATA[<blockquote><p>整理入坑学习记录</p></blockquote><a id="more"></a><h2 id="首先，面向对象是什么"><a href="#首先，面向对象是什么" class="headerlink" title="首先，面向对象是什么"></a>首先，面向对象是什么</h2><blockquote><p>浅显地说，<strong>面向对象</strong>就是只关注对象提供的功能，不在乎其内部的具体细节；</p><p>比如，电视机，我们知道怎么打开、关闭、调台，但一般我们是不知道它到底是如何打开、关闭、调台的。</p><p>再比如，黑匣子；</p><p><strong>面向对象是一种通用思想</strong>，并非只有编程中才使用，任何事情都可以找到它的影子。</p></blockquote><h2 id="OOP-的特点"><a href="#OOP-的特点" class="headerlink" title="OOP 的特点"></a>OOP 的特点</h2><blockquote><p>面向对象编程的三大特点：</p><p><strong>1. 抽象</strong>—抓住核心问题；</p><p><strong>2. 封装</strong>—只考虑功能使用，不考虑内部实现；</p><p><strong>3. 继承</strong>—从已有的对象上，继承出新的对象；</p></blockquote><h2 id="原型"><a href="#原型" class="headerlink" title="原型"></a>原型</h2><blockquote><p>定义就不粘贴了，通俗滴说，prototype 类似于我们 css 中的 class；</p><p>比如，我们给多个 div 添加相同的属性时，就会使用 class；同样的，使用 prototype 就是需要添加多个方法：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CreatePerson.prototype.showName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"我是"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line">CreatePerson.prototype.showQQ = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"我的qq号是："</span> + <span class="keyword">this</span>.qq);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>代码中，一个人的名字和 QQ 号，可以使用一般的函数来解决，若两个，十个的就麻烦了，因此使用原型<strong>prototype</strong>可以很好地解决<strong>函数重复</strong>导致的<strong>资源浪费</strong>。</p></blockquote><h2 id="类和对象的关系"><a href="#类和对象的关系" class="headerlink" title="类和对象的关系"></a>类和对象的关系</h2><blockquote><p><strong>对象</strong>，由方法和属性组成；</p><p><strong>类</strong>，比如数组 Array；</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br></pre></td></tr></table></figure><blockquote><p>其中 arr 是<strong>对象</strong>，Array 是<strong>类</strong>；</p><p>我们可以把<strong>类</strong>看做是制作产品的<strong>磨具</strong>，而<strong>对象</strong>就是由模具制作出来的<strong>产品</strong>。</p></blockquote><ul><li><strong>类</strong> — 模具；</li><li><strong>对象</strong> — 产品；</li></ul><h2 id="代码：面向过程"><a href="#代码：面向过程" class="headerlink" title="代码：面向过程"></a>代码：面向过程</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPerson</span>(<span class="params">name, qq</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 加new之后，系统偷偷给加了var this=new Object();</span></span><br><span class="line">  <span class="comment">// var person1 = new Object();</span></span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.qq = qq;</span><br><span class="line">  <span class="keyword">this</span>.showName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"我是"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">this</span>.showQQ = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"我的QQ号是"</span> + <span class="keyword">this</span>.qq);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// 加new后这里又偷偷地执行return this;</span></span><br><span class="line">  <span class="comment">// return person1;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> createPerson(<span class="string">"杨子龙"</span>, <span class="string">"33441524"</span>);</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> createPerson(<span class="string">"王德彪"</span>, <span class="string">"66111314"</span>);</span><br><span class="line"></span><br><span class="line">person1.showName();</span><br><span class="line">person1.showQQ();</span><br><span class="line"></span><br><span class="line">person2.showName();</span><br><span class="line">person2.showQQ();</span><br><span class="line"><span class="built_in">console</span>.log(person1.showName == person2.showName);</span><br></pre></td></tr></table></figure><blockquote><p>以上代码是由<strong>工厂方式</strong>创建;</p><p>用构造函数<code>function createPerson(name, qq) {}</code>创建一个类；</p><p>调用函数使用关键字 new：<code>var person1 = new createPerson()</code>;这时系统就是替你创建了一个空白对象<code>var this=new Object();</code>并且还替你返回了这个对象<code>return this;</code></p><p><strong>工厂方式</strong>的问题：函数重复使用导致资源浪费；</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(person1.showName == person2.showName); <span class="comment">//false</span></span><br></pre></td></tr></table></figure><h2 id="代码：面向对象"><a href="#代码：面向对象" class="headerlink" title="代码：面向对象"></a>代码：面向对象</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CreatePerson</span>(<span class="params">name, qq</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.qq = qq;</span><br><span class="line">&#125;</span><br><span class="line">CreatePerson.prototype.showName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"我是"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line">CreatePerson.prototype.showQQ = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"我的qq号是："</span> + <span class="keyword">this</span>.qq);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 =<span class="keyword">new</span> CreatePerson(<span class="string">"王德彪"</span>, <span class="number">330441338</span>);</span><br><span class="line"><span class="keyword">var</span> person2 =<span class="keyword">new</span> CreatePerson(<span class="string">"杨子龙"</span>, <span class="number">369898363</span>);</span><br><span class="line"></span><br><span class="line">person1.showName();</span><br><span class="line">person1.showQQ();</span><br><span class="line"></span><br><span class="line">person2.showName();</span><br><span class="line">person2.showQQ();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person1.showName == person2.showName)；</span><br></pre></td></tr></table></figure><h2 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h2><blockquote><ol><li>使用<strong>构造函数加属性</strong>；</li><li>使用<strong>原型加方法</strong>；<br>这时<code>console.log(person1.showName == person2.showName)；</code>，会是<code>true</code>，因为 person1 和 person2 都来自同个原型:<code>CreatePerson.prototype.showName()</code>。</li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>实践|JS匀速运动和缓冲运动</title>
      <link href="/2016/08/09/practice-speed-move/"/>
      <url>/2016/08/09/practice-speed-move/</url>
      
        <content type="html"><![CDATA[<blockquote><p>整理入坑学习记录：有代码有总结的 JS 匀速运动和缓冲运动学习报告</p></blockquote><a id="more"></a><h2 id="JS-匀速运动的学习总结"><a href="#JS-匀速运动的学习总结" class="headerlink" title="JS 匀速运动的学习总结"></a>JS 匀速运动的学习总结</h2><h3 id="匀速运动要点"><a href="#匀速运动要点" class="headerlink" title="匀速运动要点"></a>匀速运动要点</h3><ol><li>点击“开始”，物体向右匀速运动 600 个像素；点击“返回”，物体匀速回到初始位置；</li><li>css 样式表中，设置绝对定位；</li><li>JS 代码中：<ul><li>初始化定时器：timer=null;</li><li>开始运动时，关闭已有的定时器:clearInterval(timer);；否则你连续点击按钮时，物体会因为定时器的每次开启但没有清除每次的开启，会导致一卡一卡的运动；</li><li>设置 speed，根据目标值和 offsetLeft 之差来判断正负；</li><li>使用 if()判断，把运动和停止隔开；</li></ul></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>匀速运动<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">      <span class="selector-id">#div1</span> &#123;</span></span><br><span class="line"><span class="undefined">        width: 300px;</span></span><br><span class="line"><span class="undefined">        height: 100px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">border</span>: 5<span class="selector-tag">px</span> <span class="selector-tag">inset</span> <span class="selector-id">#890</span>;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#588</span>;</span></span><br><span class="line"><span class="undefined">        text-align: center;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">position</span>: <span class="selector-tag">absolute</span>; <span class="comment">/*设置绝对定位*/</span></span></span><br><span class="line"><span class="undefined">        left: 0;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">box-shadow</span>: 10<span class="selector-tag">px</span> 9<span class="selector-tag">px</span> 12<span class="selector-tag">px</span> <span class="selector-id">#599</span>;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-id">#div1</span> <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="undefined">        font-family: "新宋体";</span></span><br><span class="line"><span class="undefined">        font-size: 30px;</span></span><br><span class="line"><span class="undefined">        color: white;</span></span><br><span class="line"><span class="undefined">        margin-top: 14px;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> oBtn1 = <span class="built_in">document</span>.getElementById(<span class="string">"btn1"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> oBtn2 = <span class="built_in">document</span>.getElementById(<span class="string">"btn2"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> oDiv = <span class="built_in">document</span>.getElementById(<span class="string">"div1"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> oPar = <span class="built_in">document</span>.getElementById(<span class="string">"par1"</span>);</span></span><br><span class="line"><span class="javascript">        oBtn1.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">          startMove(600);</span></span><br><span class="line"><span class="javascript">          oPar.innerHTML = <span class="string">"点击返回，我会回到起点"</span>;</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="javascript">        oBtn2.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">          startMove(0);</span></span><br><span class="line"><span class="javascript">          oPar.innerHTML = <span class="string">"点击开始,我将匀速运动"</span>;</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="undefined">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> timer = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">startMove</span>(<span class="params">iTarget</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> oDiv = <span class="built_in">document</span>.getElementById(<span class="string">"div1"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="comment">//开始运动前，清除定时器</span></span></span><br><span class="line"><span class="undefined">        clearInterval(timer);</span></span><br><span class="line"><span class="javascript">        timer = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">//设置speed的初始值为0,并且根据目标值判断正负</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> speed = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (oDiv.offsetLeft &gt; iTarget) &#123;</span></span><br><span class="line"><span class="undefined">            speed = -10;</span></span><br><span class="line"><span class="javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="undefined">            speed = 10;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="javascript">          <span class="comment">//用if和else隔开运动和停止</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (oDiv.offsetLeft == iTarget) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//满足条件时，清除定时器</span></span></span><br><span class="line"><span class="undefined">            clearInterval(timer);</span></span><br><span class="line"><span class="javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">            oDiv.style.left = oDiv.offsetLeft + speed + <span class="string">"px"</span>;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;, 30);</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"btn1"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"开始"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"btn2"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"返回"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div1"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"par1"</span>&gt;</span>点击开始,我将匀速运动<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="关于-speed-的-Bug"><a href="#关于-speed-的-Bug" class="headerlink" title="关于 speed 的 Bug"></a>关于 speed 的 Bug</h3><ol><li><p>一般情况下，我们设置 speed 为偶数，如上所示代码，会如期到达目标点；</p></li><li><p>若 speed 为奇数呢？</p></li><li><p>设 speed=7，目标点为 100，从 0 开始匀速运动，经过 14 次的递加，到达 98 处，这时，问题出现了：若再递加 7，就会超过目标点 100，若不递加，就会达不到目标点；所以，开始前后卡顿。</p></li><li><p>如何解决呢？</p><ul><li>使用 <code>Math.abs()</code>;</li><li>speed 有可能为正，也有可能为负，我们使用绝对值，让目标和物体之间的距离<code>&lt;=7</code>,即：<code>Math.abs(iTarget-ele.offsetLeft) &lt;= 7</code></li><li>这时不管怎么样，都是不足 7 个，我们就可以讨巧地认为它已经 到达目标点了，所以就可以清除定时器；你再试试看，就不会晃动了，不过还没达到目标点。</li><li>为了精准地达到目标点，我们就认为 left 直接到达目标点，即：<code>ele.style.left = iTarget + &quot;px&quot;</code>;</li></ul></li><li><p>最后：只有匀速运动才会有这个问题；缓冲运动没有，因为它的 speed 是一直随之变化，越来越小，直到到达目标点。</p></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>匀速运动之speed<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">      <span class="selector-id">#div1</span> &#123;</span></span><br><span class="line"><span class="undefined">        width: 150px;</span></span><br><span class="line"><span class="undefined">        height: 200px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#880</span>;</span></span><br><span class="line"><span class="undefined">        margin-top: 35px;</span></span><br><span class="line"><span class="undefined">        position: absolute;</span></span><br><span class="line"><span class="undefined">        left: 0;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">      <span class="selector-id">#div1</span> <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="undefined">        font-size: 24px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line"><span class="undefined">        text-align: center;</span></span><br><span class="line"><span class="undefined">        line-height: 200px;</span></span><br><span class="line"><span class="undefined">        margin-top: 0;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">      <span class="selector-id">#div2</span>,</span></span><br><span class="line"><span class="css">      <span class="selector-id">#div3</span> &#123;</span></span><br><span class="line"><span class="undefined">        width: 0;</span></span><br><span class="line"><span class="undefined">        height: 300px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#000</span>;</span></span><br><span class="line"><span class="undefined">        position: absolute;</span></span><br><span class="line"><span class="undefined">        left: 300px;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">      <span class="selector-id">#div3</span> &#123;</span></span><br><span class="line"><span class="undefined">        left: 600px;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> btn_1 = <span class="built_in">document</span>.getElementById(<span class="string">"btn1"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> btn_2 = <span class="built_in">document</span>.getElementById(<span class="string">"btn2"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> btn_3 = <span class="built_in">document</span>.getElementById(<span class="string">"btn3"</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        btn_1.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">          startMove(600);</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="javascript">        btn_2.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">          startMove(300);</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="javascript">        btn_3.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">          startMove(0);</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="undefined">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> timer = <span class="literal">null</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">startMove</span>(<span class="params">iTarget</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> ele = <span class="built_in">document</span>.getElementById(<span class="string">"div1"</span>);</span></span><br><span class="line"><span class="undefined">        clearInterval(timer);</span></span><br><span class="line"><span class="javascript">        timer = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> speed = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (iTarget &gt; ele.offsetLeft) &#123;</span></span><br><span class="line"><span class="undefined">            speed = 7;</span></span><br><span class="line"><span class="javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="undefined">            speed = -7;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (<span class="built_in">Math</span>.abs(iTarget - ele.offsetLeft) &lt;= <span class="number">7</span>) &#123;</span></span><br><span class="line"><span class="undefined">            clearInterval(timer);</span></span><br><span class="line"><span class="javascript">            ele.style.left = iTarget + <span class="string">"px"</span>;</span></span><br><span class="line"><span class="javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">            ele.style.left = ele.offsetLeft + speed + <span class="string">"px"</span>;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;, 30);</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"btn1"</span> <span class="attr">value</span>=<span class="string">"600px"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"btn2"</span> <span class="attr">value</span>=<span class="string">"300px"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"btn3"</span> <span class="attr">value</span>=<span class="string">"0px"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div1"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是匀速运动<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div3"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="匀速运动之分享栏"><a href="#匀速运动之分享栏" class="headerlink" title="匀速运动之分享栏"></a>匀速运动之分享栏</h3><ol><li>当鼠标经过“分享”时，会弹出整个分享栏；鼠标离开时，又会恢复到初始状态；</li><li>css 样式表中：设置绝对定位，并设置 left 之为-150px，隐藏分享栏；</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>分享栏<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">      * &#123;</span></span><br><span class="line"><span class="undefined">        margin: 0px;</span></span><br><span class="line"><span class="undefined">        padding: 0px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#ccc</span>;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-id">#div1</span> &#123;</span></span><br><span class="line"><span class="undefined">        width: 150px;</span></span><br><span class="line"><span class="undefined">        height: 300px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#f60</span>;</span></span><br><span class="line"><span class="undefined">        position: absolute;</span></span><br><span class="line"><span class="undefined">        top: 100px;</span></span><br><span class="line"><span class="undefined">        left: -150px;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-id">#div1</span> <span class="selector-tag">span</span> &#123;</span></span><br><span class="line"><span class="undefined">        width: 30px;</span></span><br><span class="line"><span class="undefined">        height: 54px;</span></span><br><span class="line"><span class="undefined">        padding-top: 6px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#c38</span>;</span></span><br><span class="line"><span class="undefined">        color: white;</span></span><br><span class="line"><span class="undefined">        text-align: center;</span></span><br><span class="line"><span class="undefined">        position: absolute;</span></span><br><span class="line"><span class="undefined">        right: -30px;</span></span><br><span class="line"><span class="undefined">        top: 120px;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> oDiv = <span class="built_in">document</span>.getElementById(<span class="string">"div1"</span>);</span></span><br><span class="line"><span class="javascript">        oDiv.onmouseover = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">          startMove(0);</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="javascript">        oDiv.onmouseout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">          startMove(-150);</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="undefined">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> timer = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">startMove</span>(<span class="params">iTarget</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> oDiv = <span class="built_in">document</span>.getElementById(<span class="string">"div1"</span>);</span></span><br><span class="line"><span class="undefined">        clearInterval(timer);</span></span><br><span class="line"><span class="javascript">        timer = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">//offsetLeft:根据定位的左边距，所以要设置div的绝对定位</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> speed = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (oDiv.offsetLeft &gt; iTarget) &#123;</span></span><br><span class="line"><span class="undefined">            speed = -10;</span></span><br><span class="line"><span class="javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="undefined">            speed = 10;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (oDiv.offsetLeft == iTarget) &#123;</span></span><br><span class="line"><span class="undefined">            clearInterval(timer);</span></span><br><span class="line"><span class="javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">            oDiv.style.left = oDiv.offsetLeft + speed + <span class="string">"px"</span>;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;, 30);</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div1"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>分享<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h3 id="匀速运动之淡入淡出"><a href="#匀速运动之淡入淡出" class="headerlink" title="匀速运动之淡入淡出"></a>匀速运动之淡入淡出</h3><ol><li>所谓淡入淡出，就是当鼠标移到目标时，目标的透明度会匀速恢复到 100%，反之，透明度会返回到初始值；</li><li><p>css 样式表中，透明度的设置考虑浏览器兼容：</p><ul><li><code>IE：filter: alpha(opacity:30)</code>;</li><li>其它：<code>opacity: 0.3</code>;</li></ul></li><li><p>这里可不关 offset 什么事，那怎么办呢?</p><p>其实，我们可以设置一个变量，并赋值给它，比如：var alpha=30；</p><p>然后，将 speed 的值递加给它：alpha = alpha + speed;</p><p>这样，只是将每次的 speed 值赋给变量 alpha，我们就可以通过定时器来匀速改变透明度。</p></li><li><p>由于兼容问题，我们分开处理：</p><ul><li><code>oDiv.style.filter = &quot;alpha(opacity:&#39; + alpha + &#39;)&quot;</code>;</li><li><code>oDiv.style.opacity = alpha/100;</code>(因为初始值是 30)</li></ul></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>淡入淡出<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">      <span class="selector-id">#div1</span> &#123;</span></span><br><span class="line"><span class="undefined">        width: 300px;</span></span><br><span class="line"><span class="undefined">        height: 150px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#880</span>;</span></span><br><span class="line"><span class="undefined">        filter: alpha(opacity: 30);</span></span><br><span class="line"><span class="css">        <span class="selector-tag">opacity</span>: 0<span class="selector-class">.3</span>;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> oDiv = <span class="built_in">document</span>.getElementById(<span class="string">"div1"</span>);</span></span><br><span class="line"><span class="javascript">        oDiv.onmouseover = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">          getChange(100);</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="javascript">        oDiv.onmouseout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">          getChange(30);</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="undefined">      &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> alpha = <span class="number">30</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> timer = <span class="literal">null</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">getChange</span>(<span class="params">iTarget</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> oDiv = <span class="built_in">document</span>.getElementById(<span class="string">"div1"</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        clearInterval(timer);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        timer = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> speed = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (alpha &lt; iTarget) &#123;</span></span><br><span class="line"><span class="undefined">            speed = 10;</span></span><br><span class="line"><span class="javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="undefined">            speed = -10;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (alpha == iTarget) &#123;</span></span><br><span class="line"><span class="undefined">            clearInterval(timer);</span></span><br><span class="line"><span class="javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="undefined">            alpha += speed;</span></span><br><span class="line"><span class="javascript">            oDiv.style.filter = <span class="string">"alpha(opacity:' + alpha + ')"</span>;</span></span><br><span class="line"><span class="undefined">            oDiv.style.opacity = alpha / 100;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;, 30);</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div1"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="JS-缓冲运动的学习总结"><a href="#JS-缓冲运动的学习总结" class="headerlink" title="JS 缓冲运动的学习总结"></a>JS 缓冲运动的学习总结</h2><h3 id="缓冲运动的要点"><a href="#缓冲运动的要点" class="headerlink" title="缓冲运动的要点"></a>缓冲运动的要点</h3><ol><li>顾名思义，所谓缓冲，就是说速度不同；在一定条件下，距离越大，速度越大；距离越小，速度也就越小。</li><li>所以，我们只要改变 speed，就基本上 OK。</li><li>首先，通过得到位移量，再除以一个数值，就可以改变速度：<code>var speed = (iTarget - ele.offsetLeft)/10;</code></li><li><p>然后，因为是变速，所以有可能出现小数，不足以达到目标值；这时，通过 Math 对象，可以使 speed 取整，解决不足 1 个像素的问题：</p><ul><li>当 <code>speed&gt;0</code> 时，物体从左往右运动，离目标值还差不足 1px，所以我们将 speed 向上取整，<code>Math.ceil(speed)</code>;</li><li>当 <code>speed&lt;0</code> 时，反之，离目标值还差不足-1px,由于是负数，我们向下取整，比如-0.9，通过 <code>Math.floor(-0.9)</code>，得出-1；</li></ul></li><li><p>所以，我们用一个三元运算符来进行判断，并赋值给 speed：<code>speed = speed&gt;0 ? Math.ceil(speed) : Math.floor(speed);</code></p></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>缓冲运动<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">      <span class="selector-id">#div1</span> &#123;</span></span><br><span class="line"><span class="undefined">        width: 150px;</span></span><br><span class="line"><span class="undefined">        height: 200px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#880</span>;</span></span><br><span class="line"><span class="undefined">        margin-top: 35px;</span></span><br><span class="line"><span class="undefined">        position: absolute;</span></span><br><span class="line"><span class="undefined">        left: 0;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-id">#div1</span> <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="undefined">        font-size: 24px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line"><span class="undefined">        text-align: center;</span></span><br><span class="line"><span class="undefined">        line-height: 200px;</span></span><br><span class="line"><span class="undefined">        margin-top: 0;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-id">#div2</span>,</span></span><br><span class="line"><span class="css">      <span class="selector-id">#div3</span> &#123;</span></span><br><span class="line"><span class="undefined">        width: 0;</span></span><br><span class="line"><span class="undefined">        height: 300px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#000</span>;</span></span><br><span class="line"><span class="undefined">        position: absolute;</span></span><br><span class="line"><span class="undefined">        left: 300px;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-id">#div3</span> &#123;</span></span><br><span class="line"><span class="undefined">        left: 600px;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> btn_1 = <span class="built_in">document</span>.getElementById(<span class="string">"btn1"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> btn_2 = <span class="built_in">document</span>.getElementById(<span class="string">"btn2"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> btn_3 = <span class="built_in">document</span>.getElementById(<span class="string">"btn3"</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        btn_1.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">          startMove(600);</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="javascript">        btn_2.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">          startMove(300);</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="javascript">        btn_3.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">          startMove(0);</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="undefined">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> timer = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">startMove</span>(<span class="params">iTarget</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> ele = <span class="built_in">document</span>.getElementById(<span class="string">"div1"</span>);</span></span><br><span class="line"><span class="undefined">        clearInterval(timer);</span></span><br><span class="line"><span class="javascript">        timer = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">//通过位移量除以10，使speed变速，以致实现减速、停止。</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> speed = (iTarget - ele.offsetLeft) / <span class="number">10</span>;</span></span><br><span class="line"><span class="javascript">          <span class="comment">//取整，解决最后不足1px的位移量被忽略的问题。</span></span></span><br><span class="line"><span class="javascript">          speed = speed &gt; <span class="number">0</span> ? <span class="built_in">Math</span>.ceil(speed) : <span class="built_in">Math</span>.floor(speed);</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (ele.offsetLeft == iTarget) &#123;</span></span><br><span class="line"><span class="undefined">            clearInterval(timer);</span></span><br><span class="line"><span class="javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">            ele.style.left = ele.offsetLeft + speed + <span class="string">"px"</span>;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;, 30);</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"btn1"</span> <span class="attr">value</span>=<span class="string">"600px"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"btn2"</span> <span class="attr">value</span>=<span class="string">"300px"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"btn3"</span> <span class="attr">value</span>=<span class="string">"0px"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div1"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是缓冲运动<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div3"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Html </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Html </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>实践|制作一个简易数码时钟</title>
      <link href="/2016/08/04/practice-easy-clock/"/>
      <url>/2016/08/04/practice-easy-clock/</url>
      
        <content type="html"><![CDATA[<blockquote><p>整理入坑学习记录</p></blockquote><a id="more"></a><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>正常显示时间的时分秒，当鼠标移上去的时候，切换成年月日</p><p><img src="http://img1.sycdn.imooc.com/57a423af0001050406990285.gif" alt="Gif"></p><p>线上演示<a href="https://yangtao2o.github.io/clock/" target="_blank" rel="noopener">【戳我】</a></p><h2 id="主要特色"><a href="#主要特色" class="headerlink" title="主要特色"></a>主要特色</h2><ol><li>简洁</li><li>金属色彩</li><li>setInterval()–&gt;定时器</li><li>运用事件 onmouseover()和 onmouseout()，使时间与日期之间自如切换</li><li>个人能力有限，还望大家一起修改，使之更加完善</li></ol><h2 id="一些问题"><a href="#一些问题" class="headerlink" title="一些问题"></a>一些问题</h2><p>各个浏览器的显示不是很理想，我已经想尽各种办法，使之平稳展现；</p><ol><li>火狐–&gt;进行事件切换时，浮度比较大；</li><li>谷歌–&gt;完美运行(去掉某些样式）；</li><li>IE–&gt;除了最新的，其他的不敢多想；</li></ol><h2 id="时分秒"><a href="#时分秒" class="headerlink" title="时分秒"></a>时分秒</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> imgs = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"img"</span>);</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">checkTime</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">10</span>) <span class="keyword">return</span> <span class="string">"0"</span> + x;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="string">""</span> + x;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">oShowTime</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> oDate = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">var</span> oHou = oDate.getHours();</span><br><span class="line">    <span class="keyword">var</span> oMin = oDate.getMinutes();</span><br><span class="line">    <span class="keyword">var</span> oSec = oDate.getSeconds();</span><br><span class="line">    <span class="keyword">var</span> str = checkTime(oHou) + checkTime(oMin) + checkTime(oSec);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; imgs.length; i++) &#123;</span><br><span class="line">      imgs[i].src = <span class="string">"images/"</span> + str[i] + <span class="string">".JPG"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  setInterval(oShowTime, <span class="number">1000</span>);</span><br><span class="line">  oShowTime();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="时间与日期事件切换"><a href="#时间与日期事件切换" class="headerlink" title="时间与日期事件切换"></a>时间与日期事件切换</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> oDiv = <span class="built_in">document</span>.getElementById(<span class="string">"div1"</span>);</span><br><span class="line">  <span class="keyword">var</span> imgs = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"img"</span>);</span><br><span class="line">  <span class="keyword">var</span> timer = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">/*判断获取到的数字是否小于10*/</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">checkTime</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">10</span>) <span class="keyword">return</span> <span class="string">"0"</span> + x;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="string">""</span> + x;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/*鼠标点击事件*/</span></span><br><span class="line">  oDiv.onmouseover = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    clearInterval(timer);</span><br><span class="line">    fnDate();</span><br><span class="line">  &#125;;</span><br><span class="line">  oDiv.onmouseout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    clearInterval(timer);</span><br><span class="line">    fnTime();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*获取的日期函数*/</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">fnDate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">oShowDate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> oDate = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">      <span class="keyword">var</span> oYea = oDate.getFullYear();</span><br><span class="line">      oYea = oYea.toString();</span><br><span class="line">      <span class="keyword">var</span> oMon = oDate.getMonth() + <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">var</span> oDay = oDate.getDay();</span><br><span class="line">      <span class="keyword">var</span> str = oYea.substr(<span class="number">2</span>, <span class="number">2</span>) + checkTime(oMon) + checkTime(oDay);</span><br><span class="line">      <span class="keyword">var</span> aPar = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"p"</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; imgs.length; i++) &#123;</span><br><span class="line">        imgs[i].src = <span class="string">"images/"</span> + str[i] + <span class="string">".JPG"</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; aPar.length; j++) &#123;</span><br><span class="line">        aPar[j].innerHTML = <span class="string">"-"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    timer = setInterval(oShowDate, <span class="number">1000</span>);</span><br><span class="line">    oShowDate();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*获取的时间函数*/</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">fnTime</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">oShowTime</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> oDate = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">      <span class="keyword">var</span> oHou = oDate.getHours();</span><br><span class="line">      <span class="keyword">var</span> oMin = oDate.getMinutes();</span><br><span class="line">      <span class="keyword">var</span> oSec = oDate.getSeconds();</span><br><span class="line">      <span class="keyword">var</span> str = checkTime(oHou) + checkTime(oMin) + checkTime(oSec);</span><br><span class="line">      <span class="keyword">var</span> aPar = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"p"</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; imgs.length; i++) &#123;</span><br><span class="line">        imgs[i].src = <span class="string">"images/"</span> + str[i] + <span class="string">".JPG"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; aPar.length; j++) &#123;</span><br><span class="line">        aPar[j].innerHTML = <span class="string">":"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    timer = setInterval(oShowTime, <span class="number">1000</span>);</span><br><span class="line">    oShowTime();</span><br><span class="line">  &#125;</span><br><span class="line">  fnTime();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="样式设置"><a href="#样式设置" class="headerlink" title="样式设置"></a>样式设置</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#333</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">80px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#div1</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">600px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">180px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">40px</span> solid <span class="number">#999</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">10px</span> <span class="number">14px</span> <span class="number">12px</span> <span class="number">#777</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">150px</span> auto;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.div2</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">580px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">160px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">15px</span> <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">9px</span>; <span class="comment">/*谷歌浏览器不用设置*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">110px</span>;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">20px</span> <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#555</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">110px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">110px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">12px</span> <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>数码钟表<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">      body &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#333</span>;</span></span><br><span class="line"><span class="undefined">        font-size: 80px;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-id">#div1</span> &#123;</span></span><br><span class="line"><span class="undefined">        width: 600px;</span></span><br><span class="line"><span class="undefined">        height: 180px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">border</span>: 40<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#999</span>;</span></span><br><span class="line"><span class="undefined">        border-radius: 60px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">box-shadow</span>: 10<span class="selector-tag">px</span> 14<span class="selector-tag">px</span> 12<span class="selector-tag">px</span> <span class="selector-id">#777</span>;</span></span><br><span class="line"><span class="undefined">        margin: 150px auto;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-class">.div2</span> &#123;</span></span><br><span class="line"><span class="undefined">        width: 580px;</span></span><br><span class="line"><span class="undefined">        height: 160px;</span></span><br><span class="line"><span class="undefined">        margin: 15px 5px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">padding-left</span>: 9<span class="selector-tag">px</span>; <span class="comment">/*谷歌浏览器不用设置*/</span></span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">      img &#123;</span></span><br><span class="line"><span class="undefined">        width: 60px;</span></span><br><span class="line"><span class="undefined">        height: 110px;</span></span><br><span class="line"><span class="undefined">        float: left;</span></span><br><span class="line"><span class="undefined">        margin: 20px 10px;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">      p &#123;</span></span><br><span class="line"><span class="undefined">        float: left;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">color</span>: <span class="selector-id">#555</span>;</span></span><br><span class="line"><span class="undefined">        height: 110px;</span></span><br><span class="line"><span class="undefined">        line-height: 110px;</span></span><br><span class="line"><span class="undefined">        margin: 12px 5px;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> oDiv = <span class="built_in">document</span>.getElementById(<span class="string">"div1"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> imgs = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"img"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> timer = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">        <span class="comment">/*判断获取到的数字是否小于10*/</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">checkTime</span>(<span class="params">x</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (x &lt; <span class="number">10</span>) <span class="keyword">return</span> <span class="string">"0"</span> + x;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">else</span> <span class="keyword">return</span> <span class="string">""</span> + x;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="comment">/*鼠标点击事件*/</span></span></span><br><span class="line"><span class="javascript">        oDiv.onmouseover = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">          clearInterval(timer);</span></span><br><span class="line"><span class="undefined">          fnDate();</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="javascript">        oDiv.onmouseout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">          clearInterval(timer);</span></span><br><span class="line"><span class="undefined">          fnTime();</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">/*获取的日期函数*/</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">fnDate</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="function"><span class="keyword">function</span> <span class="title">oShowDate</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> oDate = <span class="keyword">new</span> <span class="built_in">Date</span>();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> oYea = oDate.getFullYear();</span></span><br><span class="line"><span class="undefined">            oYea = oYea.toString();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> oMon = oDate.getMonth() + <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> oDay = oDate.getDay();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> str = oYea.substr(<span class="number">2</span>, <span class="number">2</span>) + checkTime(oMon) + checkTime(oDay);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> aPar = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"p"</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; imgs.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">              imgs[i].src = <span class="string">"images/"</span> + str[i] + <span class="string">".JPG"</span>;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; aPar.length; j++) &#123;</span></span><br><span class="line"><span class="javascript">              aPar[j].innerHTML = <span class="string">"-"</span>;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">          timer = setInterval(oShowDate, 1000);</span></span><br><span class="line"><span class="undefined">          oShowDate();</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">/*获取的时间函数*/</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">fnTime</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="function"><span class="keyword">function</span> <span class="title">oShowTime</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> oDate = <span class="keyword">new</span> <span class="built_in">Date</span>();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> oHou = oDate.getHours();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> oMin = oDate.getMinutes();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> oSec = oDate.getSeconds();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> str = checkTime(oHou) + checkTime(oMin) + checkTime(oSec);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> aPar = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"p"</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; imgs.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">              imgs[i].src = <span class="string">"images/"</span> + str[i] + <span class="string">".JPG"</span>;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; aPar.length; j++) &#123;</span></span><br><span class="line"><span class="javascript">              aPar[j].innerHTML = <span class="string">":"</span>;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">          timer = setInterval(oShowTime, 1000);</span></span><br><span class="line"><span class="undefined">          oShowTime();</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        fnTime();</span></span><br><span class="line"><span class="undefined">      &#125;;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div1"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div2"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/0.JPG"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/0.JPG"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/0.JPG"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/0.JPG"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/0.JPG"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/0.JPG"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Html </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Html </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>实践|教你制作简易延时提示框</title>
      <link href="/2016/08/04/practice-easy-tooltip/"/>
      <url>/2016/08/04/practice-easy-tooltip/</url>
      
        <content type="html"><![CDATA[<blockquote><p>整理入坑学习记录</p></blockquote><a id="more"></a><h3 id="动态效果图"><a href="#动态效果图" class="headerlink" title="动态效果图"></a>动态效果图</h3><p><img src="http://img1.sycdn.imooc.com/57a430ad00013c0702580240.gif" alt="动态效果图"></p><h3 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h3><p>分别使用点击事件 onmouseover 和 onmouseout,来设置 oDiv2 的属性，使之显示或隐藏；</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> oDiv1 = <span class="built_in">document</span>.getElementById(<span class="string">"div1"</span>);</span><br><span class="line"><span class="keyword">var</span> oDiv2 = <span class="built_in">document</span>.getElementById(<span class="string">"div2"</span>);</span><br><span class="line">oDiv1.onmouseover = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  oDiv2.style.display = <span class="string">"block"</span>;</span><br><span class="line">&#125;;</span><br><span class="line">oDiv1.onmouseout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  oDiv2.style.display = <span class="string">"none"</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h3><p>设置 oDiv2 延时 1 秒后再消失，并且设置一个变量 timer 把它存起来;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> timer = <span class="literal">null</span>;</span><br><span class="line">oDiv1.onmouseout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    oDiv2.style.display = <span class="string">"none"</span>;</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h3><p>当鼠标移到 oDiv2 的时候，由于延时一秒后会消失，所以这时要清除定时器；</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">oDiv2.onmouseover = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  clearTimeout(timer);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="第四步"><a href="#第四步" class="headerlink" title="第四步"></a>第四步</h3><p>当鼠标离开 oDiv2 的时候，我们在 oDiv1 和 oDiv2 之间来来回回徘徊时，会有一瞬间的频闪，所以，这里也要设置当鼠标离开 oDiv2 时来个定时器；</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">oDiv2.onmouseout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    oDiv2.style.display = <span class="string">"none"</span>;</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="第五步"><a href="#第五步" class="headerlink" title="第五步"></a>第五步</h3><p>当鼠标从 oDiv2 移动到 oDiv1 的时候，由于 oDiv2 的 onmouseout 定时器没有清除，所以过一秒后，oDiv2 还是会消失；这里，我们就清除定时器（当 oDiv2 移动到 oDiv1 时，使 oDiv2 上的定时器解除）：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">oDiv1.onmouseover = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  clearTimeout(timer);</span><br><span class="line">  oDiv2.style.display = <span class="string">"block"</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>当代码相似的情况下，我们要想办法使之简化，这样就不会显得冗余；</p><p>在 JS 中，允许我们这样做：<code>a=b=c=1</code>;<br>所以，观察上面代码我们可以得出以下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">oDiv1.onmouseover = oDiv2.onmouseover = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  clearTimeout(timer);</span><br><span class="line">  oDiv2.style.display = <span class="string">"block"</span>;</span><br><span class="line">&#125;;</span><br><span class="line">oDiv1.onmouseout = oDiv2.onmouseout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    oDiv2.style.display = <span class="string">"none"</span>;</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>其实，想通制作的步骤，写代码才会行云流水。</p><h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>延时提示<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">      body &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#fc9</span>;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-id">#div1</span>,</span></span><br><span class="line"><span class="css">      <span class="selector-id">#div2</span> &#123;</span></span><br><span class="line"><span class="undefined">        margin: 10px;</span></span><br><span class="line"><span class="undefined">        float: left;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line"><span class="undefined">        text-align: center;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">border</span>: 3<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#eee</span>;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-id">#div1</span> &#123;</span></span><br><span class="line"><span class="undefined">        width: 100px;</span></span><br><span class="line"><span class="undefined">        height: 100px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#f60</span>;</span></span><br><span class="line"><span class="undefined">        font-size: 20px;</span></span><br><span class="line"><span class="undefined">        padding-top: 10px;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-id">#div2</span> &#123;</span></span><br><span class="line"><span class="undefined">        width: 300px;</span></span><br><span class="line"><span class="undefined">        height: 250px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#599</span>;</span></span><br><span class="line"><span class="undefined">        font-size: large;</span></span><br><span class="line"><span class="undefined">        line-height: 48px;</span></span><br><span class="line"><span class="undefined">        padding-top: 10px;</span></span><br><span class="line"><span class="undefined">        display: none;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> oDiv1 = <span class="built_in">document</span>.getElementById(<span class="string">"div1"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> oDiv2 = <span class="built_in">document</span>.getElementById(<span class="string">"div2"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> timer = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">        oDiv1.onmouseover = oDiv2.onmouseover = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">          clearTimeout(timer);</span></span><br><span class="line"><span class="javascript">          oDiv2.style.display = <span class="string">"block"</span>;</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="javascript">        oDiv1.onmouseout = oDiv2.onmouseout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            oDiv2.style.display = <span class="string">"none"</span>;</span></span><br><span class="line"><span class="undefined">          &#125;, 1000);</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="undefined">      &#125;;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div1"</span>&gt;</span></span><br><span class="line">      登岳阳楼</span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>杜甫<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div2"</span>&gt;</span></span><br><span class="line">      昔闻洞庭水，今上岳阳楼。<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">      吴楚东南坼，乾坤日夜浮。<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">      亲朋无一字，老病有孤舟。<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">      戎马关山北，凭轩涕泗流。</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><strong>效果图</strong><br><img src="http://img1.sycdn.imooc.com/57a2c92b0001665b05840395.jpg" alt="图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> Html </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Html </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>实践|学习制作一个简易日历</title>
      <link href="/2016/08/03/practice-easy-calendar/"/>
      <url>/2016/08/03/practice-easy-calendar/</url>
      
        <content type="html"><![CDATA[<blockquote><p>整理入坑学习记录</p></blockquote><a id="more"></a><h2 id="动态效果图-GIF-图片"><a href="#动态效果图-GIF-图片" class="headerlink" title="动态效果图 GIF 图片"></a>动态效果图 GIF 图片</h2><p><img src="http://img1.sycdn.imooc.com/57a42f40000123ac01040336.gif" alt="示例图GIF"></p><h2 id="先写-html-的-body-部分代码"><a href="#先写-html-的-body-部分代码" class="headerlink" title="先写 html 的 body 部分代码"></a>先写 html 的 body 部分代码</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"tabs"</span> <span class="attr">class</span>=<span class="string">"calender"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>1<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>JAN<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>2<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>FER<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>3<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>MAR<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>4<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>APR<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>5<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>MAY<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>6<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>JUN<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>7<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>JUL<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>8<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>AUG<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>9<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>SEP<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>10<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>OCT<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>11<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>NOV<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>12<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>DEC<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>1月活动<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span>一月小寒接大寒<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="设置-css-样式"><a href="#设置-css-样式" class="headerlink" title="设置 css 样式"></a>设置 css 样式</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#890</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#tabs</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">10px</span> solid <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">50px</span> auto;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">340px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#ddd</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#tabs</span> <span class="selector-tag">ul</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">list-style-type</span>: none;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">70px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">65px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">4px</span> solid <span class="number">#588</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#222</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** css样式设置与.active有冲突时，</span></span><br><span class="line"><span class="comment">** 优先级id&gt;class</span></span><br><span class="line"><span class="comment">** 细化选择符</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-id">#tabs</span> <span class="selector-class">.active</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#c66</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.text</span> &#123;</span><br><span class="line">  <span class="attribute">clear</span>: both;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#eee</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="javascript-代码"><a href="#javascript-代码" class="headerlink" title="javascript 代码"></a>javascript 代码</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> array = [</span><br><span class="line">    <span class="string">"一月小寒接大寒"</span>,</span><br><span class="line">    <span class="string">"二月立春雨水连"</span>,</span><br><span class="line">    <span class="string">"惊蛰春分在三月"</span>,</span><br><span class="line">    <span class="string">"清明谷雨四月天"</span>,</span><br><span class="line">    <span class="string">"五月立夏和小满"</span>,</span><br><span class="line">    <span class="string">"六月芒种夏至连"</span>,</span><br><span class="line">    <span class="string">"七月大暑和小暑"</span>,</span><br><span class="line">    <span class="string">"立秋处暑八月间"</span>,</span><br><span class="line">    <span class="string">"九月白露接秋分"</span>,</span><br><span class="line">    <span class="string">"寒露霜降十月全"</span>,</span><br><span class="line">    <span class="string">"立冬小雪十一月"</span>,</span><br><span class="line">    <span class="string">"大雪冬至迎新年"</span></span><br><span class="line">  ];</span><br><span class="line">  <span class="comment">// 这里定义oDiv.get...是为了定义className作用对象是id为tabs下的所有div文本</span></span><br><span class="line">  <span class="keyword">var</span> oDiv = <span class="built_in">document</span>.getElementById(<span class="string">"tabs"</span>);</span><br><span class="line">  <span class="keyword">var</span> aLi = oDiv.getElementsByTagName(<span class="string">"li"</span>);</span><br><span class="line">  <span class="keyword">var</span> oTxt = oDiv.getElementsByTagName(<span class="string">"div"</span>)[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; aLi.length; i++) &#123;</span><br><span class="line">    <span class="comment">// 定义一个index属性对aLi进行编号</span></span><br><span class="line">    aLi[i].index = i;</span><br><span class="line">    aLi[i].onmouseover = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 这里是相对于未被点击的部分的样式</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; aLi.length; i++) &#123;</span><br><span class="line">        aLi[i].className = <span class="string">""</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.className = <span class="string">"active"</span>;</span><br><span class="line">      <span class="comment">// 通过之前的index编号绑定指定的div文本</span></span><br><span class="line">      oTxt.innerHTML =</span><br><span class="line">        <span class="string">"&lt;h2&gt;"</span> +</span><br><span class="line">        (<span class="keyword">this</span>.index + <span class="number">1</span>) +</span><br><span class="line">        <span class="string">"月活动&lt;/h2&gt;&lt;h4&gt;"</span> +</span><br><span class="line">        array[<span class="keyword">this</span>.index] +</span><br><span class="line">        <span class="string">"&lt;/h4&gt;"</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>简易日历<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">      body &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#890</span>;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-id">#tabs</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">border</span>: 10<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#ccc</span>;</span></span><br><span class="line"><span class="undefined">        margin: 50px auto;</span></span><br><span class="line"><span class="undefined">        width: 340px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#ddd</span>;</span></span><br><span class="line"><span class="undefined">        text-align: center;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-id">#tabs</span> <span class="selector-tag">ul</span> <span class="selector-tag">li</span> &#123;</span></span><br><span class="line"><span class="undefined">        float: left;</span></span><br><span class="line"><span class="undefined">        list-style-type: none;</span></span><br><span class="line"><span class="undefined">        width: 70px;</span></span><br><span class="line"><span class="undefined">        height: 65px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">border</span>: 4<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#588</span>;</span></span><br><span class="line"><span class="undefined">        margin: 5px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#222</span>;</span></span><br><span class="line"><span class="undefined">        color: white;</span></span><br><span class="line"><span class="undefined">        line-height: 8px;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">      <span class="selector-id">#tabs</span> <span class="selector-class">.active</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">color</span>: <span class="selector-id">#c66</span>;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-class">.text</span> &#123;</span></span><br><span class="line"><span class="undefined">        clear: both;</span></span><br><span class="line"><span class="undefined">        margin: 10px 40px;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#eee</span>;</span></span><br><span class="line"><span class="undefined">        padding: 2px;</span></span><br><span class="line"><span class="undefined">        line-height: 14px;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> array = [</span></span><br><span class="line"><span class="javascript">          <span class="string">"一月小寒接大寒"</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">"二月立春雨水连"</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">"惊蛰春分在三月"</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">"清明谷雨四月天"</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">"五月立夏和小满"</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">"六月芒种夏至连"</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">"七月大暑和小暑"</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">"立秋处暑八月间"</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">"九月白露接秋分"</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">"寒露霜降十月全"</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">"立冬小雪十一月"</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">"大雪冬至迎新年"</span></span></span><br><span class="line"><span class="undefined">        ];</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> oDiv = <span class="built_in">document</span>.getElementById(<span class="string">"tabs"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> aLi = oDiv.getElementsByTagName(<span class="string">"li"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> oTxt = oDiv.getElementsByTagName(<span class="string">"div"</span>)[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; aLi.length; i++) &#123;</span></span><br><span class="line"><span class="undefined">          aLi[i].index = i;</span></span><br><span class="line"><span class="javascript">          aLi[i].onmouseover = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; aLi.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">              aLi[i].className = <span class="string">""</span>;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.className = <span class="string">"active"</span>;</span></span><br><span class="line"><span class="undefined">            oTxt.innerHTML =</span></span><br><span class="line"><span class="javascript">              <span class="string">"&lt;h2&gt;"</span> +</span></span><br><span class="line"><span class="javascript">              (<span class="keyword">this</span>.index + <span class="number">1</span>) +</span></span><br><span class="line"><span class="xml">              "月活动<span class="tag">&lt;/<span class="name">h2</span>&gt;</span><span class="tag">&lt;<span class="name">h4</span>&gt;</span>" +</span></span><br><span class="line"><span class="javascript">              array[<span class="keyword">this</span>.index] +</span></span><br><span class="line"><span class="javascript">              <span class="string">"&lt;/h4&gt;"</span>;</span></span><br><span class="line"><span class="undefined">          &#125;;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"tabs"</span> <span class="attr">class</span>=<span class="string">"calender"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h2</span>&gt;</span>1<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>JAN<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h2</span>&gt;</span>2<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>FER<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h2</span>&gt;</span>3<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>MAR<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h2</span>&gt;</span>4<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>APR<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h2</span>&gt;</span>5<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>MAY<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h2</span>&gt;</span>6<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>JUN<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h2</span>&gt;</span>7<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>JUL<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h2</span>&gt;</span>8<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>AUG<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h2</span>&gt;</span>9<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>SEP<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h2</span>&gt;</span>10<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>OCT<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h2</span>&gt;</span>11<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>NOV<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h2</span>&gt;</span>12<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>DEC<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>1月活动<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>一月小寒接大寒<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Html </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Html </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
