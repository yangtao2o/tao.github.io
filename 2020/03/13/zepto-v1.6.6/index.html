<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="baidu-site-verification" content="OavY14g4y5" />
  
  <title>Zepto-core-1.1.6 源码注释【转载】 | 大涛子</title>
  
  <meta name="keywords" content="大涛子 前端 web 摄影 yangtao 杨涛 JavaScript HTML css React Vue node 大涛子的客栈 dataozi">
  
  
  <meta name="description" content="大涛子写博客的地方，记录日常前端开发中遇到的问题，以及学习到的知识。">
  

  
  <link rel="alternate" href="/atom.xml" title="大涛子">
  

  <meta name="HandheldFriendly" content="True" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.6.3/css/all.min.css">
  

  
  <link rel="shortcut icon" type='image/x-icon' href="/img/favicon.ico">
  

  
    <link rel="stylesheet" href="/style.css">
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
    <!-- ba -->
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?xxxxxxxx";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
  
</head>

<body>
  
  
  <div class="cover-wrapper">
    <cover class='cover post half'>
      
        
  <h1 class='title'>大涛子客栈</h1>


  <div class="m_search">
    <form name="searchform" class="form u-search-form">
      <input type="text" class="input u-search-input" placeholder="前端、摄影、羽毛球、电影、脱发" />
      <i class="icon fas fa-search fa-fw"></i>
    </form>
  </div>

<div class='menu navgation'>
  <ul class='h-list'>
    
      
        <li>
          <a class="nav home" href="/"
            
            
            id="home">
            <i class='fas fa-home fa-fw'></i>&nbsp;博文
          </a>
        </li>
      
        <li>
          <a class="nav home" href="http://www.yangtao.site/vuepress"
            
            
            id="http:www.yangtao.sitevuepress">
            <i class='fas fa-rss fa-fw'></i>&nbsp;主页
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/categories/"
            
            
            id="categories">
            <i class='fas fa-folder-open fa-fw'></i>&nbsp;分类
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/archives/"
            
            
            id="archives">
            <i class='fas fa-archive fa-fw'></i>&nbsp;归档
          </a>
        </li>
      
        <li>
          <a class="nav home" href="http://dataoboy.lofter.com/"
            
              rel="nofollow"
            
            
            id="http:dataoboy.lofter.com">
            <i class='fas fa-camera-retro fa-fw'></i>&nbsp;摄影
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/friends/"
            
              rel="nofollow"
            
            
            id="friends">
            <i class='fas fa-link fa-fw'></i>&nbsp;友链
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/about/"
            
              rel="nofollow"
            
            
            id="about">
            <i class='fas fa-info-circle fa-fw'></i>&nbsp;关于
          </a>
        </li>
      
    
  </ul>
</div>

      
    </cover>
    <header class="l_header pure">
  <div id="loading-bar-wrapper">
    <div id="loading-bar" class="pure"></div>
  </div>

	<div class='wrapper'>
		<div class="nav-main container container--flex">
      <a class="logo flat-box" href='/' >
        
          大涛子
        
      </a>
			<div class='menu navgation'>
				<ul class='h-list'>
          
  					
  						<li>
								<a class="nav flat-box" href="/"
                  
                  
                  id="home">
									<i class='fas fa-home fa-fw'></i>&nbsp;博文
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/categories/"
                  
                    rel="nofollow"
                  
                  
                  id="categories">
									<i class='fas fa-folder-open fa-fw'></i>&nbsp;分类
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/tags/"
                  
                    rel="nofollow"
                  
                  
                  id="tags">
									<i class='fas fa-hashtag fa-fw'></i>&nbsp;标签
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/archives/"
                  
                    rel="nofollow"
                  
                  
                  id="archives">
									<i class='fas fa-archive fa-fw'></i>&nbsp;归档
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/friends/"
                  
                    rel="nofollow"
                  
                  
                  id="friends">
									<i class='fas fa-users fa-fw'></i>&nbsp;朋友
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="http://dataoboy.lofter.com/"
                  
                    rel="nofollow"
                  
                  
                  id="http:dataoboy.lofter.com">
									<i class='fas fa-camera-retro fa-fw'></i>&nbsp;摄影
								</a>
							</li>
      			
      		
				</ul>
			</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="搜索" />
						<i class="icon fas fa-search fa-fw"></i>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a class="fas fa-search fa-fw" href='javascript:void(0)'></a></li>
				
				<li class='s-menu'><a class="fas fa-bars fa-fw" href='javascript:void(0)'></a></li>
			</ul>
		</div>

		<div class='nav-sub container container--flex'>
			<a class="logo flat-box"></a>
			<ul class='switcher h-list'>
				<li class='s-comment'><a class="flat-btn fas fa-comments fa-fw" href='javascript:void(0)'></a></li>
        
          <li class='s-toc'><a class="flat-btn fas fa-list fa-fw" href='javascript:void(0)'></a></li>
        
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
    <header>
		<nav class="menu navgation">
      <ul>
        
          
            <li>
							<a class="nav flat-box" href="/"
                
                
                id="home">
								<i class='fas fa-clock fa-fw'></i>&nbsp;近期文章
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/blog/archives/"
                
                  rel="nofollow"
                
                
                id="blogarchives">
								<i class='fas fa-archive fa-fw'></i>&nbsp;文章归档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/projects/"
                
                
                id="projects">
								<i class='fas fa-code-branch fa-fw'></i>&nbsp;开源项目
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/friends/"
                
                  rel="nofollow"
                
                
                id="friends">
								<i class='fas fa-link fa-fw'></i>&nbsp;我的友链
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="https://xaoxuu.com/wiki/material-x/"
                
                  rel="nofollow"
                
                
                id="https:xaoxuu.comwikimaterial-x">
								<i class='fas fa-book fa-fw'></i>&nbsp;主题文档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/about/"
                
                  rel="nofollow"
                
                
                id="about">
								<i class='fas fa-info-circle fa-fw'></i>&nbsp;关于小站
							</a>
            </li>
          
       
      </ul>
		</nav>
    </header>
	</aside>
<script>setLoadingBarProgress(40);</script>

  </div>


  <div class="l_body">
    <div class='body-wrapper'>
      <div class='l_main no_sidebar'>
  

  
    <article id="post" class="post white-box article-type-post" itemscope itemprop="blogPost">
      


  <section class='meta'>
    
    
    <div class="meta" id="header-meta">
      
        
  
    <h1 class="title">
      <a href="/2020/03/13/zepto-v1.6.6/">
        Zepto-core-1.1.6 源码注释【转载】
      </a>
    </h1>
  


      
      <div class='new-meta-box'>
        
          
        
          
            
  <div class='new-meta-item author'>
    <a href="http://yangtao.site" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>杨涛</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2020-03-13</p>
  </a>
</div>

          
        
          
            
  
  <div class='new-meta-item category'>
    <a href='/categories/前端框架/' rel="nofollow">
      <i class="fas fa-folder-open" aria-hidden="true"></i>
      <p>前端框架</p>
    </a>
  </div>


          
        
          
            
  
    <div class="new-meta-item browse busuanzi">
      <a class='notlink'>
        <i class="fas fa-eye" aria-hidden="true"></i>
        <p>
          <span id="busuanzi_value_page_pv">
            <i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i>
          </span>
        </p>
      </a>
    </div>
  


          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


      <section class="article typo">
        <div class="article-entry" itemprop="articleBody">
          <blockquote>
<p>原文：<a href="https://www.kancloud.cn/wangfupeng/zepto-design-srouce/173692" target="_blank" rel="noopener">zepto-core-1.1.6 源码注释</a></p>
</blockquote>
<a id="more"></a>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br><span class="line">1835</span><br><span class="line">1836</span><br><span class="line">1837</span><br><span class="line">1838</span><br><span class="line">1839</span><br><span class="line">1840</span><br><span class="line">1841</span><br><span class="line">1842</span><br><span class="line">1843</span><br><span class="line">1844</span><br><span class="line">1845</span><br><span class="line">1846</span><br><span class="line">1847</span><br><span class="line">1848</span><br><span class="line">1849</span><br><span class="line">1850</span><br><span class="line">1851</span><br><span class="line">1852</span><br><span class="line">1853</span><br><span class="line">1854</span><br><span class="line">1855</span><br><span class="line">1856</span><br><span class="line">1857</span><br><span class="line">1858</span><br><span class="line">1859</span><br><span class="line">1860</span><br><span class="line">1861</span><br><span class="line">1862</span><br><span class="line">1863</span><br><span class="line">1864</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Zepto v1.1.6 - zepto event ajax form ie - zeptojs.com/license */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Zepto = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="literal">undefined</span>,</span><br><span class="line">    key,</span><br><span class="line">    $,</span><br><span class="line">    classList,</span><br><span class="line">    <span class="comment">// 获取数组的slice 和 filter（返回数组中的满足回调函数中指定的条件的元素）方法</span></span><br><span class="line">    emptyArray = [],</span><br><span class="line">    slice = emptyArray.slice,</span><br><span class="line">    filter = emptyArray.filter,</span><br><span class="line">    <span class="built_in">document</span> = <span class="built_in">window</span>.document,</span><br><span class="line">    elementDisplay = &#123;&#125;,</span><br><span class="line">    classCache = &#123;&#125;,</span><br><span class="line">    cssNumber = &#123;</span><br><span class="line">      <span class="string">"column-count"</span>: <span class="number">1</span>,</span><br><span class="line">      columns: <span class="number">1</span>,</span><br><span class="line">      <span class="string">"font-weight"</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">"line-height"</span>: <span class="number">1</span>,</span><br><span class="line">      opacity: <span class="number">1</span>,</span><br><span class="line">      <span class="string">"z-index"</span>: <span class="number">1</span>,</span><br><span class="line">      zoom: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 取出html代码中第一个html标签（或注释），如取出 &lt;p&gt;123&lt;/p&gt;&lt;h1&gt;345&lt;/h1&gt; 中的 &lt;p&gt;</span></span><br><span class="line">    fragmentRE = <span class="regexp">/^\s*&lt;(\w+|!)[^&gt;]*&gt;/</span>,</span><br><span class="line">    <span class="comment">// 匹配 &lt;img /&gt; &lt;p&gt;&lt;/p&gt;  不匹配 &lt;img src=""/&gt; &lt;p&gt;123&lt;/p&gt;</span></span><br><span class="line">    singleTagRE = <span class="regexp">/^&lt;(\w+)\s*\/?&gt;(?:&lt;\/\1&gt;|)$/</span>,</span><br><span class="line">    <span class="comment">// 单标签</span></span><br><span class="line">    tagExpanderRE = <span class="regexp">/&lt;(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^&gt;]*)\/&gt;/gi</span>,</span><br><span class="line">    <span class="comment">// body html</span></span><br><span class="line">    rootNodeRE = <span class="regexp">/^(?:body|html)$/i</span>,</span><br><span class="line">    <span class="comment">// 大写字母</span></span><br><span class="line">    capitalRE = <span class="regexp">/([A-Z])/g</span>,</span><br><span class="line">    <span class="comment">// special attributes that should be get/set via method calls</span></span><br><span class="line">    <span class="comment">// 应该通过方法调用来设置/获取的特殊属性</span></span><br><span class="line">    methodAttributes = [</span><br><span class="line">      <span class="string">"val"</span>,</span><br><span class="line">      <span class="string">"css"</span>,</span><br><span class="line">      <span class="string">"html"</span>,</span><br><span class="line">      <span class="string">"text"</span>,</span><br><span class="line">      <span class="string">"data"</span>,</span><br><span class="line">      <span class="string">"width"</span>,</span><br><span class="line">      <span class="string">"height"</span>,</span><br><span class="line">      <span class="string">"offset"</span></span><br><span class="line">    ],</span><br><span class="line">    adjacencyOperators = [<span class="string">"after"</span>, <span class="string">"prepend"</span>, <span class="string">"before"</span>, <span class="string">"append"</span>],</span><br><span class="line">    table = <span class="built_in">document</span>.createElement(<span class="string">"table"</span>),</span><br><span class="line">    tableRow = <span class="built_in">document</span>.createElement(<span class="string">"tr"</span>),</span><br><span class="line">    <span class="comment">// 指定特殊元素的 容器</span></span><br><span class="line">    containers = &#123;</span><br><span class="line">      tr: <span class="built_in">document</span>.createElement(<span class="string">"tbody"</span>),</span><br><span class="line">      tbody: table,</span><br><span class="line">      thead: table,</span><br><span class="line">      tfoot: table,</span><br><span class="line">      td: tableRow,</span><br><span class="line">      th: tableRow,</span><br><span class="line">      <span class="comment">// 除了上面指定的，其他所有元素的容器都是 div</span></span><br><span class="line">      <span class="string">"*"</span>: <span class="built_in">document</span>.createElement(<span class="string">"div"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// interactive ？？？</span></span><br><span class="line">    readyRE = <span class="regexp">/complete|loaded|interactive/</span>,</span><br><span class="line">    <span class="comment">// 匹配一个包括（字母、数组、下划线、-）的字符串</span></span><br><span class="line">    simpleSelectorRE = <span class="regexp">/^[\w-]*$/</span>,</span><br><span class="line">    class2type = &#123;&#125;,</span><br><span class="line">    toString = class2type.toString,</span><br><span class="line">    zepto = &#123;&#125;,</span><br><span class="line">    camelize,</span><br><span class="line">    uniq,</span><br><span class="line">    tempParent = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>),</span><br><span class="line">    <span class="comment">// 属性转换为 camalCase 格式。</span></span><br><span class="line">    <span class="comment">// $.fn.prop 方法用到了</span></span><br><span class="line">    propMap = &#123;</span><br><span class="line">      tabindex: <span class="string">"tabIndex"</span>,</span><br><span class="line">      readonly: <span class="string">"readOnly"</span>,</span><br><span class="line">      <span class="keyword">for</span>: <span class="string">"htmlFor"</span>,</span><br><span class="line">      class: "className",</span><br><span class="line">      maxlength: <span class="string">"maxLength"</span>,</span><br><span class="line">      cellspacing: <span class="string">"cellSpacing"</span>,</span><br><span class="line">      cellpadding: <span class="string">"cellPadding"</span>,</span><br><span class="line">      rowspan: <span class="string">"rowSpan"</span>,</span><br><span class="line">      colspan: <span class="string">"colSpan"</span>,</span><br><span class="line">      usemap: <span class="string">"useMap"</span>,</span><br><span class="line">      frameborder: <span class="string">"frameBorder"</span>,</span><br><span class="line">      contenteditable: <span class="string">"contentEditable"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 判断是否是arr的函数</span></span><br><span class="line">    isArray =</span><br><span class="line">      <span class="built_in">Array</span>.isArray ||</span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params">object</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> object <span class="keyword">instanceof</span> <span class="built_in">Array</span>;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 上文定义 zepto = &#123;&#125;</span></span><br><span class="line">  <span class="comment">// 判断 element 是否符合 selector 的选择要求</span></span><br><span class="line">  zepto.matches = <span class="function"><span class="keyword">function</span>(<span class="params">element, selector</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// selector有值，element有值，element是普通DOM节点</span></span><br><span class="line">    <span class="keyword">if</span> (!selector || !element || element.nodeType !== <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// elem.matchesSelector('.item')</span></span><br><span class="line">    <span class="comment">// 判断当前的 elem 是否符合传入的 selector 的要求</span></span><br><span class="line">    <span class="keyword">var</span> matchesSelector =</span><br><span class="line">      element.webkitMatchesSelector ||</span><br><span class="line">      element.mozMatchesSelector ||</span><br><span class="line">      element.oMatchesSelector ||</span><br><span class="line">      element.matchesSelector;</span><br><span class="line">    <span class="keyword">if</span> (matchesSelector) <span class="keyword">return</span> matchesSelector.call(element, selector);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 浏览器不支持 matchesSelector</span></span><br><span class="line">    <span class="comment">// fall back to performing a selector:</span></span><br><span class="line">    <span class="keyword">var</span> match,</span><br><span class="line">      parent = element.parentNode,</span><br><span class="line">      temp = !parent;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上文定义 tempParent = document.createElement('div'),</span></span><br><span class="line">    <span class="comment">// 如果没有parent，parent赋值为一个div，然后将当前元素加入到这个div中</span></span><br><span class="line">    <span class="keyword">if</span> (temp) &#123;</span><br><span class="line">      parent = tempParent;</span><br><span class="line">      tempParent.appendChild(element);</span><br><span class="line">      <span class="comment">// (parent = tempParent).appendChild(element); 这种写法不易读</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过 qsa 获取匹配的元素，判断其中有没有 element</span></span><br><span class="line">    match = ~zepto.qsa(parent, selector).indexOf(element);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (temp) &#123;</span><br><span class="line">      <span class="comment">// 如果没有parent时，之前执行过  tempParent.appendChild(element);</span></span><br><span class="line">      <span class="comment">// 此时要移除子元素</span></span><br><span class="line">      tempParent.removeChild(element);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// temp &amp;&amp; tempParent.removeChild(element)  // 这种写法不易读</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回最终的匹配结果，经过 qsa 判断的结果</span></span><br><span class="line">    <span class="keyword">return</span> match;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">type</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj == <span class="literal">null</span></span><br><span class="line">      ? <span class="built_in">String</span>(obj) <span class="comment">// null undefined</span></span><br><span class="line">      : class2type[toString.call(obj)] || <span class="string">"object"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下文定义：</span></span><br><span class="line">    <span class="comment">// // Populate the class2type map</span></span><br><span class="line">    <span class="comment">// $.each("Boolean Number String Function Array Date RegExp Object Error".split(" "), function(i, name) &#123;</span></span><br><span class="line">    <span class="comment">//   class2type[ "[object " + name + "]" ] = name.toLowerCase()</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isFunction</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> type(value) == <span class="string">"function"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// window的特点：window.window === window</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isWindow</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj == obj.window;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// document.nodeType === 9</span></span><br><span class="line">  <span class="comment">// elem.DOCUMENT_NODE 也等于 9 （这里直接判断是不是9也行？？？）</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isDocument</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj.nodeType == obj.DOCUMENT_NODE;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> type(obj) == <span class="string">"object"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 判断是否是最基本的object：Object.getPrototypeOf(obj) == Object.prototype</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isPlainObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      isObject(obj) &amp;&amp;</span><br><span class="line">      !isWindow(obj) &amp;&amp;</span><br><span class="line">      <span class="built_in">Object</span>.getPrototypeOf(obj) == <span class="built_in">Object</span>.prototype</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 数组或者对象数组</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">likeArray</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> obj.length == <span class="string">"number"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 筛选数组，踢出 null undefined 元素</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">compact</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> filter.call(array, <span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> item != <span class="literal">null</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 下文定义：</span></span><br><span class="line">  <span class="comment">// $.fn = &#123;</span></span><br><span class="line">  <span class="comment">//    concat: emptyArray.concat,</span></span><br><span class="line">  <span class="comment">// $.fn.concat.apply([], array) —— 无论 array 是不是数组，都将返回一个数组，</span></span><br><span class="line">  <span class="comment">// 例如 $.fn.concat.call([], 'abc') 返回的是 ['abc']</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">flatten</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> array.length &gt; <span class="number">0</span> ? $.fn.concat.apply([], array) : array;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// camelize 已在上文定义</span></span><br><span class="line">  <span class="comment">// 用于 css 的 camalCase 转换，例如 background-color 转换为 backgroundColor</span></span><br><span class="line">  camelize = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str.replace(<span class="regexp">/-+(.)?/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">match, chr</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> chr ? chr.toUpperCase() : <span class="string">""</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将 lineHeight 转换为 line-height 格式</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">dasherize</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line">      .replace(<span class="regexp">/::/g</span>, <span class="string">"/"</span>)</span><br><span class="line">      .replace(<span class="regexp">/([A-Z]+)([A-Z][a-z])/g</span>, <span class="string">"$1_$2"</span>)</span><br><span class="line">      .replace(<span class="regexp">/([a-z\d])([A-Z])/g</span>, <span class="string">"$1_$2"</span>)</span><br><span class="line">      .replace(<span class="regexp">/_/g</span>, <span class="string">"-"</span>)</span><br><span class="line">      .toLowerCase();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// uniq变量已经在前面定义</span></span><br><span class="line">  <span class="comment">// 用来将 [1,1,2,2,3,3] 替换为 [1,2,3]</span></span><br><span class="line">  uniq = <span class="function"><span class="keyword">function</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> filter.call(array, <span class="function"><span class="keyword">function</span>(<span class="params">item, idx</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> array.indexOf(item) == idx;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 上文定义 classCache = &#123;&#125;</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">classRE</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name <span class="keyword">in</span> classCache</span><br><span class="line">      ? classCache[name]</span><br><span class="line">      : (classCache[name] = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"(^|\\s)"</span> + name + <span class="string">"(\\s|$)"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// classCache 存储的数据是这样的：</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//   abc: /(^|\s)abc(\s|$)/,  // 能匹配 'abc' 或 ' abc ' 或 ' abc' 或 'abc '</span></span><br><span class="line">    <span class="comment">//   xyz: /(^|\s)abc(\s|$)/,</span></span><br><span class="line">    <span class="comment">//   ...</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 传入一个 css 的 name 和 value，判断这个 value 是否需要增加 'px'</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">maybeAddPx</span>(<span class="params">name, value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// dasherize(name) 将 lineHeight 转换为 line-height 格式</span></span><br><span class="line">    <span class="comment">// \!cssNumber[dasherize(name)] 判断转换出来的 css name 是否再这个数组之外</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> value == <span class="string">"number"</span> &amp;&amp; !cssNumber[dasherize(name)]</span><br><span class="line">      ? <span class="comment">// 如果 value 是数字，并且 name 不在 cssNumber 数组之内，就需要加 'px'，否则不需要</span></span><br><span class="line">        <span class="comment">// 例如 'width'、'font-size' 就需要加 'px'， 'font-weight' 就不需要加</span></span><br><span class="line">        value + <span class="string">"px"</span></span><br><span class="line">      : value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 前文定义----------------------</span></span><br><span class="line">    <span class="comment">// cssNumber = &#123;</span></span><br><span class="line">    <span class="comment">//   'column-count': 1,</span></span><br><span class="line">    <span class="comment">//   'columns': 1,</span></span><br><span class="line">    <span class="comment">//   'font-weight': 1,</span></span><br><span class="line">    <span class="comment">//   'line-height': 1,</span></span><br><span class="line">    <span class="comment">//   'opacity': 1,</span></span><br><span class="line">    <span class="comment">//   'z-index': 1,</span></span><br><span class="line">    <span class="comment">//   'zoom': 1</span></span><br><span class="line">    <span class="comment">// &#125;,</span></span><br><span class="line">    <span class="comment">// function dasherize(str) &#123;</span></span><br><span class="line">    <span class="comment">//   return str.replace(/::/g, '/')</span></span><br><span class="line">    <span class="comment">//             .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')</span></span><br><span class="line">    <span class="comment">//             .replace(/([a-z\d])([A-Z])/g, '$1_$2')</span></span><br><span class="line">    <span class="comment">//             .replace(/_/g, '-')</span></span><br><span class="line">    <span class="comment">//             .toLowerCase()</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取一个元素的默认 display 样式值，可能的结果是：inline block inline-block table .... （none 转换为 block）</span></span><br><span class="line">  <span class="comment">// $.fn.show 方法中用到了</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">defaultDisplay</span>(<span class="params">nodeName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> element, display;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 前文定义 elementDisplay = &#123;&#125;</span></span><br><span class="line">    <span class="keyword">if</span> (!elementDisplay[nodeName]) &#123;</span><br><span class="line">      <span class="comment">// 如果 elementDisplay 对象中，没有存储 nodeName 的信息</span></span><br><span class="line">      <span class="comment">// 则新建一个 nodeName 元素，添加到 body 中</span></span><br><span class="line">      element = <span class="built_in">document</span>.createElement(nodeName);</span><br><span class="line">      <span class="built_in">document</span>.body.appendChild(element);</span><br><span class="line">      <span class="comment">// 获取它的默认的 display 样式信息。</span></span><br><span class="line">      display = getComputedStyle(element, <span class="string">""</span>).getPropertyValue(<span class="string">"display"</span>);</span><br><span class="line">      <span class="comment">// 接着马上移除元素！！！</span></span><br><span class="line">      element.parentNode.removeChild(element);</span><br><span class="line">      <span class="comment">// 'none' 换成 'block'，另外还可能是 'inline' 'inline-block' 'table' 等等...</span></span><br><span class="line">      display == <span class="string">"none"</span> &amp;&amp; (display = <span class="string">"block"</span>);</span><br><span class="line">      <span class="comment">// 存储下来</span></span><br><span class="line">      elementDisplay[nodeName] = display;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 下文定义</span></span><br><span class="line">      <span class="comment">// var nativeGetComputedStyle = getComputedStyle;</span></span><br><span class="line">      <span class="comment">// window.getComputedStyle = function(element)&#123;</span></span><br><span class="line">      <span class="comment">//   try &#123;</span></span><br><span class="line">      <span class="comment">//     return nativeGetComputedStyle(element)</span></span><br><span class="line">      <span class="comment">//   &#125; catch(e) &#123;</span></span><br><span class="line">      <span class="comment">//     return null</span></span><br><span class="line">      <span class="comment">//   &#125;</span></span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line">      <span class="comment">// 解释：</span></span><br><span class="line">      <span class="comment">// 如果浏览器支持 getComputedStyle 则使用，如果不支持，就返回 null</span></span><br><span class="line">      <span class="comment">// getComputedStyle(elem, '伪类，如 :link') 返回一个 CSSStyleDeclaration 对象，里面存储了元素的样式信息，可以通过 getPropertyValue('name') 方法获取</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最终返回 display 结果</span></span><br><span class="line">    <span class="keyword">return</span> elementDisplay[nodeName];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回一个元素的子元素，数组形式</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">children</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 有些浏览器支持 elem.children 获取子元素，有些不支持</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"children"</span> <span class="keyword">in</span> element</span><br><span class="line">      ? <span class="comment">// 上文定义 slice = [].slice</span></span><br><span class="line">        <span class="comment">// slice.call(likeArr) 可以将对象数组转换为真正的数组</span></span><br><span class="line">        slice.call(element.children)</span><br><span class="line">      : <span class="comment">// 浏览器不支持 elem.children 只能通过 elem.childNodes 获取子元素</span></span><br><span class="line">        <span class="comment">// 只去 node.nodeType == 1 的子元素，通过 $.map 拼接成数组</span></span><br><span class="line">        <span class="comment">// $.map 下文定义的， $.map = function (elements, callback) &#123;....&#125;</span></span><br><span class="line">        <span class="comment">// $.map 作用：针对 elements（对象数组或数组），对每个元素都经过 callback 函数的过滤，并将过滤通过的元素，push到一个新数组中，返回新数组</span></span><br><span class="line">        $.map(element.childNodes, <span class="function"><span class="keyword">function</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (node.nodeType == <span class="number">1</span>) <span class="keyword">return</span> node;</span><br><span class="line">        &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 上文定义 zepto = &#123;&#125;</span></span><br><span class="line">  <span class="comment">// 上文定义 zepto.matches = function(element, selector) &#123; /* 判断elem是否符合selector的要求 */ &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.fragment` takes a html string and an optional tag name</span></span><br><span class="line">  <span class="comment">// to generate DOM nodes nodes from the given html string.</span></span><br><span class="line">  <span class="comment">// The generated DOM nodes are returned as an array.</span></span><br><span class="line">  <span class="comment">// This function can be overriden in plugins for example to make</span></span><br><span class="line">  <span class="comment">// it compatible with browsers that don't support the DOM fully.</span></span><br><span class="line">  zepto.fragment = <span class="function"><span class="keyword">function</span>(<span class="params">html, name, properties</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      参数：</span></span><br><span class="line"><span class="comment">      @html: 待处理的html字符串</span></span><br><span class="line"><span class="comment">      @name: 通过 name 可在 containers 中查找容器节点，如果不传入，取得的容器默认为 div</span></span><br><span class="line"><span class="comment">      @properties: 节点属性对象</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> dom, nodes, container;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上文定义：singleTagRE = /^&lt;(\w+)\s*\/?&gt;(?:&lt;\/\1&gt;|)$/,   // 匹配 &lt;img /&gt; &lt;p&gt;&lt;/p&gt;  不匹配 &lt;img src=""/&gt; &lt;p&gt;123&lt;/p&gt;</span></span><br><span class="line">    <span class="comment">// 如果 html 是单标签，则直接用该标签创建元素</span></span><br><span class="line">    <span class="comment">// RegExp.$1 表示正则中的第一个括号匹配的内容，在此即 (\w+) 匹配的内容，</span></span><br><span class="line">    <span class="comment">// A special case optimization for a single tag</span></span><br><span class="line">    <span class="keyword">if</span> (singleTagRE.test(html)) dom = $(<span class="built_in">document</span>.createElement(<span class="built_in">RegExp</span>.$<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!dom) &#123;</span><br><span class="line">      <span class="comment">// 说明 html 不是单标签，dom未被赋值</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 上文定义 tagExpanderRE = /&lt;(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^&gt;]*)\/&gt;/ig,   // 单标签</span></span><br><span class="line">      <span class="comment">// 将 &lt;p/&gt;或&lt;p /&gt;，替换为 &lt;p&gt;&lt;/p&gt;，将&lt;p abc/&gt;替换为&lt;p&gt;abc&lt;/p&gt;</span></span><br><span class="line">      <span class="comment">// &lt;input/&gt; （在 tagExpanderRE 中定义）的不替换</span></span><br><span class="line">      <span class="keyword">if</span> (html.replace) html = html.replace(tagExpanderRE, <span class="string">"&lt;$1&gt;&lt;/$2&gt;"</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// fragmentRE = /^\s*&lt;(\w+|!)[^&gt;]*&gt;/,   // 取出html代码中第一个html标签（或注释），如取出 &lt;p&gt;123&lt;/p&gt;&lt;h1&gt;345&lt;/h1&gt; 中的 &lt;p&gt;</span></span><br><span class="line">      <span class="comment">// 如果 name 未传入，则赋值为 html 的第一个标签</span></span><br><span class="line">      <span class="keyword">if</span> (name === <span class="literal">undefined</span>) name = fragmentRE.test(html) &amp;&amp; <span class="built_in">RegExp</span>.$<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 上文定义</span></span><br><span class="line">      <span class="comment">// 指定特殊元素的 容器</span></span><br><span class="line">      <span class="comment">// containers = &#123;</span></span><br><span class="line">      <span class="comment">//   'tr': document.createElement('tbody'),</span></span><br><span class="line">      <span class="comment">//   'tbody': table,</span></span><br><span class="line">      <span class="comment">//   'thead': table,</span></span><br><span class="line">      <span class="comment">//   'tfoot': table,</span></span><br><span class="line">      <span class="comment">//   'td': tableRow,</span></span><br><span class="line">      <span class="comment">//   'th': tableRow,</span></span><br><span class="line">      <span class="comment">// 除了上面指定的，其他所有元素的容器都是 div</span></span><br><span class="line">      <span class="comment">//   '*': document.createElement('div')</span></span><br><span class="line">      <span class="comment">// &#125;,</span></span><br><span class="line">      <span class="keyword">if</span> (!(name <span class="keyword">in</span> containers)) name = <span class="string">"*"</span>;</span><br><span class="line"></span><br><span class="line">      container = containers[name];</span><br><span class="line">      container.innerHTML = <span class="string">""</span> + html; <span class="comment">// 转变为字符串的快捷方式</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 遍历 container 的子元素（先转换为数组形式）</span></span><br><span class="line">      <span class="comment">// 返回的同时，将每个子元素移除。</span></span><br><span class="line">      <span class="comment">// $.each 返回的是一个数组，因为第一个参数就是数组 slice.call(container.childNodes)</span></span><br><span class="line">      dom = $.each(slice.call(container.childNodes), <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        container.removeChild(<span class="keyword">this</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 赋值属性</span></span><br><span class="line">    <span class="keyword">if</span> (isPlainObject(properties)) &#123;</span><br><span class="line">      <span class="comment">// 先将dom转换为 zepto 对象</span></span><br><span class="line">      nodes = $(dom);</span><br><span class="line"></span><br><span class="line">      $.each(properties, <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 上文定义：</span></span><br><span class="line">        <span class="comment">// 应该通过方法调用来设置/获取的特殊属性</span></span><br><span class="line">        <span class="comment">// methodAttributes = ['val', 'css', 'html', 'text', 'data', 'width', 'height', 'offset'],</span></span><br><span class="line">        <span class="keyword">if</span> (methodAttributes.indexOf(key) &gt; <span class="number">-1</span>) nodes[key](value);</span><br><span class="line">        <span class="comment">// 满足 methodAttributes 的，通过方法赋值</span></span><br><span class="line">        <span class="keyword">else</span> nodes.attr(key, value); <span class="comment">// 否则，通过属性复制</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最终返回的dom可能有两种形式</span></span><br><span class="line">    <span class="comment">// 第一，如果 html 是单标签，则dom被复制为一个zepto对象 dom = $(document.createElement(RegExp.$1))</span></span><br><span class="line">    <span class="comment">// 第二，如果 html 不是单标签，则dom被复制为一个DOM节点的数组</span></span><br><span class="line">    <span class="keyword">return</span> dom;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 上文定义 zepto = &#123;&#125;</span></span><br><span class="line">  <span class="comment">// 上文定义 zepto.matches = function(element, selector) &#123; /* 判断elem是否符合selector的要求 */ &#125;</span></span><br><span class="line">  <span class="comment">// 上文定义 zepto.fragment = function(html, name, properties) &#123; /* 通过html字符串获取文档碎片 */ &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.Z` swaps out the prototype of the given `dom` array</span></span><br><span class="line">  <span class="comment">// of nodes with `$.fn` and thus supplying all the Zepto functions</span></span><br><span class="line">  <span class="comment">// to the array. Note that `__proto__` is not supported on Internet</span></span><br><span class="line">  <span class="comment">// Explorer. This method can be overriden in plugins.</span></span><br><span class="line">  zepto.Z = <span class="function"><span class="keyword">function</span>(<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">    dom = dom || [];</span><br><span class="line">    <span class="comment">// 将 dom 隐式原型强制改为 $.fn</span></span><br><span class="line">    <span class="comment">// 下文 zepto.Z.prototype = $.fn   因此，dom.__proto__ = $.fn 即 dom.__proto__ = zepto.Z.prototype  可以不较真的认为 zepto.Z 就是一个构造函数（但感觉这么设计，有些蹩脚）</span></span><br><span class="line">    dom.__proto__ = $.fn;</span><br><span class="line">    dom.selector = selector || <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">return</span> dom;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.isZ` should return `true` if the given object is a Zepto</span></span><br><span class="line">  <span class="comment">// collection. This method can be overriden in plugins.</span></span><br><span class="line">  zepto.isZ = <span class="function"><span class="keyword">function</span>(<span class="params">object</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 上文 dom.__proto__ = $.fn</span></span><br><span class="line">    <span class="comment">// 下文 zepto.Z.prototype = $.fn</span></span><br><span class="line">    <span class="comment">// 可知：dom.__proto__ === $.fn === zepto.Z.prototype</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 因此，zepto对象都符合 object instanceof zepto.Z</span></span><br><span class="line">    <span class="keyword">return</span> object <span class="keyword">instanceof</span> zepto.Z;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.init` is Zepto's counterpart to jQuery's `$.fn.init` and</span></span><br><span class="line">  <span class="comment">// takes a CSS selector and an optional context (and handles various</span></span><br><span class="line">  <span class="comment">// special cases).</span></span><br><span class="line">  <span class="comment">// This method can be overriden in plugins.</span></span><br><span class="line">  zepto.init = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dom;</span><br><span class="line">    <span class="comment">// If nothing given, return an empty Zepto collection</span></span><br><span class="line">    <span class="keyword">if</span> (!selector) <span class="keyword">return</span> zepto.Z();</span><br><span class="line">    <span class="comment">// Optimize for string selectors</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">"string"</span>) &#123;</span><br><span class="line">      <span class="comment">// 字符串的情况，一般有两种：</span></span><br><span class="line">      <span class="comment">// 第一，一段 html 代码，旨在通过zepto生成dom对象</span></span><br><span class="line">      <span class="comment">// 第二，一段查询字符串，旨在通过zepto查找dom对象</span></span><br><span class="line">      <span class="comment">// 将查询结果存储到 dom 变量中</span></span><br><span class="line"></span><br><span class="line">      selector = selector.trim();</span><br><span class="line">      <span class="comment">// If it's a html fragment, create nodes from it</span></span><br><span class="line">      <span class="comment">// Note: In both Chrome 21 and Firefox 15, DOM error 12</span></span><br><span class="line">      <span class="comment">// is thrown if the fragment doesn't begin with &lt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 上文定义：</span></span><br><span class="line">      <span class="comment">// 取出html代码中第一个html标签（或注释），如取出 &lt;p&gt;123&lt;/p&gt;&lt;h1&gt;345&lt;/h1&gt; 中的 &lt;p&gt;</span></span><br><span class="line">      <span class="comment">// fragmentRE = /^\s*&lt;(\w+|!)[^&gt;]*&gt;/,</span></span><br><span class="line">      <span class="keyword">if</span> (selector[<span class="number">0</span>] == <span class="string">"&lt;"</span> &amp;&amp; fragmentRE.test(selector))</span><br><span class="line">        <span class="comment">// 第一，RegExp.$1取出来的就是第一个标签名称，即正则中 (\w+|!) 对应的内容</span></span><br><span class="line">        <span class="comment">// 第二，此时的 context 应该传入的是css属性对象（这里会产生歧义，老版的不会传入 context）</span></span><br><span class="line">        (dom = zepto.fragment(selector, <span class="built_in">RegExp</span>.$<span class="number">1</span>, context)), (selector = <span class="literal">null</span>);</span><br><span class="line">      <span class="comment">// If there's a context, create a collection on that context first, and select</span></span><br><span class="line">      <span class="comment">// nodes from there</span></span><br><span class="line">      <span class="comment">// 如果 selector 不是html字符串标签，并且 context 有值，则从context中查找</span></span><br><span class="line">      <span class="comment">// find 应该是在 $.fn 中定义的，有待解读？？？</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector);</span><br><span class="line">      <span class="comment">// If it's a CSS selector, use it to select nodes.</span></span><br><span class="line">      <span class="comment">// 除了以上情况，就从整个 document 执行 qsa 的查找</span></span><br><span class="line">      <span class="keyword">else</span> dom = zepto.qsa(<span class="built_in">document</span>, selector);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If a function is given, call it when the DOM is ready</span></span><br><span class="line">    <span class="comment">// 如果是函数，则dom ready时执行，</span></span><br><span class="line">    <span class="comment">// ready方法应该在 $.fn 中定义，有待解毒</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (isFunction(selector)) <span class="keyword">return</span> $(<span class="built_in">document</span>).ready(selector);</span><br><span class="line">    <span class="comment">// If a Zepto collection is given, just return it</span></span><br><span class="line">    <span class="comment">// 传入的参数本身就已经是 zepto 对象，则直接返回</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (zepto.isZ(selector)) <span class="keyword">return</span> selector;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// compact函数：踢出数组中 == null 的元素</span></span><br><span class="line">      <span class="comment">// normalize array if an array of nodes is given</span></span><br><span class="line">      <span class="keyword">if</span> (isArray(selector)) dom = compact(selector);</span><br><span class="line">      <span class="comment">// 如果传入的是object，直接强制塞进一个数组</span></span><br><span class="line">      <span class="comment">// Wrap DOM nodes.</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (isObject(selector)) (dom = [selector]), (selector = <span class="literal">null</span>);</span><br><span class="line">      <span class="comment">// 及时清空 selector 不妨碍下面的判断</span></span><br><span class="line">      <span class="comment">// 从此往下，感觉和上文 selector 是字符串的情况下，重复了</span></span><br><span class="line">      <span class="comment">// ？？？？？？？？</span></span><br><span class="line">      <span class="comment">// fragmentRE.test 即判断字符串是否是 html 标签开头（即是否是html fragement）</span></span><br><span class="line">      <span class="comment">// If it's a html fragment, create nodes from it</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (fragmentRE.test(selector))</span><br><span class="line">        <span class="comment">//此时，context 也是属性集合，不是容器！！！</span></span><br><span class="line">        <span class="comment">//（这里会产生歧义，老版的不会传入 context）</span></span><br><span class="line">        (dom = zepto.fragment(selector.trim(), <span class="built_in">RegExp</span>.$<span class="number">1</span>, context)),</span><br><span class="line">          (selector = <span class="literal">null</span>);</span><br><span class="line">      <span class="comment">// 及时清空 selector 不妨碍下面的判断</span></span><br><span class="line">      <span class="comment">// If there's a context, create a collection on that context first, and select</span></span><br><span class="line">      <span class="comment">// nodes from there</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector);</span><br><span class="line">      <span class="comment">// And last but no least, if it's a CSS selector, use it to select nodes.</span></span><br><span class="line">      <span class="keyword">else</span> dom = zepto.qsa(<span class="built_in">document</span>, selector);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最终，还是通过 zepto.Z 创建了对象</span></span><br><span class="line">    <span class="comment">// 这里的 dom，其实就是一个数组</span></span><br><span class="line">    <span class="comment">// create a new Zepto collection from the nodes found</span></span><br><span class="line">    <span class="keyword">return</span> zepto.Z(dom, selector);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$` will be the base `Zepto` object. When calling this</span></span><br><span class="line">  <span class="comment">// function just call `$.zepto.init, which makes the implementation</span></span><br><span class="line">  <span class="comment">// details of selecting nodes and creating Zepto collections</span></span><br><span class="line">  <span class="comment">// patchable in plugins.</span></span><br><span class="line">  $ = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> zepto.init(selector, context);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// $ 最终被这个匿名函数所返回，并复制给了全局的 Zepto 变量</span></span><br><span class="line">  <span class="comment">// 全局的 zepto 变量暴露给了 window，并且可能有一个别名—— $</span></span><br><span class="line">  <span class="comment">// 此 $ 非彼 $</span></span><br><span class="line">  <span class="comment">// 对于初学者来说，这里肯定非常绕（还不如把这里的 $ 改改名字）</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">extend</span>(<span class="params">target, source, deep</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// key 在上文已经定义，否则就污染全局变量了</span></span><br><span class="line">    <span class="comment">// 深度递归，首先必须 deep 参数为 true</span></span><br><span class="line">    <span class="comment">// 其次，source[key] 必须是数组或者对象，才有必要深度递归（否则没必要）</span></span><br><span class="line">    <span class="keyword">for</span> (key <span class="keyword">in</span> source)</span><br><span class="line">      <span class="keyword">if</span> (deep &amp;&amp; (isPlainObject(source[key]) || isArray(source[key]))) &#123;</span><br><span class="line">        <span class="comment">// source[key] 是对象，而 target[key] 不是对象</span></span><br><span class="line">        <span class="comment">// 则 target[key] = &#123;&#125; 初始化一下，否则递归会出错的</span></span><br><span class="line">        <span class="keyword">if</span> (isPlainObject(source[key]) &amp;&amp; !isPlainObject(target[key]))</span><br><span class="line">          target[key] = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// source[key] 是数组，而 target[key] 不是数组</span></span><br><span class="line">        <span class="comment">// 则 target[key] = [] 初始化一下，否则递归会出错的</span></span><br><span class="line">        <span class="keyword">if</span> (isArray(source[key]) &amp;&amp; !isArray(target[key])) target[key] = [];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行递归</span></span><br><span class="line">        extend(target[key], source[key], deep);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 不满足以上条件，说明 source[key] 是一般的值类型，直接赋值给 target 就是了</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (source[key] !== <span class="literal">undefined</span>) target[key] = source[key];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Copy all but undefined properties from one or more</span></span><br><span class="line">  <span class="comment">// objects to the `target` object.</span></span><br><span class="line">  $.extend = <span class="function"><span class="keyword">function</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 一般传入的参数会是：</span></span><br><span class="line">    <span class="comment">// (targetObj, srcObj1, srcObj2, srcObj1...)</span></span><br><span class="line">    <span class="comment">// (true, targetObj, srcObj1, srcObj2, srcObj1...)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// arguments 是对象数组，slice.call 会返回真正的数组（此处返回从第二项开始）</span></span><br><span class="line">    <span class="keyword">var</span> deep,</span><br><span class="line">      args = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第一个参数是boolean，这里会把第二个参数当做 target，其他的作为 source</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> target == <span class="string">"boolean"</span>) &#123;</span><br><span class="line">      deep = target;</span><br><span class="line">      target = args.shift();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将所有的 source 添加到 target 中</span></span><br><span class="line">    args.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">      extend(target, arg, deep);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 感觉这样设计是比较好，很好的将业务和底层进行了分离（虽然比较简单）：</span></span><br><span class="line">    <span class="comment">// 核心方法再 function extend(...)&#123;...&#125; 中定义，</span></span><br><span class="line">    <span class="comment">// 而 $.extend 方法中做一些外围的判断和处理，最终调用 extend 函数去执行</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.qsa` is Zepto's CSS selector implementation which</span></span><br><span class="line">  <span class="comment">// uses `document.querySelectorAll` and optimizes for some special cases, like `#id`.</span></span><br><span class="line">  <span class="comment">// This method can be overriden in plugins.</span></span><br><span class="line">  zepto.qsa = <span class="function"><span class="keyword">function</span>(<span class="params">element, selector</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      @element: 容器</span></span><br><span class="line"><span class="comment">      @selector: 选择器</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> found,</span><br><span class="line">      maybeID = selector[<span class="number">0</span>] == <span class="string">"#"</span>,</span><br><span class="line">      maybeClass = !maybeID &amp;&amp; selector[<span class="number">0</span>] == <span class="string">"."</span>,</span><br><span class="line">      <span class="comment">// ID或class形式：返回 selector.slice(1) 即ID或者class的值</span></span><br><span class="line">      <span class="comment">// 否则：返回 selector，如通过 tagName 查询</span></span><br><span class="line">      nameOnly = maybeID || maybeClass ? selector.slice(<span class="number">1</span>) : selector, <span class="comment">// Ensure that a 1 char tag name still gets checked</span></span><br><span class="line">      <span class="comment">// 是否是一个简单的字符串（可能是一个复杂的选择器，如 'div#div1 .item[link] .red'）</span></span><br><span class="line">      isSimple = simpleSelectorRE.test(nameOnly);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上文定义：</span></span><br><span class="line">    <span class="comment">// // 匹配一个包括（字母、数组、下划线、-）的字符串</span></span><br><span class="line">    <span class="comment">// simpleSelectorRE = /^[\w-]*$/,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 以下代码的基本思路是：</span></span><br><span class="line">    <span class="comment">// 1. 优先通过 ID 获取元素；</span></span><br><span class="line">    <span class="comment">// 2. 然后试图通过 className 和 tagName 获取元素</span></span><br><span class="line">    <span class="comment">// 3. 最后通过 querySelectorAll 来获取</span></span><br><span class="line">    <span class="keyword">return</span> isDocument(element) &amp;&amp; isSimple &amp;&amp; maybeID</span><br><span class="line">      ? <span class="comment">// 这是最简单的形式：容器是document、选择器是一个id</span></span><br><span class="line">        <span class="comment">// 因为 getElementById 只能在 document 上用，所以这里单独拿出来</span></span><br><span class="line">        (found = element.getElementById(nameOnly))</span><br><span class="line">        ? [found]</span><br><span class="line">        : []</span><br><span class="line">      : element.nodeType !== <span class="number">1</span> &amp;&amp; element.nodeType !== <span class="number">9</span></span><br><span class="line">      ? <span class="comment">// 容器不是一般元素，也不是document，直接返回 []</span></span><br><span class="line">        []</span><br><span class="line">      : <span class="comment">// 将获取的所有元素集合，都转换为数组</span></span><br><span class="line">        slice.call(</span><br><span class="line">          isSimple &amp;&amp; !maybeID</span><br><span class="line">            ? <span class="comment">// isSimple情况下，nameOnly 只可能是 className 或者 tagName</span></span><br><span class="line">              <span class="comment">// getElementsByClassName 和 getElementsByTagName 可以在 elem 上用，而且比 querySelectorAll 速度快</span></span><br><span class="line">              <span class="comment">// 所以，只要elem容器有值，尽量单独拿出来处理</span></span><br><span class="line">              maybeClass</span><br><span class="line">              ? element.getElementsByClassName(nameOnly) <span class="comment">// If it's simple, it could be a class</span></span><br><span class="line">              : element.getElementsByTagName(selector) <span class="comment">// Or a tag</span></span><br><span class="line">            : <span class="comment">// 最后其他情况，只能通过 querySelectorAll 来处理</span></span><br><span class="line">              element.querySelectorAll(selector) <span class="comment">// Or it's not simple, and we need to query all</span></span><br><span class="line">        );</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 根据 selector 筛选 nodes</span></span><br><span class="line">  <span class="comment">// 并将 nodes 封装为 zepto 对象</span></span><br><span class="line">  <span class="comment">// $.fn.filter 下文定义</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">filtered</span>(<span class="params">nodes, selector</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> selector == <span class="literal">null</span> ? $(nodes) : $(nodes).filter(selector);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断 parent 是否包含 node</span></span><br><span class="line">  $.contains = <span class="built_in">document</span>.documentElement.contains</span><br><span class="line">    ? <span class="comment">// 浏览器支持 contains 方法</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params">parent, node</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> parent !== node &amp;&amp; parent.contains(node);</span><br><span class="line">      &#125;</span><br><span class="line">    : <span class="comment">// 不支持 contains 方法</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params">parent, node</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (node &amp;&amp; (node = node.parentNode))</span><br><span class="line">          <span class="keyword">if</span> (node === parent) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果 arg 是函数，则改变函数的执行环境和参数</span></span><br><span class="line">  <span class="comment">// 如果不是，直接返回 arg</span></span><br><span class="line">  <span class="comment">// $.fn.html 方法就用到了</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">funcArg</span>(<span class="params">context, arg, idx, payload</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> isFunction(arg) ? arg.call(context, idx, payload) : arg;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置属性</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setAttribute</span>(<span class="params">node, name, value</span>) </span>&#123;</span><br><span class="line">    value == <span class="literal">null</span> ? node.removeAttribute(name) : node.setAttribute(name, value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置或获取 node 的 className</span></span><br><span class="line">  <span class="comment">// 考虑 svg ？？？？</span></span><br><span class="line">  <span class="comment">// access className property while respecting SVGAnimatedString</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">className</span>(<span class="params">node, value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> klass = node.className || <span class="string">""</span>,</span><br><span class="line">      svg = klass &amp;&amp; klass.baseVal !== <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取</span></span><br><span class="line">    <span class="keyword">if</span> (value === <span class="literal">undefined</span>) <span class="keyword">return</span> svg ? klass.baseVal : klass;</span><br><span class="line">    <span class="comment">// 设置</span></span><br><span class="line">    svg ? (klass.baseVal = value) : (node.className = value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将字符串变成响应的对象或者值，例如源代码的注释：</span></span><br><span class="line">  <span class="comment">// "true"  =&gt; true</span></span><br><span class="line">  <span class="comment">// "false" =&gt; false</span></span><br><span class="line">  <span class="comment">// "null"  =&gt; null</span></span><br><span class="line">  <span class="comment">// "42"    =&gt; 42</span></span><br><span class="line">  <span class="comment">// "42.5"  =&gt; 42.5</span></span><br><span class="line">  <span class="comment">// "08"    =&gt; "08"</span></span><br><span class="line">  <span class="comment">// JSON    =&gt; parse if valid</span></span><br><span class="line">  <span class="comment">// String  =&gt; self</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">deserializeValue</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">        ? <span class="comment">// value『有值』的情况：</span></span><br><span class="line">          value == <span class="string">"true"</span> || <span class="comment">// 如果 value == 'true'，那么这个表达式本身就返回 true ，导致整个函数返回true</span></span><br><span class="line">            <span class="comment">// value !== 'true' 的情况：</span></span><br><span class="line">            (value == <span class="string">"false"</span></span><br><span class="line">              ? <span class="literal">false</span> <span class="comment">// "null"  =&gt; null</span></span><br><span class="line">              : value == <span class="string">"null"</span></span><br><span class="line">              ? <span class="literal">null</span> <span class="comment">// "null"  =&gt; null</span></span><br><span class="line">              : +value + <span class="string">""</span> == value</span><br><span class="line">              ? +value <span class="comment">// 数字："42" =&gt; 42  "42.5" =&gt; 42.5  （ 但是 '08' 却不符合这个条件 ）</span></span><br><span class="line">              : <span class="regexp">/^[\[\&#123;]/</span>.test(value)</span><br><span class="line">              ? $.parseJSON(value) <span class="comment">// '[...]' 或者 '&#123;...&#125;'</span></span><br><span class="line">              : value) <span class="comment">// 其他</span></span><br><span class="line">        : <span class="comment">// value『无值』的情况： undefined / '' / flase / 0 / null</span></span><br><span class="line">          value;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将上文定义的函数，暴露给 $ 对象（其实 $ 是一个 function）</span></span><br><span class="line">  $.type = type;</span><br><span class="line">  $.isFunction = isFunction;</span><br><span class="line">  $.isWindow = isWindow;</span><br><span class="line">  $.isArray = isArray;</span><br><span class="line">  $.isPlainObject = isPlainObject;</span><br><span class="line"></span><br><span class="line">  $.isEmptyObject = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name;</span><br><span class="line">    <span class="keyword">for</span> (name <span class="keyword">in</span> obj) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  $.inArray = <span class="function"><span class="keyword">function</span>(<span class="params">elem, array, i</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> emptyArray.indexOf.call(array, elem, i);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  $.camelCase = camelize;</span><br><span class="line">  $.trim = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str == <span class="literal">null</span> ? <span class="string">""</span> : <span class="built_in">String</span>.prototype.trim.call(str);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// plugin compatibility</span></span><br><span class="line">  $.uuid = <span class="number">0</span>;</span><br><span class="line">  $.support = &#123;&#125;;</span><br><span class="line">  $.expr = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重新组织 elements 对象（数组、对象或者对象数组），针对每一个元素，都用 callback 进行检验</span></span><br><span class="line">  <span class="comment">// 检验通过后，将元素push进一个新数组，并返回</span></span><br><span class="line">  $.map = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value,</span><br><span class="line">      values = [],</span><br><span class="line">      i,</span><br><span class="line">      key;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数组，或者对象数组</span></span><br><span class="line">    <span class="keyword">if</span> (likeArray(elements))</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; elements.length; i++) &#123;</span><br><span class="line">        <span class="comment">// 遍历，经过 callback 验证，push到结果中</span></span><br><span class="line">        value = callback(elements[i], i);</span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) values.push(value);</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="comment">// 对象</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="keyword">for</span> (key <span class="keyword">in</span> elements) &#123;</span><br><span class="line">        <span class="comment">// 遍历，经过 callback 验证，push到结果中</span></span><br><span class="line">        value = callback(elements[key], key);</span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) values.push(value);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回数组</span></span><br><span class="line">    <span class="comment">// flatten 函数上文定义的，作用：无论 values 是否是数组，都将返回一个正确的数组。例如，传入 'abc' ，返回 ['abc']</span></span><br><span class="line">    <span class="keyword">return</span> flatten(values);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 遍历 elements 所有元素（数组、对象数组、对象），执行 callback 方法，最终还是返回 elements</span></span><br><span class="line">  <span class="comment">// 注意1：callback.call(elements[i], i, elements[i]) 函数执行的环境和参数</span></span><br><span class="line">  <span class="comment">// 注意2：=== false) return elements 一旦有函数返回 false，即跳出循环，类似 break</span></span><br><span class="line">  <span class="comment">// 注意3：无论哪种情况，最终返回的还是 elements</span></span><br><span class="line">  $.each = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i, key;</span><br><span class="line">    <span class="keyword">if</span> (likeArray(elements)) &#123;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; elements.length; i++)</span><br><span class="line">        <span class="keyword">if</span> (callback.call(elements[i], i, elements[i]) === <span class="literal">false</span>)</span><br><span class="line">          <span class="keyword">return</span> elements;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (key <span class="keyword">in</span> elements)</span><br><span class="line">        <span class="keyword">if</span> (callback.call(elements[key], key, elements[key]) === <span class="literal">false</span>)</span><br><span class="line">          <span class="keyword">return</span> elements;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> elements;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 上文定义：filter = emptyArray.filter</span></span><br><span class="line">  <span class="comment">// 筛选数组</span></span><br><span class="line">  $.grep = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> filter.call(elements, callback);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.JSON) $.parseJSON = <span class="built_in">JSON</span>.parse;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Populate the class2type map</span></span><br><span class="line">  $.each(</span><br><span class="line">    <span class="string">"Boolean Number String Function Array Date RegExp Object Error"</span>.split(<span class="string">" "</span>),</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">i, name</span>) </span>&#123;</span><br><span class="line">      class2type[<span class="string">"[object "</span> + name + <span class="string">"]"</span>] = name.toLowerCase();</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">      上文将 class2type 赋值为 &#123;&#125;</span></span><br><span class="line"><span class="comment">      最终将 class2type 赋值为：</span></span><br><span class="line"><span class="comment">      &#123;</span></span><br><span class="line"><span class="comment">        '[object boolean]': 'boolean',</span></span><br><span class="line"><span class="comment">        '[object number]': 'number',</span></span><br><span class="line"><span class="comment">        '[object string]': 'string',</span></span><br><span class="line"><span class="comment">        ...</span></span><br><span class="line"><span class="comment">      &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      存储这个数据是为了方便的获取一些对象的类型，</span></span><br><span class="line"><span class="comment">      例如 Object.prototype.toString.call([]) 返回的是 '[Object Array]'</span></span><br><span class="line"><span class="comment">      那么即可根据这个获取 [] 的类型是 'array'</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Define methods that will be available on all</span></span><br><span class="line">  <span class="comment">// Zepto collections</span></span><br><span class="line">  $.fn = &#123;</span><br><span class="line">    <span class="comment">// 为何要这么多数组的方法？</span></span><br><span class="line">    <span class="comment">// 因为一个 zepto 对象，本身就是一个数组</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Because a collection acts like an array</span></span><br><span class="line">    <span class="comment">// copy over these useful array functions.</span></span><br><span class="line">    forEach: emptyArray.forEach,</span><br><span class="line">    reduce: emptyArray.reduce, <span class="comment">// 方法何用？？？？</span></span><br><span class="line">    push: emptyArray.push,</span><br><span class="line">    sort: emptyArray.sort,</span><br><span class="line">    indexOf: emptyArray.indexOf,</span><br><span class="line">    concat: emptyArray.concat,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// `map` and `slice` in the jQuery API work differently</span></span><br><span class="line">    <span class="comment">// from their array counterparts</span></span><br><span class="line">    map: <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// $.map 上文定义的， $.map = function (elements, callback) &#123;....&#125;</span></span><br><span class="line">      <span class="comment">// $.map 作用：针对 elements（对象、对象数组或数组），对每个元素都经过 callback 函数的过滤，并将过滤通过的元素，push到一个新数组中，返回新数组</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 最后，用 $ 封装返回</span></span><br><span class="line">      <span class="keyword">return</span> $(</span><br><span class="line">        <span class="comment">// $.map 返回的是一个数组</span></span><br><span class="line">        $.map(</span><br><span class="line">          <span class="keyword">this</span>,</span><br><span class="line">          <span class="comment">// 针对每一个元素，都执行传入的函数，如果函数返回的 !=null 就将插入到新返回的数组</span></span><br><span class="line">          <span class="function"><span class="keyword">function</span>(<span class="params">el, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> fn.call(el, i, el);</span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        $('div').map(function(key, value)&#123;</span></span><br><span class="line"><span class="comment">          return value.id;</span></span><br><span class="line"><span class="comment">          // 或者 return this.id;</span></span><br><span class="line"><span class="comment">        &#125;)</span></span><br><span class="line"><span class="comment">        这个结果就是 $(['div1', 'div2' ...])</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    slice: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 直接数组的slice方法，并将结果用 $ 封装返回</span></span><br><span class="line">      <span class="keyword">return</span> $(slice.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>));</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在 zepto.init 函数中，当传入的函数是函数时，就用到了 ready</span></span><br><span class="line">    <span class="comment">// else if (isFunction(selector)) return $(document).ready(selector)</span></span><br><span class="line">    ready: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// need to check if document.body exists for IE as that browser reports</span></span><br><span class="line">      <span class="comment">// document ready when it hasn't yet created the body element</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 下文定义：readyRE = /complete|loaded|interactive/,</span></span><br><span class="line">      <span class="keyword">if</span> (readyRE.test(<span class="built_in">document</span>.readyState) &amp;&amp; <span class="built_in">document</span>.body) callback($);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">document</span>.addEventListener(</span><br><span class="line">          <span class="string">"DOMContentLoaded"</span>,</span><br><span class="line">          <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            callback($);</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="literal">false</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 返回当前对象</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    get: <span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> idx === <span class="literal">undefined</span></span><br><span class="line">        ? slice.call(<span class="keyword">this</span>) <span class="comment">// 未传参数，直接返回一整个数组</span></span><br><span class="line">        : <span class="comment">// 有参数，则试图返回单个元素（大于0，小于0 两种情况）</span></span><br><span class="line">          <span class="keyword">this</span>[idx &gt;= <span class="number">0</span> ? idx : idx + <span class="keyword">this</span>.length];</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将zepto集合变为纯数组</span></span><br><span class="line">    toArray: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.get();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    size: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.length;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将元素从这个DOM树中移除</span></span><br><span class="line">    remove: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.parentNode != <span class="literal">null</span>) <span class="keyword">this</span>.parentNode.removeChild(<span class="keyword">this</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    each: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// [].every ES5中Array的新特性。循环数组每个元素，返回是否符合callback函数的要求</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// every 函数返回的是 false 或者 true（不过这里返回什么无所谓，执行就可以了）</span></span><br><span class="line">      emptyArray.every.call(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el, idx</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> callback.call(el, idx, el) !== <span class="literal">false</span>;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 最后返回本身对象</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    filter: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// not函数下文定义</span></span><br><span class="line">      <span class="comment">// 如果给not传入的参数是函数，则返回不符合这个函数规则的元素的数组（用 $ 封装）</span></span><br><span class="line">      <span class="keyword">if</span> (isFunction(selector)) <span class="keyword">return</span> <span class="keyword">this</span>.not(<span class="keyword">this</span>.not(selector));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 上文定义：zepto.matches 判断elements是否符合 selector 的要求</span></span><br><span class="line">      <span class="comment">// zepto.matches = function(element, selector) &#123;...&#125;</span></span><br><span class="line">      <span class="keyword">return</span> $(</span><br><span class="line">        filter.call(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 利用 [].filter 方法做筛选，利用 zepto.matches 做判断</span></span><br><span class="line">          <span class="keyword">return</span> zepto.matches(element, selector);</span><br><span class="line">        &#125;)</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// $('div') 可能只有三个 div 节点，那么 $('div').add('p') 再三个 div 节点的基础上，增加三个 p 节点</span></span><br><span class="line">    add: <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// uniq函数——数组去重，例如：用来将 [1,1,2,2,3,3] 替换为 [1,2,3]</span></span><br><span class="line">      <span class="keyword">return</span> $(uniq(<span class="keyword">this</span>.concat($(selector, context))));</span><br><span class="line">    &#125;,</span><br><span class="line">    is: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 注意：这里只对 this[0] 第一个元素做判断了，其他的元素不管了</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.length &gt; <span class="number">0</span> &amp;&amp; zepto.matches(<span class="keyword">this</span>[<span class="number">0</span>], selector);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    not: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> nodes = []; <span class="comment">// 存储最后返回的结果</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果参数是函数</span></span><br><span class="line">      <span class="keyword">if</span> (isFunction(selector) &amp;&amp; selector.call !== <span class="literal">undefined</span>)</span><br><span class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 遍历对象的所有元素，对每个元素都执行传入的函数</span></span><br><span class="line">          <span class="comment">// 当函数返回 false 时（即不符合函数的规则），则将当前元素push到结果中，等待返回</span></span><br><span class="line">          <span class="keyword">if</span> (!selector.call(<span class="keyword">this</span>, idx)) nodes.push(<span class="keyword">this</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">      <span class="comment">// 如果参数不是函数</span></span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 为 excludes 赋值</span></span><br><span class="line">        <span class="keyword">var</span> excludes =</span><br><span class="line">          <span class="comment">// 如果 selector 是字符串（css选择器），则用filter过滤，将结果存储到 excludes 中</span></span><br><span class="line">          <span class="keyword">typeof</span> selector == <span class="string">"string"</span></span><br><span class="line">            ? <span class="keyword">this</span>.filter(selector)</span><br><span class="line">            : <span class="comment">// 如果 selector 不是字符串</span></span><br><span class="line">            <span class="comment">// 如果是数组或者对象数组（并且 selector.item 是函数？？？），则生成数组，赋值给 excludes</span></span><br><span class="line">            likeArray(selector) &amp;&amp; isFunction(selector.item)</span><br><span class="line">            ? slice.call(selector)</span><br><span class="line">            : <span class="comment">// 否则直接生成 zepto 对象，赋值给 excludes</span></span><br><span class="line">              $(selector);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 至此，excludes 中就存储了通过 selector 查找出来的元素</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// [].forEach 是ES5的新特性</span></span><br><span class="line">        <span class="keyword">this</span>.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 取出 excludes 中不包含的元素，push到结果中</span></span><br><span class="line">          <span class="keyword">if</span> (excludes.indexOf(el) &lt; <span class="number">0</span>) nodes.push(el);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 返回最后的结果，用 $ 封装</span></span><br><span class="line">      <span class="keyword">return</span> $(nodes);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    has: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 经过 filter 函数处理，返回的是一个处理后的值</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isObject(selector)</span><br><span class="line">          ? <span class="comment">// 如果 seletor 是 object（可能是elem节点），则用 $.contains 判断</span></span><br><span class="line">            $.contains(<span class="keyword">this</span>, selector)</span><br><span class="line">          : <span class="comment">// 否则（selector是css选择字符串）则返回find后的size（如果 size === 0 即相当于返回 false）</span></span><br><span class="line">            $(<span class="keyword">this</span>)</span><br><span class="line">              .find(selector)</span><br><span class="line">              .size();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// $.fn.find 在下文定义</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    eq: <span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 取出指定index的元素</span></span><br><span class="line">      <span class="comment">// 可支持 -1、0、1、2 ……</span></span><br><span class="line">      <span class="keyword">return</span> idx === <span class="number">-1</span> ? <span class="keyword">this</span>.slice(idx) : <span class="keyword">this</span>.slice(idx, +idx + <span class="number">1</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    first: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> el = <span class="keyword">this</span>[<span class="number">0</span>];</span><br><span class="line">      <span class="comment">// 不是 object 则直接返回</span></span><br><span class="line">      <span class="comment">// 是 object 类型，则用 $ 封装 （因为时刻都要支持链式操作！！！）</span></span><br><span class="line">      <span class="keyword">return</span> el &amp;&amp; !isObject(el) ? el : $(el);</span><br><span class="line">    &#125;,</span><br><span class="line">    last: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> el = <span class="keyword">this</span>[<span class="keyword">this</span>.length - <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">return</span> el &amp;&amp; !isObject(el) ? el : $(el);</span><br><span class="line">    &#125;,</span><br><span class="line">    find: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// result 存储返回结果</span></span><br><span class="line">      <span class="keyword">var</span> result,</span><br><span class="line">        $<span class="keyword">this</span> = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果没有参数，就返回一个空的 zepto 对象</span></span><br><span class="line">      <span class="keyword">if</span> (!selector) result = $();</span><br><span class="line">      <span class="comment">// 如果selector是对象</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">"object"</span>)</span><br><span class="line">        result = $(selector).filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> node = <span class="keyword">this</span>;</span><br><span class="line">          <span class="keyword">return</span> emptyArray.some.call($<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">parent</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> $.contains(parent, node);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      <span class="comment">// 如果 selector 不是对象（即是css选择器）：</span></span><br><span class="line">      <span class="comment">// 如果只有一个元素，则使用 qsa 判断，结果经过 $ 封装后赋值给 result</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.length == <span class="number">1</span>) result = $(zepto.qsa(<span class="keyword">this</span>[<span class="number">0</span>], selector));</span><br><span class="line">      <span class="comment">// 如果有多个元素，则使用 map 遍历所有元素，使用 qsa 针对每个元素判断，符合条件即返回（map将返回包含符合条件的元素的新数组，并 $ 封装，支持链式操作！！）</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        result = <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> zepto.qsa(<span class="keyword">this</span>, selector);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 返回最终结果</span></span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从元素本身开始，逐级向上级元素匹配，并返回最先匹配selector的元素</span></span><br><span class="line">    closest: <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> node = <span class="keyword">this</span>[<span class="number">0</span>],</span><br><span class="line">        collection = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果 selector 是对象，则用 $ 封装后，赋值给 collection</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">"object"</span>) collection = $(selector);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">while</span> (</span><br><span class="line">        <span class="comment">// while循环的判断条件：</span></span><br><span class="line">        <span class="comment">// 第一，node有值（node一开始被赋值为对象的第一个元素）</span></span><br><span class="line">        <span class="comment">// 第二，collection有值（传入的selector是对象）则collection包含node；collection无值（传入的selector是字符串，css选择），则node满足selector条件</span></span><br><span class="line">        <span class="comment">// 满足第一个条件，不满足第二条件，则循环继续（node试图赋值为node.parentNode）；否则，循环跳出（说明已经找到了符合条件的父节点）</span></span><br><span class="line">        node &amp;&amp;</span><br><span class="line">        !(collection</span><br><span class="line">          ? collection.indexOf(node) &gt;= <span class="number">0</span></span><br><span class="line">          : zepto.matches(node, selector))</span><br><span class="line">      )</span><br><span class="line">        <span class="comment">// node赋值成 node.parentNode</span></span><br><span class="line">        <span class="comment">// 前提条件是：node != context &amp;&amp; node 不是 document，如果是这两个条件之一，那就不继续赋值</span></span><br><span class="line">        node = node !== context &amp;&amp; !isDocument(node) &amp;&amp; node.parentNode;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 返回最终结果</span></span><br><span class="line">      <span class="keyword">return</span> $(node);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取对象集合每个元素所有的祖先元素。 $('h1').parents() =&gt; [&lt;div#container&gt;, &lt;body&gt;, &lt;html&gt;]</span></span><br><span class="line">    parents: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> ancestors = [],</span><br><span class="line">        nodes = <span class="keyword">this</span>;</span><br><span class="line">      <span class="keyword">while</span> (nodes.length &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// 可能需要执行多次 while 循环</span></span><br><span class="line">        <span class="comment">// 每次执行 $.map 函数都会对 nodes 重新赋值，然后再判断是否需要继续循环</span></span><br><span class="line">        <span class="comment">// 因为要获取每个元素的所有祖先元素，所以要多次循环</span></span><br><span class="line">        nodes = $.map(nodes, <span class="function"><span class="keyword">function</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 使用 $.map（返回符合条件的元素的新数组，并用 $ 封装）遍历所有元素</span></span><br><span class="line">          <span class="keyword">if</span> (</span><br><span class="line">            (node = node.parentNode) &amp;&amp;</span><br><span class="line">            !isDocument(node) &amp;&amp;</span><br><span class="line">            ancestors.indexOf(node) &lt; <span class="number">0</span></span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="comment">// 将符合条件的元素push到结果中</span></span><br><span class="line">            <span class="comment">// 条件：不能是 document，结果中元素不能重复。否则不执行push</span></span><br><span class="line">            ancestors.push(node);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 返回的 node ，将拼接出新数组，重新复制给 nodes，然后试图继续执行 while 循环</span></span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果css选择器参数给出，过滤出符合条件的元素</span></span><br><span class="line">      <span class="keyword">return</span> filtered(ancestors, selector);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取对象集合中每个元素的直接父元素。如果css选择器参数给出。过滤出符合条件的元素。</span></span><br><span class="line">    parent: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// pluck 函数在下文定义</span></span><br><span class="line">      <span class="comment">// parent 函数，只获取第一级父节点即可</span></span><br><span class="line">      <span class="keyword">return</span> filtered(uniq(<span class="keyword">this</span>.pluck(<span class="string">"parentNode"</span>)), selector);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得每个匹配元素集合元素的直接子元素，可通过 selector 过滤</span></span><br><span class="line">    children: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> filtered(</span><br><span class="line">        <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> children(<span class="keyword">this</span>);</span><br><span class="line">        &#125;),</span><br><span class="line">        selector</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得每个匹配元素集合元素的子元素，包括文字和注释节点</span></span><br><span class="line">    contents: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> slice.call(<span class="keyword">this</span>.childNodes);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取对象集合中所有元素的兄弟节点，可通过 selector 过滤</span></span><br><span class="line">    siblings: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> filtered(</span><br><span class="line">        <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params">i, el</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 获取兄弟节点</span></span><br><span class="line">          <span class="keyword">return</span> filter.call(children(el.parentNode), <span class="function"><span class="keyword">function</span>(<span class="params">child</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> child !== el;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;),</span><br><span class="line">        selector</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    empty: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.innerHTML = <span class="string">""</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// `pluck` is borrowed from Prototype.js</span></span><br><span class="line">    pluck: <span class="function"><span class="keyword">function</span>(<span class="params">property</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 获取自定义属性，返回值，拼接数组</span></span><br><span class="line">      <span class="keyword">return</span> $.map(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> el[property];</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    show: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 返回当前对象，保证可链式操作</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 第一步，针对内联样式，将 none 改为空字符串，如 &lt;p id="p2" style="display:none;"&gt;p2&lt;/p&gt;</span></span><br><span class="line">        <span class="keyword">this</span>.style.display == <span class="string">"none"</span> &amp;&amp; (<span class="keyword">this</span>.style.display = <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第二步，针对css样式，如果是 none 则修改为默认的显示样式</span></span><br><span class="line">        <span class="keyword">if</span> (getComputedStyle(<span class="keyword">this</span>, <span class="string">""</span>).getPropertyValue(<span class="string">"display"</span>) == <span class="string">"none"</span>)</span><br><span class="line">          <span class="keyword">this</span>.style.display = defaultDisplay(<span class="keyword">this</span>.nodeName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// show 方法是为了显示对象，而对象隐藏的方式有两种：内联样式 或 css样式</span></span><br><span class="line">        <span class="comment">// this.style.display 只能获取内联样式的值（获取属性值）</span></span><br><span class="line">        <span class="comment">// getComputedStyle(this, '').getPropertyValue("display") 可以获取内联、css样式的值（获取 renderTree 的值）</span></span><br><span class="line">        <span class="comment">// 因此，这两步都要做判断，</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    replaceWith: <span class="function"><span class="keyword">function</span>(<span class="params">newContent</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 先在前面插入，然后将当前对象移除</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.before(newContent).remove();</span><br><span class="line">    &#125;,</span><br><span class="line">    wrap: <span class="function"><span class="keyword">function</span>(<span class="params">structure</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 是否是函数</span></span><br><span class="line">      <span class="keyword">var</span> func = isFunction(structure);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; !func)</span><br><span class="line">        <span class="keyword">var</span> dom = $(structure).get(<span class="number">0</span>),</span><br><span class="line">          <span class="comment">// 何时用 clone ？</span></span><br><span class="line">          <span class="comment">// 第一，dom.parentNode 说明 dom 在文档结构中，不 clone 就会被移动</span></span><br><span class="line">          <span class="comment">// 第二，this.length &gt; 1 说明当前对象有多个元素，每个元素都要添加，所有要clone</span></span><br><span class="line">          clone = dom.parentNode || <span class="keyword">this</span>.length &gt; <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 借用 wrapAll 方法来做包装</span></span><br><span class="line">        $(<span class="keyword">this</span>).wrapAll(</span><br><span class="line">          func ? structure.call(<span class="keyword">this</span>, index) : clone ? dom.cloneNode(<span class="literal">true</span>) : dom</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 在所有匹配元素外面包一个单独的结构</span></span><br><span class="line">    wrapAll: <span class="function"><span class="keyword">function</span>(<span class="params">structure</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>[<span class="number">0</span>]) &#123;</span><br><span class="line">        <span class="comment">// 先将 structure 插入到文档结构</span></span><br><span class="line">        $(<span class="keyword">this</span>[<span class="number">0</span>]).before((structure = $(structure)));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> children;</span><br><span class="line">        <span class="comment">// drill down to the inmost element</span></span><br><span class="line">        <span class="comment">// 通过循环，将 structure 重新赋值为当前 structure 的最深处的一个子元素</span></span><br><span class="line">        <span class="keyword">while</span> ((children = structure.children()).length)</span><br><span class="line">          structure = children.first();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将所有子元素都包裹进 structure</span></span><br><span class="line">        $(structure).append(<span class="keyword">this</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 返回当前对象</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    wrapInner: <span class="function"><span class="keyword">function</span>(<span class="params">structure</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 是否是函数</span></span><br><span class="line">      <span class="keyword">var</span> func = isFunction(structure);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 返回对象自身，保证链式操作</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self = $(<span class="keyword">this</span>),</span><br><span class="line">          contents = self.contents(),</span><br><span class="line">          <span class="comment">// 是函数，即获取函数执行的返回结果；否则直接用 structure 参数</span></span><br><span class="line">          dom = func ? structure.call(<span class="keyword">this</span>, index) : structure;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果当前元素有内容，则通过内容 wrapAll。无内容，则直接用自身的 append 增加</span></span><br><span class="line">        contents.length ? contents.wrapAll(dom) : self.append(dom);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    unwrap: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 通过 this.parent() 获取每个元素的父节点（集合）</span></span><br><span class="line">      <span class="comment">// 遍历这个父节点的集合</span></span><br><span class="line">      <span class="keyword">this</span>.parent().each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 将当前父节点替换为它的子节点</span></span><br><span class="line">        $(<span class="keyword">this</span>).replaceWith($(<span class="keyword">this</span>).children());</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 返回对象自身，保证链式操作</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    clone: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 通过 this.map 循环对象，</span></span><br><span class="line">      <span class="comment">// 针对每个元素都返回它的clone         这个 this 和前面的 this 不一样</span></span><br><span class="line">      <span class="comment">// 返回新数组（用 $ 封装）</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.cloneNode(<span class="literal">true</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    hide: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.css(<span class="string">"display"</span>, <span class="string">"none"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 切换显示和隐藏</span></span><br><span class="line">    toggle: <span class="function"><span class="keyword">function</span>(<span class="params">setting</span>) </span>&#123;</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        @setting</span></span><br><span class="line"><span class="comment">        true : 强制切换为 show</span></span><br><span class="line"><span class="comment">        false : 强制切换为 hide</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> el = $(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 条件判断：</span></span><br><span class="line">        <span class="comment">// 如果 setting === undefined 则看 el.css("display") == "none"</span></span><br><span class="line">        <span class="comment">// 如果 setting !== undefined 则看 !!setting</span></span><br><span class="line">        (setting === <span class="literal">undefined</span></span><br><span class="line">        ? el.css(<span class="string">"display"</span>) == <span class="string">"none"</span></span><br><span class="line">        : setting)</span><br><span class="line">          ? el.show() <span class="comment">// 如果 true 则显示</span></span><br><span class="line">          : el.hide(); <span class="comment">// 如果 false 则隐藏</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 借助 previousElementSibling 属性</span></span><br><span class="line">    prev: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $(<span class="keyword">this</span>.pluck(<span class="string">"previousElementSibling"</span>)).filter(selector || <span class="string">"*"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 借助 nextElementSibling 属性</span></span><br><span class="line">    next: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $(<span class="keyword">this</span>.pluck(<span class="string">"nextElementSibling"</span>)).filter(selector || <span class="string">"*"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    html: <span class="function"><span class="keyword">function</span>(<span class="params">html</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 情况1：有参数，赋值，并返回自身</span></span><br><span class="line">      <span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span></span><br><span class="line">        ? <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> originHtml = <span class="keyword">this</span>.innerHTML;</span><br><span class="line">            <span class="comment">// 传入的 html 参数允许是一个字符串，也允许是一个函数</span></span><br><span class="line">            <span class="comment">// 通过 funcArg 函数：</span></span><br><span class="line">            <span class="comment">//  1.如果 html 是字符串，则返回html</span></span><br><span class="line">            <span class="comment">//  2.如果 html 是函数，则执行执行函数（传入 idx、originHtml），返回函数执行结果</span></span><br><span class="line">            $(<span class="keyword">this</span>)</span><br><span class="line">              .empty()</span><br><span class="line">              .append(funcArg(<span class="keyword">this</span>, html, idx, originHtml));</span><br><span class="line">          &#125;)</span><br><span class="line">        : <span class="comment">/*</span></span><br><span class="line"><span class="comment">          插播：</span></span><br><span class="line"><span class="comment">          function funcArg(context, arg, idx, payload) &#123;</span></span><br><span class="line"><span class="comment">            return isFunction(arg) ? arg.call(context, idx, payload) : arg</span></span><br><span class="line"><span class="comment">          &#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 情况2：无参数，取值</span></span><br><span class="line">        <span class="number">0</span> <span class="keyword">in</span> <span class="keyword">this</span></span><br><span class="line">        ? <span class="keyword">this</span>[<span class="number">0</span>].innerHTML <span class="comment">// 直接取第一个元素的 innerHTML</span></span><br><span class="line">        : <span class="literal">null</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    text: <span class="function"><span class="keyword">function</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 情况1：有参数，赋值，并返回自身</span></span><br><span class="line">      <span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span></span><br><span class="line">        ? <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// funcArg的应用，和html方法中一样</span></span><br><span class="line">            <span class="keyword">var</span> newText = funcArg(<span class="keyword">this</span>, text, idx, <span class="keyword">this</span>.textContent);</span><br><span class="line">            <span class="keyword">this</span>.textContent = newText == <span class="literal">null</span> ? <span class="string">""</span> : <span class="string">""</span> + newText;</span><br><span class="line">          &#125;)</span><br><span class="line">        : <span class="comment">// 情况2：无参数，取值</span></span><br><span class="line">        <span class="number">0</span> <span class="keyword">in</span> <span class="keyword">this</span></span><br><span class="line">        ? <span class="keyword">this</span>[<span class="number">0</span>].textContent</span><br><span class="line">        : <span class="literal">null</span>; <span class="comment">// 直接借用 textContent 属性</span></span><br><span class="line">    &#125;,</span><br><span class="line">    attr: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> result;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 情况1：无第二个参数，读取值（读取值只能读取第一个元素的值）</span></span><br><span class="line">      <span class="keyword">typeof</span> name == <span class="string">"string"</span> &amp;&amp; !(<span class="number">1</span> <span class="keyword">in</span> <span class="built_in">arguments</span>)</span><br><span class="line">        ? !<span class="keyword">this</span>.length || <span class="keyword">this</span>[<span class="number">0</span>].nodeType !== <span class="number">1</span></span><br><span class="line">          ? <span class="literal">undefined</span></span><br><span class="line">          : <span class="comment">/*</span></span><br><span class="line"><span class="comment">            注释：</span></span><br><span class="line"><span class="comment">            this[0]是一个DOM节点，有『属性』也有『特性』</span></span><br><span class="line"><span class="comment">              result = this[0].getAttribute(name) 试图获取 DOM节点属性</span></span><br><span class="line"><span class="comment">              name in this[0] 判断是不是js对象的属性</span></span><br><span class="line"><span class="comment">            然后，该返回哪一个就返回哪一个</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line">          !(result = <span class="keyword">this</span>[<span class="number">0</span>].getAttribute(name)) &amp;&amp; name <span class="keyword">in</span> <span class="keyword">this</span>[<span class="number">0</span>]</span><br><span class="line">          ? <span class="keyword">this</span>[<span class="number">0</span>][name]</span><br><span class="line">          : result</span><br><span class="line">        : <span class="comment">// 情况2：有第二个参数，设置值（针对每个元素设置值）</span></span><br><span class="line">          <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.nodeType !== <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 传入的参数可能是一个对象集合</span></span><br><span class="line">            <span class="comment">// 此时，是不是应该放在『情况1』当中？？？此时，value根本没有用啊？？？</span></span><br><span class="line">            <span class="keyword">if</span> (isObject(name))</span><br><span class="line">              <span class="keyword">for</span> (key <span class="keyword">in</span> name) setAttribute(<span class="keyword">this</span>, key, name[key]);</span><br><span class="line">            <span class="comment">// 传入的不是对象，即设置一个单一的属性。</span></span><br><span class="line">            <span class="comment">// 但是，这里的 value 参数可以是一个函数</span></span><br><span class="line">            <span class="comment">// funcArg 即处理了 value 是函数和非函数的两种情况</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">              setAttribute(</span><br><span class="line">                <span class="keyword">this</span>,</span><br><span class="line">                name,</span><br><span class="line">                funcArg(<span class="keyword">this</span>, value, idx, <span class="keyword">this</span>.getAttribute(name))</span><br><span class="line">              );</span><br><span class="line">          &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    removeAttr: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nodeType === <span class="number">1</span> &amp;&amp;</span><br><span class="line">          name.split(<span class="string">" "</span>).forEach(</span><br><span class="line">            <span class="function"><span class="keyword">function</span>(<span class="params">attribute</span>) </span>&#123;</span><br><span class="line">              setAttribute(<span class="keyword">this</span>, attribute); <span class="comment">// 将属性设置为空，setAttribute会移除属性</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">this</span> <span class="comment">// 改参数将成为 forEach 中函数的this</span></span><br><span class="line">          );</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取、设置属性（js对象的属性）</span></span><br><span class="line">    prop: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// propMap 中存储的：key是html中的属性名称，value是js对象中的属性名称</span></span><br><span class="line">      <span class="comment">// 例如，html中的 "class" 在DOM对象中，就需要使用 "className" 这个名字读取，同理于：for  maxlength  cellspacing 等等</span></span><br><span class="line">      name = propMap[name] || name;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        上文定义：</span></span><br><span class="line"><span class="comment">        propMap = &#123;</span></span><br><span class="line"><span class="comment">          'tabindex': 'tabIndex',</span></span><br><span class="line"><span class="comment">          'readonly': 'readOnly',</span></span><br><span class="line"><span class="comment">          'for': 'htmlFor',</span></span><br><span class="line"><span class="comment">          'class': 'className',</span></span><br><span class="line"><span class="comment">          'maxlength': 'maxLength',</span></span><br><span class="line"><span class="comment">          'cellspacing': 'cellSpacing',</span></span><br><span class="line"><span class="comment">          'cellpadding': 'cellPadding',</span></span><br><span class="line"><span class="comment">          'rowspan': 'rowSpan',</span></span><br><span class="line"><span class="comment">          'colspan': 'colSpan',</span></span><br><span class="line"><span class="comment">          'usemap': 'useMap',</span></span><br><span class="line"><span class="comment">          'frameborder': 'frameBorder',</span></span><br><span class="line"><span class="comment">          'contenteditable': 'contentEditable'</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 有第二个参数，设置属性</span></span><br><span class="line">      <span class="number">1</span> <span class="keyword">in</span> <span class="built_in">arguments</span></span><br><span class="line">        ? <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// 设置属性值，funcArg处理函数或者非函数</span></span><br><span class="line">            <span class="keyword">this</span>[name] = funcArg(<span class="keyword">this</span>, value, idx, <span class="keyword">this</span>[name]);</span><br><span class="line">          &#125;)</span><br><span class="line">        : <span class="comment">// 无第二个参数，读取属性（读取第一个元素的）</span></span><br><span class="line">          <span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; <span class="keyword">this</span>[<span class="number">0</span>][name];</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 前面加上 'data-' 通过 attr 设置或者读取</span></span><br><span class="line">    data: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>) </span>&#123;</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        上文定义：</span></span><br><span class="line"><span class="comment">        capitalRE = /([A-Z])/g,  //大写字母</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//      前面加上 'data-'               将 'A' 替换为 '-a'</span></span><br><span class="line">      <span class="keyword">var</span> attrName = <span class="string">"data-"</span> + name.replace(capitalRE, <span class="string">"-$1"</span>).toLowerCase();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> data =</span><br><span class="line">        <span class="number">1</span> <span class="keyword">in</span> <span class="built_in">arguments</span> ? <span class="keyword">this</span>.attr(attrName, value) : <span class="keyword">this</span>.attr(attrName);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> data !== <span class="literal">null</span> ? deserializeValue(data) : <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        上文定义的，deserializeValue 函数的作用是：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        // 将字符串变成响应的对象或者值，例如源代码的注释：</span></span><br><span class="line"><span class="comment">        // "true"  =&gt; true</span></span><br><span class="line"><span class="comment">        // "false" =&gt; false</span></span><br><span class="line"><span class="comment">        // "null"  =&gt; null</span></span><br><span class="line"><span class="comment">        // "42"    =&gt; 42</span></span><br><span class="line"><span class="comment">        // "42.5"  =&gt; 42.5</span></span><br><span class="line"><span class="comment">        // "08"    =&gt; "08"</span></span><br><span class="line"><span class="comment">        // JSON    =&gt; parse if valid</span></span><br><span class="line"><span class="comment">        // String  =&gt; self</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    val: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 有参数，设置值</span></span><br><span class="line">      <span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span></span><br><span class="line">        ? <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// 遍历每个元素，直接对 value 属性赋值</span></span><br><span class="line">            <span class="keyword">this</span>.value = funcArg(<span class="keyword">this</span>, value, idx, <span class="keyword">this</span>.value);</span><br><span class="line">          &#125;)</span><br><span class="line">        : <span class="comment">// 无参数，读取值</span></span><br><span class="line">          <span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp;</span><br><span class="line">          <span class="comment">// 如果元素是 &lt;select multiple&gt; 多选列表</span></span><br><span class="line">          (<span class="keyword">this</span>[<span class="number">0</span>].multiple</span><br><span class="line">            ? <span class="comment">// 返回所有选中的option的值的数组</span></span><br><span class="line">              $(<span class="keyword">this</span>[<span class="number">0</span>])</span><br><span class="line">                .find(<span class="string">"option"</span>)</span><br><span class="line">                .filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">this</span>.selected;</span><br><span class="line">                &#125;)</span><br><span class="line">                .pluck(<span class="string">"value"</span>)</span><br><span class="line">            : <span class="comment">/*</span></span><br><span class="line"><span class="comment">                      上文定义：</span></span><br><span class="line"><span class="comment">                      pluck: function(property)&#123;</span></span><br><span class="line"><span class="comment">                        return $.map(this, function(el)&#123; return el[property] &#125;)</span></span><br><span class="line"><span class="comment">                      &#125;,</span></span><br><span class="line"><span class="comment">                   */</span></span><br><span class="line"></span><br><span class="line">              <span class="comment">// 如果不是，直接获取 value</span></span><br><span class="line">              <span class="keyword">this</span>[<span class="number">0</span>].value);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取、设置元素的 offset</span></span><br><span class="line">    offset: <span class="function"><span class="keyword">function</span>(<span class="params">coordinates</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 如果有 coordinates 参数，设置坐标值，并返回当前对象</span></span><br><span class="line">      <span class="keyword">if</span> (coordinates)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),</span><br><span class="line">            <span class="comment">// 支持函数（传入 $this.offset() 做参数）和非函数</span></span><br><span class="line">            coords = funcArg(<span class="keyword">this</span>, coordinates, index, $<span class="keyword">this</span>.offset()),</span><br><span class="line">            <span class="comment">// 找到最近的 “relative”, “absolute” or “fixed” 的祖先元素，并获取它的 offset()</span></span><br><span class="line">            parentOffset = $<span class="keyword">this</span>.offsetParent().offset(),</span><br><span class="line">            <span class="comment">// left 和 top 需要去掉定位的祖先元素的 left、top 值</span></span><br><span class="line">            props = &#123;</span><br><span class="line">              top: coords.top - parentOffset.top,</span><br><span class="line">              left: coords.left - parentOffset.left</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// static时，设置 top、left是无效的</span></span><br><span class="line">          <span class="keyword">if</span> ($<span class="keyword">this</span>.css(<span class="string">"position"</span>) == <span class="string">"static"</span>) props[<span class="string">"position"</span>] = <span class="string">"relative"</span>;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 通过 css 赋值</span></span><br><span class="line">          $<span class="keyword">this</span>.css(props);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 当前对象是空，则返回 null</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果没有 coordinates 参数，则返回第一个元素的坐标值</span></span><br><span class="line">      <span class="keyword">var</span> obj = <span class="keyword">this</span>[<span class="number">0</span>].getBoundingClientRect();</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        elem.getBoundingClientRect() 返回一个对象，</span></span><br><span class="line"><span class="comment">        包含元素的 top bottom left right width height 的值</span></span><br><span class="line"><span class="comment">        但是这个 top、bottom、left、right 是相对于浏览器窗口的距离，而不是页面的边界</span></span><br><span class="line"><span class="comment">        （注意，elem.getBoundingClientRect()在IE低版本浏览器有2px的兼容问题）</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        window.pageXOffset 和 window.pageYOffset 可获取网页滚动的距离，</span></span><br><span class="line"><span class="comment">        IE低版本需要用 document.body.scrollLeft 和 document.body.scrollTop 兼容</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        left: obj.left + <span class="built_in">window</span>.pageXOffset,</span><br><span class="line">        top: obj.top + <span class="built_in">window</span>.pageYOffset,</span><br><span class="line">        width: <span class="built_in">Math</span>.round(obj.width),</span><br><span class="line">        height: <span class="built_in">Math</span>.round(obj.height)</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置、获取 css</span></span><br><span class="line">    css: <span class="function"><span class="keyword">function</span>(<span class="params">property, value</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 只有一个参数，获取第一个元素的样式</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> computedStyle,</span><br><span class="line">          element = <span class="keyword">this</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (!element) <span class="keyword">return</span>; <span class="comment">// 如果第一个元素无值，直接返回。否则继续</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取元素的计算后的样式</span></span><br><span class="line">        computedStyle = getComputedStyle(element, <span class="string">""</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> property == <span class="string">"string"</span>)</span><br><span class="line">          <span class="comment">// 情况1，参数为字符串形式</span></span><br><span class="line">          <span class="comment">// 先从elem内联样式获取（element.style），此时需要 camelize(property) 转换，如将 background-color 变为 backgroundColor</span></span><br><span class="line">          <span class="comment">// 如果未找到，则从css样式获取 computedStyle.getPropertyValue(property)</span></span><br><span class="line">          <span class="comment">// （重要）注释：elem.style 只能获取元素设置的内联样式、不能获取css样式；而 getComputedStyle 可获取内联、css样式。</span></span><br><span class="line">          <span class="keyword">return</span> (</span><br><span class="line">            element.style[camelize(property)] ||</span><br><span class="line">            computedStyle.getPropertyValue(property)</span><br><span class="line">          );</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (isArray(property)) &#123;</span><br><span class="line">          <span class="comment">// 情况2，参数为数组形式（注意，此时 isObject 情况尚未判断）</span></span><br><span class="line">          <span class="keyword">var</span> props = &#123;&#125;;</span><br><span class="line">          $.each(property, <span class="function"><span class="keyword">function</span>(<span class="params">_, prop</span>) </span>&#123;</span><br><span class="line">            props[prop] =</span><br><span class="line">              element.style[camelize(prop)] ||</span><br><span class="line">              computedStyle.getPropertyValue(prop);</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="keyword">return</span> props; <span class="comment">// 返回一个对象</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 其他情况：有两个参数、property是对象</span></span><br><span class="line">      <span class="keyword">var</span> css = <span class="string">""</span>;</span><br><span class="line">      <span class="keyword">if</span> (type(property) == <span class="string">"string"</span>) &#123;</span><br><span class="line">        <span class="comment">// 情况1，property 是字符串，设置单个样式</span></span><br><span class="line">        <span class="keyword">if</span> (!value &amp;&amp; value !== <span class="number">0</span>)</span><br><span class="line">          <span class="comment">// 如果value参数是 '' null undefined 则移除这个css样式</span></span><br><span class="line">          <span class="comment">// 注：此计算只适用于内联样式的删除，对 css 样式无效，因为它只通过 this.style.removeProperty 计算，而 this.style 获取不到css样式</span></span><br><span class="line">          <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.style.removeProperty(dasherize(property));</span><br><span class="line">          &#125;);</span><br><span class="line">        <span class="comment">// value有正常值，将 css 生成一个字符串（如 'font-size:20px'）等待赋值给内联样式</span></span><br><span class="line">        <span class="comment">// maybeAddPx(property, value) 需要增加 px 的增加上</span></span><br><span class="line">        <span class="keyword">else</span> css = dasherize(property) + <span class="string">":"</span> + maybeAddPx(property, value);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 情况2，property 是对象（此时就不管第二个参数是什么了，不用第二个参数），一次性设置多个样式</span></span><br><span class="line">        <span class="keyword">for</span> (key <span class="keyword">in</span> property)</span><br><span class="line">          <span class="keyword">if</span> (!property[key] &amp;&amp; property[key] !== <span class="number">0</span>)</span><br><span class="line">            <span class="comment">// 如果对象属性值是 '' null undefined 则移除这个css样式，同理，只针对内联样式</span></span><br><span class="line">            <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="keyword">this</span>.style.removeProperty(dasherize(key));</span><br><span class="line">            &#125;);</span><br><span class="line">          <span class="comment">// 否则，给 css 赋值一个字符串，多样式属性用 ; 隔开</span></span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            css += dasherize(key) + <span class="string">":"</span> + maybeAddPx(key, property[key]) + <span class="string">";"</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 针对每个元素，设置内联样式（this.style.cssText可获取、设置内联样式）</span></span><br><span class="line">      <span class="comment">// 最后返回自身</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.style.cssText += <span class="string">";"</span> + css;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        上文定义：</span></span><br><span class="line"><span class="comment">        // 将 lineHeight 转换为 line-height 格式</span></span><br><span class="line"><span class="comment">        function dasherize(str) &#123;</span></span><br><span class="line"><span class="comment">          return str.replace(/::/g, '/')</span></span><br><span class="line"><span class="comment">                    .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')</span></span><br><span class="line"><span class="comment">                    .replace(/([a-z\d])([A-Z])/g, '$1_$2')</span></span><br><span class="line"><span class="comment">                    .replace(/_/g, '-')</span></span><br><span class="line"><span class="comment">                    .toLowerCase()</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 获取一个元素的索引值（从0开始计数）。当elemen参数没有给出时，返回当前元素在兄弟节点中的位置</span></span><br><span class="line">    index: <span class="function"><span class="keyword">function</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        上文定义：</span></span><br><span class="line"><span class="comment">        $.fn.indexOf: emptyArray.indexOf</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 其实 this 本身就是一个数组，数组本身就有 indexOf ，为何还要上文的这个赋值呢？</span></span><br><span class="line">      <span class="comment">// 因为上文中，this.__proto__ 修改了，不是 Array.prototype 了，也就没有 indexOf 方法了</span></span><br><span class="line">      <span class="comment">// 因此要手动赋值，需要将数组常用的方法在重新赋值给 $.fn.indexOf</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> element</span><br><span class="line">        ? <span class="keyword">this</span>.indexOf($(element)[<span class="number">0</span>])</span><br><span class="line">        : <span class="keyword">this</span>.parent()</span><br><span class="line">            .children()</span><br><span class="line">            .indexOf(<span class="keyword">this</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;,</span><br><span class="line">    hasClass: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">return</span> emptyArray.some.call(</span><br><span class="line">        <span class="keyword">this</span>,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// this 就是 classRE(name) 的返回值（返回一个正则）</span></span><br><span class="line">          <span class="comment">// function className(node, value)&#123;...&#125; 获取或者设置elem的className</span></span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">this</span>.test(className(el));</span><br><span class="line">        &#125;,</span><br><span class="line">        classRE(name)</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">// array.some(callback,[ thisObject]); 只要数组中一项符合callback要求，即返回true</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        // 上文定义 classCache = &#123;&#125;</span></span><br><span class="line"><span class="comment">        function classRE(name) &#123;</span></span><br><span class="line"><span class="comment">          return name in classCache ?</span></span><br><span class="line"><span class="comment">                 classCache[name] : </span></span><br><span class="line"><span class="comment">                 (classCache[name] = new RegExp('(^|\\s)' + name + '(\\s|$)'))</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">          // classCache 存储的数据是这样的：</span></span><br><span class="line"><span class="comment">          // &#123;</span></span><br><span class="line"><span class="comment">          //   abc: /(^|\s)abc(\s|$)/,  // 能匹配 'abc' 或 ' abc ' 或 ' abc' 或 'abc '</span></span><br><span class="line"><span class="comment">          //   xyz: /(^|\s)abc(\s|$)/,</span></span><br><span class="line"><span class="comment">          //   ...</span></span><br><span class="line"><span class="comment">          // &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    addClass: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 针对所有元素都添加className，最终返回本身</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 说明当前元素不是 DOM node</span></span><br><span class="line">        <span class="keyword">if</span> (!(<span class="string">"className"</span> <span class="keyword">in</span> <span class="keyword">this</span>)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// classList 是一开始就定义的空变量</span></span><br><span class="line">        classList = [];</span><br><span class="line">        <span class="comment">// 获取元素的 clasname      // 支持传入函数</span></span><br><span class="line">        <span class="keyword">var</span> cls = className(<span class="keyword">this</span>),</span><br><span class="line">          newName = funcArg(<span class="keyword">this</span>, name, idx, cls);</span><br><span class="line">        <span class="comment">// 把要赋值的值，按照空白分组，遍历</span></span><br><span class="line">        newName.split(<span class="regexp">/\s+/g</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">klass</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 把当前元素不存在的class，push到classlist中</span></span><br><span class="line">          <span class="keyword">if</span> (!$(<span class="keyword">this</span>).hasClass(klass)) classList.push(klass);</span><br><span class="line">        &#125;, <span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// 如果classlist有数据，则为当前元素赋值最新的class值（现有的classname和新的classname拼接）</span></span><br><span class="line">        classList.length &amp;&amp;</span><br><span class="line">          className(<span class="keyword">this</span>, cls + (cls ? <span class="string">" "</span> : <span class="string">""</span>) + classList.join(<span class="string">" "</span>));</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    removeClass: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 针对所有元素都移除className，最终返回本身</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 说明当前元素不是 DOM node</span></span><br><span class="line">        <span class="keyword">if</span> (!(<span class="string">"className"</span> <span class="keyword">in</span> <span class="keyword">this</span>)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果参数空，则移除元素的所有class</span></span><br><span class="line">        <span class="keyword">if</span> (name === <span class="literal">undefined</span>) <span class="keyword">return</span> className(<span class="keyword">this</span>, <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取现有的classname</span></span><br><span class="line">        classList = className(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// （可以传入函数）遍历新的classname字符串</span></span><br><span class="line">        funcArg(<span class="keyword">this</span>, name, idx, classList)</span><br><span class="line">          .split(<span class="regexp">/\s+/g</span>)</span><br><span class="line">          .forEach(<span class="function"><span class="keyword">function</span>(<span class="params">klass</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// classRE(klass) 返回一个正则，匹配 'classname' 或 ' classname ' 或 ' classname' 或 'classname '</span></span><br><span class="line">            <span class="comment">// 针对传入的classname字符串，对每个符合条件的classname，都替换为 ' '（即删除了）</span></span><br><span class="line">            classList = classList.replace(classRE(klass), <span class="string">" "</span>);</span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对整理好的classname，重新赋值给当前元素</span></span><br><span class="line">        className(<span class="keyword">this</span>, classList.trim());</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    toggleClass: <span class="function"><span class="keyword">function</span>(<span class="params">name, when</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// when 参数相当于一个条件：</span></span><br><span class="line">      <span class="comment">// 如果 when === true 则单纯执行 addClass</span></span><br><span class="line">      <span class="comment">// 如果 when === false 则单纯执行 removeClass</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//                   name 可接收函数，可以是空白分割开来的多个classname</span></span><br><span class="line">        <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),</span><br><span class="line">          names = funcArg(<span class="keyword">this</span>, name, idx, className(<span class="keyword">this</span>));</span><br><span class="line">        <span class="comment">// 用空白分割开多个class</span></span><br><span class="line">        names.split(<span class="regexp">/\s+/g</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">klass</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 如果有 when 参数，则只通过when参数判断，true则只执行addClass，false则只执行removeClass</span></span><br><span class="line">          <span class="comment">// 如果没有 when 参数，则判断元素有没有该class，有则移除，没有则添加</span></span><br><span class="line">          (when === <span class="literal">undefined</span></span><br><span class="line">          ? !$<span class="keyword">this</span>.hasClass(klass)</span><br><span class="line">          : when)</span><br><span class="line">            ? $<span class="keyword">this</span>.addClass(klass)</span><br><span class="line">            : $<span class="keyword">this</span>.removeClass(klass);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    scrollTop: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 普通elem有 scrollTop 属性，可以获取或者设置top值</span></span><br><span class="line">      <span class="comment">// window对象没有 scrollTop 属性，通过 pageYOffset 获取，通过 scrollTo() 赋值</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> hasScrollTop = <span class="string">"scrollTop"</span> <span class="keyword">in</span> <span class="keyword">this</span>[<span class="number">0</span>];</span><br><span class="line">      <span class="comment">// value 无值，获取 top</span></span><br><span class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>)</span><br><span class="line">        <span class="keyword">return</span> hasScrollTop ? <span class="keyword">this</span>[<span class="number">0</span>].scrollTop : <span class="keyword">this</span>[<span class="number">0</span>].pageYOffset;</span><br><span class="line">      <span class="comment">// value 有值，设置 top</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(</span><br><span class="line">        hasScrollTop</span><br><span class="line">          ? <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="keyword">this</span>.scrollTop = value;</span><br><span class="line">            &#125;</span><br><span class="line">          : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="keyword">this</span>.scrollTo(<span class="keyword">this</span>.scrollX, value);</span><br><span class="line">            &#125;</span><br><span class="line">      ); <span class="comment">// window.scrollX 获取横向滚动值</span></span><br><span class="line">    &#125;,</span><br><span class="line">    scrollLeft: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">var</span> hasScrollLeft = <span class="string">"scrollLeft"</span> <span class="keyword">in</span> <span class="keyword">this</span>[<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>)</span><br><span class="line">        <span class="keyword">return</span> hasScrollLeft ? <span class="keyword">this</span>[<span class="number">0</span>].scrollLeft : <span class="keyword">this</span>[<span class="number">0</span>].pageXOffset;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(</span><br><span class="line">        hasScrollLeft</span><br><span class="line">          ? <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="keyword">this</span>.scrollLeft = value;</span><br><span class="line">            &#125;</span><br><span class="line">          : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="keyword">this</span>.scrollTo(value, <span class="keyword">this</span>.scrollY);</span><br><span class="line">            &#125;</span><br><span class="line">      ); <span class="comment">// window.scrollX 获取纵向滚动值</span></span><br><span class="line">    &#125;,</span><br><span class="line">    position: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> elem = <span class="keyword">this</span>[<span class="number">0</span>],</span><br><span class="line">        <span class="comment">// Get *real* offsetParent</span></span><br><span class="line">        offsetParent = <span class="keyword">this</span>.offsetParent(), <span class="comment">// 找到第一个定位过的祖先元素 “relative”, “absolute” or “fixed”</span></span><br><span class="line">        <span class="comment">// Get correct offsets</span></span><br><span class="line">        offset = <span class="keyword">this</span>.offset(), <span class="comment">// 获取自身的offset</span></span><br><span class="line">        parentOffset = rootNodeRE.test(offsetParent[<span class="number">0</span>].nodeName)</span><br><span class="line">          ? &#123; <span class="attr">top</span>: <span class="number">0</span>, <span class="attr">left</span>: <span class="number">0</span> &#125;</span><br><span class="line">          : offsetParent.offset(); <span class="comment">// 获取定位祖先元素的offset（ body、html直接设置 top:0;left:0 ）</span></span><br><span class="line">      <span class="comment">// 上文定义： rootNodeRE = /^(?:body|html)$/i,</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 去掉当前元素的 margin 宽度</span></span><br><span class="line">      <span class="comment">// Subtract element margins</span></span><br><span class="line">      <span class="comment">// note: when an element has margin: auto the offsetLeft and marginLeft</span></span><br><span class="line">      <span class="comment">// are the same in Safari causing offset.left to incorrectly be 0</span></span><br><span class="line">      offset.top -= <span class="built_in">parseFloat</span>($(elem).css(<span class="string">"margin-top"</span>)) || <span class="number">0</span>;</span><br><span class="line">      offset.left -= <span class="built_in">parseFloat</span>($(elem).css(<span class="string">"margin-left"</span>)) || <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 增加父元素的 border 宽度</span></span><br><span class="line">      <span class="comment">// Add offsetParent borders</span></span><br><span class="line">      parentOffset.top +=</span><br><span class="line">        <span class="built_in">parseFloat</span>($(offsetParent[<span class="number">0</span>]).css(<span class="string">"border-top-width"</span>)) || <span class="number">0</span>;</span><br><span class="line">      parentOffset.left +=</span><br><span class="line">        <span class="built_in">parseFloat</span>($(offsetParent[<span class="number">0</span>]).css(<span class="string">"border-left-width"</span>)) || <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Subtract the two offsets</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        top: offset.top - parentOffset.top,</span><br><span class="line">        left: offset.left - parentOffset.left</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    offsetParent: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 通过 this.map 遍历当前对象所有元素，进行计算，然后拼接新的数组，并返回。保证链式操作</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> parent = <span class="keyword">this</span>.offsetParent || <span class="built_in">document</span>.body; <span class="comment">// elem.offsetParent 可返回最近的改元素最近的已经定位的父元素</span></span><br><span class="line">        <span class="keyword">while</span> (</span><br><span class="line">          parent &amp;&amp;</span><br><span class="line">          !rootNodeRE.test(parent.nodeName) &amp;&amp;</span><br><span class="line">          $(parent).css(<span class="string">"position"</span>) == <span class="string">"static"</span></span><br><span class="line">        )</span><br><span class="line">          <span class="comment">// 如果获取的parent不是null、不是body或html、而且position==static</span></span><br><span class="line">          <span class="comment">// 则继续向上查找 offsetParent、大不了找到 body 为止</span></span><br><span class="line">          parent = parent.offsetParent;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 最后返回改元素</span></span><br><span class="line">        <span class="keyword">return</span> parent;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for now</span></span><br><span class="line">  $.fn.detach = $.fn.remove;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Generate the `width` and `height` functions</span></span><br><span class="line">  [<span class="string">"width"</span>, <span class="string">"height"</span>].forEach(<span class="function"><span class="keyword">function</span>(<span class="params">dimension</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 将 width height 变为  Width Height</span></span><br><span class="line">    <span class="keyword">var</span> dimensionProperty = dimension.replace(<span class="regexp">/./</span>, <span class="function"><span class="keyword">function</span>(<span class="params">m</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> m[<span class="number">0</span>].toUpperCase();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    $.fn[dimension] = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> offset,</span><br><span class="line">        el = <span class="keyword">this</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 情况1，无参数，获取第一个元素的值</span></span><br><span class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>)</span><br><span class="line">        <span class="keyword">return</span> isWindow(el)</span><br><span class="line">          ? el[<span class="string">"inner"</span> + dimensionProperty] <span class="comment">// window.innerHeight</span></span><br><span class="line">          : isDocument(el)</span><br><span class="line">          ? el.documentElement[<span class="string">"scroll"</span> + dimensionProperty] <span class="comment">// document.documentElement.scrollHeight</span></span><br><span class="line">          : (offset = <span class="keyword">this</span>.offset()) &amp;&amp; offset[dimension];</span><br><span class="line">      <span class="comment">// this.offset().width</span></span><br><span class="line">      <span class="comment">// 情况2，有参数，设置所有元素的值</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">          el = $(<span class="keyword">this</span>);</span><br><span class="line">          <span class="comment">// 通过 css() 方法设置，支持传入函数</span></span><br><span class="line">          el.css(dimension, funcArg(<span class="keyword">this</span>, value, idx, el[dimension]()));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 针对当前元素、遍历子元素，都执行 fun 函数</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">traverseNode</span>(<span class="params">node, fun</span>) </span>&#123;</span><br><span class="line">    fun(node);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = node.childNodes.length; i &lt; len; i++)</span><br><span class="line">      traverseNode(node.childNodes[i], fun);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 上文定义 adjacencyOperators = [ 'after', 'prepend', 'before', 'append' ],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Generate the `after`, `prepend`, `before`, `append`,</span></span><br><span class="line">  <span class="comment">// `insertAfter`, `insertBefore`, `appendTo`, and `prependTo` methods.</span></span><br><span class="line">  adjacencyOperators.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">operator, operatorIndex</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> inside = operatorIndex % <span class="number">2</span>; <span class="comment">//=&gt; prepend, append</span></span><br><span class="line"></span><br><span class="line">    $.fn[operator] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// arguments can be nodes, arrays of nodes, Zepto objects and HTML strings</span></span><br><span class="line">      <span class="keyword">var</span> argType,</span><br><span class="line">        nodes = $.map(<span class="built_in">arguments</span>, <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">          argType = type(arg);</span><br><span class="line">          <span class="keyword">return</span> argType == <span class="string">"object"</span> || argType == <span class="string">"array"</span> || arg == <span class="literal">null</span></span><br><span class="line">            ? arg</span><br><span class="line">            : zepto.fragment(arg);</span><br><span class="line">        &#125;),</span><br><span class="line">        parent,</span><br><span class="line">        copyByClone = <span class="keyword">this</span>.length &gt; <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> (nodes.length &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">_, target</span>) </span>&#123;</span><br><span class="line">        parent = inside ? target : target.parentNode;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// convert all methods to a "before" operation</span></span><br><span class="line">        target =</span><br><span class="line">          operatorIndex == <span class="number">0</span></span><br><span class="line">            ? target.nextSibling</span><br><span class="line">            : operatorIndex == <span class="number">1</span></span><br><span class="line">            ? target.firstChild</span><br><span class="line">            : operatorIndex == <span class="number">2</span></span><br><span class="line">            ? target</span><br><span class="line">            : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> parentInDocument = $.contains(<span class="built_in">document</span>.documentElement, parent);</span><br><span class="line"></span><br><span class="line">        nodes.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (copyByClone) node = node.cloneNode(<span class="literal">true</span>);</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (!parent) <span class="keyword">return</span> $(node).remove();</span><br><span class="line"></span><br><span class="line">          parent.insertBefore(node, target);</span><br><span class="line">          <span class="keyword">if</span> (parentInDocument)</span><br><span class="line">            traverseNode(node, <span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">              <span class="keyword">if</span> (</span><br><span class="line">                el.nodeName != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">                el.nodeName.toUpperCase() === <span class="string">"SCRIPT"</span> &amp;&amp;</span><br><span class="line">                (!el.type || el.type === <span class="string">"text/javascript"</span>) &amp;&amp;</span><br><span class="line">                !el.src</span><br><span class="line">              )</span><br><span class="line">                <span class="built_in">window</span>[<span class="string">"eval"</span>].call(<span class="built_in">window</span>, el.innerHTML);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// after    =&gt; insertAfter</span></span><br><span class="line">    <span class="comment">// prepend  =&gt; prependTo</span></span><br><span class="line">    <span class="comment">// before   =&gt; insertBefore</span></span><br><span class="line">    <span class="comment">// append   =&gt; appendTo</span></span><br><span class="line">    $.fn[</span><br><span class="line">      inside ? operator + <span class="string">"To"</span> : <span class="string">"insert"</span> + (operatorIndex ? <span class="string">"Before"</span> : <span class="string">"After"</span>)</span><br><span class="line">    ] = <span class="function"><span class="keyword">function</span>(<span class="params">html</span>) </span>&#123;</span><br><span class="line">      $(html)[operator](<span class="keyword">this</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  zepto.Z.prototype = $.fn;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Export internal API functions in the `$.zepto` namespace</span></span><br><span class="line">  zepto.uniq = uniq;</span><br><span class="line">  zepto.deserializeValue = deserializeValue;</span><br><span class="line">  $.zepto = zepto;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> $;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.Zepto = Zepto;</span><br><span class="line"><span class="built_in">window</span>.$ === <span class="literal">undefined</span> &amp;&amp; (<span class="built_in">window</span>.$ = Zepto);</span><br></pre></td></tr></table></figure>

        </div>
        
          


  <section class='meta' id="footer-meta">
    <hr>
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-03-16T12:05:11+08:00">
  <a class='notlink'>
    <i class="fas fa-clock" aria-hidden="true"></i>
    <p>最后更新于 2020年3月16日</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/zepto/" rel="nofollow"><i class="fas fa-hashtag" aria-hidden="true"></i>&nbsp;<p>zepto</p></a></div>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="QQ好友" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=http://yangtao.site/2020/03/13/zepto-v1.6.6/&title=Zepto-core-1.1.6 源码注释【转载】 | 大涛子&summary=
原文：zepto-core-1.1.6 源码注释
"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="QQ空间" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://yangtao.site/2020/03/13/zepto-v1.6.6/&title=Zepto-core-1.1.6 源码注释【转载】 | 大涛子&summary=
原文：zepto-core-1.1.6 源码注释
"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="微博" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=http://yangtao.site/2020/03/13/zepto-v1.6.6/&title=Zepto-core-1.1.6 源码注释【转载】 | 大涛子&summary=
原文：zepto-core-1.1.6 源码注释
"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/weibo.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


        
        
            <div class="prev-next">
                
                    <section class="prev">
                        <span class="art-item-left">
                            <h6><i class="fas fa-chevron-left" aria-hidden="true"></i>&nbsp;上一页</h6>
                            <h4>
                                <a href="/2020/03/14/gulp-v4/" rel="prev" title="Gulp 自动化构建">
                                  
                                      Gulp 自动化构建
                                  
                                </a>
                            </h4>
                            
                                
                                <h6 class="tags">
                                    <a class="tag" href="/tags/gulp/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>gulp</a>
                                </h6>
                            
                        </span>
                    </section>
                
                
                    <section class="next">
                        <span class="art-item-right" aria-hidden="true">
                            <h6>下一页&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i></h6>
                            <h4>
                                <a href="/2020/03/12/zepto/" rel="prev" title="Zepto 对象思想与源码分析">
                                    
                                        Zepto 对象思想与源码分析
                                    
                                </a>
                            </h4>
                            
                                
                                <h6 class="tags">
                                    <a class="tag" href="/tags/zepto/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>zepto</a>
                                </h6>
                            
                        </span>
                    </section>
                
            </div>
        
      </section>
    </article>
  

  
    <!-- 显示推荐文章和评论 -->



  <article class="post white-box comments">
    <section class="article typo">
      <h4><i class="fas fa-comments fa-fw" aria-hidden="true"></i>&nbsp;评论</h4>
      
      
      
      
        <section id="comments">
          <div id="valine_container" class="valine_thread">
            <i class="fas fa-spinner fa-spin fa-fw"></i>
          </div>
        </section>
      
    </section>
  </article>


  




<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: 'Zepto-core-1.1.6 源码注释【转载】',
      tools: true
    }
  </script>


</div>
<aside class='l_side'>
  

</aside>

<footer id="footer" class="clearfix">
  
  
    <div class="social-wrapper">
      
        
          <a href="https://ae01.alicdn.com/kf/Hd6aab0894803450395b643181cafabc9J.jpg"
            class="social fab fa-weixin flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="mailto:istaotao@aliyun.com"
            class="social fas fa-envelope flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://github.com/yangtao2o"
            class="social fab fa-github flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="http://www.linkedin.com/in/%E6%B6%9B-%E6%9D%A8-06a70212b/"
            class="social fab fa-linkedin flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="http://weibo.com/taoboy0208"
            class="social fab fa-weibo flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://music.163.com/#/user/home?id=282751852"
            class="social fas fa-headphones-alt flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
    </div>
  
  <br>
  <div><p><a href="http://www.beian.miit.gov.cn/">苏ICP备19070147号-1</a></p>
</div>
  <div>
    本站使用
    <a href="https://xaoxuu.com/wiki/material-x/" target="_blank" class="codename">Material X</a>
    作为主题
    
      ，
      总访问量为
      <span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
      次
    
    。
  </div>
</footer>
<script>setLoadingBarProgress(80);</script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>

  <script>
    var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
    var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
    var ALGOLIA_API_KEY = "";
    var ALGOLIA_APP_ID = "";
    var ALGOLIA_INDEX_NAME = "";
    var AZURE_SERVICE_NAME = "";
    var AZURE_INDEX_NAME = "";
    var AZURE_QUERY_KEY = "";
    var BAIDU_API_ID = "";
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/"||"/";
    if(!ROOT.endsWith('/'))ROOT += '/';
  </script>

<script src="//instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script>


  <script async src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.5/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      const $reveal = $('.reveal');
      if ($reveal.length === 0) return;
      const sr = ScrollReveal({ distance: 0 });
      sr.reveal('.reveal');
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>
  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>












  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
    
      <script src="/js/volantis.js"></script>
    
  
  <script>
  var GUEST_INFO = ['nick','mail','link'];
  var guest_info = 'nick,mail,link'.split(',').filter(function(item){
    return GUEST_INFO.indexOf(item) > -1
  });
  var notify = 'false' == true;
  var verify = 'false' == true;
  var valine = new Valine();
  valine.init({
    el: '#valine_container',
    notify: notify,
    verify: verify,
    guest_info: guest_info,
    
    appId: "BXbRzdRWKuKAzooJu0Gin1mO-gzGzoHsz",
    appKey: "WEzG2CMtkcbmqrmqMkgIGIRL",
    placeholder: "请留下你的足迹吧~",
    pageSize:'10',
    avatar:'monsterid',
    lang:'zh-cn',
    highlight:'false'
  })
  </script>



  <script src="/js/app.js"></script>


  <script src="/js/search.js"></script>




<!-- 复制 -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  let COPY_SUCCESS = "复制成功";
  let COPY_FAILURE = "复制失败";
  /*页面载入完成后，创建复制按钮*/
  !function (e, t, a) {
    /* code */
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '  <i class="fa fa-copy"></i><span>复制</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });

      clipboard.on('success', function(e) {
        //您可以加入成功提示
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
        success_prompt(COPY_SUCCESS);
        e.clearSelection();
      });
      clipboard.on('error', function(e) {
        //您可以加入失败提示
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
        fail_prompt(COPY_FAILURE);
      });
    }
    initCopyCode();

  }(window, document);

  /**
   * 弹出式提示框，默认1.5秒自动消失
   * @param message 提示信息
   * @param style 提示样式，有alert-success、alert-danger、alert-warning、alert-info
   * @param time 消失时间
   */
  var prompt = function (message, style, time)
  {
      style = (style === undefined) ? 'alert-success' : style;
      time = (time === undefined) ? 1500 : time*1000;
      $('<div>')
          .appendTo('body')
          .addClass('alert ' + style)
          .html(message)
          .show()
          .delay(time)
          .fadeOut();
  };

  // 成功提示
  var success_prompt = function(message, time)
  {
      prompt(message, 'alert-success', time);
  };

  // 失败提示
  var fail_prompt = function(message, time)
  {
      prompt(message, 'alert-danger', time);
  };

  // 提醒
  var warning_prompt = function(message, time)
  {
      prompt(message, 'alert-warning', time);
  };

  // 信息提示
  var info_prompt = function(message, time)
  {
      prompt(message, 'alert-info', time);
  };

</script>


<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>





  <script>setLoadingBarProgress(100);</script>
</body>
</html>
